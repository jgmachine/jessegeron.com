require({cache:{"dijit/Dialog":function(){define(["require","dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/Deferred","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/fx","dojo/i18n","dojo/keys","dojo/_base/lang","dojo/on","dojo/ready","dojo/sniff","dojo/touch","dojo/window","dojo/dnd/Moveable","dojo/dnd/TimedMoveable","./focus","./_base/manager","./_Widget","./_TemplatedMixin","./_CssStateMixin","./form/_FormMixin","./_DialogMixin","./DialogUnderlay","./layout/ContentPane","./layout/utils","dojo/text!./templates/Dialog.html","./a11yclick","dojo/i18n!./nls/common"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g,f,b,y,v,w,x,k,C,T,j,S,$,M,A){var E=new n;E.resolve(!0);function N(){}var L=a("dijit._DialogBase"+(m("dojo-bidi")?"_NoBidi":""),[k,T,j,C],{templateString:A,baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},_setTitleAttr:{node:"titleNode",type:"innerHTML"},open:!1,duration:w.defaultDuration,refocus:!0,autofocus:!0,_firstFocusItem:null,_lastFocusItem:null,draggable:!0,_setDraggableAttr:function(e){this._set("draggable",e)},maxRatio:.9,closable:!0,_setClosableAttr:function(e){this.closeButtonNode.style.display=e?"":"none";this._set("closable",e)},postMixInProperties:function(){var e=c.getLocalization("dijit","common");h.mixin(this,e);this.inherited(arguments)},postCreate:function(){l.set(this.domNode,{display:"none",position:"absolute"});this.ownerDocumentBody.appendChild(this.domNode);this.inherited(arguments);i.after(this,"onExecute",h.hitch(this,"hide"),!0);i.after(this,"onCancel",h.hitch(this,"hide"),!0);p(this.closeButtonNode,g.press,function(e){e.stopPropagation()});this._modalconnects=[]},onLoad:function(){this.resize();this._position();if(this.autofocus&&P.isTop(this)){this._getFocusItems();v.focus(this._firstFocusItem)}this.inherited(arguments)},focus:function(){this._getFocusItems();v.focus(this._firstFocusItem)},_endDrag:function(){var e=r.position(this.domNode),t=f.getBox(this.ownerDocument);e.y=Math.min(Math.max(e.y,0),t.h-e.h);e.x=Math.min(Math.max(e.x,0),t.w-e.w);this._relativePosition=e;this._position()},_setup:function(){var e=this.domNode;if(this.titleBar&&this.draggable){this._moveable=new(6==m("ie")?y:b)(e,{handle:this.titleBar});i.after(this._moveable,"onMoveStop",h.hitch(this,"_endDrag"),!0)}else s.add(e,"dijitDialogFixed");this.underlayAttrs={dialogId:this.id,class:t.map(this.class.split(/\s/),function(e){return e+"_underlay"}).join(" "),_onKeyDown:h.hitch(this,"_onKey"),ownerDocument:this.ownerDocument}},_size:function(){this.resize()},_position:function(){if(!s.contains(this.ownerDocumentBody,"dojoMove")){var e=this.domNode,t=f.getBox(this.ownerDocument),i=this._relativePosition,a=r.position(e),n=Math.floor(t.l+(i?Math.min(i.x,t.w-a.w):(t.w-a.w)/2)),o=Math.floor(t.t+(i?Math.min(i.y,t.h-a.h):(t.h-a.h)/2));l.set(e,{left:n+"px",top:o+"px"})}},_onKey:function(e){if(e.keyCode==u.TAB){this._getFocusItems();var t=e.target;if(this._firstFocusItem==this._lastFocusItem){e.stopPropagation();e.preventDefault()}else if(t==this._firstFocusItem&&e.shiftKey){v.focus(this._lastFocusItem);e.stopPropagation();e.preventDefault()}else if(t==this._lastFocusItem&&!e.shiftKey){v.focus(this._firstFocusItem);e.stopPropagation();e.preventDefault()}}else if(this.closable&&e.keyCode==u.ESCAPE){this.onCancel();e.stopPropagation();e.preventDefault()}},show:function(){if(this.open)return E.promise;this._started||this.startup();if(!this._alreadyInitialized){this._setup();this._alreadyInitialized=!0}if(this._fadeOutDeferred){this._fadeOutDeferred.cancel();P.hide(this)}var e,t=f.get(this.ownerDocument);this._modalconnects.push(p(t,"scroll",h.hitch(this,"resize",null)));this._modalconnects.push(p(this.domNode,"keydown",h.hitch(this,"_onKey")));l.set(this.domNode,{opacity:0,display:""});this._set("open",!0);this._onShow();this.resize();this._position();this._fadeInDeferred=new n(h.hitch(this,function(){e.stop();delete this._fadeInDeferred}));this._fadeInDeferred.then(void 0,N);var i=this._fadeInDeferred.promise;e=d.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:h.hitch(this,function(){P.show(this,this.underlayAttrs)}),onEnd:h.hitch(this,function(){if(this.autofocus&&P.isTop(this)){this._getFocusItems();v.focus(this._firstFocusItem)}this._fadeInDeferred.resolve(!0);delete this._fadeInDeferred})}).play();return i},hide:function(){if(!this._alreadyInitialized||!this.open)return E.promise;this._fadeInDeferred&&this._fadeInDeferred.cancel();var e;this._fadeOutDeferred=new n(h.hitch(this,function(){e.stop();delete this._fadeOutDeferred}));this._fadeOutDeferred.then(void 0,N);this._fadeOutDeferred.then(h.hitch(this,"onHide"));var t,i=this._fadeOutDeferred.promise;e=d.fadeOut({node:this.domNode,duration:this.duration,onEnd:h.hitch(this,function(){this.domNode.style.display="none";P.hide(this);this._fadeOutDeferred.resolve(!0);delete this._fadeOutDeferred})}).play();this._scrollConnected&&(this._scrollConnected=!1);for(;t=this._modalconnects.pop();)t.remove();this._relativePosition&&delete this._relativePosition;this._set("open",!1);return i},resize:function(e){if("none"!=this.domNode.style.display){this._checkIfSingleChild();if(!e){if(this._shrunk){if(this._singleChild&&void 0!==this._singleChildOriginalStyle){this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle;delete this._singleChildOriginalStyle}t.forEach([this.domNode,this.containerNode,this.titleBar,this.actionBarNode],function(e){e&&l.set(e,{position:"static",width:"auto",height:"auto"})});this.domNode.style.position="absolute"}var i=f.getBox(this.ownerDocument);i.w*=this.maxRatio;i.h*=this.maxRatio;var a=r.position(this.domNode);this._shrunk=!1;if(a.w>=i.w){e={w:i.w};r.setMarginBox(this.domNode,e);a=r.position(this.domNode);this._shrunk=!0}if(a.h>=i.h){e||(e={w:a.w});e.h=i.h;this._shrunk=!0}if(e){e.w||(e.w=a.w);e.h||(e.h=a.h)}}if(e){r.setMarginBox(this.domNode,e);var n=[];this.titleBar&&n.push({domNode:this.titleBar,region:"top"});this.actionBarNode&&n.push({domNode:this.actionBarNode,region:"bottom"});var o={domNode:this.containerNode,region:"center"};n.push(o);var s=M.marginBox2contentBox(this.domNode,e);M.layoutChildren(this.domNode,s,n);if(this._singleChild){var d=M.marginBox2contentBox(this.containerNode,o);this._singleChild.resize({w:d.w,h:d.h})}else{this.containerNode.style.overflow="auto";this._layoutChildren()}}else this._layoutChildren();m("touch")||e||this._position()}},_layoutChildren:function(){t.forEach(this.getChildren(),function(e){e.resize&&e.resize()})},destroy:function(){this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred&&this._fadeOutDeferred.cancel();this._moveable&&this._moveable.destroy();for(var e;e=this._modalconnects.pop();)e.remove();P.hide(this);this.inherited(arguments)}});m("dojo-bidi")&&(L=a("dijit._DialogBase",L,{_setTitleAttr:function(e){this._set("title",e);this.titleNode.innerHTML=e;this.applyTextDir(this.titleNode)},_setTextDirAttr:function(e){if(this._created&&this.textDir!=e){this._set("textDir",e);this.set("title",this.title)}}}));var D=a("dijit.Dialog",[$,L],{});D._DialogBase=L;var P=D._DialogLevelManager={_beginZIndex:950,show:function(e,t){I[I.length-1].focus=v.curNode;var i=I[I.length-1].dialog?I[I.length-1].zIndex+2:D._DialogLevelManager._beginZIndex;l.set(e.domNode,"zIndex",i);S.show(t,i-1);I.push({dialog:e,underlayAttrs:t,zIndex:i})},hide:function(e){if(I[I.length-1].dialog==e){I.pop();var i=I[I.length-1];1==I.length?S.hide():S.show(i.underlayAttrs,i.zIndex-1);if(e.refocus){var a=i.focus;if(i.dialog&&(!a||!o.isDescendant(a,i.dialog.domNode))){i.dialog._getFocusItems();a=i.dialog._firstFocusItem}if(a)try{a.focus()}catch(s){}}}else{var n=t.indexOf(t.map(I,function(e){return e.dialog}),e);-1!=n&&I.splice(n,1)}},isTop:function(e){return I[I.length-1].dialog==e}},I=D._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}];m("dijit-legacy-requires")&&_(0,function(){e(["dijit/TooltipDialog"])});return D})},"dojo/i18n":function(){define(["./_base/kernel","require","./has","./_base/array","./_base/config","./_base/lang","./_base/xhr","./json","module"],function(e,t,i,a,n,o,s,r,l){i.add("dojo-preload-i18n-Api",1);var d=e.i18n={},c=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,u={},h=function(t,i,a){a=a?a.toLowerCase():e.locale;t=t.replace(/\./g,"/");i=i.replace(/\./g,"/");return/root/i.test(a)?t+"/nls/"+i:t+"/nls/"+a+"/"+i},p=e.getL10nName=function(e,t,i){return l.id+"!"+h(e,t,i)},_=function(t,s,l){var d=c.exec(t),h=d[1]+"/",p=d[5]||d[4],_=h+p,m=d[5]&&d[4],g=m||e.locale||"",f=_+"/"+g,b=m?[g]:function(e){var t=n.extraLocale||[];(t=o.isArray(t)?t:[t]).push(e);return t}(g),y=b.length,k=function(){--y||l(o.delegate(u[f]))},C=t.split("*"),T="preload"==C[1];if(i("dojo-preload-i18n-Api")){if(T){if(!u[t]){u[t]=1;v(C[2],r.parse(C[3]),1,s)}l(1)}if(T||w(t,s,l)&&!u[f])return}else if(T){l(1);return}a.forEach(b,function(e){var t=_+"/"+e;i("dojo-preload-i18n-Api")&&x(t);u[t]?k():function(e,t,i,a,n,s){e([t],function(r){var l=void 0===r.root?r:o.clone(r.root||r.ROOT),d=function(e,t,i,a){for(var n=[i+a],o=t.split("-"),s="",r=0;r<o.length;r++){s+=(s?"-":"")+o[r];if(!e||e[s]){n.push(i+s+"/"+a);n.specificity=s}}return n}(!r._v1x&&r,n,i,a);e(d,function(){for(var e=1;e<d.length;e++)l=o.mixin(o.clone(l),arguments[e]);u[t+"/"+n]=l;l.$locale=d.specificity;s()})})}(s,_,h,p,e,k)})};i("dojo-preload-i18n-Api");var m,g=d.normalizeLocale=function(t){var i=t?t.toLowerCase():e.locale;return"root"==i?"ROOT":i},f=function(e,i){return i.isXdUrl(t.toUrl(e+".js"))},b=0,y=[],v=d._preloadLocalizations=function(i,n,s,r){r=r||t;function l(e,t){for(var i=e.split("-");i.length;){if(t(i.join("-")))return;i.pop()}t("ROOT")}function d(){b++}function c(){--b;for(;!b&&y.length;)_.apply(null,y.shift())}function h(e,t,i,a){return a.toAbsMid(e+t+"/"+i)}function p(e){l(e=g(e),function(p){if(a.indexOf(n,p)>=0){var _=i.replace(/\./g,"/")+"_"+p;d();!function(e,t){f(e,r)||s?r([e],t):T([e],t,r)}(_,function(i){for(var a in i){var n,s,_=i[a],m=a.match(/(.+)\/([^\/]+)$/);if(m){n=m[2];s=m[1]+"/";if(_._localized){var g;if("ROOT"===p){var f=g=_._localized;delete _._localized;f.root=_;u[t.toAbsMid(a)]=f}else{g=_._localized;u[h(s,n,p,t)]=_}if(p!==e){function b(i,a,n,s){var p=[],_=[];l(e,function(e){if(s[e]){p.push(t.toAbsMid(i+e+"/"+a));_.push(h(i,a,e,t))}});if(p.length){d();r(p,function(){for(var s=p.length-1;s>=0;s--){n=o.mixin(o.clone(n),arguments[s]);u[_[s]]=n}u[h(i,a,e,t)]=o.clone(n);c()})}else u[h(i,a,e,t)]=n}b(s,n,_,g)}}}}c()});return!0}return!1})}p();a.forEach(e.config.extraLocale,p)},w=function(e,t,i){b&&y.push([e,t,i]);return b},x=function(){},k={},C={},T=function(e,t,i){var n=[];a.forEach(e,function(e){var t=i.toUrl(e+".js");function a(i){m||(m=new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},\t   require = function(){define.called = 1;};try{define.called = 0;eval(__bundle);if(define.called==1)return __amdValue;if((__checkForLegacyModules = __checkForLegacyModules(__mid)))return __checkForLegacyModules;}catch(e){}try{return eval('('+__bundle+')');}catch(e){return e;}"));var a=m(i,x,e,k);if(a===k)n.push(u[t]=k.result);else{if(a instanceof Error){console.error("failed to evaluate i18n bundle; url="+t,a);a={}}n.push(u[t]=/nls\/[^\/]+\/[^\/]+$/.test(t)?a:{root:a,_v1x:1})}}if(u[t])n.push(u[t]);else{var o=i.syncLoadNls(e);o||(o=x(e.replace(/nls\/([^\/]*)\/([^\/]*)$/,"nls/$2/$1")));if(o)n.push(o);else if(s)s.get({url:t,sync:!0,load:a,error:function(){n.push(u[t]={})}});else try{i.getText(t,!0,a)}catch(r){n.push(u[t]={})}}});t&&t.apply(null,n)};x=function(t){for(var i,a=t.split("/"),n=e.global[a[0]],o=1;n&&o<a.length-1;n=n[a[o++]]);if(n){(i=n[a[o]])||(i=n[a[o].replace(/-/g,"_")]);i&&(u[t]=i)}return i};d.getLocalization=function(e,i,a){var n,o=h(e,i,a);if(C[o])return C[o];_(o,f(o,t)?t:function(e,i){T(e,i,t)},function(e){C[o]=e;n=e});return n};return o.mixin(d,{dynamic:!0,normalize:function(e,t){return/^\./.test(e)?t(e):e},load:_,cache:u,getL10nName:p})})},"dojo/touch":function(){define(["./_base/kernel","./aspect","./dom","./dom-class","./_base/lang","./on","./has","./mouse","./domReady","./_base/window"],function(e,t,i,a,n,o,s,r,l,d){var c,u,h,p,_,m,g,f,b,y,v=s("ios")<5,w=s("pointer-events")||s("MSPointer"),x=function(){var e={};for(var t in{down:1,move:1,up:1,cancel:1,over:1,out:1})e[t]=s("MSPointer")?"MSPointer"+t.charAt(0).toUpperCase()+t.slice(1):"pointer"+t;return e}(),k=s("touch-events"),C=!1;function T(e,t,i){return w&&i?function(e,t){return o(e,i,t)}:k?function(i,a){var n=o(i,t,function(e){a.call(this,e);b=(new Date).getTime()}),s=o(i,e,function(e){(!b||(new Date).getTime()>b+1e3)&&a.call(this,e)});return{remove:function(){n.remove();s.remove()}}}:function(t,i){return o(t,e,i)}}function j(e,t,n){if(!r.isRight(e)){var s=function(e){do{if(void 0!==e.dojoClick)return e}while(e=e.parentNode)}(e.target);if(u=!e.target.disabled&&s&&s.dojoClick){h=(C="useTarget"==u)?s:e.target;C&&e.preventDefault();p=e.changedTouches?e.changedTouches[0].pageX-d.global.pageXOffset:e.clientX;_=e.changedTouches?e.changedTouches[0].pageY-d.global.pageYOffset:e.clientY;m=("object"==typeof u?u.x:"number"==typeof u?u:0)||4;g=("object"==typeof u?u.y:"number"==typeof u?u:0)||4;if(!c){c=!0;function l(e){u=C?i.isDescendant(d.doc.elementFromPoint(e.changedTouches?e.changedTouches[0].pageX-d.global.pageXOffset:e.clientX,e.changedTouches?e.changedTouches[0].pageY-d.global.pageYOffset:e.clientY),h):u&&(e.changedTouches?e.changedTouches[0].target:e.target)==h&&Math.abs((e.changedTouches?e.changedTouches[0].pageX-d.global.pageXOffset:e.clientX)-p)<=m&&Math.abs((e.changedTouches?e.changedTouches[0].pageY-d.global.pageYOffset:e.clientY)-_)<=g}d.doc.addEventListener(t,function(e){if(!r.isRight(e)){l(e);C&&e.preventDefault()}},!0);d.doc.addEventListener(n,function(e){if(!r.isRight(e)){l(e);if(u){f=(new Date).getTime();var t=C?h:e.target;"LABEL"===t.tagName&&(t=i.byId(t.getAttribute("for"))||t);var a=e.changedTouches?e.changedTouches[0]:e;function n(t){var i=document.createEvent("MouseEvents");i._dojo_click=!0;i.initMouseEvent(t,!0,!0,e.view,e.detail,a.screenX,a.screenY,a.clientX,a.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null);return i}var s=n("mousedown"),d=n("mouseup"),c=n("click");setTimeout(function(){o.emit(t,"mousedown",s);o.emit(t,"mouseup",d);o.emit(t,"click",c);f=(new Date).getTime()},0)}}},!0);function b(e){d.doc.addEventListener(e,function(t){var i=t.target;if(u&&!t._dojo_click&&(new Date).getTime()<=f+1e3&&("INPUT"!=i.tagName||!a.contains(i,"dijitOffScreen"))){t.stopPropagation();t.stopImmediatePropagation&&t.stopImmediatePropagation();"click"==e&&("INPUT"!=i.tagName||"radio"==i.type&&(a.contains(i,"dijitCheckBoxInput")||a.contains(i,"mblRadioButton"))||"checkbox"==i.type&&(a.contains(i,"dijitCheckBoxInput")||a.contains(i,"mblCheckBox")))&&"TEXTAREA"!=i.tagName&&"AUDIO"!=i.tagName&&"VIDEO"!=i.tagName&&t.preventDefault()}},!0)}b("click");b("mousedown");b("mouseup")}}}}s("touch")&&l(w?function(){d.doc.addEventListener(x.down,function(e){j(e,x.move,x.up)},!0)}:function(){y=d.body();d.doc.addEventListener("touchstart",function(e){b=(new Date).getTime();var t=y;y=e.target;o.emit(t,"dojotouchout",{relatedTarget:y,bubbles:!0});o.emit(y,"dojotouchover",{relatedTarget:t,bubbles:!0});j(e,"touchmove","touchend")},!0);function e(e){var t=n.delegate(e,{bubbles:!0});if(s("ios")>=6){t.touches=e.touches;t.altKey=e.altKey;t.changedTouches=e.changedTouches;t.ctrlKey=e.ctrlKey;t.metaKey=e.metaKey;t.shiftKey=e.shiftKey;t.targetTouches=e.targetTouches}return t}o(d.doc,"touchmove",function(t){b=(new Date).getTime();var i=d.doc.elementFromPoint(t.pageX-(v?0:d.global.pageXOffset),t.pageY-(v?0:d.global.pageYOffset));if(i){if(y!==i){o.emit(y,"dojotouchout",{relatedTarget:i,bubbles:!0});o.emit(i,"dojotouchover",{relatedTarget:y,bubbles:!0});y=i}o.emit(i,"dojotouchmove",e(t))||t.preventDefault()}});o(d.doc,"touchend",function(t){b=(new Date).getTime();var i=d.doc.elementFromPoint(t.pageX-(v?0:d.global.pageXOffset),t.pageY-(v?0:d.global.pageYOffset))||d.body();o.emit(i,"dojotouchend",e(t))})});var S={press:T("mousedown","touchstart",x.down),move:T("mousemove","dojotouchmove",x.move),release:T("mouseup","dojotouchend",x.up),cancel:T(r.leave,"touchcancel",w?x.cancel:null),over:T("mouseover","dojotouchover",x.over),out:T("mouseout","dojotouchout",x.out),enter:r._eventHandler(T("mouseover","dojotouchover",x.over)),leave:r._eventHandler(T("mouseout","dojotouchout",x.out))};e.touch=S;return S})},"dojo/window":function(){define(["./_base/lang","./sniff","./_base/window","./dom","./dom-geometry","./dom-style","./dom-construct"],function(e,t,i,a,n,o,s){t.add("rtl-adjust-position-for-verticalScrollBar",function(e,t){var a=i.body(t),o=s.create("div",{style:{overflow:"scroll",overflowX:"visible",direction:"rtl",visibility:"hidden",position:"absolute",left:"0",top:"0",width:"64px",height:"64px"}},a,"last"),r=s.create("div",{style:{overflow:"hidden",direction:"ltr"}},o,"last"),l=0!=n.position(r).x;o.removeChild(r);a.removeChild(o);return l});t.add("position-fixed-support",function(e,t){var a=i.body(t),o=s.create("span",{style:{visibility:"hidden",position:"fixed",left:"1px",top:"1px"}},a,"last"),r=s.create("span",{style:{position:"fixed",left:"0",top:"0"}},o,"last"),l=n.position(r).x!=n.position(o).x;o.removeChild(r);a.removeChild(o);return l});var r={getBox:function(e){var a,o,s="BackCompat"==(e=e||i.doc).compatMode?i.body(e):e.documentElement,l=n.docScroll(e);if(t("touch")){var d=r.get(e);a=d.innerWidth||s.clientWidth;o=d.innerHeight||s.clientHeight}else{a=s.clientWidth;o=s.clientHeight}return{l:l.x,t:l.y,w:a,h:o}},get:function(e){if(t("ie")&&r!==document.parentWindow){e.parentWindow.execScript("document._parentWindow = window;","Javascript");var i=e._parentWindow;e._parentWindow=null;return i}return e.parentWindow||e.defaultView},scrollIntoView:function(e,s){try{var r=(e=a.byId(e)).ownerDocument||i.doc,l=i.body(r),d=r.documentElement||l.parentNode,c=t("ie")||t("trident"),u=t("webkit");if(e==l||e==d)return;if(!(t("mozilla")||c||u||t("opera")||t("trident")||t("edge"))&&"scrollIntoView"in e){e.scrollIntoView(!1);return}var h="BackCompat"==r.compatMode,p=Math.min(l.clientWidth||d.clientWidth,d.clientWidth||l.clientWidth),_=Math.min(l.clientHeight||d.clientHeight,d.clientHeight||l.clientHeight),m=u||h?l:d,g=s||n.position(e),f=e.parentNode,b=function(e){return!(c<=6||7==c&&h)&&(t("position-fixed-support")&&"fixed"==o.get(e,"position").toLowerCase())},y=this,v=function(e,t,i){if("BODY"==e.tagName||"HTML"==e.tagName)y.get(e.ownerDocument).scrollBy(t,i);else{t&&(e.scrollLeft+=t);i&&(e.scrollTop+=i)}};if(b(e))return;for(;f;){f==l&&(f=m);var w=n.position(f),x=b(f),k="rtl"==o.getComputedStyle(f).direction.toLowerCase();if(f==m){w.w=p;w.h=_;m==d&&(c||t("trident"))&&k&&(w.x+=m.offsetWidth-w.w);w.x=0;w.y=0}else{var C=n.getPadBorderExtents(f);w.w-=C.w;w.h-=C.h;w.x+=C.l;w.y+=C.t;var T=f.clientWidth,j=w.w-T;if(T>0&&j>0){k&&t("rtl-adjust-position-for-verticalScrollBar")&&(w.x+=j);w.w=T}T=f.clientHeight;j=w.h-T;T>0&&j>0&&(w.h=T)}if(x){if(w.y<0){w.h+=w.y;w.y=0}if(w.x<0){w.w+=w.x;w.x=0}w.y+w.h>_&&(w.h=_-w.y);w.x+w.w>p&&(w.w=p-w.x)}var S,$,M=g.x-w.x,A=g.y-w.y,E=M+g.w-w.w,N=A+g.h-w.h;if(E*M>0&&(f.scrollLeft||f==m||f.scrollWidth>f.offsetHeight)){S=Math[M<0?"max":"min"](M,E);k&&(8==c&&!h||t("trident")>=5)&&(S=-S);$=f.scrollLeft;v(f,S,0);S=f.scrollLeft-$;g.x-=S}if(N*A>0&&(f.scrollTop||f==m||f.scrollHeight>f.offsetHeight)){S=Math.ceil(Math[A<0?"max":"min"](A,N));$=f.scrollTop;v(f,0,S);S=f.scrollTop-$;g.y-=S}f=f!=m&&!x&&f.parentNode}}catch(L){console.error("scrollIntoView: "+L);e.scrollIntoView(!1)}}};e.setObject("dojo.window",r);return r})},"dojo/dnd/Moveable":function(){define(["../_base/array","../_base/declare","../_base/lang","../dom","../dom-class","../Evented","../has","../on","../topic","../touch","./common","./Mover","../_base/window"],function(e,t,i,a,n,o,s,r,l,d,c,u,h){var p,_=function(){};s("touch-action")&&(_=function(){"touchAction"in document.body.style?p="touchAction":"msTouchAction"in document.body.style&&(p="msTouchAction");(_=function(e,t){e.style[p]=t})(arguments[0],arguments[1])});return t("dojo.dnd.Moveable",[o],{handle:"",delay:0,skip:!1,constructor:function(e,t){this.node=a.byId(e);_(this.node,"none");t||(t={});this.handle=t.handle?a.byId(t.handle):null;this.handle||(this.handle=this.node);this.delay=t.delay>0?t.delay:0;this.skip=t.skip;this.mover=t.mover?t.mover:u;this.events=[r(this.handle,d.press,i.hitch(this,"onMouseDown")),r(this.handle,"dragstart",i.hitch(this,"onSelectStart")),r(this.handle,"selectstart",i.hitch(this,"onSelectStart"))]},markupFactory:function(e,t,i){return new i(t,e)},destroy:function(){e.forEach(this.events,function(e){e.remove()});_(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(e){if(!this.skip||!c.isFormElement(e)){if(this.delay){this.events.push(r(this.handle,d.move,i.hitch(this,"onMouseMove")),r(this.handle.ownerDocument,d.release,i.hitch(this,"onMouseUp")));this._lastX=e.pageX;this._lastY=e.pageY}else this.onDragDetected(e);e.stopPropagation();e.preventDefault()}},onMouseMove:function(e){if(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay){this.onMouseUp(e);this.onDragDetected(e)}e.stopPropagation();e.preventDefault()},onMouseUp:function(e){for(var t=0;t<2;++t)this.events.pop().remove();e.stopPropagation();e.preventDefault()},onSelectStart:function(e){if(!this.skip||!c.isFormElement(e)){e.stopPropagation();e.preventDefault()}},onDragDetected:function(e){new this.mover(this.node,e,this)},onMoveStart:function(e){l.publish("/dnd/move/start",e);n.add(h.body(),"dojoMove");n.add(this.node,"dojoMoveItem")},onMoveStop:function(e){l.publish("/dnd/move/stop",e);n.remove(h.body(),"dojoMove");n.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(e,t){this.onMoving(e,t);var i=e.node.style;i.left=t.l+"px";i.top=t.t+"px";this.onMoved(e,t)},onMoving:function(){},onMoved:function(){}})})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],function(e,t,i,a){var n=i.getObject("dojo.dnd",!0);n.getCopyKeyState=function(t){return t[e("mac")?"metaKey":"ctrlKey"]};n._uniqueId=0;n.getUniqueId=function(){var e;do{e=t._scopeName+"Unique"+ ++n._uniqueId}while(a.byId(e));return e};n._empty={};n.isFormElement=function(e){var t=e.target;3==t.nodeType&&(t=t.parentNode);return" a button textarea input select option ".indexOf(" "+t.tagName.toLowerCase()+" ")>=0};return n})},"dojo/dnd/Mover":function(){define(["../_base/array","../_base/declare","../_base/lang","../sniff","../_base/window","../dom","../dom-geometry","../dom-style","../Evented","../on","../touch","./common","./autoscroll"],function(e,t,i,a,n,o,s,r,l,d,c,u,h){return t("dojo.dnd.Mover",[l],{constructor:function(e,t,a){this.node=o.byId(e);this.marginBox={l:t.pageX,t:t.pageY};this.mouseButton=t.button;var n=this.host=a,s=e.ownerDocument;function r(e){e.preventDefault();e.stopPropagation()}this.events=[d(s,c.move,i.hitch(this,"onFirstMove")),d(s,c.move,i.hitch(this,"onMouseMove")),d(s,c.release,i.hitch(this,"onMouseUp")),d(s,"dragstart",r),d(s.body,"selectstart",r)];h.autoScrollStart(s);n&&n.onMoveStart&&n.onMoveStart(this)},onMouseMove:function(e){h.autoScroll(e);var t=this.marginBox;this.host.onMove(this,{l:t.l+e.pageX,t:t.t+e.pageY},e);e.preventDefault();e.stopPropagation()},onMouseUp:function(e){(a("webkit")&&a("mac")&&2==this.mouseButton?0==e.button:this.mouseButton==e.button)&&this.destroy();e.preventDefault();e.stopPropagation()},onFirstMove:function(e){var t,i,a=this.node.style,o=this.host;switch(a.position){case"relative":case"absolute":t=Math.round(parseFloat(a.left))||0;i=Math.round(parseFloat(a.top))||0;break;default:a.position="absolute";var l=s.getMarginBox(this.node),d=n.doc.body,c=r.getComputedStyle(d),u=s.getMarginBox(d,c),h=s.getContentBox(d,c);t=l.l-(h.l-u.l);i=l.t-(h.t-u.t)}this.marginBox.l=t-this.marginBox.l;this.marginBox.t=i-this.marginBox.t;o&&o.onFirstMove&&o.onFirstMove(this,e);this.events.shift().remove()},destroy:function(){e.forEach(this.events,function(e){e.remove()});var t=this.host;t&&t.onMoveStop&&t.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojo/dnd/autoscroll":function(){define(["../_base/lang","../sniff","../_base/window","../dom-geometry","../dom-style","../window"],function(e,t,i,a,n,o){var s={};e.setObject("dojo.dnd.autoscroll",s);s.getViewport=o.getBox;s.V_TRIGGER_AUTOSCROLL=32;s.H_TRIGGER_AUTOSCROLL=32;s.V_AUTOSCROLL_VALUE=16;s.H_AUTOSCROLL_VALUE=16;var r,l=i.doc,d=1/0,c=1/0;s.autoScrollStart=function(e){l=e;r=o.getBox(l);var t=i.body(l).parentNode;d=Math.max(t.scrollHeight-r.h,0);c=Math.max(t.scrollWidth-r.w,0)};s.autoScroll=function(e){var t=r||o.getBox(l),a=i.body(l).parentNode,n=0,u=0;e.clientX<s.H_TRIGGER_AUTOSCROLL?n=-s.H_AUTOSCROLL_VALUE:e.clientX>t.w-s.H_TRIGGER_AUTOSCROLL&&(n=Math.min(s.H_AUTOSCROLL_VALUE,c-a.scrollLeft));e.clientY<s.V_TRIGGER_AUTOSCROLL?u=-s.V_AUTOSCROLL_VALUE:e.clientY>t.h-s.V_TRIGGER_AUTOSCROLL&&(u=Math.min(s.V_AUTOSCROLL_VALUE,d-a.scrollTop));window.scrollBy(n,u)};s._validNodes={div:1,p:1,td:1};s._validOverflow={auto:1,scroll:1};s.autoScrollNodes=function(e){for(var o,r,l,d,c,u,h=0,p=0,_=e.target;_;){if(1==_.nodeType&&_.tagName.toLowerCase()in s._validNodes){var m=n.getComputedStyle(_),g=m.overflowX.toLowerCase()in s._validOverflow,f=m.overflowY.toLowerCase()in s._validOverflow;if(g||f){o=a.getContentBox(_,m);r=a.position(_,!0)}if(g){l=Math.min(s.H_TRIGGER_AUTOSCROLL,o.w/2);c=e.pageX-r.x;(t("webkit")||t("opera"))&&(c+=i.body().scrollLeft);h=0;if(c>0&&c<o.w){c<l?h=-l:c>o.w-l&&(h=l);_.scrollLeft;_.scrollLeft=_.scrollLeft+h}}if(f){d=Math.min(s.V_TRIGGER_AUTOSCROLL,o.h/2);u=e.pageY-r.y;(t("webkit")||t("opera"))&&(u+=i.body().scrollTop);p=0;if(u>0&&u<o.h){u<d?p=-d:u>o.h-d&&(p=d);_.scrollTop;_.scrollTop=_.scrollTop+p}}if(h||p)return}try{_=_.parentNode}catch(b){_=null}}s.autoScroll(e)};return s})},"dojo/dnd/TimedMoveable":function(){define(["../_base/declare","./Moveable"],function(e,t){var i=t.prototype.onMove;return e("dojo.dnd.TimedMoveable",t,{timeout:40,constructor:function(e,t){t||(t={});t.timeout&&"number"==typeof t.timeout&&t.timeout>=0&&(this.timeout=t.timeout)},onMoveStop:function(e){if(e._timer){clearTimeout(e._timer);i.call(this,e,e._leftTop)}t.prototype.onMoveStop.apply(this,arguments)},onMove:function(e,t){e._leftTop=t;if(!e._timer){var a=this;e._timer=setTimeout(function(){e._timer=null;i.call(a,e,e._leftTop)},this.timeout)}}})})},"dijit/focus":function(){define(["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/domReady","dojo/sniff","dojo/Stateful","dojo/_base/window","dojo/window","./a11y","./registry","./main"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g){var f,b,y=new(t([u,s],{curNode:null,activeStack:[],constructor:function(){var t=r.hitch(this,function(e){i.isDescendant(this.curNode,e)&&this.set("curNode",null);i.isDescendant(this.prevNode,e)&&this.set("prevNode",null)});e.before(o,"empty",t);e.before(o,"destroy",t)},registerIframe:function(e){return this.registerWin(e.contentWindow,e)},registerWin:function(e,t){var i=this,a=e.document&&e.document.body;if(a){var n=c("pointer-events")?"pointerdown":c("MSPointer")?"MSPointerDown":c("touch-events")?"mousedown, touchstart":"mousedown",o=l(e.document,n,function(e){e&&e.target&&null==e.target.parentNode||i._onTouchNode(t||e.target,"mouse")}),s=l(a,"focusin",function(e){if(e.target.tagName){var a=e.target.tagName.toLowerCase();"#document"!=a&&"body"!=a&&(_.isFocusable(e.target)?i._onFocusNode(t||e.target):i._onTouchNode(t||e.target))}}),r=l(a,"focusout",function(e){i._onBlurNode(t||e.target)});return{remove:function(){o.remove();s.remove();r.remove();o=s=r=null;a=null}}}},_onBlurNode:function(e){var t=(new Date).getTime();if(!(t<f+100)){this._clearFocusTimer&&clearTimeout(this._clearFocusTimer);this._clearFocusTimer=setTimeout(r.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0);this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer);t<b+100||(this._clearActiveWidgetsTimer=setTimeout(r.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0))}},_onTouchNode:function(e,t){b=(new Date).getTime();if(this._clearActiveWidgetsTimer){clearTimeout(this._clearActiveWidgetsTimer);delete this._clearActiveWidgetsTimer}n.contains(e,"dijitPopup")&&(e=e.firstChild);var i=[];try{for(;e;){var o=a.get(e,"dijitPopupParent");if(o)e=m.byId(o).domNode;else if(e.tagName&&"body"==e.tagName.toLowerCase()){if(e===h.body())break;e=p.get(e.ownerDocument).frameElement}else{var s=e.getAttribute&&e.getAttribute("widgetId"),r=s&&m.byId(s);!r||"mouse"==t&&r.get("disabled")||i.unshift(s);e=e.parentNode}}}catch(l){}this._setStack(i,t)},_onFocusNode:function(e){if(e&&9!=e.nodeType){f=(new Date).getTime();if(this._clearFocusTimer){clearTimeout(this._clearFocusTimer);delete this._clearFocusTimer}this._onTouchNode(e);if(e!=this.curNode){this.set("prevNode",this.curNode);this.set("curNode",e)}}},_setStack:function(e,t){var i=this.activeStack,a=i.length-1,n=e.length-1;if(e[n]!=i[a]){this.set("activeStack",e);var o,s;for(s=a;s>=0&&i[s]!=e[s];s--)if(o=m.byId(i[s])){o._hasBeenBlurred=!0;o.set("focused",!1);o._focusManager==this&&o._onBlur(t);this.emit("widget-blur",o,t)}for(s++;s<=n;s++)if(o=m.byId(e[s])){o.set("focused",!0);o._focusManager==this&&o._onFocus(t);this.emit("widget-focus",o,t)}}},focus:function(e){if(e)try{e.focus()}catch(t){}}}));d(function(){var e=y.registerWin(p.get(document));c("ie")&&l(window,"unload",function(){if(e){e.remove();e=null}})});g.focus=function(e){y.focus(e)};for(var v in y)/^_/.test(v)||(g.focus[v]="function"==typeof y[v]?r.hitch(y,v):y[v]);y.watch(function(e,t,i){g.focus[e]=i});return y})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(e,t,i,a){return e("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(e){var t=this._attrPairNames;return t[e]?t[e]:t[e]={s:"_"+e+"Setter",g:"_"+e+"Getter"}},postscript:function(e){e&&this.set(e)},_get:function(e,t){return"function"==typeof this[t.g]?this[t.g]():this[e]},get:function(e){return this._get(e,this._getAttrNames(e))},set:function(e,t){if("object"==typeof e){for(var i in e)e.hasOwnProperty(i)&&"_watchCallbacks"!=i&&this.set(i,e[i]);return this}var n,o=this._getAttrNames(e),s=this._get(e,o),r=this[o.s];"function"==typeof r?n=r.apply(this,Array.prototype.slice.call(arguments,1)):this[e]=t;if(this._watchCallbacks){var l=this;a(n,function(){l._watchCallbacks(e,s,t)})}return this},_changeAttrValue:function(e,t){var i=this.get(e);this[e]=t;this._watchCallbacks&&this._watchCallbacks(e,i,t);return this},watch:function(e,t){var a=this._watchCallbacks;if(!a){var n=this;a=this._watchCallbacks=function(e,t,i,o){var s=function(a){if(a)for(var o=0,s=(a=a.slice()).length;o<s;o++)a[o].call(n,e,t,i)};s(a["_"+e]);o||s(a["*"])}}if(t||"function"!=typeof e)e="_"+e;else{t=e;e="*"}var o=a[e];"object"!=typeof o&&(o=a[e]=[]);o.push(t);var s={};s.unwatch=s.remove=function(){var e=i.indexOf(o,t);e>-1&&o.splice(e,1)};return s}})})},"dijit/a11y":function(){define(["dojo/_base/array","dojo/dom","dojo/dom-attr","dojo/dom-style","dojo/_base/lang","dojo/sniff","./main"],function(e,t,i,a,n,o,s){var r,l={_isElementShown:function(e){var t=a.get(e);return"hidden"!=t.visibility&&"collapsed"!=t.visibility&&"none"!=t.display&&"hidden"!=i.get(e,"type")},hasDefaultTabStop:function(e){switch(e.nodeName.toLowerCase()){case"a":return i.has(e,"href");case"area":case"button":case"input":case"object":case"select":case"textarea":return!0;case"iframe":var t;try{var a=e.contentDocument;if("designMode"in a&&"on"==a.designMode)return!0;t=a.body}catch(n){try{t=e.contentWindow.document.body}catch(o){return!1}}return t&&("true"==t.contentEditable||t.firstChild&&"true"==t.firstChild.contentEditable);default:return"true"==e.contentEditable}},effectiveTabIndex:function(e){return i.get(e,"disabled")?r:i.has(e,"tabIndex")?+i.get(e,"tabIndex"):l.hasDefaultTabStop(e)?0:r},isTabNavigable:function(e){return l.effectiveTabIndex(e)>=0},isFocusable:function(e){return l.effectiveTabIndex(e)>=-1},_getTabNavigable:function(e){var t,a,n,s,r,d,c={};function u(e){return e&&"input"==e.tagName.toLowerCase()&&e.type&&"radio"==e.type.toLowerCase()&&e.name&&e.name.toLowerCase()}var h=l._isElementShown,p=l.effectiveTabIndex,_=function(e){for(var l=e.firstChild;l;l=l.nextSibling)if(!(1!=l.nodeType||o("ie")<=9&&"HTML"!==l.scopeName)&&h(l)){var m=p(l);if(m>=0){if(0==m){t||(t=l);a=l}else if(m>0){if(!n||m<s){s=m;n=l}if(!r||m>=d){d=m;r=l}}var g=u(l);i.get(l,"checked")&&g&&(c[g]=l)}"SELECT"!=l.nodeName.toUpperCase()&&_(l)}};h(e)&&_(e);function m(e){return c[u(e)]||e}return{first:m(t),last:m(a),lowest:m(n),highest:m(r)}},getFirstInTabbingOrder:function(e,i){var a=l._getTabNavigable(t.byId(e,i));return a.lowest?a.lowest:a.first},getLastInTabbingOrder:function(e,i){var a=l._getTabNavigable(t.byId(e,i));return a.last?a.last:a.highest}};n.mixin(s,l);return l})},"dijit/main":function(){define(["dojo/_base/kernel"],function(e){return e.dijit})},"dijit/registry":function(){define(["dojo/_base/array","dojo/_base/window","./main"],function(e,t,i){var a={},n={},o={length:0,add:function(e){if(n[e.id])throw new Error("Tried to register widget with id=="+e.id+" but that id is already registered");n[e.id]=e;this.length++},remove:function(e){if(n[e]){delete n[e];this.length--}},byId:function(e){return"string"==typeof e?n[e]:e},byNode:function(e){return n[e.getAttribute("widgetId")]},toArray:function(){var e=[];for(var t in n)e.push(n[t]);return e},getUniqueId:function(e){var t;do{t=e+"_"+(e in a?++a[e]:a[e]=0)}while(n[t]);return"dijit"==i._scopeName?t:i._scopeName+"_"+t},findWidgets:function(e,t){var i=[];!function e(a){for(var o=a.firstChild;o;o=o.nextSibling)if(1==o.nodeType){var s=o.getAttribute("widgetId");if(s){var r=n[s];r&&i.push(r)}else o!==t&&e(o)}}(e);return i},_destroyAll:function(){i._curFocus=null;i._prevFocus=null;i._activeStack=[];e.forEach(o.findWidgets(t.body()),function(e){e._destroyed||(e.destroyRecursive?e.destroyRecursive():e.destroy&&e.destroy())})},getEnclosingWidget:function(e){for(;e;){var t=1==e.nodeType&&e.getAttribute("widgetId");if(t)return n[t];e=e.parentNode}return null},_hash:n};i.registry=o;return o})},"dijit/_base/manager":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/lang","../registry","../main"],function(e,t,i,a,n){var o={};e.forEach(["byId","getUniqueId","findWidgets","_destroyAll","byNode","getEnclosingWidget"],function(e){o[e]=a[e]});i.mixin(o,{defaultDuration:t.defaultDuration||200});i.mixin(n,o);return n})},"dijit/_Widget":function(){define(["dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/ready","./registry","./_WidgetBase","./_OnDijitClickMixin","./_FocusMixin","dojo/uacss","./hccss"],function(e,t,i,a,n,o,s,r,l,d,c,u,h){function p(){}function _(e){return function(t,a,n,o){return t&&"string"==typeof a&&t[a]==p?t.on(a.substring(2).toLowerCase(),s.hitch(n,o)):e.apply(i,arguments)}}e.around(i,"connect",_);o.connect&&e.around(o,"connect",_);var m=a("dijit._Widget",[c,u,h],{onClick:p,onDblClick:p,onKeyDown:p,onKeyPress:p,onKeyUp:p,onMouseDown:p,onMouseMove:p,onMouseOut:p,onMouseOver:p,onMouseLeave:p,onMouseEnter:p,onMouseUp:p,constructor:function(e){this._toConnect={};for(var t in e)if(this[t]===p){this._toConnect[t.replace(/^on/,"").toLowerCase()]=e[t];delete e[t]}},postCreate:function(){this.inherited(arguments);for(var e in this._toConnect)this.on(e,this._toConnect[e]);delete this._toConnect},on:function(e,t){return this[this._onMap(e)]===p?i.connect(this.domNode,e.toLowerCase(),this,t):this.inherited(arguments)},_setFocusedAttr:function(e){this._focused=e;this._set("focused",e)},setAttribute:function(e,t){o.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(e,t)},attr:function(e,t){return arguments.length>=2||"object"==typeof e?this.set.apply(this,arguments):this.get(e)},getDescendants:function(){o.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?r("[widgetId]",this.containerNode).map(d.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});n("dijit-legacy-requires")&&l(0,function(){require(["dijit/_base"])});return m})},"dijit/_WidgetBase":function(){define(["require","dojo/_base/array","dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/ready","dojo/Stateful","dojo/topic","dojo/_base/window","./Destroyable","dojo/has!dojo-bidi?./_BidiMixin","./registry"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g,f,b,y,v,w,x){h.add("dijit-legacy-requires",!p.isAsync);h.add("dojo-bidi",!1);h("dijit-legacy-requires")&&g(0,function(){e(["dijit/_base/manager"])});var k={};function C(e){return function(t){r[t?"set":"remove"](this.domNode,e,t);this._set(e,t)}}var T=o("dijit._WidgetBase",[f,v],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:C("lang"),dir:"",_setDirAttr:C("dir"),class:"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(e){this._set("ownerDocument",e)},attributeMap:{},_blankGif:a.blankGif||e.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var e=this.constructor;if(!e._setterAttrs){var t=e.prototype,i=e._setterAttrs=[],a=e._onMap={};for(var n in t.attributeMap)i.push(n);for(n in t){/^on/.test(n)&&(a[n.substring(2).toLowerCase()]=n);if(/^_set[A-Z](.*)Attr$/.test(n)){n=n.charAt(4).toLowerCase()+n.substr(5,n.length-9);t.attributeMap&&n in t.attributeMap||i.push(n)}}}},postscript:function(e,t){this.create(e,t)},create:function(e,t){this._introspect();this.srcNodeRef=s.byId(t);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);if(e){this.params=e;_.mixin(this,e)}this.postMixInProperties();if(!this.id){this.id=x.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.params&&delete this.params.id}this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=y.body(this.ownerDocument);x.add(this);this.buildRendering();var i;if(this.domNode){this._applyAttributes();var a=this.srcNodeRef;if(a&&a.parentNode&&this.domNode!==a){a.parentNode.replaceChild(this.domNode,a);i=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();i&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var e={};for(var i in this.params||{})e[i]=this._get(i);t.forEach(this.constructor._setterAttrs,function(t){if(!(t in e)){var i=this._get(t);i&&this.set(t,i)}},this);for(i in e)this.set(i,e[i])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var e=this.baseClass.split(" ");this.isLeftToRight()||(e=e.concat(t.map(e,function(e){return e+"Rtl"})));l.add(this.domNode,e)}},postCreate:function(){},startup:function(){if(!this._started){this._started=!0;t.forEach(this.getChildren(),function(e){if(!e._started&&!e._destroyed&&_.isFunction(e.startup)){e.startup();e._started=!0}})}},destroyRecursive:function(e){this._beingDestroyed=!0;this.destroyDescendants(e);this.destroy(e)},destroy:function(e){this._beingDestroyed=!0;this.uninitialize();function i(t){t.destroyRecursive?t.destroyRecursive(e):t.destroy&&t.destroy(e)}t.forEach(this._connects,_.hitch(this,"disconnect"));t.forEach(this._supportingWidgets,i);this.domNode&&t.forEach(x.findWidgets(this.domNode,this.containerNode),i);this.destroyRendering(e);x.remove(this.id);this._destroyed=!0},destroyRendering:function(e){if(this.bgIframe){this.bgIframe.destroy(e);delete this.bgIframe}if(this.domNode){e?r.remove(this.domNode,"widgetId"):d.destroy(this.domNode);delete this.domNode}if(this.srcNodeRef){e||d.destroy(this.srcNodeRef);delete this.srcNodeRef}},destroyDescendants:function(e){t.forEach(this.getChildren(),function(t){t.destroyRecursive&&t.destroyRecursive(e)})},uninitialize:function(){return!1},_setStyleAttr:function(e){var t=this.domNode;_.isObject(e)?u.set(t,e):t.style.cssText?t.style.cssText+="; "+e:t.style.cssText=e;this._set("style",e)},_attrToDom:function(e,i,a){a=arguments.length>=3?a:this.attributeMap[e];t.forEach(_.isArray(a)?a:[a],function(t){var a=this[t.node||t||"domNode"];switch(t.type||"attribute"){case"attribute":_.isFunction(i)&&(i=_.hitch(this,i));var n=t.attribute?t.attribute:/^on[A-Z][a-zA-Z]*$/.test(e)?e.toLowerCase():e;a.tagName?r.set(a,n,i):a.set(n,i);break;case"innerText":a.innerHTML="";a.appendChild(this.ownerDocument.createTextNode(i));break;case"textContent":a.textContent=i;break;case"innerHTML":a.innerHTML=i;break;case"class":l.replace(a,i,this[e]);break;case"toggleClass":l.toggle(a,t.className||e,i)}},this)},get:function(e){var t=this._getAttrNames(e);return this[t.g]?this[t.g]():this._get(e)},set:function(e,t){if("object"==typeof e){for(var i in e)this.set(i,e[i]);return this}var a=this._getAttrNames(e),n=this[a.s];if(_.isFunction(n))var o=n.apply(this,Array.prototype.slice.call(arguments,1));else{var s=this.focusNode&&!_.isFunction(this.focusNode)?"focusNode":"domNode",r=this[s]&&this[s].tagName,l=r&&(k[r]||(k[r]=function(e){var t={};for(var i in e)t[i.toLowerCase()]=!0;return t}(this[s]))),d=e in this.attributeMap?this.attributeMap[e]:a.s in this?this[a.s]:l&&a.l in l&&"function"!=typeof t||/^aria-|^data-|^role$/.test(e)?s:null;null!=d&&this._attrToDom(e,t,d);this._set(e,t)}return o||this},_attrPairNames:{},_getAttrNames:function(e){var t=this._attrPairNames;if(t[e])return t[e];var i=e.replace(/^[a-z]|-[a-zA-Z]/g,function(e){return e.charAt(e.length-1).toUpperCase()});return t[e]={n:e+"Node",s:"_set"+i+"Attr",g:"_get"+i+"Attr",l:i.toLowerCase()}},_set:function(e,t){var i,a,n=this[e];this[e]=t;if(this._created&&!(i=n,a=t,i===a||i!=i&&a!=a)){this._watchCallbacks&&this._watchCallbacks(e,n,t);this.emit("attrmodified-"+e,{detail:{prevValue:n,newValue:t}})}},_get:function(e){return this[e]},emit:function(e,t,i){void 0===(t=t||{}).bubbles&&(t.bubbles=!0);void 0===t.cancelable&&(t.cancelable=!0);t.detail||(t.detail={});t.detail.widget=this;var a,n=this["on"+e];n&&(a=n.apply(this,i||[t]));this._started&&!this._beingDestroyed&&m.emit(this.domNode,e.toLowerCase(),t);return a},on:function(e,t){var a=this._onMap(e);return a?i.after(this,a,t,!0):this.own(m(this.domNode,e,t))[0]},_onMap:function(e){var t=this.constructor,i=t._onMap;if(!i){i=t._onMap={};for(var a in t.prototype)/^on/.test(a)&&(i[a.replace(/^on/,"").toLowerCase()]=a)}return i["string"==typeof e&&e.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?x.findWidgets(this.containerNode):[]},getParent:function(){return x.getEnclosingWidget(this.domNode.parentNode)},connect:function(e,t,i){return this.own(n.connect(e,t,this,i))[0]},disconnect:function(e){e.remove()},subscribe:function(e,t){return this.own(b.subscribe(e,_.hitch(this,t)))[0]},unsubscribe:function(e){e.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():c.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=u.get(this.domNode,"display")},placeAt:function(e,t){var i=!e.tagName&&x.byId(e);if(!i||!i.addChild||t&&"number"!=typeof t){var a=i&&"domNode"in i?i.containerNode&&!/after|before|replace/.test(t||"")?i.containerNode:i.domNode:s.byId(e,this.ownerDocument);d.place(this.domNode,a,t);!this._started&&(this.getParent()||{})._started&&this.startup()}else i.addChild(this,t);return this},defer:function(e,t){var i=setTimeout(_.hitch(this,function(){if(i){i=null;this._destroyed||_.hitch(this,e)()}}),t||0);return{remove:function(){if(i){clearTimeout(i);i=null}return null}}}});h("dojo-bidi")&&T.extend(w);return T})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(e,t,i){return i("dijit.Destroyable",null,{destroy:function(e){this._destroyed=!0},own:function(){var i=["destroyRecursive","destroy","remove"];e.forEach(arguments,function(a){var n,o=t.before(this,"destroy",function(e){a[n](e)}),s=[];function r(){o.remove();e.forEach(s,function(e){e.remove()})}if(a.then){n="cancel";a.then(r,r)}else e.forEach(i,function(e){if("function"==typeof a[e]){n||(n=e);s.push(t.after(a,e,r,!0))}})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define(["dojo/on","dojo/_base/array","dojo/keys","dojo/_base/declare","dojo/has","./a11yclick"],function(e,t,i,a,n,o){var s=a("dijit._OnDijitClickMixin",null,{connect:function(e,t,i){return this.inherited(arguments,[e,"ondijitclick"==t?o:t,i])}});s.a11yclick=o;return s})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(e,t,i,a){function n(t){if((t.keyCode===e.ENTER||t.keyCode===e.SPACE)&&!/input|button|textarea/i.test(t.target.nodeName))for(var i=t.target;i;i=i.parentNode)if(i.dojoClick)return!0}var o;i(document,"keydown",function(e){if(n(e)){o=e.target;e.preventDefault()}else o=null});i(document,"keyup",function(e){if(n(e)&&e.target==o){o=null;i.emit(e.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,_origType:e.type})}});var s=function(e,t){e.dojoClick=!0;return i(e,"click",t)};s.click=s;s.press=function(n,o){var s=i(n,a.press,function(e){("mousedown"!=e.type||t.isLeft(e))&&o(e)}),r=i(n,"keydown",function(t){t.keyCode!==e.ENTER&&t.keyCode!==e.SPACE||o(t)});return{remove:function(){s.remove();r.remove()}}};s.release=function(n,o){var s=i(n,a.release,function(e){("mouseup"!=e.type||t.isLeft(e))&&o(e)}),r=i(n,"keyup",function(t){t.keyCode!==e.ENTER&&t.keyCode!==e.SPACE||o(t)});return{remove:function(){s.remove();r.remove()}}};s.move=a.move;return s})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(e,t,i,a){a.extend(t,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return i("dijit._FocusMixin",null,{_focusManager:e})})},"dojo/uacss":function(){define(["./dom-geometry","./_base/lang","./domReady","./sniff","./_base/window"],function(e,t,i,a,n){var o=n.doc.documentElement,s=a("ie"),r=a("trident"),l=a("opera"),d=Math.floor,c=a("ff"),u=e.boxModel.replace(/-/,""),h={dj_quirks:a("quirks"),dj_opera:l,dj_khtml:a("khtml"),dj_webkit:a("webkit"),dj_safari:a("safari"),dj_chrome:a("chrome"),dj_edge:a("edge"),dj_gecko:a("mozilla"),dj_ios:a("ios"),dj_android:a("android")};if(s){h.dj_ie=!0;h["dj_ie"+d(s)]=!0;h.dj_iequirks=a("quirks")}if(r){h.dj_trident=!0;h["dj_trident"+d(r)]=!0}c&&(h["dj_ff"+d(c)]=!0);h["dj_"+u]=!0;var p="";for(var _ in h)h[_]&&(p+=_+" ");o.className=t.trim(o.className+" "+p);i(function(){if(!e.isBodyLtr()){var i="dj_rtl dijitRtl "+p.replace(/ /g,"-rtl ");o.className=t.trim(o.className+" "+i+"dj_rtl dijitRtl "+p.replace(/ /g,"-rtl "))}});return a})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(e,t,i,a){i(function(){t("highcontrast")&&e.add(a.body(),"dijit_a11y")});return t})},"dojo/hccss":function(){define(["require","./_base/config","./dom-class","./dom-style","./has","./domReady","./_base/window"],function(e,t,i,a,n,o,s){n.add("highcontrast",function(){var i=s.doc.createElement("div");try{i.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(t.blankGif||e.toUrl("./resources/blank.gif"))+'");';s.body().appendChild(i);var o=a.getComputedStyle(i),r=o.backgroundImage;return o.borderTopColor==o.borderRightColor||r&&("none"==r||"url(invalid-url:)"==r)}catch(l){l.toString();return!1}finally{n("ie")<=8?i.outerHTML="":s.body().removeChild(i)}});o(function(){n("highcontrast")&&i.add(s.body(),"dj_a11y")});return n})},"dijit/_TemplatedMixin":function(){define(["dojo/cache","dojo/_base/declare","dojo/dom-construct","dojo/_base/lang","dojo/on","dojo/sniff","dojo/string","./_AttachMixin"],function(e,t,i,a,n,o,s,r){var l=t("dijit._TemplatedMixin",r,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(e){var t=this.declaredClass,i=this;return s.substitute(e,this,function(e,n){"!"==n.charAt(0)&&(e=a.getObject(n.substr(1),!1,i));if(void 0===e)throw new Error(t+" template:"+n);return null==e?"":"!"==n.charAt(0)?e:this._escapeValue(""+e)},this)},_escapeValue:function(e){return e.replace(/["'<>&]/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}[e]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=e(this.templatePath,{sanitize:!0}));var t,n=l.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);if(a.isString(n)){if(1!=(t=i.toDom(this._stringRepl(n),this.ownerDocument)).nodeType)throw new Error("Invalid template: "+n)}else t=n.cloneNode(!0);this.domNode=t}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(e){var t=this.containerNode;if(e&&t)for(;e.hasChildNodes();)t.appendChild(e.firstChild)}});l._templateCache={};l.getCachedTemplate=function(e,t,a){var n=l._templateCache,o=e,r=n[o];if(r){try{if(!r.ownerDocument||r.ownerDocument==(a||document))return r}catch(c){}i.destroy(r)}e=s.trim(e);if(t||e.match(/\$\{([^\}]+)\}/g))return n[o]=e;var d=i.toDom(e,a);if(1!=d.nodeType)throw new Error("Invalid template: "+e);return n[o]=d};o("ie")&&n(window,"unload",function(){var e=l._templateCache;for(var t in e){var a=e[t];"object"==typeof a&&i.destroy(a);delete e[t]}});return l})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(e){return e.cache})},"dojo/text":function(){define(["./_base/kernel","require","./has","./request"],function(e,t,i,a){var n;n=function(e,t,i){a(e,{sync:!!t,headers:{"X-Requested-With":null}}).then(i)};var o={},s=function(e){if(e){var t=(e=e.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"")).match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);t&&(e=t[1])}else e="";return e},r={},l={};e.cache=function(e,i,a){var r;if("string"==typeof e)if(/\//.test(e)){r=e;a=i}else r=t.toUrl(e.replace(/\./g,"/")+(i?"/"+i:""));else{r=e+"";a=i}var l=null!=a&&"string"!=typeof a?a.value:a,d=a&&a.sanitize;if("string"==typeof l){o[r]=l;return d?s(l):l}if(null===l){delete o[r];return null}r in o||n(r,!0,function(e){o[r]=e});return d?s(o[r]):o[r]};return{dynamic:!0,normalize:function(e,t){var i=e.split("!"),a=i[0];return(/^\./.test(a)?t(a):a)+(i[1]?"!"+i[1]:"")},load:function(e,t,i){var a=e.split("!"),d=a.length>1,c=a[0],u=t.toUrl(a[0]),h="url:"+u,p=r,_=function(e){i(d?s(e):e)};c in o?p=o[c]:t.cache&&h in t.cache?p=t.cache[h]:u in o&&(p=o[u]);if(p===r)if(l[u])l[u].push(_);else{var m=l[u]=[_];n(u,!t.async,function(e){o[c]=o[u]=e;for(var t=0;t<m.length;)m[t++](e);delete l[u]})}else _(p)}}})},"dojo/request":function(){define(["./request/default!"],function(e){return e})},"dojo/request/default":function(){define(["exports","require","../has"],function(e,t,i){var a,n=i("config-requestProvider");a="./xhr";n||(n=a);e.getPlatformDefaultId=function(){return a};e.load=function(e,i,o,s){t(["platform"==e?a:n],function(e){o(e)})}})},"dojo/string":function(){define(["./_base/kernel","./_base/lang"],function(e,t){var i=/[&<>'"\/]/g,a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},n={};t.setObject("dojo.string",n);n.escape=function(e){return e?e.replace(i,function(e){return a[e]}):""};n.rep=function(e,t){if(t<=0||!e)return"";for(var i=[];;){1&t&&i.push(e);if(!(t>>=1))break;e+=e}return i.join("")};n.pad=function(e,t,i,a){i||(i="0");var o=String(e),s=n.rep(i,Math.ceil((t-o.length)/i.length));return a?o+s:s+o};n.substitute=function(i,a,n,o){o=o||e.global;n=n?t.hitch(o,n):function(e){return e};return i.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,function(e,i,s){if(""==i)return"$";var r=t.getObject(i,!1,a);s&&(r=t.getObject(s,!1,o).call(o,r,i));var l=n(r,i);if(void 0===l)throw new Error('string.substitute could not find key "'+i+'" in template');return l.toString()})};n.trim=String.prototype.trim?t.trim:function(e){for(var t=(e=e.replace(/^\s+/,"")).length-1;t>=0;t--)if(/\S/.test(e.charAt(t))){e=e.substring(0,t+1);break}return e};return n})},"dijit/_AttachMixin":function(){define(["require","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/mouse","dojo/on","dojo/touch","./_WidgetBase"],function(e,t,i,a,n,o,s,r,l){var d,c=n.delegate(r,{mouseenter:o.enter,mouseleave:o.leave,keypress:i._keypress}),u=a("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(e){for(var t=e;;)if(1==t.nodeType&&(this._processTemplateNode(t,function(e,t){return e.getAttribute(t)},this._attach)||this.searchContainerNode)&&t.firstChild)t=t.firstChild;else{if(t==e)return;for(;!t.nextSibling;)if((t=t.parentNode)==e)return;t=t.nextSibling}},_processTemplateNode:function(e,t,i){var a=!0,o=this.attachScope||this,s=t(e,"dojoAttachPoint")||t(e,"data-dojo-attach-point");if(s)for(var r,l=s.split(/\s*,\s*/);r=l.shift();){n.isArray(o[r])?o[r].push(e):o[r]=e;a="containerNode"!=r;this._attachPoints.push(r)}var d=t(e,"dojoAttachEvent")||t(e,"data-dojo-attach-event");if(d)for(var c,u=d.split(/\s*,\s*/),h=n.trim;c=u.shift();)if(c){var p=null;if(-1!=c.indexOf(":")){var _=c.split(":");c=h(_[0]);p=h(_[1])}else c=h(c);p||(p=c);this._attachEvents.push(i(e,c,n.hitch(o,p)))}return a},_attach:function(t,i,a){i="dijitclick"==(i=i.replace(/^on/,"").toLowerCase())?d||(d=e("./a11yclick")):c[i]||i;return s(t,i,a)},_detachTemplateNodes:function(){var e=this.attachScope||this;t.forEach(this._attachPoints,function(t){delete e[t]});this._attachPoints=[];t.forEach(this._attachEvents,function(e){e.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});n.extend(l,{dojoAttachEvent:"",dojoAttachPoint:""});return u})},"dijit/_CssStateMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/has","dojo/_base/lang","dojo/on","dojo/domReady","dojo/touch","dojo/_base/window","./a11yclick","./registry"],function(e,t,i,a,n,o,s,r,l,d,c,u){var h=t("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);e.forEach(["disabled","readOnly","checked","selected","focused","state","hovering","active","_opened"],function(e){this.watch(e,o.hitch(this,"_setStateClass"))},this);for(var t in this.cssStateNodes||{})this._trackMouseState(this[t],this.cssStateNodes[t]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(e){if(!this.disabled)switch(e.type){case"mouseover":case"MSPointerOver":case"pointerover":this._set("hovering",!0);this._set("active",this._mouseDown);break;case"mouseout":case"MSPointerOut":case"pointerout":this._set("hovering",!1);this._set("active",!1);break;case"mousedown":case"touchstart":case"MSPointerDown":case"pointerdown":case"keydown":this._set("active",!0);break;case"mouseup":case"dojotouchend":case"MSPointerUp":case"pointerup":case"keyup":this._set("active",!1)}},_setStateClass:function(){var t=this.baseClass.split(" ");function i(i){t=t.concat(e.map(t,function(e){return e+i}),"dijit"+i)}this.isLeftToRight()||i("Rtl");var a="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&i(a);this.state&&i(this.state);this.selected&&i("Selected");this._opened&&i("Opened");this.disabled?i("Disabled"):this.readOnly?i("ReadOnly"):this.active?i("Active"):this.hovering&&i("Hover");this.focused&&i("Focused");var n=this.stateNode||this.domNode,o={};e.forEach(n.className.split(" "),function(e){o[e]=!0});"_stateClasses"in this&&e.forEach(this._stateClasses,function(e){delete o[e]});e.forEach(t,function(e){o[e]=!0});var s=[];for(var r in o)s.push(r);n.className=s.join(" ");this._stateClasses=t},_subnodeCssMouseEvent:function(e,t,i){if(!this.disabled&&!this.readOnly)switch(i.type){case"mouseover":case"MSPointerOver":case"pointerover":n(!0);break;case"mouseout":case"MSPointerOut":case"pointerout":n(!1);o(!1);break;case"mousedown":case"touchstart":case"MSPointerDown":case"pointerdown":case"keydown":o(!0);break;case"mouseup":case"MSPointerUp":case"pointerup":case"dojotouchend":case"keyup":o(!1);break;case"focus":case"focusin":s(!0);break;case"blur":case"focusout":s(!1)}function n(i){a.toggle(e,t+"Hover",i)}function o(i){a.toggle(e,t+"Active",i)}function s(i){a.toggle(e,t+"Focused",i)}},_trackMouseState:function(e,t){e._cssState=t}});r(function(){function e(e,t,a){if(!a||!i.isDescendant(a,t))for(var n=t;n&&n!=a;n=n.parentNode)if(n._cssState){var o=u.getEnclosingWidget(n);o&&(n==o.domNode?o._cssMouseEvent(e):o._subnodeCssMouseEvent(n,n._cssState,e))}}var t,a=d.body();s(a,l.over,function(t){e(t,t.target,t.relatedTarget)});s(a,l.out,function(t){e(t,t.target,t.relatedTarget)});s(a,c.press,function(i){e(i,t=i.target)});s(a,c.release,function(i){e(i,t);t=null});s(a,"focusin, focusout",function(e){var t=e.target;if(t._cssState&&!t.getAttribute("widgetId")){var i=u.getEnclosingWidget(t);i&&i._subnodeCssMouseEvent(t,t._cssState,e)}})});return h})},"dijit/form/_FormMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/window"],function(e,t,i,a,n,o){return t("dijit.form._FormMixin",null,{state:"",_getDescendantFormWidgets:function(t){var i=[];e.forEach(t||this.getChildren(),function(e){"value"in e?i.push(e):i=i.concat(this._getDescendantFormWidgets(e.getChildren()))},this);return i},reset:function(){e.forEach(this._getDescendantFormWidgets(),function(e){e.reset&&e.reset()})},validate:function(){var t=!1;return e.every(e.map(this._getDescendantFormWidgets(),function(e){e._hasBeenBlurred=!0;var i=e.disabled||!e.validate||e.validate();if(!i&&!t){o.scrollIntoView(e.containerNode||e.domNode);e.focus();t=!0}return i}),function(e){return e})},setValues:function(e){i.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",e)},_setValueAttr:function(t){var i={};e.forEach(this._getDescendantFormWidgets(),function(e){if(e.name){(i[e.name]||(i[e.name]=[])).push(e)}});for(var n in i)if(i.hasOwnProperty(n)){var o=i[n],s=a.getObject(n,!1,t);if(void 0!==s){s=[].concat(s);"boolean"==typeof o[0].checked?e.forEach(o,function(t){t.set("value",-1!=e.indexOf(s,t._get("value")))}):o[0].multiple?o[0].set("value",s):e.forEach(o,function(e,t){e.set("value",s[t])})}}},getValues:function(){i.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_getValueAttr:function(){var t={};e.forEach(this._getDescendantFormWidgets(),function(e){var i=e.name;if(i&&!e.disabled){var n=e.get("value");if("boolean"==typeof e.checked)if(/Radio/.test(e.declaredClass))!1!==n?a.setObject(i,n,t):void 0===(n=a.getObject(i,!1,t))&&a.setObject(i,null,t);else{var o=a.getObject(i,!1,t);if(!o){o=[];a.setObject(i,o,t)}!1!==n&&o.push(n)}else{var s=a.getObject(i,!1,t);void 0!==s?a.isArray(s)?s.push(n):a.setObject(i,[s,n],t):a.setObject(i,n,t)}}});return t},isValid:function(){return""==this.state},onValidStateChange:function(){},_getState:function(){var t=e.map(this._descendants,function(e){return e.get("state")||""});return e.indexOf(t,"Error")>=0?"Error":e.indexOf(t,"Incomplete")>=0?"Incomplete":""},disconnectChildren:function(){},connectChildren:function(t){this._descendants=this._getDescendantFormWidgets();e.forEach(this._descendants,function(e){e._started||e.startup()});t||this._onChildChange()},_onChildChange:function(e){e&&"state"!=e&&"disabled"!=e||this._set("state",this._getState());if(!e||"value"==e||"disabled"==e||"checked"==e){this._onChangeDelayTimer&&this._onChangeDelayTimer.remove();this._onChangeDelayTimer=this.defer(function(){delete this._onChangeDelayTimer;this._set("value",this.get("value"))},10)}},startup:function(){this.inherited(arguments);this._descendants=this._getDescendantFormWidgets();this.value=this.get("value");this.state=this._getState();var e=this;this.own(n(this.containerNode,"attrmodified-state, attrmodified-disabled, attrmodified-value, attrmodified-checked",function(t){t.target!=e.domNode&&e._onChildChange(t.type.replace("attrmodified-",""))}));this.watch("state",function(e,t,i){this.onValidStateChange(""==i)})},destroy:function(){this.inherited(arguments)}})})},"dijit/_DialogMixin":function(){define(["dojo/_base/declare","./a11y"],function(e,t){return e("dijit._DialogMixin",null,{actionBarTemplate:"",execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var e=t._getTabNavigable(this.domNode);this._firstFocusItem=e.lowest||e.first||this.closeButtonNode||this.domNode;this._lastFocusItem=e.last||e.highest||this._firstFocusItem}})})},"dijit/DialogUnderlay":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-attr","dojo/dom-style","dojo/on","dojo/window","./_Widget","./_TemplatedMixin","./BackgroundIframe","./Viewport","./main"],function(e,t,i,a,n,o,s,r,l,d,c,u){var h=e("dijit.DialogUnderlay",[r,l],{templateString:"<div class='dijitDialogUnderlayWrapper'><div class='dijitDialogUnderlay' tabIndex='-1' data-dojo-attach-point='node'></div></div>",dialogId:"",class:"",_modalConnects:[],_setDialogIdAttr:function(e){a.set(this.node,"id",e+"_underlay");this._set("dialogId",e)},_setClassAttr:function(e){this.node.className="dijitDialogUnderlay "+e;this._set("class",e)},postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.own(o(this.domNode,"keydown",t.hitch(this,"_onKeyDown")));this.inherited(arguments)},layout:function(){var e=this.node.style,t=this.domNode.style;t.display="none";var i=s.getBox(this.ownerDocument);t.top=i.t+"px";t.left=i.l+"px";e.width=i.w+"px";e.height=i.h+"px";t.display="block"},show:function(){this.domNode.style.display="block";this.open=!0;this.layout();this.bgIframe=new d(this.domNode);var e=s.get(this.ownerDocument);this._modalConnects=[c.on("resize",t.hitch(this,"layout")),o(e,"scroll",t.hitch(this,"layout"))]},hide:function(){this.bgIframe.destroy();delete this.bgIframe;this.domNode.style.display="none";for(;this._modalConnects.length;)this._modalConnects.pop().remove();this.open=!1},destroy:function(){for(;this._modalConnects.length;)this._modalConnects.pop().remove();this.inherited(arguments)},_onKeyDown:function(){}});h.show=function(e,t){var i=h._singleton;!i||i._destroyed?i=u._underlay=h._singleton=new h(e):e&&i.set(e);n.set(i.domNode,"zIndex",t);i.open||i.show()};h.hide=function(){var e=h._singleton;e&&!e._destroyed&&e.hide()};return h})},"dijit/BackgroundIframe":function(){define(["require","./main","dojo/_base/config","dojo/dom-construct","dojo/dom-style","dojo/_base/lang","dojo/on","dojo/sniff"],function(e,t,i,a,n,o,s,r){r.add("config-bgIframe",(r("ie")||r("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var l=new function(){var t=[];this.pop=function(){var o;if(t.length)(o=t.pop()).style.display="";else{if(r("ie")<9){var s="<iframe src='"+(i.dojoBlankHtmlUrl||e.toUrl("dojo/resources/blank.html")||'javascript:""')+"' role='presentation' style='position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity=\"0\");'>";o=document.createElement(s)}else{(o=a.create("iframe")).src='javascript:""';o.className="dijitBackgroundIframe";o.setAttribute("role","presentation");n.set(o,"opacity",.1)}o.tabIndex=-1}return o};this.push=function(e){e.style.display="none";t.push(e)}};t.BackgroundIframe=function(e){if(!e.id)throw new Error("no id");if(r("config-bgIframe")){var t=this.iframe=l.pop();e.appendChild(t);if(r("ie")<7||r("quirks")){this.resize(e);this._conn=s(e,"resize",o.hitch(this,"resize",e))}else n.set(t,{width:"100%",height:"100%"})}};o.extend(t.BackgroundIframe,{resize:function(e){this.iframe&&n.set(this.iframe,{width:e.offsetWidth+"px",height:e.offsetHeight+"px"})},destroy:function(){if(this._conn){this._conn.remove();this._conn=null}if(this.iframe){this.iframe.parentNode.removeChild(this.iframe);l.push(this.iframe);delete this.iframe}}});return t.BackgroundIframe})},"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(e,t,i,a,n){var o,s=new e;i(function(){var e=n.getBox();s._rlh=t(window,"resize",function(){var t=n.getBox();if(e.h!=t.h||e.w!=t.w){e=t;s.emit("resize")}});if(8==a("ie")){var i=screen.deviceXDPI;setInterval(function(){if(screen.deviceXDPI!=i){i=screen.deviceXDPI;s.emit("resize")}},500)}if(a("ios")){t(document,"focusin",function(e){o=e.target});t(document,"focusout",function(e){o=null})}});s.getEffectiveBox=function(e){var t=n.getBox(e),i=o&&o.tagName&&o.tagName.toLowerCase();if(a("ios")&&o&&!o.readOnly&&("textarea"==i||"input"==i&&/^(color|email|number|password|search|tel|text|url)$/.test(o.type))){t.h*=0==orientation||180==orientation?.66:.4;var s=o.getBoundingClientRect();t.h=Math.max(t.h,s.top+s.height)}return t};return s})},"dijit/layout/ContentPane":function(){define(["dojo/_base/kernel","dojo/_base/lang","../_Widget","../_Container","./_ContentPaneResizeMixin","dojo/string","dojo/html","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/_base/xhr","dojo/i18n","dojo/when","dojo/i18n!../nls/loading"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m){return l("dijit.layout.ContentPane",[i,a,n],{href:"",content:"",extractContent:!1,parseOnLoad:!0,parserScope:e._scopeName,preventCache:!1,preload:!1,refreshOnShow:!1,loadingMessage:"<span class='dijitContentPaneLoading'><span class='dijitInline dijitIconLoading'></span>${loadingState}</span>",errorMessage:"<span class='dijitContentPaneError'><span class='dijitInline dijitIconError'></span>${errorState}</span>",isLoaded:!1,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,_setTitleAttr:null,stopParser:!0,template:!1,markupFactory:function(e,t,i){var a=new i(e,t);return!a.href&&a._contentSetter&&a._contentSetter.parseDeferred&&!a._contentSetter.parseDeferred.isFulfilled()?a._contentSetter.parseDeferred.then(function(){return a}):a},create:function(e,i){if((!e||!e.template)&&i&&!("href"in e)&&!("content"in e)){for(var a=(i=c.byId(i)).ownerDocument.createDocumentFragment();i.firstChild;)a.appendChild(i.firstChild);e=t.delegate(e,{content:a})}this.inherited(arguments,[e,i])},postMixInProperties:function(){this.inherited(arguments);var e=_.getLocalization("dijit","loading",this.lang);this.loadingMessage=o.substitute(this.loadingMessage,e);this.errorMessage=o.substitute(this.errorMessage,e)},buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.domNode.removeAttribute("title")},startup:function(){this.inherited(arguments);this._contentSetter&&r.forEach(this._contentSetter.parseResults,function(e){if(!e._started&&!e._destroyed&&t.isFunction(e.startup)){e.startup();e._started=!0}},this)},_startChildren:function(){r.forEach(this.getChildren(),function(e){if(!e._started&&!e._destroyed&&t.isFunction(e.startup)){e.startup();e._started=!0}});this._contentSetter&&r.forEach(this._contentSetter.parseResults,function(e){if(!e._started&&!e._destroyed&&t.isFunction(e.startup)){e.startup();e._started=!0}},this)},setHref:function(t){e.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.","","2.0");return this.set("href",t)},_setHrefAttr:function(e){this.cancel();this.onLoadDeferred=new d(t.hitch(this,"cancel"));this.onLoadDeferred.then(t.hitch(this,"onLoad"));this._set("href",e);this.preload||this._created&&this._isShown()?this._load():this._hrefChanged=!0;return this.onLoadDeferred},setContent:function(t){e.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",t)},_setContentAttr:function(e){this._set("href","");this.cancel();this.onLoadDeferred=new d(t.hitch(this,"cancel"));this._created&&this.onLoadDeferred.then(t.hitch(this,"onLoad"));this._setContent(e||"");this._isDownloaded=!1;return this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&-1==this._xhrDfd.fired&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},destroy:function(){this.cancel();this.inherited(arguments)},destroyRecursive:function(e){this._beingDestroyed||this.inherited(arguments)},_onShow:function(){this.inherited(arguments);if(this.href&&!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))return this.refresh()},refresh:function(){this.cancel();this.onLoadDeferred=new d(t.hitch(this,"cancel"));this.onLoadDeferred.then(t.hitch(this,"onLoad"));this._load();return this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),!0);var e=this,i={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};t.isObject(this.ioArgs)&&t.mixin(i,this.ioArgs);var a,n=this._xhrDfd=(this.ioMethod||p.get)(i);n.then(function(t){a=t;try{e._isDownloaded=!0;return e._setContent(t,!1)}catch(i){e._onError("Content",i)}},function(t){n.canceled||e._onError("Download",t);delete e._xhrDfd;return t}).then(function(){e.onDownloadEnd();delete e._xhrDfd;return a});delete this._hrefChanged},_onLoadHandler:function(e){this._set("isLoaded",!0);try{this.onLoadDeferred.resolve(e)}catch(t){console.error("Error "+(this.widgetId||this.id)+" running custom onLoad code: "+t.message)}},_onUnloadHandler:function(){this._set("isLoaded",!1);try{this.onUnload()}catch(e){console.error("Error "+this.widgetId+" running custom onUnload code: "+e.message)}},destroyDescendants:function(e){this.isLoaded&&this._onUnloadHandler();var t=this._contentSetter;r.forEach(this.getChildren(),function(t){t.destroyRecursive?t.destroyRecursive(e):t.destroy&&t.destroy(e);t._destroyed=!0});if(t){r.forEach(t.parseResults,function(t){if(!t._destroyed){t.destroyRecursive?t.destroyRecursive(e):t.destroy&&t.destroy(e);t._destroyed=!0}});delete t.parseResults}e||h.empty(this.containerNode);delete this._singleChild},_setContent:function(e,i){e=this.preprocessContent(e);this.destroyDescendants();var a=this._contentSetter;a&&a instanceof s._ContentSetter||(a=this._contentSetter=new s._ContentSetter({node:this.containerNode,_onError:t.hitch(this,this._onError),onContentError:t.hitch(this,function(e){var t=this.onContentError(e);try{this.containerNode.innerHTML=t}catch(e){console.error("Fatal "+this.id+" could not change content due to "+e.message,e)}})}));var n=t.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:!e.domNode&&this.parseOnLoad,parserScope:this.parserScope,startup:!1,dir:this.dir,lang:this.lang,textDir:this.textDir},this._contentSetterParams||{}),o=a.set(t.isObject(e)&&e.domNode?e.domNode:e,n),r=this;return m(o&&o.then?o:a.parseDeferred,function(){delete r._contentSetterParams;if(!i){if(r._started){r._startChildren();r._scheduleLayout()}r._onLoadHandler(e)}})},preprocessContent:function(e){return e},_onError:function(e,t,i){this.onLoadDeferred.reject(t);var a=this["on"+e+"Error"].call(this,t);i?console.error(i,t):a&&this._setContent(a,!0)},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],function(e,t,i,a){return t("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(e,t){var a=this.containerNode;if(t>0){a=a.firstChild;for(;t>0;){1==a.nodeType&&t--;a=a.nextSibling}if(a)t="before";else{a=this.containerNode;t="last"}}i.place(e.domNode,a,t);this._started&&!e._started&&e.startup()},removeChild:function(e){"number"==typeof e&&(e=this.getChildren()[e]);if(e){var t=e.domNode;t&&t.parentNode&&t.parentNode.removeChild(t)}},hasChildren:function(){return this.getChildren().length>0},_getSiblingOfChild:function(t,i){var a=this.getChildren();return a[e.indexOf(a,t)+i]},getIndexOfChild:function(t){return e.indexOf(this.getChildren(),t)}})})},"dijit/layout/_ContentPaneResizeMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang","dojo/query","../registry","../Viewport","./utils"],function(e,t,i,a,n,o,s,r,l,d){return t("dijit.layout._ContentPaneResizeMixin",null,{doLayout:!0,isLayoutContainer:!0,startup:function(){if(!this._started){var e=this.getParent();this._childOfLayoutWidget=e&&e.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._isShown()&&this._onShow();this._childOfLayoutWidget||this.own(l.on("resize",o.hitch(this,"resize")))}},_checkIfSingleChild:function(){if(this.doLayout){var e=[],t=!1;s("> *",this.containerNode).some(function(i){var a=r.byNode(i);a&&a.resize?e.push(a):!/script|link|style/i.test(i.nodeName)&&i.offsetHeight&&(t=!0)});this._singleChild=1!=e.length||t?null:e[0];i.toggle(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)}},resize:function(e,t){this._resizeCalled=!0;this._scheduleLayout(e,t)},_scheduleLayout:function(e,t){if(this._isShown())this._layout(e,t);else{this._needLayout=!0;this._changeSize=e;this._resultSize=t}},_layout:function(e,t){delete this._needLayout;this._wasShown||!1===this.open||this._onShow();e&&a.setMarginBox(this.domNode,e);var i=this.containerNode;if(i===this.domNode){var n=t||{};o.mixin(n,e||{});"h"in n&&"w"in n||(n=o.mixin(a.getMarginBox(i),n));this._contentBox=d.marginBox2contentBox(i,n)}else this._contentBox=a.getContentBox(i);this._layoutChildren()},_layoutChildren:function(){this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){var e=this._contentBox||a.getContentBox(this.containerNode);this._singleChild.resize({w:e.w,h:e.h})}else for(var t,i=this.getChildren(),n=0;t=i[n++];)t.resize&&t.resize()},_isShown:function(){if(this._childOfLayoutWidget)return this._resizeCalled&&"open"in this?this.open:this._resizeCalled;if("open"in this)return this.open;var e=this.domNode,t=this.domNode.parentNode;return"none"!=e.style.display&&"hidden"!=e.style.visibility&&!i.contains(e,"dijitHidden")&&t&&t.style&&"none"!=t.style.display},_onShow:function(){this._wasShown=!0;this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments)}})})},"dijit/layout/utils":function(){define(["dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang"],function(e,t,i,a,n){function o(e,t){var a=e.resize?e.resize(t):i.setMarginBox(e.domNode,t);if(a)n.mixin(e,a);else{n.mixin(e,i.getMarginBox(e.domNode));n.mixin(e,t)}}var s={marginBox2contentBox:function(e,t){var n=a.getComputedStyle(e),o=i.getMarginExtents(e,n),s=i.getPadBorderExtents(e,n);return{l:a.toPixelValue(e,n.paddingLeft),t:a.toPixelValue(e,n.paddingTop),w:t.w-(o.w+s.w),h:t.h-(o.h+s.h)}},layoutChildren:function(i,a,s,r,l){a=n.mixin({},a);t.add(i,"dijitLayoutContainer");s=e.filter(s,function(e){return"center"!=e.region&&"client"!=e.layoutAlign}).concat(e.filter(s,function(e){return"center"==e.region||"client"==e.layoutAlign}));e.forEach(s,function(e){var i=e.domNode,n=e.region||e.layoutAlign;if(!n)throw new Error("No region setting for "+e.id);var s,d=i.style;d.left=a.l+"px";d.top=a.t+"px";d.position="absolute";t.add(i,"dijitAlign"+((s=n).substring(0,1).toUpperCase()+s.substring(1)));var c={};r&&r==e.id&&(c["top"==e.region||"bottom"==e.region?"h":"w"]=l);"leading"==n&&(n=e.isLeftToRight()?"left":"right");"trailing"==n&&(n=e.isLeftToRight()?"right":"left");if("top"==n||"bottom"==n){c.w=a.w;o(e,c);a.h-=e.h;"top"==n?a.t+=e.h:d.top=a.t+a.h+"px"}else if("left"==n||"right"==n){c.h=a.h;o(e,c);a.w-=e.w;"left"==n?a.l+=e.w:d.left=a.l+a.w+"px"}else"client"!=n&&"center"!=n||o(e,a)})}};n.setObject("dijit.layout.utils",s);return s})},"dojo/html":function(){define(["./_base/kernel","./_base/lang","./_base/array","./_base/declare","./dom","./dom-construct","./parser"],function(e,t,i,a,n,o,s){var r=0,l={_secureForInnerHtml:function(e){return e.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/gi,"")},_emptyNode:o.empty,_setNodeContent:function(e,i){o.empty(e);if(i){"number"==typeof i&&(i=i.toString());"string"==typeof i&&(i=o.toDom(i,e.ownerDocument));if(!i.nodeType&&t.isArrayLike(i))for(var a=i.length,n=0;n<i.length;n=a==i.length?n+1:0)o.place(i[n],e,"last");else o.place(i,e,"last")}return e},_ContentSetter:a("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:!1,extractContent:!1,parseContent:!1,parserScope:e._scopeName,startup:!0,constructor:function(e,i){t.mixin(this,e||{});i=this.node=n.byId(this.node||i);this.id||(this.id=["Setter",i?i.id||i.tagName:"",r++].join("_"))},set:function(e,t){void 0!==e&&(this.content=e);"number"==typeof e&&(e=e.toString());t&&this._mixin(t);this.onBegin();this.setContent();var i=this.onEnd();return i&&i.then?i:this.node},setContent:function(){var e=this.node;if(!e)throw new Error(this.declaredClass+": setContent given no node");try{e=l._setNodeContent(e,this.content)}catch(i){var t=this.onContentError(i);try{e.innerHTML=t}catch(i){console.error("Fatal "+this.declaredClass+".setContent could not change content due to "+i.message,i)}}this.node=e},empty:function(){if(this.parseDeferred){this.parseDeferred.isResolved()||this.parseDeferred.cancel();delete this.parseDeferred}if(this.parseResults&&this.parseResults.length){i.forEach(this.parseResults,function(e){e.destroy&&e.destroy()});delete this.parseResults}o.empty(this.node)},onBegin:function(){var e=this.content;if(t.isString(e)){this.cleanContent&&(e=l._secureForInnerHtml(e));if(this.extractContent){var i=e.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);i&&(e=i[1])}}this.empty();this.content=e;return this.node},onEnd:function(){this.parseContent&&this._parse();return this.node},tearDown:function(){delete this.parseResults;delete this.parseDeferred;delete this.node;delete this.content},onContentError:function(e){return"Error occurred setting content: "+e},onExecError:function(e){return"Error occurred executing scripts: "+e},_mixin:function(e){var t,i={};for(t in e)t in i||(this[t]=e[t])},_parse:function(){var e=this.node;try{var t={};i.forEach(["dir","lang","textDir"],function(e){this[e]&&(t[e]=this[e])},this);var a=this;this.parseDeferred=s.parse({rootNode:e,noStart:!this.startup,inherited:t,scope:this.parserScope}).then(function(e){return a.parseResults=e},function(e){a._onError("Content",e,"Error parsing in _ContentSetter#"+a.id)})}catch(n){this._onError("Content",n,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(e,t,i){var a=this["on"+e+"Error"].call(this,t);i?console.error(i,t):a&&l._setNodeContent(this.node,a,!0)}}),set:function(e,i,a){null==i&&(i="");"number"==typeof i&&(i=i.toString());if(a){return new l._ContentSetter(t.mixin(a,{content:i,node:e})).set()}return l._setNodeContent(e,i,!0)}};t.setObject("dojo.html",l);return l})},"dojo/parser":function(){define(["require","./_base/kernel","./_base/lang","./_base/array","./_base/config","./dom","./_base/window","./_base/url","./aspect","./promise/all","./date/stamp","./Deferred","./has","./query","./on","./ready"],function(require,dojo,dlang,darray,config,dom,dwindow,_Url,aspect,all,dates,Deferred,has,query,don,ready){new Date("X");function myEval(text){return eval("("+text+")")}var extendCnt=0;aspect.after(dlang,"extend",function(){extendCnt++},!0);function getNameMap(e){var t=e._nameCaseMap,i=e.prototype;if(!t||t._extendCnt<extendCnt){t=e._nameCaseMap={};for(var a in i)"_"!==a.charAt(0)&&(t[a.toLowerCase()]=a);t._extendCnt=extendCnt}return t}function getCtor(e,t){t||(t=require);var i=t._dojoParserCtorMap||(t._dojoParserCtorMap={}),a=e.join();if(!i[a]){for(var n=[],o=0,s=e.length;o<s;o++){var r=e[o];n[n.length]=i[r]=i[r]||dlang.getObject(r)||~r.indexOf("/")&&t(r)}var l=n.shift();i[a]=n.length?l.createSubclass?l.createSubclass(n):l.extend.apply(l,n):l}return i[a]}var parser={_clearCache:function(){extendCnt++;_ctorMap={}},_functionFromScript:function(e,t){var i="",a="",n=e.getAttribute(t+"args")||e.getAttribute("args"),o=e.getAttribute("with"),s=(n||"").split(/\s*,\s*/);o&&o.length&&darray.forEach(o.split(/\s*,\s*/),function(e){i+="with("+e+"){";a+="}"});return new Function(s,i+e.innerHTML+a)},instantiate:function(e,t,i){t=t||{};var a=((i=i||{}).scope||dojo._scopeName)+"Type",n="data-"+(i.scope||dojo._scopeName)+"-",o=n+"type",s=n+"mixins",r=[];darray.forEach(e,function(e){var i=a in t?t[a]:e.getAttribute(o)||e.getAttribute(a);if(i){var n=e.getAttribute(s),l=n?[i].concat(n.split(/\s*,\s*/)):[i];r.push({node:e,types:l})}});return this._instantiate(r,t,i)},_instantiate:function(e,t,i,a){var n=darray.map(e,function(e){var a=e.ctor||getCtor(e.types,i.contextRequire);if(!a)throw new Error("Unable to resolve constructor for: '"+e.types.join()+"'");return this.construct(a,e.node,t,i,e.scripts,e.inherited)},this);function o(e){t._started||i.noStart||darray.forEach(e,function(e){"function"!=typeof e.startup||e._started||e.startup()});return e}return a?all(n).then(o):o(n)},construct:function(e,t,i,a,n,o){var s,r=e&&e.prototype,l={};(a=a||{}).defaults&&dlang.mixin(l,a.defaults);o&&dlang.mixin(l,o);if(has("dom-attributes-explicit"))s=t.attributes;else if(has("dom-attributes-specified-flag"))s=darray.filter(t.attributes,function(e){return e.specified});else{var d=(/^input$|^img$/i.test(t.nodeName)?t:t.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,"");s=darray.map(d.split(/\s+/),function(e){var i=e.toLowerCase();return{name:e,value:"LI"==t.nodeName&&"value"==e||"enctype"==i?t.getAttribute(i):t.getAttributeNode(i).value}})}var c=a.scope||dojo._scopeName,u="data-"+c+"-",h={};if("dojo"!==c){h[u+"props"]="data-dojo-props";h[u+"type"]="data-dojo-type";h[u+"mixins"]="data-dojo-mixins";h[c+"type"]="dojotype";h[u+"id"]="data-dojo-id"}for(var p,_,m,g=0,f=[];p=s[g++];){var b=p.name,y=b.toLowerCase(),v=p.value;switch(h[y]||y){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":m=v;break;case"data-dojo-id":case"jsid":_=v;break;case"data-dojo-attach-point":case"dojoattachpoint":l.dojoAttachPoint=v;break;case"data-dojo-attach-event":case"dojoattachevent":l.dojoAttachEvent=v;break;case"class":l.class=t.className;break;case"style":l.style=t.style&&t.style.cssText;break;default:if(!(b in r)){b=getNameMap(e)[y]||b}if(b in r)switch(typeof r[b]){case"string":l[b]=v;break;case"number":l[b]=v.length?Number(v):NaN;break;case"boolean":l[b]="false"!=v.toLowerCase();break;case"function":""===v||-1!=v.search(/[^\w\.]+/i)?l[b]=new Function(v):l[b]=dlang.getObject(v,!1)||new Function(v);f.push(b);break;default:var w=r[b];l[b]=w&&"length"in w?v?v.split(/\s*,\s*/):[]:w instanceof Date?""==v?new Date(""):"now"==v?new Date:dates.fromISOString(v):w instanceof _Url?dojo.baseUrl+v:myEval(v)}else l[b]=v}}for(var x=0;x<f.length;x++){var k=f[x].toLowerCase();t.removeAttribute(k);t[k]=null}if(m)try{m=myEval.call(a.propsThis,"{"+m+"}");dlang.mixin(l,m)}catch(F){throw new Error(F.toString()+" in data-dojo-props='"+m+"'")}dlang.mixin(l,i);n||(n=e&&(e._noScript||r._noScript)?[]:query("> script[type^='dojo/']",t));var C=[],T=[],j=[],S=[];if(n)for(g=0;g<n.length;g++){var $=n[g];t.removeChild($);var M=$.getAttribute(u+"event")||$.getAttribute("event"),A=$.getAttribute(u+"prop"),E=$.getAttribute(u+"method"),N=$.getAttribute(u+"advice"),L=$.getAttribute("type"),D=this._functionFromScript($,u);M?"dojo/connect"==L?C.push({method:M,func:D}):"dojo/on"==L?S.push({event:M,func:D}):l[M]=D:"dojo/aspect"==L?C.push({method:E,advice:N,func:D}):"dojo/watch"==L?j.push({prop:A,func:D}):T.push(D)}var P=e.markupFactory||r.markupFactory,I=P?P(l,t,e):new e(l,t);function R(e){_&&dlang.setObject(_,e);for(g=0;g<C.length;g++)aspect[C[g].advice||"after"](e,C[g].method,dlang.hitch(e,C[g].func),!0);for(g=0;g<T.length;g++)T[g].call(e);for(g=0;g<j.length;g++)e.watch(j[g].prop,j[g].func);for(g=0;g<S.length;g++)don(e,S[g].event,S[g].func);return e}return I.then?I.then(R):R(I)},scan:function(e,t){var i=[],a=[],n={},o=(t.scope||dojo._scopeName)+"Type",s="data-"+(t.scope||dojo._scopeName)+"-",r=s+"type",l=s+"textdir",d=s+"mixins",c=e.firstChild,u=t.inherited;if(!u){function h(e,t){return e.getAttribute&&e.getAttribute(t)||e.parentNode&&h(e.parentNode,t)}u={dir:h(e,"dir"),lang:h(e,"lang"),textDir:h(e,l)};for(var p in u)u[p]||delete u[p]}var _,m,g={inherited:u};function f(e){if(!e.inherited){e.inherited={};var t=e.node,i=f(e.parent),a={dir:t.getAttribute("dir")||i.dir,lang:t.getAttribute("lang")||i.lang,textDir:t.getAttribute(l)||i.textDir};for(var n in a)a[n]&&(e.inherited[n]=a[n])}return e.inherited}for(;;)if(c)if(1==c.nodeType)if(_&&"script"==c.nodeName.toLowerCase()){(b=c.getAttribute("type"))&&/^dojo\/\w/i.test(b)&&_.push(c);c=c.nextSibling}else if(m)c=c.nextSibling;else{var b=c.getAttribute(r)||c.getAttribute(o),y=c.firstChild;if(b||y&&(3!=y.nodeType||y.nextSibling)){var v,w=null;if(b){var x=c.getAttribute(d),k=x?[b].concat(x.split(/\s*,\s*/)):[b];try{w=getCtor(k,t.contextRequire)}catch(j){}w||darray.forEach(k,function(e){if(~e.indexOf("/")&&!n[e]){n[e]=!0;a[a.length]=e}});var C=w&&!w.prototype._noScript?[]:null;(v={types:k,ctor:w,parent:g,node:c,scripts:C}).inherited=f(v);i.push(v)}else v={node:c,scripts:_,parent:g};_=C;m=c.stopParser||w&&w.prototype.stopParser&&!t.template;g=v;c=y}else c=c.nextSibling}else c=c.nextSibling;else{if(!g||!g.node)break;c=g.node.nextSibling;m=!1;_=(g=g.parent).scripts}var T=new Deferred;if(a.length){has("dojo-debug-messages")&&a.join(", ");(t.contextRequire||require)(a,function(){T.resolve(darray.filter(i,function(e){if(!e.ctor)try{e.ctor=getCtor(e.types,t.contextRequire)}catch(j){}for(var i=e.parent;i&&!i.types;)i=i.parent;var a=e.ctor&&e.ctor.prototype;e.instantiateChildren=!(a&&a.stopParser&&!t.template);e.instantiate=!i||i.instantiate&&i.instantiateChildren;return e.instantiate}))})}else T.resolve(i);return T.promise},_require:function(e,t){var i=myEval("{"+e.innerHTML+"}"),a=[],n=[],o=new Deferred,s=t&&t.contextRequire||require;for(var r in i){a.push(r);n.push(i[r])}s(n,function(){for(var e=0;e<a.length;e++)dlang.setObject(a[e],arguments[e]);o.resolve(arguments)});return o.promise},_scanAmd:function(e,t){var i=new Deferred,a=i.promise;i.resolve(!0);var n=this;query("script[type='dojo/require']",e).forEach(function(e){a=a.then(function(){return n._require(e,t)});e.parentNode.removeChild(e)});return a},parse:function(e,t){e&&"string"!=typeof e&&!("nodeType"in e)&&(e=(t=e).rootNode);var i=e?dom.byId(e):dwindow.body(),a=(t=t||{}).template?{template:!0}:{},n=[],o=this,s=this._scanAmd(i,t).then(function(){return o.scan(i,t)}).then(function(e){return o._instantiate(e,a,t,!0)}).then(function(e){return n=n.concat(e)}).otherwise(function(e){console.error("dojo/parser::parse() error",e);throw e});dlang.mixin(n,s);return n}};dojo.parser=parser;config.parseOnLoad&&ready(100,parser,"parse");return parser})},"dojo/_base/url":function(){define(["./kernel"],function(e){var t=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),i=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$"),a=function(){for(var e=null,n=arguments,o=[n[0]],s=1;s<n.length;s++)if(n[s]){var r=new a(n[s]+""),l=new a(o[0]+"");if(""!=r.path||r.scheme||r.authority||r.query){if(!r.scheme){r.scheme=l.scheme;if(!r.authority){r.authority=l.authority;if("/"!=r.path.charAt(0)){for(var d=(l.path.substring(0,l.path.lastIndexOf("/")+1)+r.path).split("/"),c=0;c<d.length;c++)if("."==d[c])if(c==d.length-1)d[c]="";else{d.splice(c,1);c--}else if(c>0&&(1!=c||""!=d[0])&&".."==d[c]&&".."!=d[c-1])if(c==d.length-1){d.splice(c,1);d[c-1]=""}else{d.splice(c-1,2);c-=2}r.path=d.join("/")}}}}else{r.fragment!=e&&(l.fragment=r.fragment);r=l}o=[];r.scheme&&o.push(r.scheme,":");r.authority&&o.push("//",r.authority);o.push(r.path);r.query&&o.push("?",r.query);r.fragment&&o.push("#",r.fragment)}this.uri=o.join("");var u=this.uri.match(t);this.scheme=u[2]||(u[1]?"":e);this.authority=u[4]||(u[3]?"":e);this.path=u[5];this.query=u[7]||(u[6]?"":e);this.fragment=u[9]||(u[8]?"":e);if(this.authority!=e){u=this.authority.match(i);this.user=u[3]||e;this.password=u[4]||e;this.host=u[6]||u[7];this.port=u[9]||e}};a.prototype.toString=function(){return this.uri};return e._Url=a})},"dojo/promise/all":function(){define(["../_base/array","../_base/lang","../Deferred","../when"],function(e,t,i,a){"use strict";var n=e.some;return function(e){var o,s,r;t.isArray(e)?s=e:e&&"object"==typeof e&&(o=e);var l=[];if(o){s=[];for(var d in o)if(Object.hasOwnProperty.call(o,d)){l.push(d);s.push(o[d])}r={}}else s&&(r=[]);if(!s||!s.length)return(new i).resolve(r);var c=new i;c.promise.always(function(){r=l=null});var u=s.length;n(s,function(e,t){o||l.push(t);a(e,function(e){if(!c.isFulfilled()){r[l[t]]=e;0===--u&&c.resolve(r)}},c.reject);return c.isFulfilled()});return c.promise}})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(e,t){var i={};e.setObject("dojo.date.stamp",i);i.fromISOString=function(e,a){i._isoRegExp||(i._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var n=i._isoRegExp.exec(e),o=null;if(n){n.shift();n[1]&&n[1]--;n[6]&&(n[6]*=1e3);if(a){a=new Date(a);t.forEach(t.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(e){return a["get"+e]()}),function(e,t){n[t]=n[t]||e})}o=new Date(n[0]||1970,n[1]||0,n[2]||1,n[3]||0,n[4]||0,n[5]||0,n[6]||0);n[0]<100&&o.setFullYear(n[0]||1970);var s=0,r=n[7]&&n[7].charAt(0);if("Z"!=r){s=60*(n[8]||0)+(Number(n[9])||0);"-"!=r&&(s*=-1)}r&&(s-=o.getTimezoneOffset());s&&o.setTime(o.getTime()+6e4*s)}return o};i.toISOString=function(e,t){var i=function(e){return e<10?"0"+e:e},a=[],n=(t=t||{}).zulu?"getUTC":"get",o="";if("time"!=t.selector){var s=e[n+"FullYear"]();o=["0000".substr((s+"").length)+s,i(e[n+"Month"]()+1),i(e[n+"Date"]())].join("-")}a.push(o);if("date"!=t.selector){var r=[i(e[n+"Hours"]()),i(e[n+"Minutes"]()),i(e[n+"Seconds"]())].join(":"),l=e[n+"Milliseconds"]();t.milliseconds&&(r+="."+(l<100?"0":"")+i(l));if(t.zulu)r+="Z";else if("time"!=t.selector){var d=e.getTimezoneOffset(),c=Math.abs(d);r+=(d>0?"-":"+")+i(Math.floor(c/60))+":"+i(c%60)}a.push(r)}return a.join("T")};return i})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(e){var t=e.getObject("dojox.html.entities",!0),i=function(e,t){var i,a;if(t._encCache&&t._encCache.regexp&&t._encCache.mapper&&t.length==t._encCache.length){i=t._encCache.mapper;a=t._encCache.regexp}else{i={};a=["["];var n;for(n=0;n<t.length;n++){i[t[n][0]]="&"+t[n][1]+";";a.push(t[n][0])}a.push("]");a=new RegExp(a.join(""),"g");t._encCache={mapper:i,regexp:a,length:t.length}}return e=e.replace(a,function(e){return i[e]})},a=function(e,t){var i,a;if(t._decCache&&t._decCache.regexp&&t._decCache.mapper&&t.length==t._decCache.length){i=t._decCache.mapper;a=t._decCache.regexp}else{i={};a=["("];var n;for(n=0;n<t.length;n++){var o="&"+t[n][1]+";";n&&a.push("|");i[o]=t[n][0];a.push(o)}a.push(")");a=new RegExp(a.join(""),"g");t._decCache={mapper:i,regexp:a,length:t.length}}return e=e.replace(a,function(e){return i[e]})};t.html=[["&","amp"],['"',"quot"],["<","lt"],[">","gt"],["","nbsp"]];t.latin=[["","iexcl"],["","cent"],["","pound"],["","euro"],["","curren"],["","yen"],["","brvbar"],["","sect"],["","uml"],["","copy"],["","ordf"],["","laquo"],["","not"],["","shy"],["","reg"],["","macr"],["","deg"],["","plusmn"],["","sup2"],["","sup3"],["","acute"],["","micro"],["","para"],["","middot"],["","cedil"],["","sup1"],["","ordm"],["","raquo"],["","frac14"],["","frac12"],["","frac34"],["","iquest"],["","Agrave"],["","Aacute"],["","Acirc"],["","Atilde"],["","Auml"],["","Aring"],["","AElig"],["","Ccedil"],["","Egrave"],["","Eacute"],["","Ecirc"],["","Euml"],["","Igrave"],["","Iacute"],["","Icirc"],["","Iuml"],["","ETH"],["","Ntilde"],["","Ograve"],["","Oacute"],["","Ocirc"],["","Otilde"],["","Ouml"],["","times"],["","Oslash"],["","Ugrave"],["","Uacute"],["","Ucirc"],["","Uuml"],["","Yacute"],["","THORN"],["","szlig"],["","agrave"],["","aacute"],["","acirc"],["","atilde"],["","auml"],["","aring"],["","aelig"],["","ccedil"],["","egrave"],["","eacute"],["","ecirc"],["","euml"],["","igrave"],["","iacute"],["","icirc"],["","iuml"],["","eth"],["","ntilde"],["","ograve"],["","oacute"],["","ocirc"],["","otilde"],["","ouml"],["","divide"],["","oslash"],["","ugrave"],["","uacute"],["","ucirc"],["","uuml"],["","yacute"],["","thorn"],["","yuml"],["","fnof"],["","Alpha"],["","Beta"],["","Gamma"],["","Delta"],["","Epsilon"],["","Zeta"],["","Eta"],["","Theta"],["","Iota"],["","Kappa"],["","Lambda"],["","Mu"],["","Nu"],["","Xi"],["","Omicron"],["","Pi"],["","Rho"],["","Sigma"],["","Tau"],["","Upsilon"],["","Phi"],["","Chi"],["","Psi"],["","Omega"],["","alpha"],["","beta"],["","gamma"],["","delta"],["","epsilon"],["","zeta"],["","eta"],["","theta"],["","iota"],["","kappa"],["","lambda"],["","mu"],["","nu"],["","xi"],["","omicron"],["","pi"],["","rho"],["","sigmaf"],["","sigma"],["","tau"],["","upsilon"],["","phi"],["","chi"],["","psi"],["","omega"],["","thetasym"],["","upsih"],["","piv"],["","bull"],["","hellip"],["","prime"],["","Prime"],["","oline"],["","frasl"],["","weierp"],["","image"],["","real"],["","trade"],["","alefsym"],["","larr"],["","uarr"],["","rarr"],["","darr"],["","harr"],["","crarr"],["","lArr"],["","uArr"],["","rArr"],["","dArr"],["","hArr"],["","forall"],["","part"],["","exist"],["","empty"],["","nabla"],["","isin"],["","notin"],["","ni"],["","prod"],["","sum"],["","minus"],["","lowast"],["","radic"],["","prop"],["","infin"],["","ang"],["","and"],["","or"],["","cap"],["","cup"],["","int"],["","there4"],["","sim"],["","cong"],["","asymp"],["","ne"],["","equiv"],["","le"],["","ge"],["","sub"],["","sup"],["","nsub"],["","sube"],["","supe"],["","oplus"],["","otimes"],["","perp"],["","sdot"],["","lceil"],["","rceil"],["","lfloor"],["","rfloor"],["","lang"],["","rang"],["","loz"],["","spades"],["","clubs"],["","hearts"],["","diams"],["","OElig"],["","oelig"],["","Scaron"],["","scaron"],["","Yuml"],["","circ"],["","tilde"],["","ensp"],["","emsp"],["","thinsp"],["","zwnj"],["","zwj"],["","lrm"],["","rlm"],["","ndash"],["","mdash"],["","lsquo"],["","rsquo"],["","sbquo"],["","ldquo"],["","rdquo"],["","bdquo"],["","dagger"],["","Dagger"],["","permil"],["","lsaquo"],["","rsaquo"]];t.encode=function(e,a){if(e)if(a)e=i(e,a);else{e=i(e,t.html);e=i(e,t.latin)}return e};t.decode=function(e,i){if(e)if(i)e=a(e,i);else{e=a(e,t.html);e=a(e,t.latin)}return e};return t})},"dojo/fx":function(){define(["./_base/lang","./Evented","./_base/kernel","./_base/array","./aspect","./_base/fx","./dom","./dom-style","./dom-geometry","./ready","require"],function(e,t,i,a,n,o,s,r,l,d,c){i.isAsync||d(0,function(){c(["./fx/Toggler"])});var u=i.fx={},h={_fire:function(e,t){this[e]&&this[e].apply(this,t||[]);return this}},p=function(e){this._index=-1;this._animations=e||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;a.forEach(this._animations,function(e){if(e){void 0!==e.duration&&(this.duration+=e.duration);e.delay&&(this.duration+=e.delay)}},this)};p.prototype=new t;e.extend(p,{_onAnimate:function(){this._fire("onAnimate",arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;if(this._index+1==this._animations.length)this._fire("onEnd");else{this._current=this._animations[++this._index];this._onAnimateCtx=n.after(this._current,"onAnimate",e.hitch(this,"_onAnimate"),!0);this._onEndCtx=n.after(this._current,"onEnd",e.hitch(this,"_onEnd"),!0);this._current.play(0,!0)}},play:function(t,i){this._current||(this._current=this._animations[this._index=0]);if(!i&&"playing"==this._current.status())return this;var a=n.after(this._current,"beforeBegin",e.hitch(this,function(){this._fire("beforeBegin")}),!0),o=n.after(this._current,"onBegin",e.hitch(this,function(e){this._fire("onBegin",arguments)}),!0),s=n.after(this._current,"onPlay",e.hitch(this,function(e){this._fire("onPlay",arguments);a.remove();o.remove();s.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=n.after(this._current,"onAnimate",e.hitch(this,"_onAnimate"),!0);this._onEndCtx&&this._onEndCtx.remove();this._onEndCtx=n.after(this._current,"onEnd",e.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var t=n.after(this._current,"onPause",e.hitch(this,function(e){this._fire("onPause",arguments);t.remove()}),!0);this._current.pause()}return this},gotoPercent:function(e,t){this.pause();var i=this.duration*e;this._current=null;a.some(this._animations,function(e,t){if(i<=e.duration){this._current=e;this._index=t;return!0}i-=e.duration;return!1},this);this._current&&this._current.gotoPercent(i/this._current.duration);t&&this.play();return this},stop:function(t){if(this._current){if(t){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var i=n.after(this._current,"onStop",e.hitch(this,function(e){this._fire("onStop",arguments);i.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});e.extend(p,h);u.chain=function(t){return new p(e.isArray(t)?t:Array.prototype.slice.call(t,0))};var _=function(t){this._animations=t||[];this._connects=[];this._finished=0;this.duration=0;a.forEach(t,function(t){var i=t.duration;t.delay&&(i+=t.delay);this.duration<i&&(this.duration=i);this._connects.push(n.after(t,"onEnd",e.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=new o.Animation({curve:[0,1],duration:this.duration});var i=this;a.forEach(["beforeBegin","onBegin","onPlay","onAnimate","onPause","onStop","onEnd"],function(e){i._connects.push(n.after(i._pseudoAnimation,e,function(){i._fire(e,arguments)},!0))})};e.extend(_,{_doAction:function(e,t){a.forEach(this._animations,function(i){i[e].apply(i,t)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(e,t){var i=this._pseudoAnimation;i[e].apply(i,t)},play:function(e,t){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(e,t){var i=this.duration*e;a.forEach(this._animations,function(e){e.gotoPercent(e.duration<i?1:i/e.duration,t)});this._call("gotoPercent",arguments);return this},stop:function(e){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},destroy:function(){this.stop();a.forEach(this._connects,function(e){e.remove()})}});e.extend(_,h);u.combine=function(t){return new _(e.isArray(t)?t:Array.prototype.slice.call(t,0))};u.wipeIn=function(t){var i,a=t.node=s.byId(t.node),l=a.style,d=o.animateProperty(e.mixin({properties:{height:{start:function(){i=l.overflow;l.overflow="hidden";if("hidden"==l.visibility||"none"==l.display){l.height="1px";l.display="";l.visibility="";return 1}var e=r.get(a,"height");return Math.max(e,1)},end:function(){return a.scrollHeight}}}},t)),c=function(){l.height="auto";l.overflow=i};n.after(d,"onStop",c,!0);n.after(d,"onEnd",c,!0);return d};u.wipeOut=function(t){var i,a=(t.node=s.byId(t.node)).style,r=o.animateProperty(e.mixin({properties:{height:{end:1}}},t));n.after(r,"beforeBegin",function(){i=a.overflow;a.overflow="hidden";a.display=""},!0);var l=function(){a.overflow=i;a.height="auto";a.display="none"};n.after(r,"onStop",l,!0);n.after(r,"onEnd",l,!0);return r};u.slideTo=function(t){var i,a=t.node=s.byId(t.node),d=null,c=null,u=(i=a,function(){var e=r.getComputedStyle(i),t=e.position;d="absolute"==t?i.offsetTop:parseInt(e.top)||0;c="absolute"==t?i.offsetLeft:parseInt(e.left)||0;if("absolute"!=t&&"relative"!=t){var a=l.position(i,!0);d=a.y;c=a.x;i.style.position="absolute";i.style.top=d+"px";i.style.left=c+"px"}});u();var h=o.animateProperty(e.mixin({properties:{top:t.top||0,left:t.left||0}},t));n.after(h,"beforeBegin",u,!0);return h};return u})},"dojo/fx/easing":function(){define(["../_base/lang"],function(e){var t={linear:function(e){return e},quadIn:function(e){return Math.pow(e,2)},quadOut:function(e){return e*(e-2)*-1},quadInOut:function(e){return(e*=2)<1?Math.pow(e,2)/2:-1*(--e*(e-2)-1)/2},cubicIn:function(e){return Math.pow(e,3)},cubicOut:function(e){return Math.pow(e-1,3)+1},cubicInOut:function(e){if((e*=2)<1)return Math.pow(e,3)/2;e-=2;return(Math.pow(e,3)+2)/2},quartIn:function(e){return Math.pow(e,4)},quartOut:function(e){return-1*(Math.pow(e-1,4)-1)},quartInOut:function(e){if((e*=2)<1)return Math.pow(e,4)/2;e-=2;return-.5*(Math.pow(e,4)-2)},quintIn:function(e){return Math.pow(e,5)},quintOut:function(e){return Math.pow(e-1,5)+1},quintInOut:function(e){if((e*=2)<1)return Math.pow(e,5)/2;e-=2;return(Math.pow(e,5)+2)/2},sineIn:function(e){return-1*Math.cos(e*(Math.PI/2))+1},sineOut:function(e){return Math.sin(e*(Math.PI/2))},sineInOut:function(e){return-1*(Math.cos(Math.PI*e)-1)/2},expoIn:function(e){return 0==e?0:Math.pow(2,10*(e-1))},expoOut:function(e){return 1==e?1:-1*Math.pow(2,-10*e)+1},expoInOut:function(e){if(0==e)return 0;if(1==e)return 1;if((e*=2)<1)return Math.pow(2,10*(e-1))/2;--e;return(-1*Math.pow(2,-10*e)+2)/2},circIn:function(e){return-1*(Math.sqrt(1-Math.pow(e,2))-1)},circOut:function(e){e-=1;return Math.sqrt(1-Math.pow(e,2))},circInOut:function(e){if((e*=2)<1)return-.5*(Math.sqrt(1-Math.pow(e,2))-1);e-=2;return.5*(Math.sqrt(1-Math.pow(e,2))+1)},backIn:function(e){var t=1.70158;return Math.pow(e,2)*((t+1)*e-t)},backOut:function(e){e-=1;var t=1.70158;return Math.pow(e,2)*((t+1)*e+t)+1},backInOut:function(e){var t=2.5949095;if((e*=2)<1)return Math.pow(e,2)*((t+1)*e-t)/2;e-=2;return(Math.pow(e,2)*((t+1)*e+t)+2)/2},elasticIn:function(e){if(0==e||1==e)return e;e-=1;return-1*Math.pow(2,10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)},elasticOut:function(e){if(0==e||1==e)return e;return Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)+1},elasticInOut:function(e){if(0==e)return 0;if(2==(e*=2))return 1;var t=.3*1.5,i=t/4;if(e<1){e-=1;return Math.pow(2,10*e)*Math.sin((e-i)*(2*Math.PI)/t)*-.5}e-=1;return Math.pow(2,-10*e)*Math.sin((e-i)*(2*Math.PI)/t)*.5+1},bounceIn:function(e){return 1-t.bounceOut(1-e)},bounceOut:function(e){var t,i=7.5625,a=2.75;if(e<1/a)t=i*Math.pow(e,2);else if(e<2/a){e-=1.5/a;t=i*Math.pow(e,2)+.75}else if(e<2.5/a){e-=2.25/a;t=i*Math.pow(e,2)+.9375}else{e-=2.625/a;t=i*Math.pow(e,2)+.984375}return t},bounceInOut:function(e){return e<.5?t.bounceIn(2*e)/2:t.bounceOut(2*e-1)/2+.5}};e.setObject("dojo.fx.easing",t);return t})},"dojo/io/iframe":function(){define(["../_base/config","../_base/json","../_base/kernel","../_base/lang","../_base/xhr","../sniff","../_base/window","../dom","../dom-construct","../query","require","../aspect","../request/iframe"],function(e,t,i,a,n,o,s,r,l,d,c,u,h){i.deprecated("dojo/io/iframe","Use dojo/request/iframe.","2.0");var p=h._iframeName;p=p.substring(0,p.lastIndexOf("_"));var _=a.delegate(h,{create:function(){return _._frame=h.create.apply(h,arguments)},get:null,post:null,send:function(a){var o,s=n._ioSetArgs(a,function(e){o&&o.cancel()},function(e){var a=null,n=e.ioArgs;try{var s=n.handleAs;if("xml"===s||"html"===s)a=o.response.data;else{a=o.response.text;"json"===s?a=t.fromJson(a):"javascript"===s&&(a=i.eval(a))}}catch(r){a=r}return a},function(e,t){t.ioArgs._hasError=!0;return e}),l=s.ioArgs,d="GET",c=r.byId(a.form);a.method&&"POST"===a.method.toUpperCase()&&c&&(d="POST");var p={method:d,handleAs:"json"===a.handleAs||"javascript"===a.handleAs?"text":a.handleAs,form:a.form,query:c?null:a.content,data:c?a.content:null,timeout:a.timeout,ioArgs:l};p.method&&(p.method=p.method.toUpperCase());if(e.ioPublish&&i.publish&&!1!==l.args.ioPublish)var _=u.after(h,"_notifyStart",function(e){if(e.options.ioArgs===l){_.remove();n._ioNotifyStart(s)}},!0);o=h(l.url,p,!0);l._callNext=o._callNext;o.then(function(){s.resolve(s)}).otherwise(function(e){s.ioArgs.error=e;s.reject(e)});return s},_iframeOnload:s.global[p+"_onload"]});a.setObject("dojo.io.iframe",_);return _})},"dojo/request/iframe":function(){define(["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom","../NodeList-manipulate"],function(e,t,i,a,n,o,s,r,l,d,c,u){var h=e.id.replace(/[\/\.\-]/g,"_"),p=h+"_onload";u.global[p]||(u.global[p]=function(){var e=y._currentDfd;if(e){var t=e.response.options,i=d.byId(t.form)||e._tmpForm;if(i){for(var a=e._contentToClean,n=0;n<a.length;n++)for(var o=a[n],s=0;s<i.childNodes.length;s++){var r=i.childNodes[s];if(r.name===o){c.destroy(r);break}}e._originalAction&&i.setAttribute("action",e._originalAction);if(e._originalMethod){i.setAttribute("method",e._originalMethod);i.method=e._originalMethod}if(e._originalTarget){i.setAttribute("target",e._originalTarget);i.target=e._originalTarget}}if(e._tmpForm){c.destroy(e._tmpForm);delete e._tmpForm}e._finished=!0}else y._fireNextRequest()});function _(e){return!this.isFulfilled()}function m(e){return!!this._finished}function g(e,t){if(!t)try{var i=e.options,a=y.doc(y._frame),s=i.handleAs;if("html"!==s){if("xml"===s)if("html"===a.documentElement.tagName.toLowerCase()){r("a",a.documentElement).orphan();var l=a.documentElement.innerText||a.documentElement.textContent;l=l.replace(/>\s+</g,"><");e.text=o.trim(l)}else e.data=a;else e.text=a.getElementsByTagName("textarea")[0].value;n(e)}else e.data=a}catch(d){t=d}t?this.reject(t):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function f(e){this._callNext()}var b={method:"POST"};function y(e,t,n){var o=a.parseArgs(e,a.deepCreate(b,t),!0);e=o.url;if("GET"!==(t=o.options).method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");y._frame||(y._frame=y.create(y._iframeName,p+"();"));var s=a.deferred(o,null,_,m,g,f);s._callNext=function(){if(!this._calledNext){this._calledNext=!0;y._currentDfd=null;y._fireNextRequest()}};s._legacy=n;y._dfdQueue.push(s);y._fireNextRequest();i(s);return n?s:s.promise}y.create=function(e,i,a){if(u.global[e])return u.global[e];if(u.global.frames[e])return u.global.frames[e];if(!a){l("config-useXDomain")&&l("config-dojoBlankHtmlUrl");a=l("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html")}var n=c.place('<iframe id="'+e+'" name="'+e+'" src="'+a+'" onload="'+i+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',u.body());u.global[e]=n;return n};y.doc=function(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var i=u.doc.getElementsByTagName("iframe");if(e.document&&i[t].contentWindow&&i[t].contentWindow.document)return i[t].contentWindow.document;if(u.doc.frames[t]&&u.doc.frames[t].document)return u.doc.frames[t].document}return null};y.setSrc=function(e,t,i){var a=u.global.frames[e.name];a.contentWindow&&(a=a.contentWindow);try{i?a.location.replace(t):a.location=t}catch(n){}};y._iframeName=h+"_IoIframe";y._notifyStart=function(){};y._dfdQueue=[];y._currentDfd=null;y._fireNextRequest=function(){var e;try{if(y._currentDfd||!y._dfdQueue.length)return;do{e=y._currentDfd=y._dfdQueue.shift()}while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&y._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled()){y._currentDfd=null;return}var t,i=e.response,n=i.options,l=e._contentToClean=[],p=d.byId(n.form),_=a.notify,m=n.data||null;if(e._legacy||"POST"!==n.method||p){if("GET"===n.method&&p&&i.url.indexOf("?")>-1){t=i.url.slice(i.url.indexOf("?")+1);m=o.mixin(s.queryToObject(t),m)}}else p=e._tmpForm=c.create("form",{name:h+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},u.body());if(p){if(!e._legacy){var g=p;do{g=g.parentNode}while(g&&g!==u.doc.documentElement);if(!g){p.style.position="absolute";p.style.left="-1000px";p.style.top="-1000px";u.body().appendChild(p)}p.name||(p.name=h+"_form")}if(m){var f=function(e,t){c.create("input",{type:"hidden",name:e,value:t},p);l.push(e)};for(var b in m){var v=m[b];if(o.isArray(v)&&v.length>1)for(var w=0;w<v.length;w++)f(b,v[w]);else{var x=r("input[name='"+b+"']",p);-1==x.indexOf()?f(b,v):x.val(v)}}}var k=p.getAttributeNode("action"),C=p.getAttributeNode("method"),T=p.getAttributeNode("target");if(i.url){e._originalAction=k?k.value:null;k?k.value=i.url:p.setAttribute("action",i.url)}if(e._legacy)C&&C.value||(C?C.value=n.method:p.setAttribute("method",n.method));else{e._originalMethod=C?C.value:null;C?C.value=n.method:p.setAttribute("method",n.method)}e._originalTarget=T?T.value:null;T?T.value=y._iframeName:p.setAttribute("target",y._iframeName);p.target=y._iframeName;_&&_.emit("send",i,e.promise.cancel);y._notifyStart(i);p.submit()}else{var j="";i.options.data&&"string"!=typeof(j=i.options.data)&&(j=s.objectToQuery(j));var S=i.url+(i.url.indexOf("?")>-1?"&":"?")+j;_&&_.emit("send",i,e.promise.cancel);y._notifyStart(i);y.setSrc(y._frame,S,!0)}}catch($){e.reject($)}};a.addCommonMethods(y,["GET","POST"]);return y})},"dojo/NodeList-manipulate":function(){define(["./query","./_base/lang","./_base/array","./dom-construct","./dom-attr","./NodeList-dom"],function(e,t,i,a,n){var o=e.NodeList;function s(e){for(;e.childNodes[0]&&1==e.childNodes[0].nodeType;)e=e.childNodes[0];return e}function r(e,t){"string"==typeof e?11==(e=a.toDom(e,t&&t.ownerDocument)).nodeType&&(e=e.childNodes[0]):1==e.nodeType&&e.parentNode&&(e=e.cloneNode(!1));return e}t.extend(o,{_placeMultiple:function(t,i){for(var n="string"==typeof t||t.nodeType?e(t):t,o=[],s=0;s<n.length;s++)for(var r,l=n[s],d=this.length,c=d-1;r=this[c];c--){if(s>0){r=this._cloneNode(r);o.unshift(r)}c==d-1?a.place(r,l,i):l.parentNode.insertBefore(r,l);l=r}if(o.length){o.unshift(0);o.unshift(this.length-1);Array.prototype.splice.apply(this,o)}return this},innerHTML:function(e){return arguments.length?this.addContent(e,"only"):this[0].innerHTML},text:function(e){if(arguments.length){for(var t,i=0;t=this[i];i++)1==t.nodeType&&n.set(t,"textContent",e);return this}var a="";for(i=0;t=this[i];i++)a+=n.get(t,"textContent");return a},val:function(e){if(arguments.length){for(var a,n=t.isArray(e),o=0;a=this[o];o++){var s=a.nodeName.toUpperCase(),r=a.type,l=n?e[o]:e;if("SELECT"==s)for(var d=a.options,c=0;c<d.length;c++){var u=d[c];a.multiple?u.selected=-1!=i.indexOf(e,u.value):u.selected=u.value==l}else"checkbox"==r||"radio"==r?a.checked=a.value==l:a.value=l}return this}if((a=this[0])&&1==a.nodeType){e=a.value||"";if("SELECT"==a.nodeName.toUpperCase()&&a.multiple){e=[];d=a.options;for(c=0;c<d.length;c++)(u=d[c]).selected&&e.push(u.value);e.length||(e=null)}return e}},append:function(e){return this.addContent(e,"last")},appendTo:function(e){return this._placeMultiple(e,"last")},prepend:function(e){return this.addContent(e,"first")},prependTo:function(e){return this._placeMultiple(e,"first")},after:function(e){return this.addContent(e,"after")},insertAfter:function(e){return this._placeMultiple(e,"after")},before:function(e){return this.addContent(e,"before")},insertBefore:function(e){return this._placeMultiple(e,"before")},remove:o.prototype.orphan,wrap:function(e){if(this[0]){e=r(e,this[0]);for(var t,i=0;t=this[i];i++){var a=this._cloneNode(e);t.parentNode&&t.parentNode.replaceChild(a,t);s(a).appendChild(t)}}return this},wrapAll:function(e){if(this[0]){e=r(e,this[0]);this[0].parentNode.replaceChild(e,this[0]);for(var t,i=s(e),a=0;t=this[a];a++)i.appendChild(t)}return this},wrapInner:function(e){if(this[0]){e=r(e,this[0]);for(var i=0;i<this.length;i++){var a=this._cloneNode(e);this._wrap(t._toArray(this[i].childNodes),null,this._NodeListCtor).wrapAll(a)}}return this},replaceWith:function(e){e=this._normalize(e,this[0]);for(var t,i=0;t=this[i];i++){this._place(e,t,"before",i>0);t.parentNode.removeChild(t)}return this},replaceAll:function(t){for(var i,a=e(t),n=this._normalize(this,this[0]),o=0;i=a[o];o++){this._place(n,i,"before",o>0);i.parentNode.removeChild(i)}return this},clone:function(){for(var e=[],t=0;t<this.length;t++)e.push(this._cloneNode(this[t]));return this._wrap(e,this,this._NodeListCtor)}});o.prototype.html||(o.prototype.html=o.prototype.innerHTML);return o})},"dijit/Tooltip":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/fx","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang","dojo/mouse","dojo/on","dojo/sniff","./_base/manager","./place","./_Widget","./_TemplatedMixin","./BackgroundIframe","dojo/text!./templates/Tooltip.html","./main"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g,f){var b=t("dijit._MasterTooltip",[p,_],{duration:u.defaultDuration,templateString:g,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new m(this.domNode);this.fadeIn=i.fadeIn({node:this.domNode,duration:this.duration,onEnd:r.hitch(this,"_onShow")});this.fadeOut=i.fadeOut({node:this.domNode,duration:this.duration,onEnd:r.hitch(this,"_onHide")})},show:function(e,t,i,a,n,o,l){if(!this.aroundNode||this.aroundNode!==t||this.containerNode.innerHTML!=e)if("playing"!=this.fadeOut.status()){this.containerNode.innerHTML=e;n&&this.set("textDir",n);this.containerNode.align=a?"right":"left";var d=h.around(this.domNode,t,i&&i.length?i:C.defaultPosition,!a,r.hitch(this,"orient")),c=d.aroundNodePos;if("M"==d.corner.charAt(0)&&"M"==d.aroundCorner.charAt(0)){this.connectorNode.style.top=c.y+(c.h-this.connectorNode.offsetHeight>>1)-d.y+"px";this.connectorNode.style.left=""}else if("M"==d.corner.charAt(1)&&"M"==d.aroundCorner.charAt(1))this.connectorNode.style.left=c.x+(c.w-this.connectorNode.offsetWidth>>1)-d.x+"px";else{this.connectorNode.style.left="";this.connectorNode.style.top=""}s.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=t;this.onMouseEnter=o||k;this.onMouseLeave=l||k}else this._onDeck=arguments},orient:function(e,t,i,a,n){this.connectorNode.style.top="";var s=a.h,r=a.w;e.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove","BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[t+"-"+i];this.domNode.style.width="auto";var l=o.position(this.domNode);(c("ie")||c("trident"))&&(l.w+=2);var d=Math.min(Math.max(r,1),l.w);o.setMarginBox(this.domNode,{w:d});if("B"==i.charAt(0)&&"B"==t.charAt(0)){var u=o.position(e),h=this.connectorNode.offsetHeight;if(u.h>s){var p=s-(n.h+h>>1);this.connectorNode.style.top=p+"px";this.connectorNode.style.bottom=""}else{this.connectorNode.style.bottom=Math.min(Math.max(n.h/2-h/2,0),u.h-h)+"px";this.connectorNode.style.top=""}}else{this.connectorNode.style.top="";this.connectorNode.style.bottom=""}return Math.max(0,l.w-r)},_onShow:function(){c("ie")&&(this.domNode.style.filter="")},hide:function(e){if(this._onDeck&&this._onDeck[1]==e)this._onDeck=null;else if(this.aroundNode===e){this.fadeIn.stop();this.isShowingNow=!1;this.aroundNode=null;this.fadeOut.play()}this.onMouseEnter=this.onMouseLeave=k},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";if(this._onDeck){this.show.apply(this,this._onDeck);this._onDeck=null}}});c("dojo-bidi")&&b.extend({_setAutoTextDir:function(t){this.applyTextDir(t);e.forEach(t.children,function(e){this._setAutoTextDir(e)},this)},_setTextDirAttr:function(e){this._set("textDir",e);"auto"==e?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});f.showTooltip=function(t,i,a,n,o,s,r){a&&(a=e.map(a,function(e){return{after:"after-centered",before:"before-centered"}[e]||e}));C._masterTT||(f._masterTT=C._masterTT=new b);return C._masterTT.show(t,i,a,n,o,s,r)};f.hideTooltip=function(e){return C._masterTT&&C._masterTT.hide(e)};var y="DORMANT",v="SHOW TIMER",w="SHOWING",x="HIDE TIMER";function k(){}var C=t("dijit.Tooltip",p,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(t){e.forEach(this._connections||[],function(t){e.forEach(t,function(e){e.remove()})},this);this._connectIds=e.filter(r.isArrayLike(t)?t:t?[t]:[],function(e){return a.byId(e,this.ownerDocument)},this);this._connections=e.map(this._connectIds,function(e){var t=a.byId(e,this.ownerDocument),i=this.selector,n=i?function(e){return d.selector(i,e)}:function(e){return e},o=this;return[d(t,n(l.enter),function(){o._onHover(this)}),d(t,n("focusin"),function(){o._onHover(this)}),d(t,n(l.leave),r.hitch(o,"_onUnHover")),d(t,n("focusout"),r.hitch(o,"set","state",y))]},this);this._set("connectId",t)},addTarget:function(t){var i=t.id||t;-1==e.indexOf(this._connectIds,i)&&this.set("connectId",this._connectIds.concat(i))},removeTarget:function(t){var i=t.id||t,a=e.indexOf(this._connectIds,i);if(a>=0){this._connectIds.splice(a,1);this.set("connectId",this._connectIds)}},buildRendering:function(){this.inherited(arguments);n.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var t=this.connectId;e.forEach(r.isArrayLike(t)?t:[t],this.addTarget,this)},getContent:function(e){return this.label||this.domNode.innerHTML},state:y,_setStateAttr:function(e){if(!(this.state==e||e==v&&this.state==w||e==x&&this.state==y)){if(this._hideTimer){this._hideTimer.remove();delete this._hideTimer}if(this._showTimer){this._showTimer.remove();delete this._showTimer}switch(e){case y:if(this._connectNode){C.hide(this._connectNode);delete this._connectNode;this.onHide()}break;case v:this.state!=w&&(this._showTimer=this.defer(function(){this.set("state",w)},this.showDelay));break;case w:var t=this.getContent(this._connectNode);if(!t){this.set("state",y);return}C.show(t,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,r.hitch(this,"set","state",w),r.hitch(this,"set","state",x));this.onShow(this._connectNode,this.position);break;case x:this._hideTimer=this.defer(function(){this.set("state",y)},this.hideDelay)}this._set("state",e)}},_onHover:function(e){this._connectNode&&e!=this._connectNode&&this.set("state",y);this._connectNode=e;this.set("state",v)},_onUnHover:function(e){this.set("state",x)},open:function(e){this.set("state",y);this._connectNode=e;this.set("state",w)},close:function(){this.set("state",y)},onShow:function(){},onHide:function(){},destroy:function(){this.set("state",y);e.forEach(this._connections||[],function(t){e.forEach(t,function(e){e.remove()})},this);this.inherited(arguments)}});C._MasterTooltip=b;C.show=f.showTooltip;C.hide=f.hideTooltip;C.defaultPosition=["after-centered","before-centered"];return C})},"dijit/place":function(){define(["dojo/_base/array","dojo/dom-geometry","dojo/dom-style","dojo/_base/kernel","dojo/_base/window","./Viewport","./main"],function(e,t,i,a,n,o,s){function r(a,s,r,l){var d=o.getEffectiveBox(a.ownerDocument);a.parentNode&&"body"==String(a.parentNode.tagName).toLowerCase()||n.body(a.ownerDocument).appendChild(a);var c=null;e.some(s,function(e){var i=e.corner,n=e.pos,o=0,s={w:{L:d.l+d.w-n.x,R:n.x-d.l,M:d.w}[i.charAt(1)],h:{T:d.t+d.h-n.y,B:n.y-d.t,M:d.h}[i.charAt(0)]},u=a.style;u.left=u.right="auto";if(r){var h=r(a,e.aroundCorner,i,s,l);o=void 0===h?0:h}var p=a.style,_=p.display,m=p.visibility;if("none"==p.display){p.visibility="hidden";p.display=""}var g=t.position(a);p.display=_;p.visibility=m;var f={L:n.x,R:n.x-g.w,M:Math.max(d.l,Math.min(d.l+d.w,n.x+(g.w>>1))-g.w)}[i.charAt(1)],b={T:n.y,B:n.y-g.h,M:Math.max(d.t,Math.min(d.t+d.h,n.y+(g.h>>1))-g.h)}[i.charAt(0)],y=Math.max(d.l,f),v=Math.max(d.t,b),w=Math.min(d.l+d.w,f+g.w)-y,x=Math.min(d.t+d.h,b+g.h)-v;o+=g.w-w+(g.h-x);(null==c||o<c.overflow)&&(c={corner:i,aroundCorner:e.aroundCorner,x:y,y:v,w:w,h:x,overflow:o,spaceAvailable:s});return!o});c.overflow&&r&&r(a,c.aroundCorner,c.corner,c.spaceAvailable,l);var u=c.y,h=c.x,p=n.body(a.ownerDocument);if(/relative|absolute/.test(i.get(p,"position"))){u-=i.get(p,"marginTop");h-=i.get(p,"marginLeft")}var _=a.style;_.top=u+"px";_.left=h+"px";_.right="auto";return c}var l={TL:"BR",TR:"BL",BL:"TR",BR:"TL"},d={at:function(t,i,a,n,o){return r(t,e.map(a,function(e){var t={corner:e,aroundCorner:l[e],pos:{x:i.x,y:i.y}};if(n){t.pos.x+="L"==e.charAt(1)?n.x:-n.x;t.pos.y+="T"==e.charAt(0)?n.y:-n.y}return t}),o)},around:function(n,o,s,l,d){var c;if("string"==typeof o||"offsetWidth"in o||"ownerSVGElement"in o){c=t.position(o,!0);if(/^(above|below)/.test(s[0])){var u=t.getBorderExtents(o),h=o.firstChild?t.getBorderExtents(o.firstChild):{t:0,l:0,b:0,r:0},p=t.getBorderExtents(n),_=n.firstChild?t.getBorderExtents(n.firstChild):{t:0,l:0,b:0,r:0};c.y+=Math.min(u.t+h.t,p.t+_.t);c.h-=Math.min(u.t+h.t,p.t+_.t)+Math.min(u.b+h.b,p.b+_.b)}}else c=o;if(o.parentNode)for(var m="absolute"==i.getComputedStyle(o).position,g=o.parentNode;g&&1==g.nodeType&&"BODY"!=g.nodeName;){var f=t.position(g,!0),b=i.getComputedStyle(g);/relative|absolute/.test(b.position)&&(m=!1);if(!m&&/hidden|auto|scroll/.test(b.overflow)){var y=Math.min(c.y+c.h,f.y+f.h),v=Math.min(c.x+c.w,f.x+f.w);c.x=Math.max(c.x,f.x);c.y=Math.max(c.y,f.y);c.h=y-c.y;c.w=v-c.x}"absolute"==b.position&&(m=!0);g=g.parentNode}var w=c.x,x=c.y,k="w"in c?c.w:c.w=c.width,C="h"in c?c.h:(a.deprecated("place.around: dijit/place.__Rectangle: { x:"+w+", y:"+x+", height:"+c.height+", width:"+k+" } has been deprecated.  Please use { x:"+w+", y:"+x+", h:"+c.height+", w:"+k+" }","","2.0"),c.h=c.height),T=[];function j(e,t){T.push({aroundCorner:e,corner:t,pos:{x:{L:w,R:w+k,M:w+(k>>1)}[e.charAt(1)],y:{T:x,B:x+C,M:x+(C>>1)}[e.charAt(0)]}})}e.forEach(s,function(e){var t=l;switch(e){case"above-centered":j("TM","BM");break;case"below-centered":j("BM","TM");break;case"after-centered":t=!t;case"before-centered":j(t?"ML":"MR",t?"MR":"ML");break;case"after":t=!t;case"before":j(t?"TL":"TR",t?"TR":"TL");j(t?"BL":"BR",t?"BR":"BL");break;case"below-alt":t=!t;case"below":j(t?"BL":"BR",t?"TL":"TR");j(t?"BR":"BL",t?"TR":"TL");break;case"above-alt":t=!t;case"above":j(t?"TL":"TR",t?"BL":"BR");j(t?"TR":"TL",t?"BR":"BL");break;default:j(e.aroundCorner,e.corner)}});var S=r(n,T,d,{w:k,h:C});S.aroundNodePos=c;return S}};return s.place=d})},"dojox/uuid/generateRandomUuid":function(){define(["./_base"],function(){dojox.uuid.generateRandomUuid=function(){function e(){for(var e=Math.floor(Math.random()%1*Math.pow(2,32)).toString(16);e.length<8;)e="0"+e;return e}var t="-",i=e(),a=e();a=a.substring(0,4)+t+"4"+a.substring(5,8);var n=e(),o=i+t+a+t+(n="8"+n.substring(1,4)+t+n.substring(4,8))+e();return o=o.toLowerCase()};return dojox.uuid.generateRandomUuid})},"dojox/uuid/_base":function(){define(["dojo/_base/kernel","dojo/_base/lang"],function(e){e.getObject("uuid",!0,dojox);dojox.uuid.NIL_UUID="00000000-0000-0000-0000-000000000000";dojox.uuid.version={UNKNOWN:0,TIME_BASED:1,DCE_SECURITY:2,NAME_BASED_MD5:3,RANDOM:4,NAME_BASED_SHA1:5};dojox.uuid.variant={NCS:"0",DCE:"10",MICROSOFT:"110",UNKNOWN:"111"};dojox.uuid.assert=function(e,t){if(!e){t||(t="An assert statement failed.\nThe method dojox.uuid.assert() was called with a 'false' value.\n");throw new Error(t)}};dojox.uuid.generateNilUuid=function(){return dojox.uuid.NIL_UUID};dojox.uuid.isValid=function(t){t=t.toString();var i=e.isString(t)&&36==t.length&&t==t.toLowerCase();if(i){var a=t.split("-");i=5==a.length&&8==a[0].length&&4==a[1].length&&4==a[2].length&&4==a[3].length&&12==a[4].length;for(var n in a){var o=a[n],s=parseInt(o,16);i=i&&isFinite(s)}}return i};dojox.uuid.getVariant=function(e){if(!dojox.uuid._ourVariantLookupTable){var t=dojox.uuid.variant,i=[];i[0]=t.NCS;i[1]=t.NCS;i[2]=t.NCS;i[3]=t.NCS;i[4]=t.NCS;i[5]=t.NCS;i[6]=t.NCS;i[7]=t.NCS;i[8]=t.DCE;i[9]=t.DCE;i[10]=t.DCE;i[11]=t.DCE;i[12]=t.MICROSOFT;i[13]=t.MICROSOFT;i[14]=t.UNKNOWN;i[15]=t.UNKNOWN;dojox.uuid._ourVariantLookupTable=i}var a=(e=e.toString()).charAt(19),n=parseInt(a,16);dojox.uuid.assert(n>=0&&n<=16);return dojox.uuid._ourVariantLookupTable[n]};dojox.uuid.getVersion=function(e){dojox.uuid.assert(dojox.uuid.getVariant(e)==dojox.uuid.variant.DCE,"dojox.uuid.getVersion() was not passed a DCE Variant UUID.");var t=(e=e.toString()).charAt(14);return parseInt(t,16)};dojox.uuid.getNode=function(e){dojox.uuid.assert(dojox.uuid.getVersion(e)==dojox.uuid.version.TIME_BASED,"dojox.uuid.getNode() was not passed a TIME_BASED UUID.");return(e=e.toString()).split("-")[4]};dojox.uuid.getTimestamp=function(e,t){dojox.uuid.assert(dojox.uuid.getVersion(e)==dojox.uuid.version.TIME_BASED,"dojox.uuid.getTimestamp() was not passed a TIME_BASED UUID.");e=e.toString();t||(t=null);switch(t){case"string":case String:return dojox.uuid.getTimestamp(e,Date).toUTCString();case"hex":var i=e.split("-"),a=i[0],n=i[1],o=i[2],s=(o=o.slice(1))+n+a;dojox.uuid.assert(15==s.length);return s;case null:case"date":case Date:var r=e.split("-"),l=parseInt(r[0],16),d=parseInt(r[1],16),c=4095&parseInt(r[2],16);c<<=16;c+=d;c*=4294967296;c+=l;return new Date(c/1e4-122192928e5);default:dojox.uuid.assert(!1,"dojox.uuid.getTimestamp was not passed a valid returnType: "+t)}};return dojox.uuid})},"dojo/back":function(){define(["./_base/config","./_base/lang","./sniff","./dom","./dom-construct","./_base/window","require"],function(e,t,i,a,n,o,s){var r={};t.setObject("dojo.back",r);var l=r.getHash=function(){var e=window.location.hash;"#"==e.charAt(0)&&(e=e.substring(1));return i("mozilla")?e:decodeURIComponent(e)},d=r.setHash=function(e){e||(e="");window.location.hash=encodeURIComponent(e);history.length},c="undefined"!=typeof window?window.location.href:"",u="undefined"!=typeof window?l():"",h=null,p=null,_=null,m=null,g=[],f=[],b=!1,y=!1;function v(){var e=f.pop();if(e){var t=f[f.length-1];t||0!=f.length||(t=h);t&&(t.kwArgs.back?t.kwArgs.back():t.kwArgs.backButton?t.kwArgs.backButton():t.kwArgs.handle&&t.kwArgs.handle("back"));g.push(e)}}r.goBack=v;function w(){var e=g.pop();if(e){e.kwArgs.forward?e.kwArgs.forward():e.kwArgs.forwardButton?e.kwArgs.forwardButton():e.kwArgs.handle&&e.kwArgs.handle("forward");f.push(e)}}r.goForward=w;function x(e,t,i){return{url:e,kwArgs:t,urlHash:i}}function k(e){var t=e.split("?");return t.length<2?null:t[1]}function C(){var t=(e.dojoIframeHistoryUrl||s.toUrl("./resources/iframe_history.html"))+"?"+(new Date).getTime();b=!0;m&&(i("webkit")?m.location=t:window.frames[m.name].location=t);return t}function T(){if(!y){var e=f.length,t=l();if((t===u||window.location.href==c)&&1==e){v();return}if(g.length>0&&g[g.length-1].urlHash===t){w();return}e>=2&&f[e-2]&&f[e-2].urlHash===t&&v()}}r.init=function(){if(!a.byId("dj_history")){var t=e.dojoIframeHistoryUrl||s.toUrl("./resources/iframe_history.html");e.afterOnLoad?console.error("dojo/back::init() must be called before the DOM has loaded. Include dojo/back in a build layer."):document.write('<iframe style="border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;" name="dj_history" id="dj_history" src="'+t+'"></iframe>')}};r.setInitialState=function(e){h=x(c,e,u)};r.addToHistory=function(t){g=[];var a=null,s=null;if(!m){e.useXDomain&&e.dojoIframeHistoryUrl;m=window.frames.dj_history}_||(_=n.create("a",{style:{display:"none"}},o.body()));if(t.changeUrl){a=""+(!0!==t.changeUrl?t.changeUrl:(new Date).getTime());if(0==f.length&&h.urlHash==a){h=x(s,t,a);return}if(f.length>0&&f[f.length-1].urlHash==a){f[f.length-1]=x(s,t,a);return}y=!0;setTimeout(function(){d(a);y=!1},1);_.href=a;if(i("ie")){s=C();var r=t.back||t.backButton||t.handle,c=function(e){""!=l()&&setTimeout(function(){d(a)},1);r.apply(this,[e])};t.back?t.back=c:t.backButton?t.backButton=c:t.handle&&(t.handle=c);var u=t.forward||t.forwardButton||t.handle,b=function(e){""!=l()&&d(a);u&&u.apply(this,[e])};t.forward?t.forward=b:t.forwardButton?t.forwardButton=b:t.handle&&(t.handle=b)}else i("ie")||p||(p=setInterval(T,200))}else s=C();f.push(x(s,t,a))};r._iframeLoaded=function(e,t){var i=k(t.href);null!=i?b?b=!1:f.length>=2&&i==k(f[f.length-2].url)?v():g.length>0&&i==k(g[g.length-1].url)&&w():1==f.length&&v()};return r})},"dojo/hash":function(){define(["./_base/kernel","require","./_base/config","./aspect","./_base/lang","./topic","./domReady","./sniff"],function(e,t,i,a,n,o,s,r){e.hash=function(e,t){if(!arguments.length)return p();"#"==e.charAt(0)&&(e=e.substring(1));t?g(e):location.hash="#"+e;return e};var l,d,c,u=i.hashPollFrequency||100;function h(e,t){var i=e.indexOf(t);return i>=0?e.substring(i+1):""}function p(){return h(location.href,"#")}function _(){o.publish("/dojo/hashchange",p())}function m(){if(p()!==l){l=p();_()}}function g(e){if(d){if(d.isTransitioning()){setTimeout(n.hitch(null,g,e),u);return}var t=(i=d.iframe.location.href).indexOf("?");d.iframe.location.replace(i.substring(0,t)+"?"+e)}else{var i=location.href.replace(/#.*/,"");location.replace(i+"#"+e);!c&&m()}}function f(){var a=document.createElement("iframe"),o="dojo-hash-iframe",s=i.dojoBlankHtmlUrl||t.toUrl("./resources/blank.html");i.useXDomain&&i.dojoBlankHtmlUrl;a.id=o;a.src=s+"?"+p();a.style.display="none";document.body.appendChild(a);this.iframe=e.global[o];var r,d,c,m,g,f=this.iframe.location;function b(){l=p();r=g?l:h(f.href,"?");d=!1;c=null}this.isTransitioning=function(){return d};this.pollLocation=function(){if(!g)try{var e=h(f.href,"?");document.title!=m&&(m=this.iframe.document.title=document.title)}catch(i){g=!0;console.error("dojo/hash: Error adding history entry. Server unreachable.")}var t=p();if(d&&l===t){if(!g&&e!==c){setTimeout(n.hitch(this,this.pollLocation),0);return}b();_()}else if(l!==t||!g&&r!==e){if(l!==t){l=t;d=!0;c=t;a.src=s+"?"+c;g=!1;setTimeout(n.hitch(this,this.pollLocation),0);return}if(!g){location.href="#"+f.search.substring(1);b();_()}}else;setTimeout(n.hitch(this,this.pollLocation),u)};b();setTimeout(n.hitch(this,this.pollLocation),u)}s(function(){if("onhashchange"in e.global&&(!r("ie")||r("ie")>=8&&"BackCompat"!=document.compatMode))c=a.after(e.global,"onhashchange",_,!0);else if(document.addEventListener){l=p();setInterval(m,u)}else document.attachEvent&&(d=new f)});return e.hash})},"dojox/dtl/filter/strings":function(){define(["dojo/_base/lang","dojo/_base/array","dojox/string/tokenize","dojox/string/sprintf","../filter/htmlstrings","../_base"],function(e,t,i,a,n,o){var s=e.getObject("filter.strings",!0,o);e.mixin(s,{_urlquote:function(e,t){t||(t="/");return i(e,/([^\w-_.])/g,function(e){if(-1==t.indexOf(e)){if(" "==e)return"+";for(var i=e.charCodeAt(0).toString(16).toUpperCase();i.length<2;)i="0"+i;return"%"+i}return e}).join("")},addslashes:function(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'")},capfirst:function(e){return(e=""+e).charAt(0).toUpperCase()+e.substring(1)},center:function(e,t){var i=(t=t||e.length)-(e+="").length;if(i%2){e+=" ";i-=1}for(var a=0;a<i;a+=2)e=" "+e+" ";return e},cut:function(e,t){t=t+""||"";return(e+="").replace(new RegExp(t,"g"),"")},_fix_ampersands:/&(?!(\w+|#\d+);)/g,fix_ampersands:function(e){return e.replace(s._fix_ampersands,"&amp;")},floatformat:function(e,t){t=parseInt(t||-1,10);if(!((e=parseFloat(e))-e.toFixed(0))&&t<0)return e.toFixed();e=e.toFixed(Math.abs(t));return t<0?parseFloat(e)+"":e},iriencode:function(e){return s._urlquote(e,"/#%[]=:;$&()+,!")},linenumbers:function(e){for(var t,i=dojox.dtl.filter,a=e.split("\n"),n=[],o=(a.length+"").length,s=0;s<a.length;s++){t=a[s];n.push(i.strings.ljust(s+1,o)+". "+dojox.dtl._base.escape(t))}return n.join("\n")},ljust:function(e,t){e+="";t=parseInt(t,10);for(;e.length<t;)e+=" ";return e},lower:function(e){return(e+"").toLowerCase()},make_list:function(e){var t=[];"number"==typeof e&&(e+="");if(e.charAt){for(var i=0;i<e.length;i++)t.push(e.charAt(i));return t}if("object"==typeof e){for(var a in e)t.push(e[a]);return t}return[]},rjust:function(e,t){e+="";t=parseInt(t,10);for(;e.length<t;)e=" "+e;return e},slugify:function(e){return(e=e.replace(/[^\w\s-]/g,"").toLowerCase()).replace(/[\-\s]+/g,"-")},_strings:{},stringformat:function(e,t){t=""+t;var i=s._strings;i[t]||(i[t]=new a.Formatter("%"+t));return i[t].format(e)},title:function(e){for(var t,i,a="",n=0;n<e.length;n++){i=e.charAt(n);a+=" "!=t&&"\n"!=t&&"\t"!=t&&t?i.toLowerCase():i.toUpperCase();t=i}return a},_truncatewords:/[ \n\r\t]/,truncatewords:function(e,t){if(!(t=parseInt(t,10)))return e;for(var i,a,n=0,o=e.length,r=0;n<e.length;n++){i=e.charAt(n);if(s._truncatewords.test(a)){if(!s._truncatewords.test(i)&&++r==t)return e.substring(0,o+1)+" ..."}else s._truncatewords.test(i)||(o=n);a=i}return e},_truncate_words:/(&.*?;|<.*?>|(\w[\w\-]*))/g,_truncate_tag:/<(\/)?([^ ]+?)(?: (\/)| .*?)?>/,_truncate_singlets:{br:!0,col:!0,link:!0,base:!0,img:!0,param:!0,area:!0,hr:!0,input:!0},truncatewords_html:function(e,a){if((a=parseInt(a,10))<=0)return"";var n=0,o=[],r=i(e,s._truncate_words,function(e,i){if(i){if(++n<a)return i;if(n==a)return i+" ..."}var r=e.match(s._truncate_tag);if(r&&!(n>=a)){var l=r[1],d=r[2].toLowerCase();r[3];if(l||s._truncate_singlets[d]);else if(l){var c=t.indexOf(o,d);-1!=c&&(o=o.slice(c+1))}else o.unshift(d);return e}}).join("");r=r.replace(/\s+$/g,"");for(var l,d=0;l=o[d];d++)r+="</"+l+">";return r},upper:function(e){return e.toUpperCase()},urlencode:function(e){return s._urlquote(e)},_urlize:/^((?:[(>]|&lt;)*)(.*?)((?:[.,)>\n]|&gt;)*)$/,_urlize2:/^\S+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+$/,urlize:function(e){return s.urlizetrunc(e)},urlizetrunc:function(e,t){t=parseInt(t);return i(e,/(\S+)/g,function(e){var i=s._urlize.exec(e);if(!i)return e;i[1];var a=i[2],n=(i[3],0==a.indexOf("www.")),o=-1!=a.indexOf("@"),r=-1!=a.indexOf(":"),l=0==a.indexOf("http://"),d=0==a.indexOf("https://"),c=/[a-zA-Z0-9]/.test(a.charAt(0)),u=a.substring(a.length-4),h=a;t>3&&(h=h.substring(0,t-3)+"...");return n||!o&&!l&&a.length&&c&&(".org"==u||".net"==u||".com"==u)?'<a href="http://'+a+'" rel="nofollow">'+h+"</a>":l||d?'<a href="'+a+'" rel="nofollow">'+h+"</a>":o&&!n&&!r&&s._urlize2.test(a)?'<a href="mailto:'+a+'">'+a+"</a>":e}).join("")},wordcount:function(t){return(t=e.trim(t))?t.split(/\s+/g).length:0},wordwrap:function(e,t){t=parseInt(t);var i=[],a=e.split(/\s+/g);if(a.length){var n=a.shift();i.push(n);for(var o=n.length-n.lastIndexOf("\n")-1,s=0;s<a.length;s++){if(-1!=(n=a[s]).indexOf("\n"))var r=n.split(/\n/g);else r=[n];o+=r[0].length+1;if(t&&o>t){i.push("\n");o=r[r.length-1].length}else{i.push(" ");r.length>1&&(o=r[r.length-1].length)}i.push(n)}}return i.join("")}});return s})},"dojox/string/tokenize":function(){define(["dojo/_base/lang","dojo/_base/sniff"],function(e,t){e.getObject("dojox.string",!0).tokenize;return function(e,i,a,n){for(var o,s,r=[],l=0;o=i.exec(e);){(s=e.slice(l,i.lastIndex-o[0].length)).length&&r.push(s);if(a){if(t("opera")){for(var d=o.slice(0);d.length<o.length;)d.push(null);o=d}var c=a.apply(n,o.slice(1).concat(r.length));void 0!==c&&r.push(c)}l=i.lastIndex}(s=e.slice(l)).length&&r.push(s);return r}})},"dojox/string/sprintf":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/sniff","./tokenize"],function(e,t,i,a){var n=t.getObject("string",!0,dojox);n.sprintf=function(e,t){for(var i=[],a=1;a<arguments.length;a++)i.push(arguments[a]);var o=new n.sprintf.Formatter(e);return o.format.apply(o,i)};n.sprintf.Formatter=function(e){this._mapped=!1;this._format=e;this._tokens=a(e,this._re,this._parseDelim,this)};t.extend(n.sprintf.Formatter,{_re:/\%(?:\(([\w_]+)\)|([1-9]\d*)\$)?([0 +\-\#]*)(\*|\d+)?(\.)?(\*|\d+)?[hlL]?([\%scdeEfFgGiouxX])/g,_parseDelim:function(e,t,i,a,n,o,s){e&&(this._mapped=!0);return{mapping:e,intmapping:t,flags:i,_minWidth:a,period:n,_precision:o,specifier:s}},_specifiers:{b:{base:2,isInt:!0},o:{base:8,isInt:!0},x:{base:16,isInt:!0},X:{extend:["x"],toUpper:!0},d:{base:10,isInt:!0},i:{extend:["d"]},u:{extend:["d"],isUnsigned:!0},c:{setArg:function(e){if(!isNaN(e.arg)){var t=parseInt(e.arg);if(t<0||t>127)throw new Error("invalid character code passed to %c in sprintf");e.arg=isNaN(t)?""+t:String.fromCharCode(t)}}},s:{setMaxWidth:function(e){e.maxWidth="."==e.period?e.precision:-1}},e:{isDouble:!0,doubleNotation:"e"},E:{extend:["e"],toUpper:!0},f:{isDouble:!0,doubleNotation:"f"},F:{extend:["f"]},g:{isDouble:!0,doubleNotation:"g"},G:{extend:["g"],toUpper:!0}},format:function(e){if(this._mapped&&"object"!=typeof e)throw new Error("format requires a mapping");for(var i,a="",n=0,o=0;o<this._tokens.length;o++)if("string"==typeof(i=this._tokens[o]))a+=i;else{if(this._mapped){if(void 0===e[i.mapping])throw new Error("missing key "+i.mapping);i.arg=e[i.mapping]}else{if(i.intmapping)n=parseInt(i.intmapping)-1;if(n>=arguments.length)throw new Error("got "+arguments.length+" printf arguments, insufficient for '"+this._format+"'");i.arg=arguments[n++]}if(!i.compiled){i.compiled=!0;i.sign="";i.zeroPad=!1;i.rightJustify=!1;i.alternative=!1;for(var s={},r=i.flags.length;r--;){var l=i.flags.charAt(r);s[l]=!0;switch(l){case" ":i.sign=" ";break;case"+":i.sign="+";break;case"0":i.zeroPad=!s["-"];break;case"-":i.rightJustify=!0;i.zeroPad=!1;break;case"#":i.alternative=!0;break;default:throw Error("bad formatting flag '"+i.flags.charAt(r)+"'")}}i.minWidth=i._minWidth?parseInt(i._minWidth):0;i.maxWidth=-1;i.toUpper=!1;i.isUnsigned=!1;i.isInt=!1;i.isDouble=!1;i.precision=1;"."==i.period&&(i._precision?i.precision=parseInt(i._precision):i.precision=0);var d=this._specifiers[i.specifier];if(void 0===d)throw new Error("unexpected specifier '"+i.specifier+"'");if(d.extend){t.mixin(d,this._specifiers[d.extend]);delete d.extend}t.mixin(i,d)}"function"==typeof i.setArg&&i.setArg(i);"function"==typeof i.setMaxWidth&&i.setMaxWidth(i);if("*"==i._minWidth){if(this._mapped)throw new Error("* width not supported in mapped formats");i.minWidth=parseInt(arguments[n++]);if(isNaN(i.minWidth))throw new Error("the argument for * width at position "+n+" is not a number in "+this._format);if(i.minWidth<0){i.rightJustify=!0;i.minWidth=-i.minWidth}}if("*"==i._precision&&"."==i.period){if(this._mapped)throw new Error("* precision not supported in mapped formats");i.precision=parseInt(arguments[n++]);if(isNaN(i.precision))throw Error("the argument for * precision at position "+n+" is not a number in "+this._format);if(i.precision<0){i.precision=1;i.period=""}}if(i.isInt){"."==i.period&&(i.zeroPad=!1);this.formatInt(i)}else if(i.isDouble){"."!=i.period&&(i.precision=6);this.formatDouble(i)}this.fitField(i);a+=""+i.arg}return a},_zeros10:"0000000000",_spaces10:"          ",formatInt:function(e){var t=parseInt(e.arg);if(!isFinite(t)){if("number"!=typeof e.arg)throw new Error("format argument '"+e.arg+"' not an integer; parseInt returned "+t);t=0}t<0&&(e.isUnsigned||10!=e.base)&&(t=4294967295+t+1);if(t<0){e.arg=(-t).toString(e.base);this.zeroPad(e);e.arg="-"+e.arg}else{e.arg=t.toString(e.base);t||e.precision?this.zeroPad(e):e.arg="";e.sign&&(e.arg=e.sign+e.arg)}if(16==e.base){e.alternative&&(e.arg="0x"+e.arg);e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()}8==e.base&&e.alternative&&"0"!=e.arg.charAt(0)&&(e.arg="0"+e.arg)},formatDouble:function(e){var t=parseFloat(e.arg);if(!isFinite(t)){if("number"!=typeof e.arg)throw new Error("format argument '"+e.arg+"' not a float; parseFloat returned "+t);t=0}switch(e.doubleNotation){case"e":e.arg=t.toExponential(e.precision);break;case"f":e.arg=t.toFixed(e.precision);break;case"g":Math.abs(t)<1e-4?e.arg=t.toExponential(e.precision>0?e.precision-1:e.precision):e.arg=t.toPrecision(e.precision);if(!e.alternative){e.arg=e.arg.replace(/(\..*[^0])0*/,"$1");e.arg=e.arg.replace(/\.0*e/,"e").replace(/\.0$/,"")}break;default:throw new Error("unexpected double notation '"+e.doubleNotation+"'")}e.arg=e.arg.replace(/e\+(\d)$/,"e+0$1").replace(/e\-(\d)$/,"e-0$1");i("opera")&&(e.arg=e.arg.replace(/^\./,"0."));if(e.alternative){e.arg=e.arg.replace(/^(\d+)$/,"$1.");e.arg=e.arg.replace(/^(\d+)e/,"$1.e")}t>=0&&e.sign&&(e.arg=e.sign+e.arg);e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()},zeroPad:function(e,t){t=2==arguments.length?t:e.precision;"string"!=typeof e.arg&&(e.arg=""+e.arg);for(var i=t-10;e.arg.length<i;)e.arg=e.rightJustify?e.arg+this._zeros10:this._zeros10+e.arg;var a=t-e.arg.length;e.arg=e.rightJustify?e.arg+this._zeros10.substring(0,a):this._zeros10.substring(0,a)+e.arg},fitField:function(e){if(e.maxWidth>=0&&e.arg.length>e.maxWidth)return e.arg.substring(0,e.maxWidth);e.zeroPad?this.zeroPad(e,e.minWidth):this.spacePad(e)},spacePad:function(e,t){t=2==arguments.length?t:e.minWidth;"string"!=typeof e.arg&&(e.arg=""+e.arg);for(var i=t-10;e.arg.length<i;)e.arg=e.rightJustify?e.arg+this._spaces10:this._spaces10+e.arg;var a=t-e.arg.length;e.arg=e.rightJustify?e.arg+this._spaces10.substring(0,a):this._spaces10.substring(0,a)+e.arg}});return n.sprintf})},"dojox/dtl/filter/htmlstrings":function(){define(["dojo/_base/lang","../_base"],function(e,t){var i=e.getObject("filter.htmlstrings",!0,t);e.mixin(i,{_linebreaksrn:/(\r\n|\n\r)/g,_linebreaksn:/\n{2,}/g,_linebreakss:/(^\s+|\s+$)/g,_linebreaksbr:/\n/g,_removetagsfind:/[a-z0-9]+/g,_striptags:/<[^>]*?>/g,linebreaks:function(e){for(var t=[],a=i,n=(e=e.replace(a._linebreaksrn,"\n")).split(a._linebreaksn),o=0;o<n.length;o++){var s=n[o].replace(a._linebreakss,"").replace(a._linebreaksbr,"<br />");t.push("<p>"+s+"</p>")}return t.join("\n\n")},linebreaksbr:function(e){var t=i;return e.replace(t._linebreaksrn,"\n").replace(t._linebreaksbr,"<br />")},removetags:function(e,t){for(var a,n=i,o=[];a=n._removetagsfind.exec(t);)o.push(a[0]);o="("+o.join("|")+")";return e.replace(new RegExp("</?s*"+o+"s*[^>]*>","gi"),"")},striptags:function(e){return e.replace(dojox.dtl.filter.htmlstrings._striptags,"")}});return i})},"dojox/dtl/_base":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojox/string/tokenize","dojo/_base/json","dojo/dom","dojo/_base/xhr","dojox/string/Builder","dojo/_base/Deferred"],function(e,t,a,n,o,s,r,l){e.experimental("dojox.dtl");var d=t.getObject("dojox.dtl",!0);d._base={};d.TOKEN_BLOCK=-1;d.TOKEN_VAR=-2;d.TOKEN_COMMENT=-3;d.TOKEN_TEXT=3;d._Context=t.extend(function(e){if(e){t._mixin(this,e);if(e.get){this._getter=e.get;delete this.get}}},{push:function(){var e=this,i=t.delegate(this);i.pop=function(){return e};return i},pop:function(){throw new Error("pop() called on empty Context")},get:function(e,t){var i=this._normalize;if(this._getter){var a=this._getter(e);if(void 0!==a)return i(a)}return void 0!==this[e]?i(this[e]):t},_normalize:function(e){if(e instanceof Date){e.year=e.getFullYear();e.month=e.getMonth()+1;e.day=e.getDate();e.date=e.year+"-"+("0"+e.month).slice(-2)+"-"+("0"+e.day).slice(-2);e.hour=e.getHours();e.minute=e.getMinutes();e.second=e.getSeconds();e.microsecond=e.getMilliseconds()}return e},update:function(e){var i=this.push();e&&t._mixin(this,e);return i}});var c=/("(?:[^"\\]*(?:\\.[^"\\]*)*)"|'(?:[^'\\]*(?:\\.[^'\\]*)*)'|[^\s]+)/g,u=/\s+/g,h=function(e,t){(e=e||u)instanceof RegExp||(e=new RegExp(e,"g"));if(!e.global)throw new Error("You must use a globally flagged RegExp with split "+e);e.exec("");for(var i,a=[],n=0,o=0;i=e.exec(this);){a.push(this.slice(n,e.lastIndex-i[0].length));n=e.lastIndex;if(t&&++o>t-1)break}a.push(this.slice(n));return a};d.Token=function(e,i){this.token_type=e;this.contents=new String(t.trim(i));this.contents.split=h;this.split=function(){return String.prototype.split.apply(this.contents,arguments)}};d.Token.prototype.split_contents=function(e){var t,i=[],a=0;e=e||999;for(;a++<e&&(t=c.exec(this.contents));)'"'==(t=t[0]).charAt(0)&&'"'==t.slice(-1)?i.push('"'+t.slice(1,-1).replace('\\"','"').replace("\\\\","\\")+'"'):"'"==t.charAt(0)&&"'"==t.slice(-1)?i.push("'"+t.slice(1,-1).replace("\\'","'").replace("\\\\","\\")+"'"):i.push(t);return i};var p=d.text={_get:function(e,i,a){var n=d.register.get(e,i.toLowerCase(),a);if(!n){if(!a)throw new Error("No tag found for "+i);return null}var o,s=n[1],r=n[2];if(-1!=s.indexOf(":")){o=s.split(":");s=o.pop()}var l=r;/\./.test(r)&&(r=r.replace(/\./g,"/"));require([r],function(){});var c=t.getObject(l);return c[s||i]||c[i+"_"]||c[s+"_"]},getTag:function(e,t){return p._get("tag",e,t)},getFilter:function(e,t){return p._get("filter",e,t)},getTemplate:function(e){return new d.Template(p.getTemplateString(e))},getTemplateString:function(e){return s._getText(e.toString())||""},_resolveLazy:function(e,t,i){return t?i?i.fromJson(s._getText(e))||{}:d.text.getTemplateString(e):s.get({handleAs:i?"json":"text",url:e})},_resolveTemplateArg:function(e,t){if(p._isTemplate(e)){if(!t){var i=new l;i.callback(e);return i}return e}return p._resolveLazy(e,t)},_isTemplate:function(e){return void 0===e||"string"==typeof e&&(e.match(/^\s*[<{]/)||-1!=e.indexOf(" "))},_resolveContextArg:function(e,t){if(e.constructor==Object){if(!t){var i=new l;i.callback(e);return i}return e}return p._resolveLazy(e,t,!0)},_re:/(?:\{\{\s*(.+?)\s*\}\}|\{%\s*(load\s*)?(.+?)\s*%\})/g,tokenize:function(e){return a(e,p._re,p._parseDelims)},_parseDelims:function(e,i,a){if(e)return[d.TOKEN_VAR,e];if(!i)return[d.TOKEN_BLOCK,a];for(var n,o=t.trim(a).split(/\s+/g),s=0;n=o[s];s++){/\./.test(n)&&(n=n.replace(/\./g,"/"));require([n])}}};d.Template=t.extend(function(e,t){var i=t?e:p._resolveTemplateArg(e,!0)||"",a=p.tokenize(i),n=new d._Parser(a);this.nodelist=n.parse()},{update:function(e,t){return p._resolveContextArg(t).addCallback(this,function(t){var i=this.render(new d._Context(t));e.forEach?e.forEach(function(e){e.innerHTML=i}):o.byId(e).innerHTML=i;return this})},render:function(e,t){t=t||this.getBuffer();e=e||new d._Context({});return this.nodelist.render(e,t)+""},getBuffer:function(){return new r}});var _=/\{\{\s*(.+?)\s*\}\}/g;d.quickFilter=function(e){return e?-1==e.indexOf("{%")?new d._QuickNodeList(a(e,_,function(e){return new d._Filter(e)})):void 0:new d._NodeList};d._QuickNodeList=t.extend(function(e){this.contents=e},{render:function(e,t){for(var i=0,a=this.contents.length;i<a;i++)t=this.contents[i].resolve?t.concat(this.contents[i].resolve(e)):t.concat(this.contents[i]);return t},dummyRender:function(e){return this.render(e,d.Template.prototype.getBuffer()).toString()},clone:function(e){return this}});d._Filter=t.extend(function(e){if(!e)throw new Error("Filter must be called with variable name");this.contents=e;var t=this._cache[e];if(t){this.key=t[0];this.filters=t[1]}else{this.filters=[];a(e,this._re,this._tokenize,this);this._cache[e]=[this.key,this.filters]}},{_cache:{},_re:/(?:^_\("([^\\"]*(?:\\.[^\\"])*)"\)|^"([^\\"]*(?:\\.[^\\"]*)*)"|^([a-zA-Z0-9_.]+)|\|(\w+)(?::(?:_\("([^\\"]*(?:\\.[^\\"])*)"\)|"([^\\"]*(?:\\.[^\\"]*)*)"|([a-zA-Z0-9_.]+)|'([^\\']*(?:\\.[^\\']*)*)'))?|^'([^\\']*(?:\\.[^\\']*)*)')/g,_values:{0:'"',1:'"',2:"",8:'"'},_args:{4:'"',5:'"',6:"",7:"'"},_tokenize:function(){for(var e,i,a=0,n=[];a<arguments.length;a++)n[a]=void 0!==arguments[a]&&"string"==typeof arguments[a]&&arguments[a];if(this.key){for(e in this._args)if(n[e]){var o=arguments[e];"'"==this._args[e]?o=o.replace(/\\'/g,"'"):'"'==this._args[e]&&(o=o.replace(/\\"/g,'"'));i=[!this._args[e],o];break}var s=p.getFilter(arguments[3]);if(!t.isFunction(s))throw new Error(arguments[3]+" is not registered as a filter");this.filters.push([s,i])}else for(e in this._values)if(n[e]){this.key=this._values[e]+arguments[e]+this._values[e];break}},getExpression:function(){return this.contents},resolve:function(e){if(void 0===this.key)return"";for(var t,i=this.resolvePath(this.key,e),a=0;t=this.filters[a];a++)i=t[1]?t[1][0]?t[0](i,this.resolvePath(t[1][1],e)):t[0](i,t[1][1]):t[0](i);return i},resolvePath:function(e,i){var a,n,o=e.charAt(0),s=e.slice(-1);if(isNaN(parseInt(o)))if('"'==o&&o==s)a=e.slice(1,-1);else{if("true"==e)return!0;if("false"==e)return!1;if("null"==e||"None"==e)return null;n=e.split(".");a=i.get(n[0]);if(t.isFunction(a)){var r=i.getThis&&i.getThis();a=a.alters_data?"":r?a.call(r):""}for(var l=1;l<n.length;l++){var c=n[l];if(!a)return"";var u=a;if(t.isObject(a)&&"items"==c&&void 0===a[c]){var h=[];for(var p in a)h.push([p,a[p]]);a=h}else{if(a.get&&t.isFunction(a.get)&&a.get.safe)a=a.get(c);else{if(void 0===a[c]){a=a[c];break}a=a[c]}t.isFunction(a)?a=a.alters_data?"":a.call(u):a instanceof Date&&(a=d._Context.prototype._normalize(a))}}}else a=-1==e.indexOf(".")?parseInt(e):parseFloat(e);return a}});d._TextNode=d._Node=t.extend(function(e){this.contents=e},{set:function(e){this.contents=e;return this},render:function(e,t){return t.concat(this.contents)},isEmpty:function(){return!t.trim(this.contents)},clone:function(){return this}});d._NodeList=t.extend(function(e){this.contents=e||[];this.last=""},{push:function(e){this.contents.push(e);return this},concat:function(e){this.contents=this.contents.concat(e);return this},render:function(e,t){for(var i=0;i<this.contents.length;i++)if(!(t=this.contents[i].render(e,t)))throw new Error("Template must return buffer");return t},dummyRender:function(e){return this.render(e,d.Template.prototype.getBuffer()).toString()},unrender:function(){return arguments[1]},clone:function(){return this},rtrim:function(){for(;;){i=this.contents.length-1;if(!(this.contents[i]instanceof d._TextNode&&this.contents[i].isEmpty()))break;this.contents.pop()}return this}});d._VarNode=t.extend(function(e){this.contents=new d._Filter(e)},{render:function(e,t){var i=this.contents.resolve(e);null==i&&(i="");i.safe||(i=d._base.escape(""+i));return t.concat(i)}});d._noOpNode=new function(){this.render=this.unrender=function(){return arguments[1]};this.clone=function(){return this}};d._Parser=t.extend(function(e){this.contents=e},{i:0,parse:function(e){var t,i={};e=e||[];for(var a=0;a<e.length;a++)i[e[a]]=!0;for(var n=new d._NodeList;this.i<this.contents.length;)if("string"==typeof(t=this.contents[this.i++]))n.push(new d._TextNode(t));else{var o=t[0],s=t[1];if(o==d.TOKEN_VAR)n.push(new d._VarNode(s));else if(o==d.TOKEN_BLOCK){if(i[s]){--this.i;return n}var r=s.split(/\s+/g);if(r.length){r=r[0];var l=p.getTag(r);l&&n.push(l(this,new d.Token(o,s)))}}}if(e.length)throw new Error("Could not find closing tag(s): "+e.toString());this.contents.length=0;return n},next_token:function(){var e=this.contents[this.i++];return new d.Token(e[0],e[1])},delete_first_token:function(){this.i++},skip_past:function(e){for(;this.i<this.contents.length;){var t=this.contents[this.i++];if(t[0]==d.TOKEN_BLOCK&&t[1]==e)return}throw new Error("Unclosed tag found when looking for "+e)},create_variable_node:function(e){return new d._VarNode(e)},create_text_node:function(e){return new d._TextNode(e||"")},getTemplate:function(e){return new d.Template(e)}});d.register={_registry:{attributes:[],tags:[],filters:[]},get:function(e,t){for(var i,a=d.register._registry[e+"s"],n=0;i=a[n];n++)if("string"==typeof i[0]){if(i[0]==t)return i}else if(t.match(i[0]))return i},getAttributeTags:function(){for(var e,i=[],a=d.register._registry.attributes,n=0;e=a[n];n++)if(3==e.length)i.push(e);else{var o=t.getObject(e[1]);if(o&&t.isFunction(o)){e.push(o);i.push(e)}}return i},_any:function(e,i,a){for(var n in a)for(var o,s=0;o=a[n][s];s++){var r=o;if(t.isArray(o)){r=o[0];o=o[1]}if("string"==typeof r){if("attr:"==r.substr(0,5)){var l=o;"attr:"==l.substr(0,5)&&(l=l.slice(5));d.register._registry.attributes.push([l.toLowerCase(),i+"."+n+"."+l])}r=r.toLowerCase()}d.register._registry[e].push([r,o,i+"."+n])}},tags:function(e,t){d.register._any("tags",e,t)},filters:function(e,t){d.register._any("filters",e,t)}};var m=/&/g,g=/</g,f=/>/g,b=/'/g,y=/"/g;d._base.escape=function(e){return d.mark_safe(e.replace(m,"&amp;").replace(g,"&lt;").replace(f,"&gt;").replace(y,"&quot;").replace(b,"&#39;"))};d._base.safe=function(e){"string"==typeof e&&(e=new String(e));"object"==typeof e&&(e.safe=!0);return e};d.mark_safe=d._base.safe;d.register.tags("dojox.dtl.tag",{date:["now"],logic:["if","for","ifequal","ifnotequal"],loader:["extends","block","include","load","ssi"],misc:["comment","debug","filter","firstof","spaceless","templatetag","widthratio","with"],loop:["cycle","ifchanged","regroup"]});d.register.filters("dojox.dtl.filter",{dates:["date","time","timesince","timeuntil"],htmlstrings:["linebreaks","linebreaksbr","removetags","striptags"],integers:["add","get_digit"],lists:["dictsort","dictsortreversed","first","join","length","length_is","random","slice","unordered_list"],logic:["default","default_if_none","divisibleby","yesno"],misc:["filesizeformat","pluralize","phone2numeric","pprint"],strings:["addslashes","capfirst","center","cut","fix_ampersands","floatformat","iriencode","linenumbers","ljust","lower","make_list","rjust","slugify","stringformat","title","truncatewords","truncatewords_html","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap"]});d.register.filters("dojox.dtl",{_base:["escape","safe"]});return d})},"dojox/string/Builder":function(){define(["dojo/_base/lang"],function(e){var t=e.getObject("string",!0,dojox).Builder=function(e){var t="";this.length=0;this.append=function(e){if(arguments.length>1){var i="";switch(arguments.length){case 9:i=""+arguments[8]+i;case 8:i=""+arguments[7]+i;case 7:i=""+arguments[6]+i;case 6:i=""+arguments[5]+i;case 5:i=""+arguments[4]+i;case 4:i=""+arguments[3]+i;case 3:i=""+arguments[2]+i;case 2:t+=""+arguments[0]+arguments[1]+i;break;default:for(var a=0;a<arguments.length;)i+=arguments[a++];t+=i}}else t+=e;this.length=t.length;return this};this.concat=function(e){return this.append.apply(this,arguments)};this.appendArray=function(e){return this.append.apply(this,e)};this.clear=function(){t="";this.length=0;return this};this.replace=function(e,i){t=t.replace(e,i);this.length=t.length;return this};this.remove=function(e,i){void 0===i&&(i=t.length);if(0==i)return this;t=t.substr(0,e)+t.substr(e+i);this.length=t.length;return this};this.insert=function(e,i){t=0==e?i+t:t.slice(0,e)+i+t.slice(e);this.length=t.length;return this};this.toString=function(){return t};e&&this.append(e)};return t})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(e,t,i,a,n){return e("dijit.form.FilteringSelect",[a,n],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(e,t,i,a){t&&t[this.searchAttr]!==this._lastQuery||!t&&e.length&&this.store.getIdentity(e[0])!=this._lastQuery||(e.length?this.set("item",e[0],a):this.set("value","",a||void 0===a&&!this.focused,this.textbox.value,null))},_openResultList:function(e,t,i){if(t[this.searchAttr]===this._lastQuery){this.inherited(arguments);void 0===this.item&&this.validate(!0)}},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(e,a,n,o){this._onChangeActive||(a=null);if(void 0===o){if(null===e||""===e){e="";if(!t.isString(n)){this._setDisplayedValueAttr(n||"",a);return}}var s=this;this._lastQuery=e;i(this.store.get(e),function(e){s._callbackSetLabel(e?[e]:[],void 0,void 0,a)})}else{this.valueNode.value=e;this.inherited(arguments,[e,a,n,o])}},_setItemAttr:function(e,t,i){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(e){return e.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(e,a){null==e&&(e="");if(!this._created){if(!("displayedValue"in this.params))return;a=!1}if(this.store){this.closeDropDown();var n,o=t.clone(this.query),s=this._getDisplayQueryString(e);this.store._oldAPI?n=s:(n=this._patternToRegExp(s)).toString=function(){return s};this._lastQuery=o[this.searchAttr]=n;this.textbox.value=e;this._lastDisplayedValue=e;this._set("displayedValue",e);var r=this,l={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};t.mixin(l,this.fetchProperties);this._fetchHandle=this.store.query(o,l);i(this._fetchHandle,function(e){r._fetchHandle=null;r._callbackSetLabel(e||[],o,l,a)},function(e){r._fetchHandle=null;r._cancelingQuery||console.error("dijit.form.FilteringSelect: "+e.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(e,t,i,a){return e("dijit.form.MappedTextBox",a,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(e){return e.toString?e.toString():""},toString:function(){var e=this.filter(this.get("value"));return null!=e?"string"==typeof e?e:this.serialize(e,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=i.place("<input type='hidden'"+(this.name&&!t("msapp")?' name="'+this.name.replace(/"/g,"&quot;")+'"':"")+"/>",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ValidationTextBox":function(){define(["dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/i18n","./TextBox","../Tooltip","dojo/text!./templates/ValidationTextBox.html","dojo/i18n!./nls/validate"],function(e,t,i,a,n,o,s){var r=e("dijit.form.ValidationTextBox",n,{templateString:s,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(e,i){if(i!=r.prototype[e]){t.deprecated("ValidationTextBox id="+this.id+", set('"+e+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0");this.set("pattern",i)}},_setRegExpGenAttr:function(e){this._deprecateRegExp("regExpGen",e);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(e){this._deprecateRegExp("regExp",e)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},validator:function(e,t){return new RegExp("^(?:"+this._computeRegexp(t)+")"+(this.required?"":"?")+"$").test(e)&&(!this.required||!this._isEmpty(e))&&(this._isEmpty(e)||void 0!==this.parse(e,t))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,this.get("constraints"))},_isEmpty:function(e){return(this.trim?/^\s*$/:/^$/).test(e)},getErrorMessage:function(){var e="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,t="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:e;return this.required&&this._isEmpty(this.textbox.value)?t:e},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(e){var t="",i=this.disabled||this.isValid(e);i&&(this._maskValidSubsetError=!0);var a=this._isEmpty(this.textbox.value),n=!i&&e&&this._isValidSubset();this._set("state",i?"":((!this._hasBeenBlurred||e)&&a||n)&&(this._maskValidSubsetError||n&&!this._hasBeenBlurred&&e)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");if("Error"==this.state){this._maskValidSubsetError=e&&n;t=this.getErrorMessage(e)}else if("Incomplete"==this.state){t=this.getPromptMessage(e);this._maskValidSubsetError=!this._hasBeenBlurred||e}else a&&(t=this.getPromptMessage(e));this.set("message",t);return i},displayMessage:function(e){e&&this.focused?o.show(e,this.domNode,this.tooltipPosition,!this.isLeftToRight()):o.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(e){this.constraints=i.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(e){!e.locale&&this.lang&&(e.locale=this.lang);this._set("constraints",e);this._refreshState()},_setPatternAttr:function(e){this._set("pattern",e);this._refreshState()},_computeRegexp:function(e){var t=this.pattern;"function"==typeof t&&(t=t.call(this,e));if(t!=this._lastRegExp){var i="";this._lastRegExp=t;".*"!=t&&t.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(e){switch(e.charAt(0)){case"{":case"+":case"?":case"*":case"^":case"$":case"|":case"(":i+=e;break;case")":i+="|$)";break;default:i+="(?:"+e+"|$)"}});try{"".search(i)}catch(a){i=this.pattern;this.declaredClass,this.pattern}this._partialre="^(?:"+i+")$"}return t},postMixInProperties:function(){this.inherited(arguments);this.messages=a.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(e){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(e){this._set("required",e);this.focusNode.setAttribute("aria-required",e);this._refreshState()},_setMessageAttr:function(e){this._set("message",e);this.displayMessage(e)},reset:function(){this._maskValidSubsetError=!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){o.hide(this.domNode);this.inherited(arguments)}});return r})},"dijit/form/TextBox":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/dom-style","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/sniff","./_FormValueWidget","./_TextBoxMixin","dojo/text!./templates/TextBox.html","../main"],function(e,t,i,a,n,o,s,r,l,d,c){var u=e("dijit.form.TextBox"+(s("dojo-bidi")?"_NoBidi":""),[r,l],{templateString:d,_singleNodeTemplate:'<input class="dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point="textbox,focusNode" autocomplete="off" type="${type}" ${!nameAttrSetting} />',_buttonInputDisabled:s("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var e=this.type.toLowerCase();(this.templateString&&"input"==this.templateString.toLowerCase()||("hidden"==e||"file"==e)&&this.templateString==this.constructor.prototype.templateString)&&(this.templateString=this._singleNodeTemplate);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);s("ie")<9&&this.defer(function(){try{var e=i.getComputedStyle(this.domNode);if(e){var t=e.fontFamily;if(t){var a=this.domNode.getElementsByTagName("INPUT");if(a)for(var n=0;n<a.length;n++)a[n].style.fontFamily=t}}}catch(o){}})},_setPlaceHolderAttr:function(e){this._set("placeHolder",e);if(!this._phspan){this._attachPoints.push("_phspan");this._phspan=t.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after");this.own(o(this._phspan,"mousedown",function(e){e.preventDefault()}),o(this._phspan,"touchend, pointerup, MSPointerUp",n.hitch(this,function(){this.focus()})))}this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(e));this._updatePlaceHolder()},_onInput:function(e){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},_setValueAttr:function(e,t,i){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){a.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(e){a.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",e)},_onBlur:function(e){if(!this.disabled){this.inherited(arguments);this._updatePlaceHolder();s("mozilla")&&this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0)}},_onFocus:function(e){if(!this.disabled&&!this.readOnly){this.inherited(arguments);this._updatePlaceHolder()}}});if(s("ie")<9){u.prototype._isTextSelected=function(){var e=this.ownerDocument.selection.createRange();return e.parentElement()==this.textbox&&e.text.length>0};c._setSelectionRange=l._setSelectionRange=function(e,t,i){if(e.createTextRange){var a=e.createTextRange();a.collapse(!0);a.moveStart("character",-99999);a.moveStart("character",t);a.moveEnd("character",i-t);a.select()}}}s("dojo-bidi")&&(u=e("dijit.form.TextBox",u,{_setPlaceHolderAttr:function(e){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return u})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(e,t,i,a){return e("dijit.form._FormValueWidget",[i,a],{_layoutHackIE7:function(){if(7==t("ie"))for(var e=this.domNode,i=e.parentNode,a=e.firstChild||e,n=a.style.filter,o=this;i&&0==i.clientHeight;){(function(){var e=o.connect(i,"onscroll",function(){o.disconnect(e);a.style.filter=(new Date).getMilliseconds();o.defer(function(){a.style.filter=n})})})();i=i.parentNode}}})})},"dijit/form/_FormWidget":function(){define(["dojo/_base/declare","dojo/sniff","dojo/_base/kernel","dojo/ready","../_Widget","../_CssStateMixin","../_TemplatedMixin","./_FormWidgetMixin"],function(e,t,i,a,n,o,s,r){t("dijit-legacy-requires")&&a(0,function(){require(["dijit/form/_FormValueWidget"])});return e("dijit.form._FormWidget",[n,s,o,r],{setDisabled:function(e){i.deprecated("setDisabled("+e+") is deprecated. Use set('disabled',"+e+") instead.","","2.0");this.set("disabled",e)},setValue:function(e){i.deprecated("dijit.form._FormWidget:setValue("+e+") is deprecated.  Use set('value',"+e+") instead.","","2.0");this.set("value",e)},getValue:function(){i.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name&&!t("msapp")?'name="'+this.name.replace(/"/g,"&quot;")+'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-style","dojo/_base/lang","dojo/mouse","dojo/on","dojo/sniff","dojo/window","../a11y"],function(e,t,i,a,n,o,s,r,l,d){return t("dijit.form._FormWidgetMixin",null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(t){this._set("disabled",t);if(/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)){i.set(this.focusNode,"disabled",t);r("trident")&&"readOnly"in this&&i.set(this.focusNode,"readonly",t||this.readOnly)}else this.focusNode.setAttribute("aria-disabled",t?"true":"false");this.valueNode&&i.set(this.valueNode,"disabled",t);if(t){this._set("hovering",!1);this._set("active",!1);var a="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode";e.forEach(n.isArray(a)?a:[a],function(e){var t=this[e];r("webkit")||d.hasDefaultTabStop(t)?t.setAttribute("tabIndex","-1"):t.removeAttribute("tabIndex")},this)}else""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(e){if("mouse"==e&&this.isFocusable())var t=this.own(s(this.focusNode,"focus",function(){a.remove();t.remove()}))[0],i=r("pointer-events")?"pointerup":r("MSPointer")?"MSPointerUp":r("touch-events")?"touchend, mouseup":"mouseup",a=this.own(s(this.ownerDocumentBody,i,n.hitch(this,function(e){a.remove();t.remove();this.focused&&("touchend"==e.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){l.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=a.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(e){}},compare:function(e,t){return"number"==typeof e&&"number"==typeof t?isNaN(e)&&isNaN(t)?0:e-t:e>t?1:e<t?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(e,t){null!=this._lastValueReported||null!==t&&this._onChangeActive||(this._resetValue=this._lastValueReported=e);this._pendingOnChange=this._pendingOnChange||typeof e!=typeof this._lastValueReported||0!=this.compare(e,this._lastValueReported);if((this.intermediateChanges||t||void 0===t)&&this._pendingOnChange){this._lastValueReported=e;this._pendingOnChange=!1;if(this._onChangeActive){this._onChangeHandle&&this._onChangeHandle.remove();this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(e)})}}},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){if(this._onChangeHandle){this._onChangeHandle.remove();this.onChange(this._lastValueReported)}this.inherited(arguments)}})})},"dijit/form/_FormValueMixin":function(){define(["dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","./_FormWidgetMixin"],function(e,t,i,a,n,o,s){return e("dijit.form._FormValueMixin",s,{readOnly:!1,_setReadOnlyAttr:function(e){o("trident")&&"disabled"in this?t.set(this.focusNode,"readOnly",e||this.disabled):t.set(this.focusNode,"readOnly",e);this._set("readOnly",e)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(e,t){this._handleOnChange(e,t)},_handleOnChange:function(e,t){this._set("value",e);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,!0)}})})},"dijit/form/_TextBoxMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/sniff","dojo/keys","dojo/_base/lang","dojo/on","../main"],function(e,t,i,a,n,o,s,r){var l=t("dijit.form._TextBoxMixin"+(a("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(e,t,i){var a;if(void 0!==e){a=this.filter(e);if("string"!=typeof i){i=null===a||"number"==typeof a&&isNaN(a)?"":this.filter(this.format(a,this.constraints));0!=this.compare(a,this.filter(this.parse(i,this.constraints)))&&(i=null)}}if(null!=i&&("number"!=typeof i||!isNaN(i))&&this.textbox.value!=i){this.textbox.value=i;this._set("displayedValue",this.get("displayedValue"))}this.inherited(arguments,[a,t])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(e){null==e?e="":"string"!=typeof e&&(e=String(e));this.textbox.value=e;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(e){return null==e?"":e.toString?e.toString():e},parse:function(e){return e},_refreshState:function(){},onInput:function(){},_onInput:function(e){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||e);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(s(this.textbox,"keydown, keypress, paste, cut, compositionend",o.hitch(this,function(e){var t;if("keydown"==e.type&&229!=e.keyCode){switch(t=e.keyCode){case n.SHIFT:case n.ALT:case n.CTRL:case n.META:case n.CAPS_LOCK:case n.NUM_LOCK:case n.SCROLL_LOCK:return}if(!e.ctrlKey&&!e.metaKey&&!e.altKey){switch(t){case n.NUMPAD_0:case n.NUMPAD_1:case n.NUMPAD_2:case n.NUMPAD_3:case n.NUMPAD_4:case n.NUMPAD_5:case n.NUMPAD_6:case n.NUMPAD_7:case n.NUMPAD_8:case n.NUMPAD_9:case n.NUMPAD_MULTIPLY:case n.NUMPAD_PLUS:case n.NUMPAD_ENTER:case n.NUMPAD_MINUS:case n.NUMPAD_PERIOD:case n.NUMPAD_DIVIDE:return}if(t>=65&&t<=90||t>=48&&t<=57||t==n.SPACE)return;var i=!1;for(var r in n)if(n[r]===e.keyCode){i=!0;break}if(!i)return}}(t=e.charCode>=32?String.fromCharCode(e.charCode):e.charCode)||(t=e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57||e.keyCode==n.SPACE?String.fromCharCode(e.keyCode):e.keyCode);t||(t=229);if("keypress"==e.type){if("string"!=typeof t)return;if((t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||" "===t)&&(e.ctrlKey||e.metaKey||e.altKey))return}var l,d={faux:!0};for(l in e)if(!/^(layer[XY]|returnValue|keyLocation)$/.test(l)){var c=e[l];"function"!=typeof c&&void 0!==c&&(d[l]=c)}o.mixin(d,{charOrCode:t,_wasConsumed:!1,preventDefault:function(){d._wasConsumed=!0;e.preventDefault()},stopPropagation:function(){e.stopPropagation()}});this._lastInputProducingEvent=d;if(!1===this.onInput(d)){d.preventDefault();d.stopPropagation()}if(!d._wasConsumed&&a("ie")<=9)switch(e.keyCode){case n.TAB:case n.ESCAPE:case n.DOWN_ARROW:case n.UP_ARROW:case n.LEFT_ARROW:case n.RIGHT_ARROW:break;default:if(e.keyCode==n.ENTER&&"textarea"!=this.textbox.tagName.toLowerCase())break;this.defer(function(){this.textbox.value!==this._lastInputEventValue&&s.emit(this.textbox,"input",{bubbles:!0})})}})),s(this.textbox,"input",o.hitch(this,"_onInput")),s(this.domNode,"keypress",function(e){e.stopPropagation()}))},_blankValue:"",filter:function(e){if(null===e)return this._blankValue;if("string"!=typeof e)return e;this.trim&&(e=o.trim(e));this.uppercase&&(e=e.toUpperCase());this.lowercase&&(e=e.toLowerCase());this.propercase&&(e=e.replace(/[^\s]+/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}));return e},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(e){if(!this.disabled){this._setBlurValue();this.inherited(arguments)}},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(e){if(!this.disabled&&!this.readOnly){if(this.selectOnClick&&"mouse"==e){this._selectOnClickHandle=s.once(this.domNode,"mouseup, touchend",o.hitch(this,function(e){this._isTextSelected()||l.selectInputText(this.textbox)}));this.own(this._selectOnClickHandle);this.defer(function(){if(this._selectOnClickHandle){this._selectOnClickHandle.remove();this._selectOnClickHandle=null}},500)}this.inherited(arguments);this._refreshState()}},reset:function(){this.textbox.value="";this.inherited(arguments)}});a("dojo-bidi")&&(l=t("dijit.form._TextBoxMixin",l,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));l._setSelectionRange=r._setSelectionRange=function(e,t,i){e.setSelectionRange&&e.setSelectionRange(t,i)};l.selectInputText=r.selectInputText=function(e,t,a){e=i.byId(e);isNaN(t)&&(t=0);isNaN(a)&&(a=e.value?e.value.length:0);try{e.focus();l._setSelectionRange(e,t,a)}catch(n){}};return l})},"dijit/form/ComboBoxMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/kernel","dojo/_base/lang","dojo/store/util/QueryResults","./_AutoCompleterMixin","./_ComboBoxMenu","../_HasDropDown","dojo/text!./templates/DropDownBox.html"],function(e,t,i,a,n,o,s,r,l){return e("dijit.form.ComboBoxMixin",[r,o],{dropDownClass:s,hasDownArrow:!0,templateString:l,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(e){this._set("hasDownArrow",e);this._buttonNode.style.display=e?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(e){e.get||a.mixin(e,{_oldAPI:!0,get:function(e){var i=new t;this.fetchItemByIdentity({identity:e,onItem:function(e){i.resolve(e)},onError:function(e){i.reject(e)}});return i.promise},query:function(e,i){var o=new t(function(){s.abort&&s.abort()});o.total=new t;var s=this.fetch(a.mixin({query:e,onBegin:function(e){o.total.resolve(e)},onComplete:function(e){o.resolve(e)},onError:function(e){o.reject(e)}},i));return n(o)}});this._set("store",e)},postMixInProperties:function(){var e=this.params.store||this.store;e&&this._setStoreAttr(e);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var t=this.declaredClass;a.mixin(this.store,{getValue:function(e,a){i.deprecated(t+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return e[a]},getLabel:function(e){i.deprecated(t+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return e.name},fetch:function(e){i.deprecated(t+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],a.hitch(this,function(t){new t({objectStore:this}).fetch(e)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(e,t,i){var a=function(n){if(!n)return n;var o=!!n.then;o&&(n=t.delegate(n));function s(t){n[t]=function(){var s=arguments,r=i(n,function(i){Array.prototype.unshift.call(s,i);return a(e[t].apply(e,s))});if("forEach"!==t||o)return r}}s("forEach");s("filter");s("map");null==n.total&&(n.total=i(n,function(e){return e.length}));return n};t.setObject("dojo.store.util.QueryResults",a);return a})},"dijit/form/_AutoCompleterMixin":function(){define(["dojo/aspect","dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/query","dojo/regexp","dojo/sniff","./DataList","./_TextBoxMixin","./_SearchMixin"],function(e,t,i,a,n,o,s,r,l,d,c){var u=t("dijit.form._AutoCompleterMixin",c,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(e){var t=0;if("number"==typeof e.selectionStart)t=e.selectionStart;else if(r("ie")){var i=e.ownerDocument.selection.createRange().duplicate(),a=e.createTextRange();i.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",i);t=String(a.text).replace(/\r/g,"").length}catch(n){}}return t},_setCaretPos:function(e,t){t=parseInt(t);d.selectInputText(e,t,t)},_setDisabledAttr:function(e){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",e?"true":"false")},_onKey:function(e){if(!(e.charCode>=32)){var t=e.charCode||e.keyCode;if(t!=a.ALT&&t!=a.CTRL&&t!=a.META&&t!=a.SHIFT){var i=this.dropDown,n=null;this._abortQuery();this.inherited(arguments);if(!(e.altKey||e.ctrlKey||e.metaKey)){this._opened&&(n=i.getHighlightedOption());switch(t){case a.PAGE_DOWN:case a.DOWN_ARROW:case a.PAGE_UP:case a.UP_ARROW:this._opened&&this._announceOption(n);e.stopPropagation();e.preventDefault();break;case a.ENTER:if(n){if(n==i.nextButton){this._nextSearch(1);e.stopPropagation();e.preventDefault();break}if(n==i.previousButton){this._nextSearch(-1);e.stopPropagation();e.preventDefault();break}e.stopPropagation();e.preventDefault()}else{this._setBlurValue();this._setCaretPos(this.focusNode,this.focusNode.value.length)}case a.TAB:var o=this.get("displayedValue");if(i&&(o==i._messages.previousMessage||o==i._messages.nextMessage))break;n&&this._selectOption(n);case a.ESCAPE:if(this._opened){this._lastQuery=null;this.closeDropDown()}}}}}},_autoCompleteText:function(e){var t=this.focusNode;d.selectInputText(t,t.value.length);var i=this.ignoreCase?"toLowerCase":"substr";if(0==e[i](0).indexOf(this.focusNode.value[i](0))){var a=this.autoComplete?this._getCaretPos(t):t.value.length;if(a+1>t.value.length){t.value=e;d.selectInputText(t,a)}}else{t.value=e;d.selectInputText(t)}},_openResultList:function(e,t,i){var a=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();if(e.length||0!=i.start){this._nextSearch=this.dropDown.onPage=n.hitch(this,function(t){e.nextPage(-1!==t);this.focus()});this.dropDown.createOptions(e,i,n.hitch(this,"_getMenuLabelFromItem"));this._showResultList();if("direction"in i){i.direction?this.dropDown.highlightFirstOption():i.direction||this.dropDown.highlightLastOption();a&&this._announceOption(this.dropDown.getHighlightedOption())}else!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(t[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)}else this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();if(this._opened){this.inherited(arguments);this.domNode.setAttribute("aria-expanded","false")}},_setBlurValue:function(){var e=this.get("displayedValue"),t=this.dropDown;if(!t||e!=t._messages.previousMessage&&e!=t._messages.nextMessage)if(void 0===this.item){this.item=null;this.set("displayedValue",e)}else{this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0);this._refreshState()}else this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(e,t,i){var a="";if(e){i||(i=this.store._oldAPI?this.store.getValue(e,this.searchAttr):e[this.searchAttr]);a=this._getValueField()!=this.searchAttr?this.store.getIdentity(e):i}this.set("value",a,t,i,e)},_announceOption:function(e){if(e){var t;if(e==this.dropDown.nextButton||e==this.dropDown.previousButton){t=e.innerHTML;this.item=void 0;this.value=""}else{var a=this.dropDown.items[e.getAttribute("item")];t=(this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]).toString();this.set("item",a,!1,t)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",i.get(e,"id"));this._autoCompleteText(t)}},_selectOption:function(e){this.closeDropDown();e&&this._announceOption(e);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(e){if(!this.dropDown){var t=this.id+"_popup",i=n.isString(this.dropDownClass)?n.getObject(this.dropDownClass,!1):this.dropDownClass;this.dropDown=new i({onChange:n.hitch(this,this._selectOption),id:t,dir:this.dir,textDir:this.textDir})}this._lastInput=e;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef){var e=this.srcNodeRef;this.store=new l({},e);if(!("value"in this.params)){var t=this.item=this.store.fetchSelectedItem();if(t){var i=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(t,i):t[i]}}}},postCreate:function(){var t=o('label[for="'+this.id+'"]');if(t.length){t[0].id||(t[0].id=this.id+"_label");this.domNode.setAttribute("aria-labelledby",t[0].id)}this.inherited(arguments);e.after(this,"onSearch",n.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(e){var t=this.labelFunc(e,this.store),i=this.labelType;if("none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput){t=this.doHighlight(t,this._lastInput);i="html"}return{html:"html"==i,label:t}},doHighlight:function(e,t){var i=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),a=this.queryExpr.indexOf("${0}");t=s.escapeString(t);return this._escapeHtml(e.replace(new RegExp((0==a?"^":"")+"("+t+")"+(a==this.queryExpr.length-4?"$":""),i),"$1")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'<span class="dijitComboBoxHighlightMatch">$1</span>')},_escapeHtml:function(e){return e=String(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(e,t){return(t._oldAPI?t.getValue(e,this.labelAttr||this.searchAttr):e[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(e,t,i,a){this._set("item",a||null);null==e&&(e="");this.inherited(arguments)}});r("dojo-bidi")&&u.extend({_setTextDirAttr:function(e){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",e)}});return u})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(e,t){var i={};t.setObject("dojo.regexp",i);i.escapeString=function(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(e){return t&&-1!=t.indexOf(e)?e:"\\"+e})};i.buildGroupRE=function(e,t,a){if(!(e instanceof Array))return t(e);for(var n=[],o=0;o<e.length;o++)n.push(t(e[o]));return i.group(n.join("|"),a)};i.group=function(e,t){return"("+(t?"?:":"")+e+")"};return i})},"dijit/form/DataList":function(){define(["dojo/_base/declare","dojo/dom","dojo/_base/lang","dojo/query","dojo/store/Memory","../registry"],function(e,t,i,a,n,o){function s(e){return{id:e.value,value:e.value,name:i.trim(e.innerText||e.textContent||"")}}return e("dijit.form.DataList",n,{constructor:function(e,n){this.domNode=t.byId(n);i.mixin(this,e);this.id&&o.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:a("option",this.domNode).map(s)}])},destroy:function(){o.remove(this.id)},fetchSelectedItem:function(){var e=a("> option[selected]",this.domNode)[0]||a("> option",this.domNode)[0];return e&&s(e)}})})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(e,t,i){return e("dojo.store.Memory",null,{constructor:function(e){for(var t in e)this[t]=e[t];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:i,get:function(e){return this.data[this.index[e]]},getIdentity:function(e){return e[this.idProperty]},put:function(e,t){var i=this.data,a=this.index,n=this.idProperty,o=e[n]=t&&"id"in t?t.id:n in e?e[n]:Math.random();if(o in a){if(t&&!1===t.overwrite)throw new Error("Object already exists");i[a[o]]=e}else a[o]=i.push(e)-1;return o},add:function(e,t){(t=t||{}).overwrite=!1;return this.put(e,t)},remove:function(e){var t=this.index,i=this.data;if(e in t){i.splice(t[e],1);this.setData(i);return!0}},query:function(e,i){return t(this.queryEngine(e,i)(this.data))},setData:function(e){if(e.items){this.idProperty=e.identifier||this.idProperty;e=this.data=e.items}else this.data=e;this.index={};for(var t=0,i=e.length;t<i;t++)this.index[e[t][this.idProperty]]=t}})})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(e){return function(t,i){switch(typeof t){default:throw new Error("Can not query with a "+typeof t);case"object":case"undefined":var a=t;t=function(e){for(var t in a){var i=a[t];if(i&&i.test){if(!i.test(e[t],e))return!1}else if(i!=e[t])return!1}return!0};break;case"string":if(!this[t])throw new Error("No filter function "+t+" was found in store");t=this[t];case"function":}function n(a){var n=e.filter(a,t),o=i&&i.sort;o&&n.sort("function"==typeof o?o:function(e,t){for(var i,a=0;i=o[a];a++){var n=e[i.attribute],s=t[i.attribute];if((n=null!=n?n.valueOf():n)!=(s=null!=s?s.valueOf():s))return!!i.descending==(null==n||n>s)?-1:1}return 0});if(i&&(i.start||i.count)){var s=n.length;(n=n.slice(i.start||0,(i.start||0)+(i.count||1/0))).total=s}return n}n.matches=t;return n}})},"dijit/form/_SearchMixin":function(){define(["dojo/_base/declare","dojo/keys","dojo/_base/lang","dojo/query","dojo/string","dojo/when","../registry"],function(e,t,i,a,n,o,s){return e("dijit.form._SearchMixin",null,{pageSize:1/0,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(e){this._set("list",e)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(e){return new RegExp("^"+e.replace(/(\\.)|(\*)|(\?)|\W/g,function(e,t,i,a){return i?".*":a?".":t||"\\"+e})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());if(this._fetchHandle){if(this._fetchHandle.abort){this._cancelingQuery=!0;this._fetchHandle.abort();this._cancelingQuery=!1}if(this._fetchHandle.cancel){this._cancelingQuery=!0;this._fetchHandle.cancel();this._cancelingQuery=!1}this._fetchHandle=null}},_processInput:function(e){if(!this.disabled&&!this.readOnly){var i=e.charOrCode;this._prev_key_backspace=!1;if(i==t.DELETE||i==t.BACKSPACE){this._prev_key_backspace=!0;this._maskValidSubsetError=!0}this.store?this.searchTimer=this.defer("_startSearchFromInput",1):this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(e){this._abortQuery();var t,a=this,s=i.clone(this.query),r={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},l=n.substitute(this.queryExpr,[e.replace(/([\\\*\?])/g,"\\$1")]),d=function(){var e=a._fetchHandle=a.store.query(s,r);a.disabled||a.readOnly||t!==a._lastQuery||o(e,function(i){a._fetchHandle=null;a.disabled||a.readOnly||t!==a._lastQuery||o(e.total,function(e){i.total=e;var t=a.pageSize;(isNaN(t)||t>i.total)&&(t=i.total);i.nextPage=function(e){r.direction=e=!1!==e;r.count=t;if(e){r.start+=i.length;r.start>=i.total&&(r.count=0)}else{r.start-=t;if(r.start<0){r.count=Math.max(t+r.start,0);r.start=0}}if(r.count<=0){i.length=0;a.onSearch(i,s,r)}else d()};a.onSearch(i,s,r)})},function(e){a._fetchHandle=null;a._cancelingQuery||console.error(a.declaredClass+" "+e.toString())})};i.mixin(r,this.fetchProperties);this.store._oldAPI?t=l:(t=this._patternToRegExp(l)).toString=function(){return l};this._lastQuery=s[this.searchAttr]=t;this._queryDeferHandle=this.defer(d,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var e=this.list;e&&(this.store=s.byId(e))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-style","dojo/keys","../_WidgetBase","../_TemplatedMixin","./_ComboBoxMenuMixin","./_ListMouseMixin"],function(e,t,i,a,n,o,s,r){return e("dijit.form._ComboBoxMenu",[n,o,r,s],{templateString:"<div class='dijitReset dijitMenu' data-dojo-attach-point='containerNode' style='overflow: auto; overflow-x: hidden;' role='listbox'><div class='dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point='previousButton' role='option'></div><div class='dijitMenuItem dijitMenuNextButton' data-dojo-attach-point='nextButton' role='option'></div></div>",baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);if(!this.isLeftToRight()){t.add(this.previousButton,"dijitMenuItemRtl");t.add(this.nextButton,"dijitMenuItemRtl")}this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var e=this.ownerDocument.createElement("div");e.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");e.setAttribute("role","option");return e},onHover:function(e){t.add(e,"dijitMenuItemHover")},onUnhover:function(e){t.remove(e,"dijitMenuItemHover")},onSelect:function(e){t.add(e,"dijitMenuItemSelected")},onDeselect:function(e){t.remove(e,"dijitMenuItemSelected")},_page:function(e){var t=0,a=this.domNode.scrollTop,n=i.get(this.domNode,"height");this.getHighlightedOption()||this.selectNextNode();for(;t<n;){var o=this.getHighlightedOption();if(e){if(!o.previousSibling||"none"==o.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!o.nextSibling||"none"==o.nextSibling.style.display)break;this.selectNextNode()}var s=this.domNode.scrollTop;t+=(s-a)*(e?-1:1);a=s}},handleKey:function(e){switch(e.keyCode){case a.DOWN_ARROW:this.selectNextNode();return!1;case a.PAGE_DOWN:this._page(!1);return!1;case a.UP_ARROW:this.selectPreviousNode();return!1;case a.PAGE_UP:this._page(!0);return!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/has","dojo/i18n","dojo/i18n!./nls/ComboBox"],function(e,t,i,a,n){var o=t("dijit.form._ComboBoxMenuMixin"+(a("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=n.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(e){this._set("value",e);this.onChange(e)},onClick:function(e){if(e==this.previousButton){this._setSelectedAttr(null);this.onPage(-1)}else if(e==this.nextButton){this._setSelectedAttr(null);this.onPage(1)}else this.onChange(e)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(e,t){var i=this._createMenuItem(),a=t(e);a.html?i.innerHTML=a.label:i.appendChild(i.ownerDocument.createTextNode(a.label));""==i.innerHTML&&(i.innerHTML="&#160;");return i},createOptions:function(t,a,n){this.items=t;this.previousButton.style.display=0==a.start?"none":"";i.set(this.previousButton,"id",this.id+"_prev");e.forEach(t,function(e,t){var a=this._createOption(e,n);a.setAttribute("item",t);i.set(a,"id",this.id+t);this.nextButton.parentNode.insertBefore(a,this.nextButton)},this);var o=!1;t.total&&!t.total.then&&-1!=t.total?(a.start+a.count<t.total||a.start+a.count>t.total&&a.count==t.length)&&(o=!0):a.count==t.length&&(o=!0);this.nextButton.style.display=o?"":"none";i.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var e=this.containerNode;e.childNodes.length>2;)e.removeChild(e.childNodes[e.childNodes.length-2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});a("dojo-bidi")&&(o=t("dijit.form._ComboBoxMenuMixin",o,{_createOption:function(){var e=this.inherited(arguments);this.applyTextDir(e);return e}}));return o})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(e,t,i,a){return e("dijit.form._ListMouseMixin",a,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover","_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(e,t){this._setSelectedAttr(t,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(t)})},_onMouseDown:function(e,t){if(this._hoveredNode){this.onUnhover(this._hoveredNode);this._hoveredNode=null}this._isDragging=!0;this._setSelectedAttr(t,!1)},_onMouseUp:function(e,t){this._isDragging=!1;var i=this.selected,a=this._hoveredNode;i&&t==i?this.defer(function(){this._onClick(e,i)}):a&&this.defer(function(){this._onClick(e,a)})},_onMouseOut:function(e,t){if(this._hoveredNode){this.onUnhover(this._hoveredNode);this._hoveredNode=null}this._isDragging&&(this._cancelDrag=(new Date).getTime()+1e3)},_onMouseOver:function(e,t){if(this._cancelDrag){(new Date).getTime()>this._cancelDrag&&(this._isDragging=!1);this._cancelDrag=null}this._hoveredNode=t;this.onHover(t);this._isDragging&&this._setSelectedAttr(t,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on","dojo/window"],function(e,t,i){return e("dijit.form._ListBase",null,{selected:null,_listConnect:function(e,i){var a=this;return a.own(t(a.containerNode,t.selector(function(e,t,i){return e.parentNode==i},e),function(e){a[i](e,this)}))},selectFirstNode:function(){for(var e=this.containerNode.firstChild;e&&"none"==e.style.display;)e=e.nextSibling;this._setSelectedAttr(e,!0)},selectLastNode:function(){for(var e=this.containerNode.lastChild;e&&"none"==e.style.display;)e=e.previousSibling;this._setSelectedAttr(e,!0)},selectNextNode:function(){var e=this.selected;if(e){for(var t=e.nextSibling;t&&"none"==t.style.display;)t=t.nextSibling;t?this._setSelectedAttr(t,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var e=this.selected;if(e){for(var t=e.previousSibling;t&&"none"==t.style.display;)t=t.previousSibling;t?this._setSelectedAttr(t,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(e,t){if(this.selected!=e){var a=this.selected;a&&this.onDeselect(a);if(e){t&&i.scrollIntoView(e);this.onSelect(e)}this._set("selected",e)}else e&&this.onSelect(e)}})})},"dijit/_HasDropDown":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","dojo/touch","./registry","./focus","./popup","./_FocusMixin"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m){return e("dijit._HasDropDown",m,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(e){if(!this.disabled&&!this.readOnly){"MSPointerDown"!=e.type&&e.preventDefault();this.own(c.once(this.ownerDocument,u.release,d.hitch(this,"_onDropDownMouseUp")));this.toggleDropDown()}},_onDropDownMouseUp:function(e){var t=this.dropDown,i=!1;if(e&&this._opened){var a=o.position(this._buttonNode,!0);if(!(e.pageX>=a.x&&e.pageX<=a.x+a.w&&e.pageY>=a.y&&e.pageY<=a.y+a.h)){for(var s=e.target;s&&!i;)n.contains(s,"dijitPopup")?i=!0:s=s.parentNode;if(i){s=e.target;if(t.onItemClick){for(var r;s&&!(r=h.byNode(s));)s=s.parentNode;r&&r.onClick&&r.getParent&&r.getParent().onItemClick(r,e)}return}}}this._opened?t.focus&&(!1!==t.autoFocus||"mouseup"==e.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){t.focus();delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(e){if(this._stopClickEvents){e.stopPropagation();e.preventDefault()}},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var e={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";n.add(this._arrowWrapperNode||this._buttonNode,"dijit"+e+"ArrowButton")},postCreate:function(){this.inherited(arguments);var e=this.focusNode||this.domNode;this.own(c(this._buttonNode,u.press,d.hitch(this,"_onDropDownMouseDown")),c(this._buttonNode,"click",d.hitch(this,"_onDropDownClick")),c(e,"keydown",d.hitch(this,"_onKey")),c(e,"keyup",d.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);if(this.dropDown){this.dropDown._destroyed||this.dropDown.destroyRecursive();delete this.dropDown}this.inherited(arguments)},_onKey:function(e){if(!this.disabled&&!this.readOnly){var t=this.dropDown,i=e.target;if(t&&this._opened&&t.handleKey&&!1===t.handleKey(e)){e.stopPropagation();e.preventDefault()}else if(t&&this._opened&&e.keyCode==l.ESCAPE){this.closeDropDown();e.stopPropagation();e.preventDefault()}else if(!this._opened&&(e.keyCode==l.DOWN_ARROW||(e.keyCode==l.ENTER||e.keyCode==l.SPACE&&(!this._searchTimer||e.ctrlKey||e.altKey||e.metaKey))&&("input"!==(i.tagName||"").toLowerCase()||i.type&&"text"!==i.type.toLowerCase()))){this._toggleOnKeyUp=!0;e.stopPropagation();e.preventDefault()}}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var e=this.dropDown;e&&e.focus&&this.defer(d.hitch(e,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(e){e()},loadAndOpenDropDown:function(){var e=new t,i=d.hitch(this,function(){this.openDropDown();e.resolve(this.dropDown)});this.isLoaded()?i():this.loadDropDown(i);return e},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var e=this.dropDown,t=e.domNode,i=this._aroundNode||this.domNode,s=this,r=_.open({parent:this,popup:e,around:i,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){s.closeDropDown(!0)},onCancel:function(){s.closeDropDown(!0)},onClose:function(){a.set(s._popupStateNode,"popupActive",!1);n.remove(s._popupStateNode,"dijitHasDropDownOpen");s._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&i.offsetWidth>e._popupWrapper.offsetWidth){var l=i.offsetWidth-e._popupWrapper.offsetWidth,c={w:e.domNode.offsetWidth+l};this._origStyle=t.style.cssText;d.isFunction(e.resize)?e.resize(c):o.setMarginBox(t,c);"R"==r.corner[1]&&(e._popupWrapper.style.left=e._popupWrapper.style.left.replace("px","")-l+"px")}a.set(this._popupStateNode,"popupActive","true");n.add(this._popupStateNode,"dijitHasDropDownOpen");this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",e.id);"presentation"===t.getAttribute("role")||t.getAttribute("aria-labelledby")||t.setAttribute("aria-labelledby",this.id);return r},closeDropDown:function(e){if(this._focusDropDownTimer){this._focusDropDownTimer.remove();delete this._focusDropDownTimer}if(this._opened){this._popupStateNode.setAttribute("aria-expanded","false");e&&this.focus&&this.focus();_.close(this.dropDown);this._opened=!1}if(this._origStyle){this.dropDown.domNode.style.cssText=this._origStyle;delete this._origStyle}}})})},"dijit/popup":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","./place","./BackgroundIframe","./Viewport","./main","dojo/touch"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m){function g(){if(this._popupWrapper){o.destroy(this._popupWrapper);delete this._popupWrapper}}var f=i(null,{_stack:[],_beginZIndex:1e3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var e=this._firstAroundPosition,t=s.position(this._firstAroundNode,!0),i=t.x-e.x,a=t.y-e.y;if(i||a){this._firstAroundPosition=t;for(var n=0;n<this._stack.length;n++){var o=this._stack[n].wrapper.style;o.top=parseFloat(o.top)+a+"px";"auto"==o.right?o.left=parseFloat(o.left)+i+"px":o.right=parseFloat(o.right)-i+"px"}}this._aroundMoveListener=setTimeout(c.hitch(this,"_repositionAll"),i||a?10:50)}},_createWrapper:function(e){var i=e._popupWrapper,a=e.domNode;if(!i){(i=o.create("div",{class:"dijitPopup",style:{display:"none"},role:"region","aria-label":e["aria-label"]||e.label||e.name||e.id},e.ownerDocumentBody)).appendChild(a);var n=a.style;n.display="";n.visibility="";n.position="";n.top="0px";e._popupWrapper=i;t.after(e,"destroy",g,!0);"ontouchend"in document&&u(i,"touchend",function(e){/^(input|button|textarea)$/i.test(e.target.tagName)||e.preventDefault()});i.dojoClick=!0}return i},moveOffScreen:function(e){var t=this._createWrapper(e),i=s.isBodyLtr(e.ownerDocument),a={visibility:"hidden",top:"-9999px",display:""};a[i?"left":"right"]="-9999px";a[i?"right":"left"]="auto";r.set(t,a);return t},hide:function(e){var t=this._createWrapper(e);r.set(t,{display:"none",height:"auto",overflowY:"visible",border:""});var i=e.domNode;"_originalStyle"in i&&(i.style.cssText=i._originalStyle)},getTopPopup:function(){for(var e=this._stack,t=e.length-1;t>0&&e[t].parent===e[t-1].widget;t--);return e[t]},open:function(e){for(var t=this._stack,i=e.popup,o=i.domNode,m=e.orient||["below","below-alt","above","above-alt"],g=e.parent?e.parent.isLeftToRight():s.isBodyLtr(i.ownerDocument),f=e.around,b=e.around&&e.around.id?e.around.id+"_dropdown":"popup_"+this._idGen++;t.length&&(!e.parent||!a.isDescendant(e.parent.domNode,t[t.length-1].widget.domNode));)this.close(t[t.length-1].widget);var y=this.moveOffScreen(i);i.startup&&!i._started&&i.startup();var v,w=s.position(o);if("maxHeight"in e&&-1!=e.maxHeight)v=e.maxHeight||1/0;else{var x=_.getEffectiveBox(this.ownerDocument),k=f?s.position(f,!1):{y:e.y-(e.padding||0),h:2*(e.padding||0)};v=Math.floor(Math.max(k.y,x.h-(k.y+k.h)))}if(w.h>v){var C=r.getComputedStyle(o),T=C.borderLeftWidth+" "+C.borderLeftStyle+" "+C.borderLeftColor;r.set(y,{overflowY:"scroll",height:v+"px",border:T});o._originalStyle=o.style.cssText;o.style.border="none"}n.set(y,{id:b,style:{zIndex:this._beginZIndex+t.length},class:"dijitPopup "+(i.baseClass||i.class||"").split(" ")[0]+"Popup",dijitPopupParent:e.parent?e.parent.id:""});if(0==t.length&&f){this._firstAroundNode=f;this._firstAroundPosition=s.position(f,!0);this._aroundMoveListener=setTimeout(c.hitch(this,"_repositionAll"),50)}l("config-bgIframe")&&!i.bgIframe&&(i.bgIframe=new p(y));var j=i.orient?c.hitch(i,"orient"):null,S=f?h.around(y,f,m,g,j):h.at(y,e,"R"==m?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],e.padding,j);y.style.visibility="visible";o.style.visibility="visible";var $=[];$.push(u(y,"keydown",c.hitch(this,function(t){if(t.keyCode==d.ESCAPE&&e.onCancel){t.stopPropagation();t.preventDefault();e.onCancel()}else if(t.keyCode==d.TAB){t.stopPropagation();t.preventDefault();var i=this.getTopPopup();i&&i.onCancel&&i.onCancel()}})));i.onCancel&&e.onCancel&&$.push(i.on("cancel",e.onCancel));$.push(i.on(i.onExecute?"execute":"change",c.hitch(this,function(){var e=this.getTopPopup();e&&e.onExecute&&e.onExecute()})));t.push({widget:i,wrapper:y,parent:e.parent,onExecute:e.onExecute,onCancel:e.onCancel,onClose:e.onClose,handlers:$});i.onOpen&&i.onOpen(S);return S},close:function(t){for(var i=this._stack;t&&e.some(i,function(e){return e.widget==t})||!t&&i.length;){var a,n=i.pop(),o=n.widget,s=n.onClose;if(o.bgIframe){o.bgIframe.destroy();delete o.bgIframe}o.onClose&&o.onClose();for(;a=n.handlers.pop();)a.remove();o&&o.domNode&&this.hide(o);s&&s()}if(0==i.length&&this._aroundMoveListener){clearTimeout(this._aroundMoveListener);this._firstAroundNode=this._firstAroundPosition=this._aroundMoveListener=null}}});return m.popup=new f})},"dijit/Editor":function(){define(["require","dojo/_base/array","dojo/_base/declare","dojo/Deferred","dojo/i18n","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/keys","dojo/_base/lang","dojo/sniff","dojo/string","dojo/topic","./_Container","./Toolbar","./ToolbarSeparator","./layout/_LayoutWidget","./form/ToggleButton","./_editor/_Plugin","./_editor/plugins/EnterKeyHandling","./_editor/html","./_editor/range","./_editor/RichText","./main","dojo/i18n!./_editor/nls/commands"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g,f,b,y,v,w,x,k,C){var T=i("dijit.Editor",k,{plugins:null,extraPlugins:null,constructor:function(){c.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",v]);this._plugins=[];this._editInterval=1e3*this.editActionInterval;if(u("ie")||u("trident")||u("edge")){this.events.push("onBeforeDeactivate");this.events.push("onBeforeActivate")}},postMixInProperties:function(){this.setValueDeferred=new a;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);c.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=n.getLocalization("dijit._editor","commands",this.lang);u("webkit")&&l.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);if(!this.toolbar){this.toolbar=new m({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id});this.header.appendChild(this.toolbar.domNode)}t.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);s.add(this.iframe.parentNode,"dijitEditorIFrameContainer");s.add(this.iframe,"dijitEditorIFrame");o.set(this.iframe,"allowTransparency",!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){t.forEach(this._plugins,function(e){e&&e.destroy&&e.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(t,i){var a=c.isString(t)?{name:t}:c.isFunction(t)?{ctor:t}:t;if(!a.setEditor){var n={args:a,plugin:null,editor:this};a.name&&(y.registry[a.name]?n.plugin=y.registry[a.name](a):p.publish(C._scopeName+".Editor.getPlugin",n));if(!n.plugin)try{var o=a.ctor||c.getObject(a.name)||e(a.name);o&&(n.plugin=new o(a))}catch(s){throw new Error(this.id+": cannot find plugin ["+a.name+"]")}if(!n.plugin)throw new Error(this.id+": cannot find plugin ["+a.name+"]");t=n.plugin}arguments.length>1?this._plugins[i]=t:this._plugins.push(t);t.setEditor(this);c.isFunction(t.setToolbar)&&t.setToolbar(this.toolbar)},resize:function(e){e&&f.prototype.resize.apply(this,arguments)},layout:function(){var e=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+r.getPadBorderExtents(this.iframe.parentNode).h+r.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=e+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(e){var t,i=this.document.body,a=i.clientWidth,n=i.clientHeight,o=i.clientLeft,s=i.offsetWidth,r=i.offsetHeight,l=i.offsetLeft;/^rtl$/i.test(i.dir||"")?a<s&&e.x>a&&e.x<s&&(t=!0):e.x<o&&e.x>l&&(t=!0);t||n<r&&e.y>n&&e.y<r&&(t=!0);if(!t){delete this._cursorToStart;delete this._savedSelection;"BODY"==e.target.tagName&&this.defer("placeCursorAtEnd");this.inherited(arguments)}},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(e){this.customUndo&&this.endEditing(!0);"BODY"!=e.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(e){if(!this._inEditing){this._inEditing=!0;this._beginEditing(e)}if(this.editActionInterval>0){this._editTimer&&this._editTimer.remove();this._editTimer=this.defer("endEditing",this._editInterval)}},_steps:[],_undoedSteps:[],execCommand:function(e){if(!this.customUndo||"undo"!=e&&"redo"!=e){if(this.customUndo){this.endEditing();this._beginEditing()}var t=this.inherited(arguments);this.customUndo&&this._endEditing();return t}return this[e]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(e){var t;try{t=this.document.execCommand(e,!1,null);if(u("webkit")&&!t)throw{}}catch(a){var i=h.substitute;alert(i(this.commands.systemShortcut,[this.commands[e],i(this.commands[u("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[e]])]));t=!1}return t},queryCommandEnabled:function(e){return!this.customUndo||"undo"!=e&&"redo"!=e?this.inherited(arguments):"undo"==e?this._steps.length>1:this._undoedSteps.length>0},_moveToBookmark:function(e){var i,a,n,o,s=e.mark,r=e.mark,l=e.isCollapsed;if(r)if(u("ie")<9||9===u("ie")&&u("quirks")){if(c.isArray(r)){s=[];t.forEach(r,function(e){s.push(x.getNode(e,this.editNode))},this);this.selection.moveToBookmark({mark:s,isCollapsed:l})}else if(r.startContainer&&r.endContainer&&(o=x.getSelection(this.window))&&o.removeAllRanges){o.removeAllRanges();i=x.create(this.window);a=x.getNode(r.startContainer,this.editNode);n=x.getNode(r.endContainer,this.editNode);if(a&&n){i.setStart(a,r.startOffset);i.setEnd(n,r.endOffset);o.addRange(i)}}}else if((o=x.getSelection(this.window))&&o.removeAllRanges){o.removeAllRanges();i=x.create(this.window);a=x.getNode(r.startContainer,this.editNode);n=x.getNode(r.endContainer,this.editNode);if(a&&n){i.setStart(a,r.startOffset);i.setEnd(n,r.endOffset);o.addRange(i)}}},_changeToStep:function(e,t){this.setValue(t.text);var i=t.bookmark;i&&this._moveToBookmark(i)},undo:function(){var e=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var t=this._steps.pop();if(t&&this._steps.length>0){this.focus();this._changeToStep(t,this._steps[this._steps.length-1]);this._undoedSteps.push(t);this.onDisplayChanged();delete this._undoRedoActive;e=!0}delete this._undoRedoActive}return e},redo:function(){var e=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var t=this._undoedSteps.pop();if(t&&this._steps.length>0){this.focus();this._changeToStep(this._steps[this._steps.length-1],t);this._steps.push(t);this.onDisplayChanged();e=!0}delete this._undoRedoActive}return e},endEditing:function(e){this._editTimer&&(this._editTimer=this._editTimer.remove());if(this._inEditing){this._endEditing(e);this._inEditing=!1}},_getBookmark:function(){var e=this.selection.getBookmark(),i=[];if(e&&e.mark){var a=e.mark;if(u("ie")<9||9===u("ie")&&u("quirks")){var n=x.getSelection(this.window);if(c.isArray(a)){t.forEach(e.mark,function(e){i.push(x.getIndex(e,this.editNode).o)},this);e.mark=i}else if(n){var o;n.rangeCount&&(o=n.getRangeAt(0));e.mark=o?o.cloneRange():this.selection.getBookmark()}}try{if(e.mark&&e.mark.startContainer){i=x.getIndex(e.mark.startContainer,this.editNode).o;e.mark={startContainer:i,startOffset:e.mark.startOffset,endContainer:e.mark.endContainer===e.mark.startContainer?i:x.getIndex(e.mark.endContainer,this.editNode).o,endOffset:e.mark.endOffset}}}catch(s){e.mark=null}}return e},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:w.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var e=w.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:e,bookmark:this._getBookmark()})},onKeyDown:function(e){u("ie")||this.iframe||e.keyCode!=d.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var t=e.keyCode;if(e.ctrlKey&&!e.shiftKey&&!e.altKey){if(90==t||122==t){e.stopPropagation();e.preventDefault();this.undo();return}if(89==t||121==t){e.stopPropagation();e.preventDefault();this.redo();return}}this.inherited(arguments);switch(t){case d.ENTER:case d.BACKSPACE:case d.DELETE:this.beginEditing();break;case 88:case 86:if(e.ctrlKey&&!e.altKey&&!e.metaKey){this.endEditing();88==e.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!e.ctrlKey&&!e.altKey&&!e.metaKey&&(e.keyCode<d.F1||e.keyCode>d.F15)){this.beginEditing();break}case d.ALT:this.endEditing();break;case d.UP_ARROW:case d.DOWN_ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.HOME:case d.END:case d.PAGE_UP:case d.PAGE_DOWN:this.endEditing(!0);case d.CTRL:case d.SHIFT:case d.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(e){}},_restoreSelection:function(){if(this._savedSelection){delete this._cursorToStart;this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection);delete this._savedSelection}},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(e){if(this.customUndo)if(this.isClosed)this.setValue(e);else{this.beginEditing();e||(e="&#160;");this.setValue(e);this.endEditing()}else this.inherited(arguments)},_setDisabledAttr:function(e){this.setValueDeferred.then(c.hitch(this,function(){!this.disabled&&e||!this._buttonEnabledPlugins&&e?t.forEach(this._plugins,function(e){e.set("disabled",!0)}):this.disabled&&!e&&t.forEach(this._plugins,function(e){e.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments);if(this.document&&this.document.body){l.set(this.document.body,"color",l.get(this.iframe,"color"));l.set(this.document.body,"background-color",l.get(this.iframe,"background-color"))}}catch(e){}}});function j(e){return new y({command:e.name})}function S(e){return new y({buttonClass:b,command:e.name})}c.mixin(y.registry,{undo:j,redo:j,cut:j,copy:j,paste:j,insertOrderedList:j,insertUnorderedList:j,indent:j,outdent:j,justifyCenter:j,justifyFull:j,justifyLeft:j,justifyRight:j,delete:j,selectAll:j,removeFormat:j,unlink:j,insertHorizontalRule:j,bold:S,italic:S,underline:S,strikethrough:S,subscript:S,superscript:S,"|":function(){return new y({setEditor:function(e){this.editor=e;this.button=new g({ownerDocument:e.ownerDocument})}})}});return T})},"dijit/Toolbar":function(){define(["require","dojo/_base/declare","dojo/has","dojo/keys","dojo/ready","./_Widget","./_KeyNavContainer","./_TemplatedMixin"],function(e,t,i,a,n,o,s,r){i("dijit-legacy-requires")&&n(0,function(){e(["dijit/ToolbarSeparator"])});return t("dijit.Toolbar",[o,r,s],{templateString:'<div class="dijit" role="toolbar" tabIndex="${tabIndex}" data-dojo-attach-point="containerNode"></div>',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/_KeyNavContainer":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/_base/kernel","dojo/keys","dojo/_base/lang","./registry","./_Container","./_FocusMixin","./_KeyNavMixin"],function(e,t,i,a,n,o,s,r,l,d){return t("dijit._KeyNavContainer",[l,d,r],{connectKeyNavHandlers:function(t,i){var a=this._keyNavCodes={},s=o.hitch(this,"focusPrev"),r=o.hitch(this,"focusNext");e.forEach(t,function(e){a[e]=s});e.forEach(i,function(e){a[e]=r});a[n.HOME]=o.hitch(this,"focusFirstChild");a[n.END]=o.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){a.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);e.forEach(this.getChildren(),o.hitch(this,"_startupChild"))},addChild:function(e,t){this.inherited(arguments);this._startupChild(e)},_startupChild:function(e){e.set("tabIndex","-1")},_getFirst:function(){var e=this.getChildren();return e.length?e[0]:null},_getLast:function(){var e=this.getChildren();return e.length?e[e.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(e){return(e=s.byNode(e))&&e.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/on","dijit/registry","dijit/_FocusMixin"],function(e,t,i,a,n,o,s,r){return t("dijit._KeyNavMixin",r,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);i.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var e=this._keyNavCodes={};e[a.HOME]=n.hitch(this,"focusFirstChild");e[a.END]=n.hitch(this,"focusLastChild");e[this.isLeftToRight()?a.LEFT_ARROW:a.RIGHT_ARROW]=n.hitch(this,"_onLeftArrow");e[this.isLeftToRight()?a.RIGHT_ARROW:a.LEFT_ARROW]=n.hitch(this,"_onRightArrow");e[a.UP_ARROW]=n.hitch(this,"_onUpArrow");e[a.DOWN_ARROW]=n.hitch(this,"_onDownArrow")}var t=this,r="string"==typeof this.childSelector?this.childSelector:n.hitch(this,"childSelector");this.own(o(this.domNode,"keypress",n.hitch(this,"_onContainerKeypress")),o(this.domNode,"keydown",n.hitch(this,"_onContainerKeydown")),o(this.domNode,"focus",n.hitch(this,"_onContainerFocus")),o(this.containerNode,o.selector(r,"focusin"),function(e){t._onChildFocus(s.getEnclosingWidget(this),e)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(e,t){if(e){this.focusedChild&&e!==this.focusedChild&&this._onChildBlur(this.focusedChild);e.set("tabIndex",this.tabIndex);e.focus(t?"end":"start")}},_onContainerFocus:function(e){e.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){i.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(e){i.set(this.domNode,"tabIndex",this.tabIndex);if(this.focusedChild){this.focusedChild.set("tabIndex","-1");this.lastFocusedChild=this.focusedChild;this._set("focusedChild",null)}this.inherited(arguments)},_onChildFocus:function(e){if(e&&e!=this.focusedChild){this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1");e.set("tabIndex",this.tabIndex);this.lastFocused=e;this._set("focusedChild",e)}},_searchString:"",multiCharSearchDuration:1e3,onKeyboardSearch:function(e,t,i,a){e&&this.focusChild(e)},_keyboardSearchCompare:function(e,t){var i=e.domNode,a=(e.label||(i.focusNode?i.focusNode.label:"")||i.innerText||i.textContent||"").replace(/^\s+/,"").substr(0,t.length).toLowerCase();return t.length&&a==t?-1:0},_onContainerKeydown:function(e){var t=this._keyNavCodes[e.keyCode];if(t){t(e,this.focusedChild);e.stopPropagation();e.preventDefault();this._searchString=""}else if(e.keyCode==a.SPACE&&this._searchTimer&&!(e.ctrlKey||e.altKey||e.metaKey)){e.stopImmediatePropagation();e.preventDefault();this._keyboardSearch(e," ")}},_onContainerKeypress:function(e){if(!(e.charCode<=a.SPACE||e.ctrlKey||e.altKey||e.metaKey)){e.preventDefault();e.stopPropagation();this._keyboardSearch(e,String.fromCharCode(e.charCode).toLowerCase())}},_keyboardSearch:function(e,t){var i,a=null,o=0;n.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=t;var e=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;i=this._searchString.substr(0,e);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var n=this.focusedChild||null;if(1!=e&&n||(n=this._getNextFocusableChild(n,1))){var s=n;do{var r=this._keyboardSearchCompare(n,i);r&&0==o++&&(a=n);if(-1==r){o=-1;break}n=this._getNextFocusableChild(n,1)}while(n&&n!=s)}})();this.onKeyboardSearch(a,e,i,o)},_onChildBlur:function(){},_getNextFocusableChild:function(e,t){var i=e;do{if(e)e=this._getNext(e,t);else if(!(e=this[t>0?"_getFirst":"_getLast"]()))break;if(null!=e&&e!=i&&e.isFocusable())return e}while(e!=i);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(e,t){if(e){e=e.domNode;for(;e;)if((e=e[t<0?"previousSibling":"nextSibling"])&&"getAttribute"in e){var i=s.byNode(e);if(i)return i}}return null}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],function(e,t,i,a){return e("dijit.ToolbarSeparator",[i,a],{templateString:'<div class="dijitToolbarSeparator dijitInline" role="presentation"></div>',buildRendering:function(){this.inherited(arguments);t.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/layout/_LayoutWidget":function(){define(["dojo/_base/lang","../_Widget","../_Container","../_Contained","../Viewport","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/dom-style"],function(e,t,i,a,n,o,s,r,l){return o("dijit.layout._LayoutWidget",[t,i,a],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);s.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var t=this.getParent&&this.getParent();if(!t||!t.isLayoutContainer){this.resize();this.own(n.on("resize",e.hitch(this,"resize")))}}},resize:function(t,i){var a=this.domNode;t&&r.setMarginBox(a,t);var n=i||{};e.mixin(n,t||{});"h"in n&&"w"in n||(n=e.mixin(r.getMarginBox(a),n));var o=l.getComputedStyle(a),s=r.getMarginExtents(a,o),d=r.getBorderExtents(a,o),c=this._borderBox={w:n.w-(s.w+d.w),h:n.h-(s.h+d.h)},u=r.getPadExtents(a,o);this._contentBox={l:l.toPixelValue(a,o.paddingLeft),t:l.toPixelValue(a,o.paddingTop),w:c.w-u.w,h:c.h-u.h};this.layout()},layout:function(){},_setupChild:function(e){var t=this.baseClass+"-child "+(e.baseClass?this.baseClass+"-"+e.baseClass:"");s.add(e.domNode,t)},addChild:function(e,t){this.inherited(arguments);this._started&&this._setupChild(e)},removeChild:function(e){var t=this.baseClass+"-child"+(e.baseClass?" "+this.baseClass+"-"+e.baseClass:"");s.remove(e.domNode,t);this.inherited(arguments)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(e,t){return e("dijit._Contained",null,{_getSibling:function(e){var t=this.getParent();return t&&t._getSiblingOfChild&&t._getSiblingOfChild(this,"previous"==e?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var e=this.getParent();return e&&e.getIndexOfChild?e.getIndexOfChild(this):-1}})})},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(e,t,i,a){return e("dijit.form.ToggleButton",[i,a],{baseClass:"dijitToggleButton",setChecked:function(e){t.deprecated("setChecked("+e+") is deprecated. Use set('checked',"+e+") instead.","","2.0");this.set("checked",e)}})})},"dijit/form/Button":function(){define(["require","dojo/_base/declare","dojo/dom-class","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/ready","./_FormWidget","./_ButtonMixin","dojo/text!./templates/Button.html","../a11yclick"],function(e,t,i,a,n,o,s,r,l,d){a("dijit-legacy-requires")&&s(0,function(){e(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});var c=t("dijit.form.Button"+(a("dojo-bidi")?"_NoBidi":""),[r,l],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:d,_setValueAttr:"valueNode",_setNameAttr:function(e){this.valueNode&&this.valueNode.setAttribute("name",e)},postCreate:function(){this.inherited(arguments);this._setLabelFromContainer()},_setLabelFromContainer:function(){if(this.containerNode&&!this.label){this.label=o.trim(this.containerNode.innerHTML);this.onLabelSet()}},_setShowLabelAttr:function(e){this.containerNode&&i.toggle(this.containerNode,"dijitDisplayNone",!e);this._set("showLabel",e)},setLabel:function(e){n.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",e)},onLabelSet:function(){this.inherited(arguments);this.showLabel||"title"in this.params||(this.titleNode.title=o.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});a("dojo-bidi")&&(c=t("dijit.form.Button",c,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(e){if(this._created&&this.textDir!=e){this._set("textDir",e);this._setLabelAttr(this.label)}}}));return c})},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom","dojo/has","../registry"],function(e,t,i,a){var n=e("dijit.form._ButtonMixin"+(i("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(e){e.stopPropagation();e.preventDefault();this.disabled||this.valueNode.click(e);return!1},_onClick:function(e){if(this.disabled){e.stopPropagation();e.preventDefault();return!1}!1===this.onClick(e)&&e.preventDefault();var t=e.defaultPrevented;if(!t&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var i=this.domNode;i.parentNode;i=i.parentNode){var n=a.byNode(i);if(n&&"function"==typeof n._onSubmit){n._onSubmit(e);e.preventDefault();t=!0;break}}return!t},postCreate:function(){this.inherited(arguments);t.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(e){this._set("label",e);(this.containerNode||this.focusNode).innerHTML=e;this.onLabelSet()},onLabelSet:function(){}});i("dojo-bidi")&&(n=e("dijit.form._ButtonMixin",n,{onLabelSet:function(){this.inherited(arguments);var e=this.containerNode||this.focusNode;this.applyTextDir(e)}}));return n})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(e,t){return e("dijit.form._ToggleButtonMixin",null,{checked:!1,_aria_attr:"aria-pressed",_onClick:function(e){var t=this.checked;this._set("checked",!t);var i=this.inherited(arguments);this.set("checked",i?this.checked:t);return i},_setCheckedAttr:function(e,i){this._set("checked",e);var a=this.focusNode||this.domNode;this._created&&t.get(a,"checked")!=!!e&&t.set(a,"checked",!!e);a.setAttribute(this._aria_attr,String(e));this._handleOnChange(e,i)},postCreate:function(){this.inherited(arguments);var e=this.focusNode||this.domNode;this.checked&&e.setAttribute("checked","checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(e,t,i,a,n){var o=t("dijit._editor._Plugin",a,{constructor:function(e){this.params=e||{};i.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:n,disabled:!1,getLabel:function(e){return this.editor.commands[e]},_initButton:function(){if(this.command.length){var e=this.getLabel(this.command),t=this.editor,a=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);if(!this.button){var n=i.mixin({label:e,ownerDocument:t.ownerDocument,dir:t.dir,lang:t.lang,showLabel:!1,iconClass:a,dropDown:this.dropDown,tabIndex:"-1"},this.params||{});delete n.name;this.button=new this.buttonClass(n)}}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(t,i,a){this.own(e.connect(t,i,this,a))},updateState:function(){var e,t,i=this.editor,a=this.command;if(i&&i.isLoaded&&a.length){var n=this.get("disabled");if(this.button)try{var o=i._implCommand(a);t=!n&&(this[o]?this[o](a):i.queryCommandEnabled(a));if(this.enabled!==t){this.enabled=t;this.button.set("disabled",!t)}if(t&&"boolean"==typeof this.button.checked){e=i.queryCommandState(a);if(this.checked!==e){this.checked=e;this.button.set("checked",i.queryCommandState(a))}}}catch(i){}}},setEditor:function(e){this.editor=e;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",i.hitch(this.editor,"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",i.hitch(this,"updateState")))},setToolbar:function(e){this.button&&e.addChild(this.button)},set:function(e,t){if("object"==typeof e){for(var i in e)this.set(i,e[i]);return this}var a=this._getAttrNames(e);if(this[a.s])var n=this[a.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(e,t);return n||this},get:function(e){var t=this._getAttrNames(e);return this[t.g]?this[t.g]():this[e]},_setDisabledAttr:function(e){this._set("disabled",e);this.updateState()},_getAttrNames:function(e){var t=this._attrPairNames;if(t[e])return t[e];var i=e.charAt(0).toUpperCase()+e.substr(1);return t[e]={s:"_set"+i+"Attr",g:"_get"+i+"Attr"}},_set:function(e,t){this[e]=t}});o.registry={};return o})},"dijit/_editor/plugins/EnterKeyHandling":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","dojo/_base/window","dojo/window","../_Plugin","../RichText","../range"],function(e,t,i,a,n,o,s,r,l,d,c){return e("dijit._editor.plugins.EnterKeyHandling",l,{blockNodeForEnter:"BR",constructor:function(e){if(e){"blockNodeForEnter"in e&&(e.blockNodeForEnter=e.blockNodeForEnter.toUpperCase());a.mixin(this,e)}},setEditor:function(e){if(this.editor!==e){this.editor=e;if("BR"==this.blockNodeForEnter){this.editor.customUndo=!0;e.onLoadDeferred.then(a.hitch(this,function(t){this.own(n(e.document,"keydown",a.hitch(this,function(e){if(e.keyCode==i.ENTER){var t=a.mixin({},e);t.shiftKey=!0;if(!this.handleEnterKey(t)){e.stopPropagation();e.preventDefault()}}})));o("ie")>=9&&o("ie")<=10&&this.own(n(e.document,"paste",a.hitch(this,function(e){setTimeout(a.hitch(this,function(){var e=this.editor.document.selection.createRange();e.move("character",-1);e.select();e.move("character",1);e.select()}),0)})));return t}))}else if(this.blockNodeForEnter){var t=a.hitch(this,"handleEnterKey");e.addKeyHandler(13,0,0,t);e.addKeyHandler(13,0,1,t);this.own(this.editor.on("KeyPressed",a.hitch(this,"onKeyPressed")))}}},onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var e=this.editor.selection.getAncestorElement("LI");if(e){o("mozilla")&&"LI"==e.parentNode.parentNode.nodeName&&(e=e.parentNode.parentNode);var t=e.firstChild;if(t&&1==t.nodeType&&("UL"==t.nodeName||"OL"==t.nodeName)){e.insertBefore(t.ownerDocument.createTextNode(""),t);var i=c.create(this.editor.window);i.setStart(e.firstChild,0);var a=c.getSelection(this.editor.window,!0);a.removeAllRanges();a.addRange(i)}}else{d.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter);var n=this.editor.selection.getAncestorElement(this.blockNodeForEnter);if(n){n.innerHTML=this.bogusHtmlContent;if(o("ie")<=9){var s=this.editor.document.selection.createRange();s.move("character",-1);s.select()}}else console.error("onKeyPressed: Cannot find the new block node")}}this._checkListLater=!1}if(this._pressedEnterInBlock){this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling);delete this._pressedEnterInBlock}},bogusHtmlContent:"&#160;",blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(e){var i,a,n,s,l,u,h,p=this.editor.document;if(e.shiftKey){var _=this.editor.selection.getParentElement(),m=c.getAncestor(_,this.blockNodes);if(m){if("LI"==m.tagName)return!0;if(!(a=(i=c.getSelection(this.editor.window)).getRangeAt(0)).collapsed){a.deleteContents();a=(i=c.getSelection(this.editor.window)).getRangeAt(0)}if(c.atBeginningOfContainer(m,a.startContainer,a.startOffset)){l=p.createElement("br");n=c.create(this.editor.window);m.insertBefore(l,m.firstChild);n.setStartAfter(l);i.removeAllRanges();i.addRange(n)}else{if(!c.atEndOfContainer(m,a.startContainer,a.startOffset)){if((u=a.startContainer)&&3==u.nodeType){h=u.nodeValue;s=p.createTextNode(h.substring(0,a.startOffset));y=p.createTextNode(h.substring(a.startOffset));b=p.createElement("br");""==y.nodeValue&&o("webkit")&&(y=p.createTextNode(""));t.place(s,u,"after");t.place(b,s,"after");t.place(y,b,"after");t.destroy(u);(n=c.create(this.editor.window)).setStart(y,0);i.removeAllRanges();i.addRange(n);return!1}return!0}n=c.create(this.editor.window);l=p.createElement("br");m.appendChild(l);m.appendChild(p.createTextNode(""));n.setStart(m.lastChild,0);i.removeAllRanges();i.addRange(n)}}else if((i=c.getSelection(this.editor.window)).rangeCount){if((a=i.getRangeAt(0))&&a.startContainer){if(!a.collapsed){a.deleteContents();a=(i=c.getSelection(this.editor.window)).getRangeAt(0)}if((u=a.startContainer)&&3==u.nodeType){var g=a.startOffset;if(u.length<g){u=(j=this._adjustNodeAndOffset(u,g)).node;g=j.offset}h=u.nodeValue;s=p.createTextNode(h.substring(0,g));y=p.createTextNode(h.substring(g));b=p.createElement("br");y.length||(y=p.createTextNode(""));s.length?t.place(s,u,"after"):s=u;t.place(b,s,"after");t.place(y,b,"after");t.destroy(u);(n=c.create(this.editor.window)).setStart(y,0);n.setEnd(y,y.length);i.removeAllRanges();i.addRange(n);this.editor.selection.collapse(!0)}else{var f;a.startOffset>=0&&(f=u.childNodes[a.startOffset]);var b=p.createElement("br"),y=p.createTextNode("");if(f){t.place(b,f,"before");t.place(y,b,"after")}else{u.appendChild(b);u.appendChild(y)}(n=c.create(this.editor.window)).setStart(y,0);n.setEnd(y,y.length);i.removeAllRanges();i.addRange(n);this.editor.selection.collapse(!0)}}}else d.prototype.execCommand.call(this.editor,"inserthtml","<br>");return!1}var v=!0;if(!(a=(i=c.getSelection(this.editor.window)).getRangeAt(0)).collapsed){a.deleteContents();a=(i=c.getSelection(this.editor.window)).getRangeAt(0)}var w=c.getBlockAncestor(a.endContainer,null,this.editor.editNode),x=w.blockNode;if(this._checkListLater=x&&("LI"==x.nodeName||"LI"==x.parentNode.nodeName)){o("mozilla")&&(this._pressedEnterInBlock=x);if(/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(x.innerHTML)){x.innerHTML="";if(o("webkit")){(n=c.create(this.editor.window)).setStart(x,0);i.removeAllRanges();i.addRange(n)}this._checkListLater=!1}return!0}if(!w.blockNode||w.blockNode===this.editor.editNode){try{d.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(P){}if((w={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),blockContainer:this.editor.editNode}).blockNode){if(w.blockNode!=this.editor.editNode&&!(w.blockNode.textContent||w.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length){this.removeTrailingBr(w.blockNode);return!1}}else w.blockNode=this.editor.editNode;a=(i=c.getSelection(this.editor.window)).getRangeAt(0)}var k=p.createElement(this.blockNodeForEnter);k.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(w.blockNode);var C=a.endOffset,T=a.endContainer;if(T.length<C){var j=this._adjustNodeAndOffset(T,C);T=j.node;C=j.offset}if(c.atEndOfContainer(w.blockNode,T,C)){w.blockNode===w.blockContainer?w.blockNode.appendChild(k):t.place(k,w.blockNode,"after");v=!1;(n=c.create(this.editor.window)).setStart(k,0);i.removeAllRanges();i.addRange(n);this.editor.height&&r.scrollIntoView(k)}else if(c.atBeginningOfContainer(w.blockNode,a.startContainer,a.startOffset)){t.place(k,w.blockNode,w.blockNode===w.blockContainer?"first":"before");if(k.nextSibling&&this.editor.height){(n=c.create(this.editor.window)).setStart(k.nextSibling,0);i.removeAllRanges();i.addRange(n);r.scrollIntoView(k.nextSibling)}v=!1}else{w.blockNode===w.blockContainer?w.blockNode.appendChild(k):t.place(k,w.blockNode,"after");v=!1;w.blockNode.style&&k.style&&w.blockNode.style.cssText&&(k.style.cssText=w.blockNode.style.cssText);var S,$;if((u=a.startContainer)&&3==u.nodeType){var M,A;C=a.endOffset;if(u.length<C){u=(j=this._adjustNodeAndOffset(u,C)).node;C=j.offset}h=u.nodeValue;s=p.createTextNode(h.substring(0,C));y=p.createTextNode(h.substring(C,h.length));t.place(s,u,"before");t.place(y,u,"after");t.destroy(u);for(var E=s.parentNode;E!==w.blockNode;){var N=E.tagName,L=p.createElement(N);E.style&&L.style&&E.style.cssText&&(L.style.cssText=E.style.cssText);if("FONT"===E.tagName){E.color&&(L.color=E.color);E.face&&(L.face=E.face);E.size&&(L.size=E.size)}M=y;for(;M;){A=M.nextSibling;L.appendChild(M);M=A}t.place(L,E,"after");s=E;y=L;E=E.parentNode}(1==(M=y).nodeType||3==M.nodeType&&M.nodeValue)&&(k.innerHTML="");S=M;for(;M;){A=M.nextSibling;k.appendChild(M);M=A}}n=c.create(this.editor.window);var D=S;if("BR"!==this.blockNodeForEnter){for(;D;){$=D;D=A=D.firstChild}if($&&$.parentNode){k=$.parentNode;n.setStart(k,0);i.removeAllRanges();i.addRange(n);this.editor.height&&r.scrollIntoView(k);o("mozilla")&&(this._pressedEnterInBlock=w.blockNode)}else v=!0}else{n.setStart(k,0);i.removeAllRanges();i.addRange(n);this.editor.height&&r.scrollIntoView(k);o("mozilla")&&(this._pressedEnterInBlock=w.blockNode)}}return v},_adjustNodeAndOffset:function(e,t){for(;e.length<t&&e.nextSibling&&3==e.nextSibling.nodeType;){t-=e.length;e=e.nextSibling}return{node:e,offset:t}},removeTrailingBr:function(e){var i=/P|DIV|LI/i.test(e.tagName)?e:this.editor.selection.getParentOfType(e,["P","DIV","LI"]);if(i){i.lastChild&&(i.childNodes.length>1&&3==i.lastChild.nodeType&&/^[\s\xAD]*$/.test(i.lastChild.nodeValue)||"BR"==i.lastChild.tagName)&&t.destroy(i.lastChild);i.childNodes.length||(i.innerHTML=this.bogusHtmlContent)}}})})},"dijit/_editor/RichText":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/_base/kernel","dojo/keys","dojo/_base/lang","dojo/on","dojo/query","dojo/domReady","dojo/sniff","dojo/string","dojo/topic","dojo/_base/unload","dojo/_base/url","dojo/window","../_Widget","../_CssStateMixin","../selection","./range","./html","../focus","../main"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g,f,b,y,v,w,x,k,C,T,j,S,$){var M=i("dijit._editor.RichText",[x,k],{constructor:function(e){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};e&&h.isString(e.value)&&(this.value=e.value);this.onLoadDeferred=new a},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){this.domNode.tagName.toLowerCase();this.contentPreFilters=[h.trim,h.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);if(g("mozilla")){this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters);this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters)}if(g("webkit")){this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters);this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters)}if(g("ie")||g("trident")){this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters);this.contentDomPostFilters=[h.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters)}this.contentDomPostFilters=[h.hitch(this,"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);b.publish($._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var e,t=h.hitch(this,function(e,t){return function(){return!this.execCommand(e,t)}}),i={b:t("bold"),i:t("italic"),u:t("underline"),a:t("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:t("formatblock","h1"),2:t("formatblock","h2"),3:t("formatblock","h3"),4:t("formatblock","h4"),"\\":t("insertunorderedlist")};g("ie")||(i.Z=t("redo"));for(e in i)this.addKeyHandler(e,!0,!1,i[e])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(M._editorCommandsLocalized){this._local2NativeFormatNames=M._local2NativeFormatNames;this._native2LocalFormatNames=M._native2LocalFormatNames}else{M._editorCommandsLocalized=!0;M._local2NativeFormatNames={};M._native2LocalFormatNames={};this._local2NativeFormatNames=M._local2NativeFormatNames;this._native2LocalFormatNames=M._native2LocalFormatNames;for(var e,t=["div","p","pre","h1","h2","h3","h4","h5","h6","ol","ul","address"],i="",a=0;e=t[a++];)"l"!==e.charAt(1)?i+="<"+e+"><span>content</span></"+e+"><br/>":i+="<"+e+"><li>content</li></"+e+"><br/>";var n=r.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:i});this.ownerDocumentBody.appendChild(n);var o=h.hitch(this,function(){for(var e=n.firstChild;e;)try{this.selection.selectElement(e.firstChild);var t=e.tagName.toLowerCase();this._local2NativeFormatNames[t]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[t]]=t;e=e.nextSibling.nextSibling}catch(i){}r.destroy(n)});this.defer(o)}},open:function(e){(!this.onLoadDeferred||this.onLoadDeferred.fired>=0)&&(this.onLoadDeferred=new a);this.isClosed||this.close();b.publish($._scopeName+"._editor.RichText::open",this);1===arguments.length&&e.nodeName&&(this.domNode=e);var i,l=this.domNode;if(h.isString(this.value)){i=this.value;l.innerHTML=""}else if(l.nodeName&&"textarea"==l.nodeName.toLowerCase()){var c=this.textarea=l;this.name=c.name;i=c.value;(l=this.domNode=this.ownerDocument.createElement("div")).setAttribute("widgetId",this.id);c.removeAttribute("widgetId");l.cssText=c.cssText;l.className+=" "+c.className;r.place(l,c,"before");var u=h.hitch(this,function(){d.set(c,{display:"block",position:"absolute",top:"-1000px"});if(g("ie")){var e=c.style;this.__overflow=e.overflow;e.overflow="hidden"}});g("ie")?this.defer(u,10):u();if(c.form){var _=c.value;this.reset=function(){this.getValue()!==_&&this.replaceValue(_)};p(c.form,"submit",h.hitch(this,function(){o.set(c,"disabled",this.disabled);c.value=this.getValue()}))}}else{i=j.getChildrenHtml(l);l.innerHTML=""}this.value=i;l.nodeName&&"LI"===l.nodeName&&(l.innerHTML=" <br>");this.header=l.ownerDocument.createElement("div");l.appendChild(this.header);this.editingArea=l.ownerDocument.createElement("div");l.appendChild(this.editingArea);this.footer=l.ownerDocument.createElement("div");l.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!t.useXDomain||t.allowXdRichTextSave)){var m=n.byId($._scopeName+"._editor.RichText.value");if(m&&""!==m.value)for(var f,v=m.value.split(this._SEPARATOR),w=0;f=v[w++];){var x=f.split(this._NAME_CONTENT_SEP);if(x[0]===this.name){this.value=x[1];v=v.splice(w,1);m.value=v.join(this._SEPARATOR);break}}if(!M._globalSaveHandler){M._globalSaveHandler={};y.addOnUnload(function(){var e;for(e in M._globalSaveHandler){var t=M._globalSaveHandler[e];h.isFunction(t)&&t()}})}M._globalSaveHandler[this.id]=h.hitch(this,"_saveContent")}this.isClosed=!1;var k=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");k.id=this.id+"_iframe";k.style.border="none";k.style.width="100%";if(this._layoutMode)k.style.height="100%";else if(g("ie")>=7){this.height&&(k.style.height=this.height);this.minHeight&&(k.style.minHeight=this.minHeight)}else k.style.height=this.height?this.height:this.minHeight;k.frameBorder=0;k._loadFunc=h.hitch(this,function(e){this.window=e;this.document=e.document;this.selection=new C.SelectionManager(e);g("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});var T,S=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");T=g("ie")<11?'javascript:document.open();try{parent.window;}catch(e){document.domain="'+document.domain+"\";}document.write('"+S+"');document.close()":"javascript: '"+S+"'";this.editingArea.appendChild(k);k.src=T;"LI"===l.nodeName&&(l.lastChild.style.marginTop="-1.2em");s.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var e,t=d.getComputedStyle(this.domNode);if(this["aria-label"])e=this["aria-label"];else{var i=_('label[for="'+this.id+'"]',this.ownerDocument)[0]||n.byId(this["aria-labelledby"],this.ownerDocument);i&&(e=i.textContent||i.innerHTML||"")}var a="<div id='dijitEditorBody' role='textbox' aria-multiline='true' "+(e?" aria-label='"+f.escape(e)+"'":"")+"></div>",o=[t.fontWeight,t.fontSize,t.fontFamily].join(" "),s=t.lineHeight;s=s.indexOf("px")>=0?parseFloat(s)/parseFloat(t.fontSize):s.indexOf("em")>=0?parseFloat(s):"normal";var r="",l=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/gi,function(e){var t=(e=e.replace(/^;/gi,"")+";").split(":")[0];if(t){t=(t=h.trim(t)).toLowerCase();var i,a="";for(i=0;i<t.length;i++){var n=t.charAt(i);if("-"===n){i++;n=t.charAt(i).toUpperCase()}a+=n}d.set(l.domNode,a,"")}r+=e+";"});this.iframe.setAttribute("title",e);return["<!DOCTYPE html>","<html lang='"+(this.lang||c.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir='rtl'")+">\n","<head>\n","<meta http-equiv='Content-Type' content='text/html'>\n",e?"<title>"+f.escape(e)+"</title>":"","<style>\n","\tbody,html {\n","\t\tbackground:transparent;\n","\t\tpadding: 1px 0 0 0;\n","\t\tmargin: -1px 0 0 0;\n","\t}\n","\tbody,html,#dijitEditorBody { outline: none; }","html { height: 100%; width: 100%; overflow: hidden; }\n",this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n","\t\ttop:0px;\n","\t\tleft:0px;\n","\t\tright:0px;\n","\t\tfont:",o,";\n",this.height||g("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",s,";\n","\t}\n","\tp{ margin: 1em 0; }\n","\tli > ul:-moz-first-node, li > ol:-moz-first-node{ padding-top: 1.2em; }\n",g("ie")||g("trident")||g("edge")?"":"\tli{ min-height:1.2em; }\n","</style>\n",this._applyEditingAreaStyleSheets(),"\n","</head>\n<body role='application'",e?" aria-label='"+f.escape(e)+"'":"","onload='try{frameElement && frameElement._loadFunc(window,document)}catch(e){document.domain=\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style='"+r+"'>",a,"</body>\n</html>"].join("")},_applyEditingAreaStyleSheets:function(){var e=[];if(this.styleSheets){e=this.styleSheets.split(";");this.styleSheets=""}e=e.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var t,i="",a=0,n=w.get(this.ownerDocument);t=e[a++];){var o=new v(n.location,t).toString();this.editingAreaStyleSheets.push(o);i+='<link rel="stylesheet" type="text/css" href="'+o+'"/>'}return i},addStyleSheet:function(t){var i=t.toString(),a=w.get(this.ownerDocument);("."===i.charAt(0)||"/"!==i.charAt(0)&&!t.host)&&(i=new v(a.location,i).toString());if(!(e.indexOf(this.editingAreaStyleSheets,i)>-1)){this.editingAreaStyleSheets.push(i);this.onLoadDeferred.then(h.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(i);else{var e=this.document.getElementsByTagName("head")[0],t=this.document.createElement("link");t.rel="stylesheet";t.type="text/css";t.href=i;e.appendChild(t)}}))}},removeStyleSheet:function(t){var i=t.toString(),a=w.get(this.ownerDocument);("."===i.charAt(0)||"/"!==i.charAt(0)&&!t.host)&&(i=new v(a.location,i).toString());var n=e.indexOf(this.editingAreaStyleSheets,i);if(-1!==n){delete this.editingAreaStyleSheets[n];_('link[href="'+i+'"]',this.window.document).orphan()}},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(e){e=!!e;this._set("disabled",e);if(this.isLoaded){var t=g("ie")&&(this.isLoaded||!this.focusOnLoad);t&&(this.editNode.unselectable="on");this.editNode.contentEditable=!e;this.editNode.tabIndex=e?"-1":this.tabIndex;t&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(g("mozilla")&&!e&&this._mozSettingProps){var i,a=this._mozSettingProps;for(i in a)if(a.hasOwnProperty(i))try{this.document.execCommand(i,!1,a[i])}catch(n){}}this._disabledOK=!0}},onLoad:function(t){if(!this.window.__registeredWindow){this.window.__registeredWindow=!0;this._iframeRegHandle=S.registerIframe(this.iframe)}this.editNode=this.document.body.firstChild;var i=this;this.beforeIframeNode=r.place("<div tabIndex=-1></div>",this.iframe,"before");this.afterIframeNode=r.place("<div tabIndex=-1></div>",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){i.editNode.focus()};this.focusNode=this.editNode;var a=this.events.concat(this.captureEvents),n=this.iframe?this.document:this.editNode;this.own.apply(this,e.map(a,function(e){var t=e.toLowerCase().replace(/^on/,"");return p(n,t,h.hitch(this,e))},this));this.own(p(n,"mouseup",h.hitch(this,"onClick")));if(g("ie")){this.own(p(this.document,"mousedown",h.hitch(this,"_onIEMouseDown")));this.editNode.style.zoom=1}if(g("webkit")){this._webkitListener=this.own(p(this.document,"mouseup",h.hitch(this,"onDisplayChanged")))[0];this.own(p(this.document,"mousedown",h.hitch(this,function(e){var t=e.target;!t||t!==this.document.body&&t!==this.document||this.defer("placeCursorAtEnd")})))}if(g("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(s){}this.isLoaded=!0;this.set("disabled",this.disabled);var o=h.hitch(this,function(){this.setValue(t);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&m(h.hitch(this,"defer","focus",this.updateInterval));this.value=this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(o):o()},onKeyDown:function(t){if(t.keyCode===u.SHIFT||t.keyCode===u.ALT||t.keyCode===u.META||t.keyCode===u.CTRL)return!0;if(t.keyCode===u.TAB&&this.isTabIndent){t.stopPropagation();t.preventDefault();this.queryCommandEnabled(t.shiftKey?"outdent":"indent")&&this.execCommand(t.shiftKey?"outdent":"indent")}if(t.keyCode==u.TAB&&!this.isTabIndent&&!t.ctrlKey&&!t.altKey){t.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus();return!0}if(g("ie")<9&&t.keyCode===u.BACKSPACE&&"Control"===this.document.selection.type){t.stopPropagation();t.preventDefault();this.execCommand("delete")}g("ff")&&(t.keyCode!==u.PAGE_UP&&t.keyCode!==u.PAGE_DOWN||this.editNode.clientHeight>=this.editNode.scrollHeight&&t.preventDefault());var i=this._keyHandlers[t.keyCode],a=arguments;i&&!t.altKey&&e.some(i,function(e){if(!(e.shift^t.shiftKey||e.ctrl^(t.ctrlKey||t.metaKey))){e.handler.apply(this,a)||t.preventDefault();return!0}},this);this.defer("onKeyPressed",1);return!0},onKeyUp:function(){},setDisabled:function(e){c.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",e)},_setValueAttr:function(e){this.setValue(e)},_setDisableSpellCheckAttr:function(e){this.document?o.set(this.document.body,"spellcheck",!e):this.onLoadDeferred.then(h.hitch(this,function(){o.set(this.document.body,"spellcheck",!e)}));this._set("disableSpellCheck",e)},addKeyHandler:function(e,t,i,a){"string"==typeof e&&(e=e.toUpperCase().charCodeAt(0));h.isArray(this._keyHandlers[e])||(this._keyHandlers[e]=[]);this._keyHandlers[e].push({shift:i||!1,ctrl:t||!1,handler:a})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(e){this.onDisplayChanged(e)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(e){(g("ie")||g("trident"))&&this.defer(function(){S.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var t=this.getValue(!0);t!==this.value&&this.onChange(t);this._set("value",t)},_onFocus:function(e){if(!this.disabled){this._disabledOK||this.set("disabled",!1);this.inherited(arguments)}},blur:function(){!g("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?g("ie")<9?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(e,t){var i=e.toLowerCase();"formatblock"===i?g("safari")&&void 0===t&&(i="heading"):"hilitecolor"!==i||g("mozilla")||(i="backcolor");return i},_implCommand:function(e){return"_"+this._normalizeCommand(e)+"EnabledImpl"},_qcaCache:{},queryCommandAvailable:function(e){var t=this._qcaCache[e];return void 0!==t?t:this._qcaCache[e]=this._queryCommandAvailable(e)},_queryCommandAvailable:function(e){switch(e.toLowerCase()){case"bold":case"italic":case"underline":case"subscript":case"superscript":case"fontname":case"fontsize":case"forecolor":case"hilitecolor":case"justifycenter":case"justifyfull":case"justifyleft":case"justifyright":case"delete":case"selectall":case"toggledir":case"createlink":case"unlink":case"removeformat":case"inserthorizontalrule":case"insertimage":case"insertorderedlist":case"insertunorderedlist":case"indent":case"outdent":case"formatblock":case"inserthtml":case"undo":case"redo":case"strikethrough":case"tabindent":case"cut":case"copy":case"paste":return!0;case"blockdirltr":case"blockdirrtl":case"dirltr":case"dirrtl":case"inlinedirltr":case"inlinedirrtl":return g("ie")||g("trident")||g("edge");case"inserttable":case"insertcell":case"insertcol":case"insertrow":case"deletecells":case"deletecols":case"deleterows":case"mergecells":case"splitcell":return!g("webkit");default:return!1}},execCommand:function(e,t){var i;this.focused&&this.focus();e=this._normalizeCommand(e,t);if(void 0!==t){if("heading"===e)throw new Error("unimplemented");"formatblock"===e&&(g("ie")||g("trident"))&&(t="<"+t+">")}var a="_"+e+"Impl";this[a]?i=this[a](t):((t=arguments.length>1?t:null)||"createlink"!==e)&&(i=this.document.execCommand(e,!1,t));this.onDisplayChanged();return i},queryCommandEnabled:function(e){if(this.disabled||!this._disabledOK)return!1;e=this._normalizeCommand(e);var t=this._implCommand(e);return this[t]?this[t](e):this._browserQueryCommandEnabled(e)},queryCommandState:function(e){if(this.disabled||!this._disabledOK)return!1;e=this._normalizeCommand(e);try{return this.document.queryCommandState(e)}catch(t){return!1}},queryCommandValue:function(e){if(this.disabled||!this._disabledOK)return!1;var t;e=this._normalizeCommand(e);if(g("ie")&&"formatblock"===e)t=this._native2LocalFormatNames[this.document.queryCommandValue(e)];else if(g("mozilla")&&"hilitecolor"===e){var i;try{i=this.document.queryCommandValue("styleWithCSS")}catch(a){i=!1}this.document.execCommand("styleWithCSS",!1,!0);t=this.document.queryCommandValue(e);this.document.execCommand("styleWithCSS",!1,i)}else t=this.document.queryCommandValue(e);return t},_sCall:function(e,t){return this.selection[e].apply(this.selection,t)},placeCursorAtStart:function(){this.focus();var e=!1;if(g("mozilla"))for(var t=this.editNode.firstChild;t;){if(3===t.nodeType){if(t.nodeValue.replace(/^\s+|\s+$/g,"").length>0){e=!0;this.selection.selectElement(t);break}}else if(1===t.nodeType){e=!0;var i=t.tagName?t.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(i)?this.selection.selectElement(t):this.selection.selectElementChildren(t);break}t=t.nextSibling}else{e=!0;this.selection.selectElementChildren(this.editNode)}e&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var e=!1;if(g("mozilla"))for(var t=this.editNode.lastChild;t;){if(3===t.nodeType){if(t.nodeValue.replace(/^\s+|\s+$/g,"").length>0){e=!0;this.selection.selectElement(t);break}}else if(1===t.nodeType){e=!0;this.selection.selectElement(t.lastChild||t);break}t=t.previousSibling}else{e=!0;this.selection.selectElementChildren(this.editNode)}e&&this.selection.collapse(!1)},getValue:function(e){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,e):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(e){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){e=this._preFilterContent(e);var t=this.isClosed?this.domNode:this.editNode;t.innerHTML=e;this._preDomFilterContent(t)}else this.textarea.value=e;this.onDisplayChanged();this._set("value",this.getValue(!0))}else this.onLoadDeferred.then(h.hitch(this,function(){this.setValue(e)}))},replaceValue:function(e){if(this.isClosed)this.setValue(e);else if(this.window&&this.window.getSelection&&!g("mozilla"))this.setValue(e);else if(this.window&&this.window.getSelection){e=this._preFilterContent(e);this.execCommand("selectall");this.execCommand("inserthtml",e);this._preDomFilterContent(this.editNode)}else this.document&&this.document.selection&&this.setValue(e);this._set("value",this.getValue(!0))},_preFilterContent:function(t){var i=t;e.forEach(this.contentPreFilters,function(e){e&&(i=e(i))});return i},_preDomFilterContent:function(t){t=t||this.editNode;e.forEach(this.contentDomPreFilters,function(e){e&&h.isFunction(e)&&e(t)},this)},_postFilterContent:function(t,i){var a;if(h.isString(t))a=t;else{t=t||this.editNode;if(this.contentDomPostFilters.length){i&&(t=h.clone(t));e.forEach(this.contentDomPostFilters,function(e){t=e(t)})}a=j.getChildrenHtml(t)}h.trim(a.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(a="");e.forEach(this.contentPostFilters,function(e){a=e(a)});return a},_saveContent:function(){var e=n.byId($._scopeName+"._editor.RichText.value");if(e){e.value&&(e.value+=this._SEPARATOR);e.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0)}},escapeXml:function(e,t){e=e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");t||(e=e.replace(/'/gm,"&#39;"));return e},getNodeHtml:function(e){c.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",2);return j.getNodeHtml(e)},getNodeChildrenHtml:function(e){c.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return j.getChildrenHtml(e)},close:function(e){if(!this.isClosed){arguments.length||(e=!0);e&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);if(this._webkitListener){this._webkitListener.remove();delete this._webkitListener}g("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;if(this._iframeRegHandle){this._iframeRegHandle.remove();delete this._iframeRegHandle}if(this.textarea){var t=this.textarea.style;t.position="";t.left=t.top="";if(g("ie")){t.overflow=this.__overflow;this.__overflow=null}this.textarea.value=this.value;r.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;s.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=null);this.window=null;this.document=null;this.editingArea=null;this.editorObject=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);M._globalSaveHandler&&delete M._globalSaveHandler[this.id]},_removeMozBogus:function(e){return e.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(e){return e=(e=(e=e.replace(/\sclass="webkit-block-placeholder"/gi,"")).replace(/\sclass="apple-style-span"/gi,"")).replace(/<meta charset=\"utf-8\" \/>/gi,"")},_normalizeFontStyle:function(e){return e.replace(/<(\/)?strong([ \>])/gi,"<$1b$2").replace(/<(\/)?em([ \>])/gi,"<$1i$2")},_preFixUrlAttributes:function(e){return e.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2")},_browserQueryCommandEnabled:function(e){if(!e)return!1;var t=g("ie")<9?this.document.selection.createRange():this.document;try{return t.queryCommandEnabled(e)}catch(i){return!1}},_createlinkEnabledImpl:function(){var e=!0;if(g("opera")){e=!!this.window.getSelection().isCollapsed||this.document.queryCommandEnabled("createlink")}else e=this._browserQueryCommandEnabled("createlink");return e},_unlinkEnabledImpl:function(){return g("mozilla")||g("webkit")?this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){return!(!g("mozilla")&&!g("webkit"))||this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var e=!0;if(g("webkit")){var t=this.window.getSelection();t&&(t=t.toString());e=!!t}else e=this._browserQueryCommandEnabled("cut");return e},_copyEnabledImpl:function(){var e=!0;if(g("webkit")){var t=this.window.getSelection();t&&(t=t.toString());e=!!t}else e=this._browserQueryCommandEnabled("copy");return e},_pasteEnabledImpl:function(){return!!g("webkit")||this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(e){return g("ie")?this._inserthtmlImpl("<hr>"):this.document.execCommand("inserthorizontalrule",!1,e)},_unlinkImpl:function(e){if(this.queryCommandEnabled("unlink")&&(g("mozilla")||g("webkit"))){var t=this.selection.getAncestorElement("a");this.selection.selectElement(t);return this.document.execCommand("unlink",!1,null)}return this.document.execCommand("unlink",!1,e)},_hilitecolorImpl:function(e){var t;if(!this._handleTextColorOrProperties("hilitecolor",e))if(g("mozilla")){this.document.execCommand("styleWithCSS",!1,!0);t=this.document.execCommand("hilitecolor",!1,e);this.document.execCommand("styleWithCSS",!1,!1)}else t=this.document.execCommand("hilitecolor",!1,e);return t},_backcolorImpl:function(e){g("ie")&&(e=e||null);var t=this._handleTextColorOrProperties("backcolor",e);t||(t=this.document.execCommand("backcolor",!1,e));return t},_forecolorImpl:function(e){g("ie")&&(e=e||null);var t=!1;(t=this._handleTextColorOrProperties("forecolor",e))||(t=this.document.execCommand("forecolor",!1,e));return t},_inserthtmlImpl:function(e){e=this._preFilterContent(e);var t=!0;if(g("ie")<9){var i=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var a=i.item(0);i.length;)i.remove(i.item(0));a.outerHTML=e}else i.pasteHTML(e);i.select()}else if(g("trident")<8){var n=T.getSelection(this.window);if(n&&n.rangeCount&&n.getRangeAt){(i=n.getRangeAt(0)).deleteContents();var o,s,l=r.create("div");l.innerHTML=e;for(a=this.document.createDocumentFragment();o=l.firstChild;)s=a.appendChild(o);i.insertNode(a);if(s){(i=i.cloneRange()).setStartAfter(s);i.collapse(!1);n.removeAllRanges();n.addRange(i)}}}else g("mozilla")&&!e.length?this.selection.remove():t=this.document.execCommand("inserthtml",!1,e);return t},_boldImpl:function(e){var t=!1;if(g("ie")||g("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("bold")}t||(t=this.document.execCommand("bold",!1,e));return t},_italicImpl:function(e){var t=!1;if(g("ie")||g("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("italic")}t||(t=this.document.execCommand("italic",!1,e));return t},_underlineImpl:function(e){var t=!1;if(g("ie")||g("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("underline")}t||(t=this.document.execCommand("underline",!1,e));return t},_strikethroughImpl:function(e){var t=!1;if(g("ie")||g("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("strikethrough")}t||(t=this.document.execCommand("strikethrough",!1,e));return t},_superscriptImpl:function(e){var t=!1;if(g("ie")||g("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("superscript")}t||(t=this.document.execCommand("superscript",!1,e));return t},_subscriptImpl:function(e){var t=!1;if(g("ie")||g("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("subscript")}t||(t=this.document.execCommand("subscript",!1,e));return t},_fontnameImpl:function(e){var t;(g("ie")||g("trident"))&&(t=this._handleTextColorOrProperties("fontname",e));t||(t=this.document.execCommand("fontname",!1,e));return t},_fontsizeImpl:function(e){var t;(g("ie")||g("trident"))&&(t=this._handleTextColorOrProperties("fontsize",e));t||(t=this.document.execCommand("fontsize",!1,e));return t},_insertorderedlistImpl:function(e){var t=!1;(g("ie")||g("trident")||g("edge"))&&(t=this._adaptIEList("insertorderedlist",e));t||(t=this.document.execCommand("insertorderedlist",!1,e));return t},_insertunorderedlistImpl:function(e){var t=!1;(g("ie")||g("trident")||g("edge"))&&(t=this._adaptIEList("insertunorderedlist",e));t||(t=this.document.execCommand("insertunorderedlist",!1,e));return t},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(e){var t=0;if(e&&e.childNodes){var i;for(i=0;i<e.childNodes.length;i++){t+=l.position(e.childNodes[i]).h}}return t},_isNodeEmpty:function(e,t){return 1===e.nodeType?!(e.childNodes.length>0)||this._isNodeEmpty(e.childNodes[0],t):3===e.nodeType&&""===e.nodeValue.substring(t)},_removeStartingRangeFromRange:function(e,t){if(e.nextSibling)t.setStart(e.nextSibling,0);else{for(var i=e.parentNode;i&&null==i.nextSibling;)i=i.parentNode;i&&t.setStart(i.nextSibling,0)}return t},_adaptIESelection:function(){var e=T.getSelection(this.window);if(e&&e.rangeCount&&!e.isCollapsed){for(var t=e.getRangeAt(0),i=t.startContainer,a=t.startOffset;3===i.nodeType&&a>=i.length&&i.nextSibling;){a-=i.length;i=i.nextSibling}for(var n=null;this._isNodeEmpty(i,a)&&i!==n;){n=i;i=(t=this._removeStartingRangeFromRange(i,t)).startContainer;a=0}e.removeAllRanges();e.addRange(t)}},_adaptIEFormatAreaAndExec:function(t){var i,a,n,o,s,l,d,c,u=T.getSelection(this.window),h=this.document;if(!(t&&u&&u.isCollapsed))return!1;if(this.queryCommandValue(t)){var p,_=this._tagNamesForCommand(t),m=(n=u.getRangeAt(0)).startContainer;if(3===m.nodeType){var g=n.endOffset;if(m.length<g){m=(a=this._adjustNodeAndOffset(i,g)).node;g=a.offset}}for(;m&&m!==this.editNode;){var f=m.tagName?m.tagName.toLowerCase():"";if(e.indexOf(_,f)>-1){p=m;break}m=m.parentNode}if(p){i=n.startContainer;var b=h.createElement(p.tagName);r.place(b,p,"after");if(i&&3===i.nodeType){var y,v,w=n.endOffset;if(i.length<w){i=(a=this._adjustNodeAndOffset(i,w)).node;w=a.offset}o=i.nodeValue;s=h.createTextNode(o.substring(0,w));(A=o.substring(w,o.length))&&(l=h.createTextNode(A));r.place(s,i,"before");if(l){(d=h.createElement("span")).className="ieFormatBreakerSpan";r.place(d,i,"after");r.place(l,d,"after");l=d}r.destroy(i);for(var x,k=s.parentNode,C=[];k!==p;){var j=k.tagName;x={tagName:j};C.push(x);var S=h.createElement(j);if(k.style&&S.style&&k.style.cssText){S.style.cssText=k.style.cssText;x.cssText=k.style.cssText}if("FONT"===k.tagName){if(k.color){S.color=k.color;x.color=k.color}if(k.face){S.face=k.face;x.face=k.face}if(k.size){S.size=k.size;x.size=k.size}}if(k.className){S.className=k.className;x.className=k.className}if(l){y=l;for(;y;){v=y.nextSibling;S.appendChild(y);y=v}}if(S.tagName==k.tagName){(d=h.createElement("span")).className="ieFormatBreakerSpan";r.place(d,k,"after");r.place(S,d,"after")}else r.place(S,k,"after");s=k;l=S;k=k.parentNode}if(l){(1===(y=l).nodeType||3===y.nodeType&&y.nodeValue)&&(b.innerHTML="");for(;y;){v=y.nextSibling;b.appendChild(y);y=v}}if(C.length){x=C.pop();var $=h.createElement(x.tagName);x.cssText&&$.style&&($.style.cssText=x.cssText);x.className&&($.className=x.className);if("FONT"===x.tagName){x.color&&($.color=x.color);x.face&&($.face=x.face);x.size&&($.size=x.size)}r.place($,b,"before");for(;C.length;){x=C.pop();var M=h.createElement(x.tagName);x.cssText&&M.style&&(M.style.cssText=x.cssText);x.className&&(M.className=x.className);if("FONT"===x.tagName){x.color&&(M.color=x.color);x.face&&(M.face=x.face);x.size&&(M.size=x.size)}$.appendChild(M);$=M}c=h.createTextNode(".");d.appendChild(c);$.appendChild(c);(E=T.create(this.window)).setStart(c,0);E.setEnd(c,c.length);u.removeAllRanges();u.addRange(E);this.selection.collapse(!1);c.parentNode.innerHTML=""}else{(d=h.createElement("span")).className="ieFormatBreakerSpan";c=h.createTextNode(".");d.appendChild(c);r.place(d,b,"before");(E=T.create(this.window)).setStart(c,0);E.setEnd(c,c.length);u.removeAllRanges();u.addRange(E);this.selection.collapse(!1);c.parentNode.innerHTML=""}b.firstChild||r.destroy(b);return!0}}return!1}if((i=(n=u.getRangeAt(0)).startContainer)&&3===i.nodeType){var A,E;g=n.startOffset;if(i.length<g){i=(a=this._adjustNodeAndOffset(i,g)).node;g=a.offset}o=i.nodeValue;s=h.createTextNode(o.substring(0,g));""!==(A=o.substring(g))&&(l=h.createTextNode(o.substring(g)));d=h.createElement("span");c=h.createTextNode(".");d.appendChild(c);s.length?r.place(s,i,"after"):s=i;r.place(d,s,"after");l&&r.place(l,d,"after");r.destroy(i);(E=T.create(this.window)).setStart(c,0);E.setEnd(c,c.length);u.removeAllRanges();u.addRange(E);h.execCommand(t);r.place(d.firstChild,d,"before");r.destroy(d);E.setStart(c,0);E.setEnd(c,c.length);u.removeAllRanges();u.addRange(E);this.selection.collapse(!1);c.parentNode.innerHTML="";return!0}},_adaptIEList:function(e){var t=T.getSelection(this.window);if(t.isCollapsed&&t.rangeCount&&!this.queryCommandValue(e)){var i=t.getRangeAt(0),a=i.startContainer;if(a&&3==a.nodeType&&!i.startOffset){var n="ul";"insertorderedlist"===e&&(n="ol");var o=this.document.createElement(n),s=r.create("li",null,o);r.place(o,a,"before");s.appendChild(a);r.create("br",null,o,"after");var l=T.create(this.window);l.setStart(a,0);l.setEnd(a,a.length);t.removeAllRanges();t.addRange(l);this.selection.collapse(!0);return!0}}return!1},_handleTextColorOrProperties:function(e,t){var i,a,n,o,s,l,c,u,h=T.getSelection(this.window),p=this.document;t=t||null;if(e&&h&&h.isCollapsed&&h.rangeCount&&(i=(n=h.getRangeAt(0)).startContainer)&&3===i.nodeType){var _=n.startOffset;if(i.length<_){i=(a=this._adjustNodeAndOffset(i,_)).node;_=a.offset}o=i.nodeValue;s=p.createTextNode(o.substring(0,_));""!==o.substring(_)&&(l=p.createTextNode(o.substring(_)));c=p.createElement("span");u=p.createTextNode(".");c.appendChild(u);var m=p.createElement("span");c.appendChild(m);s.length?r.place(s,i,"after"):s=i;r.place(c,s,"after");l&&r.place(l,c,"after");r.destroy(i);var f=T.create(this.window);f.setStart(u,0);f.setEnd(u,u.length);h.removeAllRanges();h.addRange(f);if(g("webkit")){var b="color";"hilitecolor"!==e&&"backcolor"!==e||(b="backgroundColor");d.set(c,b,t);this.selection.remove();r.destroy(m);c.innerHTML="&#160;";this.selection.selectElement(c);this.focus()}else{this.execCommand(e,t);r.place(c.firstChild,c,"before");r.destroy(c);f.setStart(u,0);f.setEnd(u,u.length);h.removeAllRanges();h.addRange(f);this.selection.collapse(!1);u.parentNode.removeChild(u)}return!0}return!1},_adjustNodeAndOffset:function(e,t){for(;e.length<t&&e.nextSibling&&3===e.nextSibling.nodeType;){t-=e.length;e=e.nextSibling}return{node:e,offset:t}},_tagNamesForCommand:function(e){return"bold"===e?["b","strong"]:"italic"===e?["i","em"]:"strikethrough"===e?["s","strike"]:"superscript"===e?["sup"]:"subscript"===e?["sub"]:"underline"===e?["u"]:[]},_stripBreakerNodes:function(e){if(this.isLoaded){_(".ieFormatBreakerSpan",e).forEach(function(e){for(;e.firstChild;)r.place(e.firstChild,e,"before");r.destroy(e)});return e}},_stripTrailingEmptyNodes:function(e){function t(e){return/^(p|div|br)$/i.test(e.nodeName)&&0==e.children.length&&/^[\s\xA0]*$/.test(e.textContent||e.innerText||"")||3===e.nodeType&&/^[\s\xA0]*$/.test(e.nodeValue)}for(;e.lastChild&&t(e.lastChild);)r.destroy(e.lastChild);return e},_setTextDirAttr:function(e){this._set("textDir",e);this.onLoadDeferred.then(h.hitch(this,function(){this.editNode.dir=e}))}});return M})},"dijit/selection":function(){define(["dojo/_base/array","dojo/dom","dojo/_base/lang","dojo/sniff","dojo/_base/window","dijit/focus"],function(e,t,i,a,n,o){var s=function(s){var r=s.document;this.getType=function(){if(r.getSelection){var e,t="text";try{e=s.getSelection()}catch(a){}if(e&&1==e.rangeCount){var i=e.getRangeAt(0);i.startContainer==i.endContainer&&i.endOffset-i.startOffset==1&&3!=i.startContainer.nodeType&&(t="control")}return t}return r.selection.type.toLowerCase()};this.getSelectedText=function(){if(r.getSelection){var e=s.getSelection();return e?e.toString():""}return"control"==this.getType()?null:r.selection.createRange().text};this.getSelectedHtml=function(){if(r.getSelection){var e=s.getSelection();if(e&&e.rangeCount){var t,i="";for(t=0;t<e.rangeCount;t++){var a=e.getRangeAt(t).cloneContents(),n=r.createElement("div");n.appendChild(a);i+=n.innerHTML}return i}return null}return"control"==this.getType()?null:r.selection.createRange().htmlText};this.getSelectedElement=function(){if("control"==this.getType()){if(r.getSelection){var e=s.getSelection();return e.anchorNode.childNodes[e.anchorOffset]}var t=r.selection.createRange();if(t&&t.item)return r.selection.createRange().item(0)}return null};this.getParentElement=function(){if("control"==this.getType()){var e=this.getSelectedElement();if(e)return e.parentNode}else{if(!r.getSelection){var t=r.selection.createRange();t.collapse(!0);return t.parentElement()}var i=r.getSelection();if(i){for(var a=i.anchorNode;a&&1!=a.nodeType;)a=a.parentNode;return a}}return null};this.hasAncestorElement=function(e){return null!=this.getAncestorElement.apply(this,arguments)};this.getAncestorElement=function(e){var t=this.getSelectedElement()||this.getParentElement();return this.getParentOfType(t,arguments)};this.isTag=function(e,t){if(e&&e.tagName)for(var i=e.tagName.toLowerCase(),a=0;a<t.length;a++){var n=String(t[a]).toLowerCase();if(i==n)return n}return""};this.getParentOfType=function(e,t){for(;e;){if(this.isTag(e,t).length)return e;e=e.parentNode}return null};this.collapse=function(e){if(r.getSelection){var t=s.getSelection();t.removeAllRanges?e?t.collapseToStart():t.collapseToEnd():t.collapse(e)}else{var i=r.selection.createRange();i.collapse(e);i.select()}};this.remove=function(){var e=r.selection;if(r.getSelection){(e=s.getSelection()).deleteFromDocument();return e}"none"!=e.type.toLowerCase()&&e.clear();return e};this.selectElementChildren=function(e,i){var n;e=t.byId(e);if(r.getSelection){var o=s.getSelection();if(a("opera")){(n=o.rangeCount?o.getRangeAt(0):r.createRange()).setStart(e,0);n.setEnd(e,3==e.nodeType?e.length:e.childNodes.length);o.addRange(n)}else o.selectAllChildren(e)}else{(n=e.ownerDocument.body.createTextRange()).moveToElementText(e);if(!i)try{n.select()}catch(l){}}};this.selectElement=function(e,i){var o;e=t.byId(e);if(r.getSelection){var s=r.getSelection();o=r.createRange();if(s.removeAllRanges){a("opera")&&s.getRangeAt(0)&&(o=s.getRangeAt(0));o.selectNode(e);s.removeAllRanges();s.addRange(o)}}else try{var l=e.tagName?e.tagName.toLowerCase():"";(o="img"===l||"table"===l?n.body(r).createControlRange():n.body(r).createRange()).addElement(e);i||o.select()}catch(d){this.selectElementChildren(e,i)}};this.inSelection=function(e){if(e){var t,i;if(r.getSelection){var a=s.getSelection();a&&a.rangeCount>0&&(i=a.getRangeAt(0));if(i&&i.compareBoundaryPoints&&r.createRange)try{(t=r.createRange()).setStart(e,0);if(1===i.compareBoundaryPoints(i.START_TO_END,t))return!0}catch(n){}}else{i=r.selection.createRange();try{(t=e.ownerDocument.body.createTextRange()).moveToElementText(e)}catch(o){}if(i&&t&&1===i.compareEndPoints("EndToStart",t))return!0}}return!1};this.getBookmark=function(){var e,t,i,a=r.selection,n=o.curNode;if(r.getSelection){if(a=s.getSelection())if(a.isCollapsed){if((i=n?n.tagName:"")&&("textarea"==(i=i.toLowerCase())||"input"==i&&(!n.type||"text"==n.type.toLowerCase())))return{isCollapsed:(a={start:n.selectionStart,end:n.selectionEnd,node:n,pRange:!0}).end<=a.start,mark:a};e={isCollapsed:!0};a.rangeCount&&(e.mark=a.getRangeAt(0).cloneRange())}else e={isCollapsed:!1,mark:(t=a.getRangeAt(0)).cloneRange()}}else if(a){i=(i=n?n.tagName:"").toLowerCase();if(n&&i&&("button"==i||"textarea"==i||"input"==i))return a.type&&"none"==a.type.toLowerCase()?{isCollapsed:!0,mark:null}:{isCollapsed:!(t=a.createRange()).text||!t.text.length,mark:{range:t,pRange:!0}};e={};try{t=a.createRange();e.isCollapsed=!("Text"==a.type?t.htmlText.length:t.length)}catch(c){e.isCollapsed=!0;return e}if("CONTROL"==a.type.toUpperCase())if(t.length){e.mark=[];for(var l=0,d=t.length;l<d;)e.mark.push(t.item(l++))}else{e.isCollapsed=!0;e.mark=null}else e.mark=t.getBookmark()}return e};this.moveToBookmark=function(t){var a=t.mark;if(a)if(r.getSelection){var n=s.getSelection();if(n&&n.removeAllRanges)if(a.pRange){var o=a.node;o.selectionStart=a.start;o.selectionEnd=a.end}else{n.removeAllRanges();n.addRange(a)}}else if(r.selection&&a){var l;if(a.pRange)l=a.range;else if(i.isArray(a)){l=r.body.createControlRange();e.forEach(a,function(e){l.addElement(e)})}else(l=r.body.createTextRange()).moveToBookmark(a);l.select()}};this.isCollapsed=function(){return this.getBookmark().isCollapsed}},r=new s(window);r.SelectionManager=s;return r})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(e,t,i){var a={getIndex:function(e,t){for(var i,a,n=[],o=[],s=e;e!=t;){var r=0;i=e.parentNode;for(;a=i.childNodes[r++];)if(a===e){--r;break}n.unshift(r);o.unshift(r-i.childNodes.length);e=i}if(n.length>0&&3==s.nodeType){a=s.previousSibling;for(;a&&3==a.nodeType;){n[n.length-1]--;a=a.previousSibling}a=s.nextSibling;for(;a&&3==a.nodeType;){o[o.length-1]++;a=a.nextSibling}}return{o:n,r:o}},getNode:function(t,a){if(!i.isArray(t)||0==t.length)return a;var n=a;e.every(t,function(e){if(!(e>=0&&e<n.childNodes.length)){n=null;return!1}n=n.childNodes[e];return!0});return n},getCommonAncestor:function(e,t,i){i=i||e.ownerDocument.body;for(var a=function(e){for(var t=[];e;){t.unshift(e);if(e===i)break;e=e.parentNode}return t},n=a(e),o=a(t),s=Math.min(n.length,o.length),r=n[0],l=1;l<s&&n[l]===o[l];l++)r=n[l];return r},getAncestor:function(e,t,i){i=i||e.ownerDocument.body;for(;e&&e!==i;){var a=e.nodeName.toUpperCase();if(t.test(a))return e;e=e.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(e,t,i){i=i||e.ownerDocument.body;t=t||a.BlockTagNames;for(var n,o=null;e&&e!==i;){var s=e.nodeName.toUpperCase();!o&&t.test(s)&&(o=e);!n&&/^(?:BODY|TD|TH|CAPTION)$/.test(s)&&(n=e);e=e.parentNode}return{blockNode:o,blockContainer:n||e.ownerDocument.body}},atBeginningOfContainer:function(e,t,i){var a=!1,n=0==i;n||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(0,i))&&(n=!0);if(n){var o=t;a=!0;for(;o&&o!==e;){if(o.previousSibling){a=!1;break}o=o.parentNode}}return a},atEndOfContainer:function(e,t,i){var a=!1,n=i==(t.length||t.childNodes.length);n||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(i))&&(n=!0);if(n){var o=t;a=!0;for(;o&&o!==e;){if(o.nextSibling){a=!1;break}o=o.parentNode}}return a},adjacentNoneTextNode:function(e,t){for(var i=e,a=0-e.length||0,n=t?"nextSibling":"previousSibling";i&&3==i.nodeType;){a+=i.length;i=i[n]}return[i,a]},create:function(e){return(e=e||window).getSelection?e.document.createRange():new o},getSelection:function(e,t){if(e.getSelection)return e.getSelection();var i=new n.selection(e);t||i._getCurrentSelection();return i}};if(!window.getSelection)var n=a.ie={cachedSelection:{},selection:function(e){this._ranges=[];this.addRange=function(e,t){this._ranges.push(e);t||e._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(e){return this._ranges[e]};this._getCurrentSelection=function(){this.removeAllRanges();var t=function(){var t=e.document.selection.createRange(),i=e.document.selection.type.toUpperCase();return new o("CONTROL"==i?n.decomposeControlRange(t):n.decomposeTextRange(t))}();if(t){this.addRange(t,!0);this.isCollapsed=t.collapsed}else this.isCollapsed=!0}},decomposeControlRange:function(e){var t=e.item(0),i=e.item(e.length-1),n=t.parentNode,o=i.parentNode;return[n,a.getIndex(t,n).o[0],o,a.getIndex(i,o).o[0]+1]},getEndPoint:function(t,i){var n=t.duplicate();n.collapse(!i);var o,s,r,l="EndTo"+(i?"End":"Start"),d=n.parentElement();if(d.childNodes.length>0)e.every(d.childNodes,function(e,i){var c;if(3!=e.nodeType){n.moveToElementText(e);if(n.compareEndPoints(l,t)>0){if(!r||3!=r.nodeType){o=d;s=i;return!1}o=r;c=!0}else if(i==d.childNodes.length-1){o=d;s=d.childNodes.length;return!1}}else if(i==d.childNodes.length-1){o=e;c=!0}if(c&&o){var u=a.adjacentNoneTextNode(o)[0];o=u?u.nextSibling:d.firstChild;var h=a.adjacentNoneTextNode(o);u=h[0];var p=h[1];if(u){n.moveToElementText(u);n.collapse(!1)}else n.moveToElementText(d);n.setEndPoint(l,t);s=n.text.length-p;return!1}r=e;return!0});else{o=d;s=0}if(!i&&1==o.nodeType&&s==o.childNodes.length){var c=o.nextSibling;if(c&&3==c.nodeType){o=c;s=0}}return[o,s]},setEndPoint:function(e,t,i){var n,o,s=e.duplicate();if(3!=t.nodeType)if(i>0){if(n=t.childNodes[i-1])if(3==n.nodeType){t=n;i=n.length}else if(n.nextSibling&&3==n.nextSibling.nodeType){t=n.nextSibling;i=0}else{s.moveToElementText(n.nextSibling?n:t);var r=n.parentNode,l=r.insertBefore(n.ownerDocument.createTextNode(" "),n.nextSibling);s.collapse(!1);r.removeChild(l)}}else{s.moveToElementText(t);s.collapse(!0)}if(3==t.nodeType){var d=a.adjacentNoneTextNode(t),c=d[0];o=d[1];if(c){s.moveToElementText(c);s.collapse(!1);"inherit"!=c.contentEditable&&o++}else{s.moveToElementText(t.parentNode);s.collapse(!0);s.move("character",1);s.move("character",-1)}(i+=o)>0&&s.move("character",i)!=i&&console.error("Error when moving!")}return s},decomposeTextRange:function(e){var t=n.getEndPoint(e),i=t[0],a=t[1],o=t[0],s=t[1];e.htmlText.length&&(e.htmlText==e.text?s=a+e.text.length:(o=(t=n.getEndPoint(e,!0))[0],s=t[1]));return[i,a,o,s]},setRange:function(e,t,i,a,o,s){var r=n.setEndPoint(e,t,i);e.setEndPoint("StartToStart",r);if(!s)var l=n.setEndPoint(e,a,o);e.setEndPoint("EndToEnd",l||r);return e}},o=a.W3CRange=t(null,{constructor:function(){if(arguments.length>0){this.setStart(arguments[0][0],arguments[0][1]);this.setEnd(arguments[0][2],arguments[0][3])}else{this.commonAncestorContainer=null;this.startContainer=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}},_updateInternal:function(){this.startContainer!==this.endContainer?this.commonAncestorContainer=a.getCommonAncestor(this.startContainer,this.endContainer):this.commonAncestorContainer=this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(e,t){t=parseInt(t);if(this.startContainer!==e||this.startOffset!=t){delete this._cachedBookmark;this.startContainer=e;this.startOffset=t;this.endContainer?this._updateInternal():this.setEnd(e,t)}},setEnd:function(e,t){t=parseInt(t);if(this.endContainer!==e||this.endOffset!=t){delete this._cachedBookmark;this.endContainer=e;this.endOffset=t;this.startContainer?this._updateInternal():this.setStart(e,t)}},setStartAfter:function(e,t){this._setPoint("setStart",e,t,1)},setStartBefore:function(e,t){this._setPoint("setStart",e,t,0)},setEndAfter:function(e,t){this._setPoint("setEnd",e,t,1)},setEndBefore:function(e,t){this._setPoint("setEnd",e,t,0)},_setPoint:function(e,t,i,n){var o=a.getIndex(t,t.parentNode).o;this[e](t.parentNode,o.pop()+n)},_getIERange:function(){var e=(this._body||this.endContainer.ownerDocument.body).createTextRange();n.setRange(e,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return e},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var e=this.startContainer,t=this._getIERange();3!==e.nodeType||this.startOffset||this.setStartBefore(e);t.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var e=new o([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);e._body=this._body;return e},detach:function(){this._body=null;this.commonAncestorContainer=null;this.startContainer=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});i.setObject("dijit.range",a);return a})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(e,t,i){var a={};t.setObject("dijit._editor.html",a);var n=a.escapeXml=function(e,t){e=e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");t||(e=e.replace(/'/gm,"&#39;"));return e};a.getNodeHtml=function(e){var t=[];a.getNodeHtmlHelper(e,t);return t.join("")};a.getNodeHtmlHelper=function(t,o){switch(t.nodeType){case 1:var s=t.nodeName.toLowerCase();if(!s||"/"==s.charAt(0))return"";o.push("<",s);var r,l=[],d={};if(i("dom-attributes-explicit")||i("dom-attributes-specified-flag"))for(var c=0;r=t.attributes[c++];){var u=r.name;if("_dj"!==u.substr(0,3)&&(!i("dom-attributes-specified-flag")||r.specified)&&!(u in d)){var h=r.value;"src"!=u&&"href"!=u||t.getAttribute("_djrealurl")&&(h=t.getAttribute("_djrealurl"));8===i("ie")&&"style"===u&&(h=h.replace("HEIGHT:","height:").replace("WIDTH:","width:"));l.push([u,h]);d[u]=h}}else{var p=(/^input$|^img$/i.test(t.nodeName)?t:t.cloneNode(!1)).outerHTML,_=p.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);p=p.substr(0,p.indexOf(">"));e.forEach(_,function(e){if(e){var i=e.indexOf("=");if(i>0){var a=e.substring(0,i);if("_dj"!=a.substr(0,3)){if(("src"==a||"href"==a)&&t.getAttribute("_djrealurl")){l.push([a,t.getAttribute("_djrealurl")]);return}var n,o;switch(a){case"style":n=t.style.cssText.toLowerCase();break;case"class":n=t.className;break;case"width":if("img"===s){(o=/width=(\S+)/i.exec(p))&&(n=o[1]);break}case"height":if("img"===s){(o=/height=(\S+)/i.exec(p))&&(n=o[1]);break}default:n=t.getAttribute(a)}null!=n&&l.push([a,n.toString()])}}}},this)}l.sort(function(e,t){return e[0]<t[0]?-1:e[0]==t[0]?0:1});for(var m=0;r=l[m++];)o.push(" ",r[0],'="',"string"==typeof r[1]?n(r[1],!0):r[1],'"');switch(s){case"br":case"hr":case"img":case"input":case"base":case"meta":case"area":case"basefont":o.push(" />");break;case"script":o.push(">",t.innerHTML,"</",s,">");break;default:o.push(">");t.hasChildNodes()&&a.getChildrenHtmlHelper(t,o);o.push("</",s,">")}break;case 4:case 3:o.push(n(t.nodeValue,!0));break;case 8:o.push("\x3c!--",n(t.nodeValue,!0),"--\x3e");break;default:o.push("\x3c!-- Element not recognized - Type: ",t.nodeType," Name: ",t.nodeName,"--\x3e")}};a.getChildrenHtml=function(e){var t=[];a.getChildrenHtmlHelper(e,t);return t.join("")};a.getChildrenHtmlHelper=function(e,t){if(e)for(var n,o=e.childNodes||e,s=!i("ie")||o!==e,r=0;n=o[r++];)s&&n.parentNode!=e||a.getNodeHtmlHelper(n,t)};return a})},"dijit/_editor/plugins/FontChoice":function(){define(["require","dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/i18n","dojo/_base/lang","dojo/string","dojo/store/Memory","../../registry","../../_Widget","../../_TemplatedMixin","../../_WidgetsInTemplateMixin","../../form/FilteringSelect","../_Plugin","../range","dojo/i18n!../nls/FontChoice"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_){var m=i("dijit._editor.plugins._FontDropDown",[d,c,u],{label:"",plainText:!1,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline'><label class='dijitLeft dijitInline' for='${selectId}'>${label}</label><input data-dojo-type='../../form/FilteringSelect' required='false' data-dojo-props='labelType:\"html\", labelAttr:\"label\", searchAttr:\"name\"' class='${comboClass}' tabIndex='-1' id='${selectId}' data-dojo-attach-point='select' value=''/></span>",contextRequire:e,postMixInProperties:function(){this.inherited(arguments);this.strings=n.getLocalization("dijit._editor","FontChoice");this.label=this.strings[this.command];this.id=l.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.selectId=this.id+"_select";this.inherited(arguments)},postCreate:function(){this.select.set("store",new r({idProperty:"value",data:t.map(this.values,function(e){var t=this.strings[e]||e;return{label:this.getLabel(e,t),name:t,value:e}},this)}));this.select.set("value","",!1);this.disabled=this.select.get("disabled")},_setValueAttr:function(e,i){i=!1!==i;this.select.set("value",t.indexOf(this.values,e)<0?"":e,i);i||(this.select._lastValueReported=null)},_getValueAttr:function(){return this.select.get("value")},focus:function(){this.select.focus()},_setDisabledAttr:function(e){this._set("disabled",e);this.select.set("disabled",e)}}),g=i("dijit._editor.plugins._FontNameDropDown",m,{generic:!1,command:"fontName",comboClass:"dijitFontNameCombo",postMixInProperties:function(){this.values||(this.values=this.generic?["serif","sans-serif","monospace","cursive","fantasy"]:["Arial","Times New Roman","Comic Sans MS","Courier New"]);this.inherited(arguments)},getLabel:function(e,t){return this.plainText?t:"<div style='font-family: "+e+"'>"+t+"</div>"},_normalizeFontName:function(e){var i=this.values;if(!e||!i)return e;var a=e.split(",");if(a.length>1)for(var n=0,o=a.length;n<o;n++){var r=s.trim(a[n]);if(t.indexOf(i,r)>-1)return r}return e},_setValueAttr:function(e,t){t=!1!==t;e=this._normalizeFontName(e);if(this.generic){e={Arial:"sans-serif",Helvetica:"sans-serif",Myriad:"sans-serif",Times:"serif","Times New Roman":"serif","Comic Sans MS":"cursive","Apple Chancery":"cursive",Courier:"monospace","Courier New":"monospace",Papyrus:"fantasy","Estrangelo Edessa":"cursive",Gabriola:"fantasy"}[e]||e}this.inherited(arguments,[e,t])}}),f=i("dijit._editor.plugins._FontSizeDropDown",m,{command:"fontSize",comboClass:"dijitFontSizeCombo",values:[1,2,3,4,5,6,7],getLabel:function(e,t){return this.plainText?t:"<font size="+e+"'>"+t+"</font>"},_setValueAttr:function(e,t){t=!1!==t;if(e.indexOf&&-1!=e.indexOf("px")){e={10:1,13:2,16:3,18:4,24:5,32:6,48:7}[parseInt(e,10)]||e}this.inherited(arguments,[e,t])}}),b=i("dijit._editor.plugins._FormatBlockDropDown",m,{command:"formatBlock",comboClass:"dijitFormatBlockCombo",values:["noFormat","p","h1","h2","h3","pre"],postCreate:function(){this.inherited(arguments);this.set("value","noFormat",!1)},getLabel:function(e,t){return this.plainText||"noFormat"==e?t:"<"+e+">"+t+"</"+e+">"},_execCommand:function(e,i,a){if("noFormat"===a){var n,s,r=_.getSelection(e.window);if(r&&r.rangeCount>0){var l,d,c=r.getRangeAt(0);if(c){n=c.startContainer;s=c.endContainer;for(;n&&n!==e.editNode&&n!==e.document.body&&1!==n.nodeType;)n=n.parentNode;for(;s&&s!==e.editNode&&s!==e.document.body&&1!==s.nodeType;)s=s.parentNode;var u=o.hitch(this,function(i,a){if(i.childNodes&&i.childNodes.length){var n;for(n=0;n<i.childNodes.length;n++){var o=i.childNodes[n];if(1==o.nodeType&&e.selection.inSelection(o)){var s=o.tagName?o.tagName.toLowerCase():"";-1!==t.indexOf(this.values,s)&&a.push(o);u(o,a)}}}}),h=o.hitch(this,function(t){if(t&&t.length){e.beginEditing();for(;t.length;)this._removeFormat(e,t.pop());e.endEditing()}}),p=[];if(n==s){var m;l=n;for(;l&&l!==e.editNode&&l!==e.document.body;){if(1==l.nodeType){d=l.tagName?l.tagName.toLowerCase():"";if(-1!==t.indexOf(this.values,d)){m=l;break}}l=l.parentNode}u(n,p);m&&(p=[m].concat(p));h(p)}else{l=n;for(;e.selection.inSelection(l);){if(1==l.nodeType){d=l.tagName?l.tagName.toLowerCase():"";-1!==t.indexOf(this.values,d)&&p.push(l);u(l,p)}l=l.nextSibling}h(p)}e.onDisplayChanged()}}}else e.execCommand(i,a)},_removeFormat:function(e,t){if(e.customUndo){for(;t.firstChild;)a.place(t.firstChild,t,"before");t.parentNode.removeChild(t)}else{e.selection.selectElementChildren(t);var i=e.selection.getSelectedHtml();e.selection.selectElement(t);e.execCommand("inserthtml",i||"")}}}),y=i("dijit._editor.plugins.FontChoice",p,{useDefaultCommand:!1,_initButton:function(){var e={fontName:g,fontSize:f,formatBlock:b}[this.command],t=this.params;this.params.custom&&(t.values=this.params.custom);var i=this.editor;this.button=new e(o.delegate({dir:i.dir,lang:i.lang},t));this.own(this.button.select.on("change",o.hitch(this,function(e){this.editor.focused&&this.editor.focus();"fontName"==this.command&&-1!=e.indexOf(" ")&&(e="'"+e+"'");this.button._execCommand?this.button._execCommand(this.editor,this.command,e):this.editor.execCommand(this.command,e)})))},updateState:function(){var e=this.editor,i=this.command;if(e&&e.isLoaded&&i.length&&this.button){var a,n=this.get("disabled");this.button.set("disabled",n);if(n)return;try{a=e.queryCommandValue(i)||""}catch(u){a=""}var s=o.isString(a)&&(a.match(/'([^']*)'/)||a.match(/"([^"]*)"/));s&&(a=s[1]);"fontSize"!==i||a||(a=3);if("formatBlock"===i)if(a&&"p"!=a)t.indexOf(this.button.values,a)<0&&(a="noFormat");else{a=null;var r,l=_.getSelection(this.editor.window);if(l&&l.rangeCount>0){var d=l.getRangeAt(0);d&&(r=d.endContainer)}for(;r&&r!==e.editNode&&r!==e.document;){var c=r.tagName?r.tagName.toLowerCase():"";if(c&&t.indexOf(this.button.values,c)>-1){a=c;break}r=r.parentNode}a||(a="noFormat")}a!==this.button.get("value")&&this.button.set("value",a,!1)}}});t.forEach(["fontName","fontSize","formatBlock"],function(e){p.registry[e]=function(t){return new y({command:e,plainText:t.plainText})}});y._FontDropDown=m;y._FontNameDropDown=g;y._FontSizeDropDown=f;y._FormatBlockDropDown=b;return y})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(e,t,i,a,n){return i("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var e=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);n.parse(e,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(a.hitch(this,function(e){this._startupWidgets=e;for(var t=0;t<e.length;t++)this._processTemplateNode(e[t],function(e,t){return e[t]},function(e,t,i){return t in e?e.connect(e,t,i):e.on(t,i,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw new Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.")}},_processTemplateNode:function(e,t,i){return!(!t(e,"dojoType")&&!t(e,"data-dojo-type"))||this.inherited(arguments)},startup:function(){e.forEach(this._startupWidgets,function(e){e&&!e._started&&e.startup&&e.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dijit/_editor/plugins/TextColor":function(){define(["require","dojo/colors","dojo/_base/declare","dojo/_base/lang","../_Plugin","../../form/DropDownButton"],function(e,t,i,a,n,o){var s=i("dijit._editor.plugins.TextColor",n,{buttonClass:o,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;this.inherited(arguments);var t=this;this.button.loadDropDown=function(i){function a(e){t.button.dropDown=new e({dir:t.editor.dir,ownerDocument:t.editor.ownerDocument,value:t.value,onChange:function(e){t.editor.execCommand(t.command,e)},onExecute:function(){t.editor.execCommand(t.command,this.get("value"))}});i()}"string"==typeof t.colorPicker?e([t.colorPicker],a):a(t.colorPicker)}},updateState:function(){var e=this.editor,i=this.command;if(e&&e.isLoaded&&i.length){if(this.button){var a,n=this.get("disabled");this.button.set("disabled",n);if(n)return;try{a=e.queryCommandValue(i)||""}catch(s){a=""}}""==a&&(a="#000000");"transparent"==a&&(a="#ffffff");if("string"==typeof a)a.indexOf("rgb")>-1&&(a=t.fromRgb(a).toHex());else{a=(a=(255&a)<<16|65280&a|(16711680&a)>>>16).toString(16);a="#000000".slice(0,7-a.length)+a}this.value=a;var o=this.button.dropDown;o&&o.get&&a!==o.get("value")&&o.set("value",a,!1)}}});n.registry.foreColor=function(e){return new s(e)};n.registry.hiliteColor=function(e){return new s(e)};return s})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(e,t,i,a){var n={};t.setObject("dojo.colors",n);var o=function(e,t,i){i<0&&++i;i>1&&--i;var a=6*i;return a<1?e+(t-e)*a:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e};e.colorFromRgb=i.fromRgb=function(e,t){var n=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(n){var s,r=n[2].split(/\s*,\s*/),l=r.length,d=n[1];if("rgb"==d&&3==l||"rgba"==d&&4==l){var c=r[0];if("%"==c.charAt(c.length-1)){s=a.map(r,function(e){return 2.56*parseFloat(e)});4==l&&(s[3]=r[3]);return i.fromArray(s,t)}return i.fromArray(r,t)}if("hsl"==d&&3==l||"hsla"==d&&4==l){var u=(parseFloat(r[0])%360+360)%360/360,h=parseFloat(r[1])/100,p=parseFloat(r[2])/100,_=p<=.5?p*(h+1):p+h-p*h,m=2*p-_;s=[256*o(m,_,u+1/3),256*o(m,_,u),256*o(m,_,u-1/3),1];4==l&&(s[3]=r[3]);return i.fromArray(s,t)}}return null};var s=function(e,t,i){e=Number(e);return isNaN(e)?i:e<t?t:e>i?i:e};i.prototype.sanitize=function(){var e=this;e.r=Math.round(s(e.r,0,255));e.g=Math.round(s(e.g,0,255));e.b=Math.round(s(e.b,0,255));e.a=s(e.a,0,1);return this};n.makeGrey=i.makeGrey=function(e,t){return i.fromArray([e,e,e,t])};t.mixin(i.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return i})},"dijit/form/DropDownButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/query","../registry","../popup","./Button","../_Container","../_HasDropDown","dojo/text!./templates/DropDownButton.html","../a11yclick"],function(e,t,i,a,n,o,s,r,l,d){return e("dijit.form.DropDownButton",[s,r,l],{baseClass:"dijitDropDownButton",templateString:d,_fillContent:function(){var e=this.srcNodeRef,i=this.containerNode;if(e&&i)for(;e.hasChildNodes();){var a=e.firstChild;if(a.hasAttribute&&(a.hasAttribute("data-dojo-type")||a.hasAttribute("dojoType")||a.hasAttribute("data-"+t._scopeName+"-type")||a.hasAttribute(t._scopeName+"Type"))){this.dropDownContainer=this.ownerDocument.createElement("div");this.dropDownContainer.appendChild(a)}else i.appendChild(a)}},startup:function(){if(!this._started){if(!this.dropDown&&this.dropDownContainer){this.dropDown=n.byNode(this.dropDownContainer.firstChild);delete this.dropDownContainer}this.dropDown&&o.hide(this.dropDown);this.inherited(arguments)}},isLoaded:function(){var e=this.dropDown;return!!e&&(!e.href||e.isLoaded)},loadDropDown:function(e){var t=this.dropDown,a=t.on("load",i.hitch(this,function(){a.remove();e()}));t.refresh()},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}})})},"dijit/_editor/plugins/LinkDialog":function(){define(["require","dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","dojo/query","dojo/string","../_Plugin","../../form/DropDownButton","../range"],function(e,t,i,a,n,o,s,r,l,d,c,u){var h=t("dijit._editor.plugins.LinkDialog",d,{buttonClass:c,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",emailRegExp:"<?(mailto\\:)([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*>?",htmlTemplate:'<a href="${urlInput}" _djrealurl="${urlInput}" target="${targetSelect}">${textInput}</a>',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,linkDialogTemplate:["<table role='presentation'><tr><td>","<label for='${id}_urlInput'>${url}</label>","</td><td>","<input data-dojo-type='dijit.form.ValidationTextBox' required='true' id='${id}_urlInput' name='urlInput' data-dojo-props='intermediateChanges:true'/>","</td></tr><tr><td>","<label for='${id}_textInput'>${text}</label>","</td><td>","<input data-dojo-type='dijit.form.ValidationTextBox' required='true' id='${id}_textInput' name='textInput' data-dojo-props='intermediateChanges:true'/>","</td></tr><tr><td>","<label for='${id}_targetSelect'>${target}</label>","</td><td>","<select id='${id}_targetSelect' name='targetSelect' data-dojo-type='dijit.form.Select'>","<option selected='selected' value='_self'>${currentWindow}</option>","<option value='_blank'>${newWindow}</option>","<option value='_top'>${topWindow}</option>","<option value='_parent'>${parentWindow}</option>","</select>","</td></tr><tr><td colspan='2'>","<button data-dojo-type='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>","<button data-dojo-type='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button>","</td></tr></table>"].join(""),_initButton:function(){this.inherited(arguments);this.button.loadDropDown=n.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(t){e(["dojo/i18n","../../TooltipDialog","../../registry","../../form/Button","../../form/Select","../../form/ValidationTextBox","dojo/i18n!../../nls/common","dojo/i18n!../nls/LinkDialog"],n.hitch(this,function(e,i,s){var r=this;this.tag="insertImage"==this.command?"img":"a";var d=n.delegate(e.getLocalization("dijit","common",this.lang),e.getLocalization("dijit._editor","LinkDialog",this.lang)),c=this.dropDown=this.button.dropDown=new i({title:d[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:n.hitch(this,"setValue"),onOpen:function(){r._onOpenDialog();i.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(n.hitch(r,"_onCloseDialog"),0)}});d.urlRegExp=this.urlRegExp;d.id=s.getUniqueId(this.editor.id);this._uniqueId=d.id;this._setContent(c.title+"<div style='border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'></div>"+l.substitute(this.linkDialogTemplate,d));c.startup();this._urlInput=s.byId(this._uniqueId+"_urlInput");this._textInput=s.byId(this._uniqueId+"_textInput");this._setButton=s.byId(this._uniqueId+"_setButton");this.own(s.byId(this._uniqueId+"_cancelButton").on("click",n.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",n.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",n.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=n.hitch(this,function(){var e=this._urlInput.get("value");return this._urlRegExp.test(e)||this._emailRegExp.test(e)});this.own(o(c.domNode,"keydown",n.hitch(this,n.hitch(this,function(e){if(e&&e.keyCode==a.ENTER&&!e.shiftKey&&!e.metaKey&&!e.ctrlKey&&!e.altKey&&!this._setButton.get("disabled")){c.onExecute();c.execute(c.get("value"))}}))));t()}))},_checkAndFixInput:function(){var e=this,t=this._urlInput.get("value");if(this._delayedCheck){clearTimeout(this._delayedCheck);this._delayedCheck=null}this._delayedCheck=setTimeout(function(){!function(t){var i=!1,a=!1;t&&t.length>1&&0!==(t=n.trim(t)).indexOf("mailto:")&&(t.indexOf("/")>0?-1===t.indexOf("://")&&"/"!==t.charAt(0)&&t.indexOf("./")&&0!==t.indexOf("../")&&e._hostRxp.test(t)&&(i=!0):e._userAtRxp.test(t)&&(a=!0));i&&e._urlInput.set("value","http://"+t);a&&e._urlInput.set("value","mailto:"+t);e._setButton.set("disabled",!e._isValid())}(t)},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(n.hitch(this,function(){this.own(o(this.editor.editNode,"mouseup",n.hitch(this,"_onMouseUp")));this.own(o(this.editor.editNode,"dblclick",n.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(e){this.dropDown.set({parserScope:"dojo",content:e})},_checkValues:function(e){e&&e.urlInput&&(e.urlInput=e.urlInput.replace(/"/g,"&quot;"));return e},_createlinkEnabledImpl:function(){return!0},setValue:function(e){this._onCloseDialog();if(s("ie")<9){var t=u.getSelection(this.editor.window).getRangeAt(0).endContainer;3===t.nodeType&&(t=t.parentNode);t&&t.nodeName&&t.nodeName.toLowerCase()!==this.tag&&(t=this.editor.selection.getSelectedElement(this.tag));if(t&&t.nodeName&&t.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")){this.editor.selection.selectElementChildren(t);this.editor.execCommand("unlink")}}e=this._checkValues(e);this.editor.execCommand("inserthtml",l.substitute(this.htmlTemplate,e));r("a",this.editor.document).forEach(function(e){e.innerHTML||i.has(e,"name")||e.parentNode.removeChild(e)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(e){var t,i,a;if(e&&e.tagName.toLowerCase()===this.tag){t=e.getAttribute("_djrealurl")||e.getAttribute("href");a=e.getAttribute("target")||"_self";i=e.textContent||e.innerText;this.editor.selection.selectElement(e,!0)}else i=this.editor.selection.getSelectedText();return{urlInput:t||"",textInput:i||"",targetSelect:a||""}},_onOpenDialog:function(){var e,t,i;if(s("ie")){var a=u.getSelection(this.editor.window);if(a.rangeCount){var n=a.getRangeAt(0);3===(e=n.endContainer).nodeType&&(e=e.parentNode);e&&e.nodeName&&e.nodeName.toLowerCase()!==this.tag&&(e=this.editor.selection.getSelectedElement(this.tag));if(!e||e.nodeName&&e.nodeName.toLowerCase()!==this.tag)if((t=this.editor.selection.getAncestorElement(this.tag))&&t.nodeName&&t.nodeName.toLowerCase()==this.tag){e=t;this.editor.selection.selectElement(e)}else if(n.startContainer===n.endContainer&&(i=n.startContainer.firstChild)&&i.nodeName&&i.nodeName.toLowerCase()==this.tag){e=i;this.editor.selection.selectElement(e)}}}else e=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(e))},_onDblClick:function(e){if(e&&e.target){var t=e.target;if((t.tagName?t.tagName.toLowerCase():"")===this.tag&&i.get(t,"href")){var a=this.editor;this.editor.selection.selectElement(t);a.onDisplayChanged();if(a._updateTimer){a._updateTimer.remove();delete a._updateTimer}a.onNormalizedDisplayChanged();var n=this.button;setTimeout(function(){n.set("disabled",!1);n.loadAndOpenDropDown().then(function(){n.dropDown.focus&&n.dropDown.focus()})},10)}}},_onMouseUp:function(){if(s("ff")){var e=this.editor.selection.getAncestorElement(this.tag);if(e){var t=u.getSelection(this.editor.window).getRangeAt(0);if(t.collapsed&&e.childNodes.length){var i=t.cloneRange();i.selectNodeContents(e.childNodes[e.childNodes.length-1]);i.setStart(e.childNodes[0],0);1!==t.compareBoundaryPoints(i.START_TO_START,i)?t.setStartBefore(e):-1!==t.compareBoundaryPoints(i.END_TO_START,i)&&t.setStartAfter(e)}}}}}),p=t("dijit._editor.plugins.ImgLinkDialog",[h],{linkDialogTemplate:["<table role='presentation'><tr><td>","<label for='${id}_urlInput'>${url}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' regExp='${urlRegExp}' required='true' id='${id}_urlInput' name='urlInput' data-dojo-props='intermediateChanges:true'/>","</td></tr><tr><td>","<label for='${id}_textInput'>${text}</label>","</td><td>","<input data-dojo-type='dijit.form.ValidationTextBox' required='false' id='${id}_textInput' name='textInput' data-dojo-props='intermediateChanges:true'/>","</td></tr><tr><td>","</td><td>","</td></tr><tr><td colspan='2'>","<button data-dojo-type='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>","<button data-dojo-type='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button>","</td></tr></table>"].join(""),htmlTemplate:'<img src="${urlInput}" _djrealurl="${urlInput}" alt="${textInput}" />',tag:"img",_getCurrentValues:function(e){var t,i;if(e&&e.tagName.toLowerCase()===this.tag){t=e.getAttribute("_djrealurl")||e.getAttribute("src");i=e.getAttribute("alt");this.editor.selection.selectElement(e,!0)}else i=this.editor.selection.getSelectedText();return{urlInput:t||"",textInput:i||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);this.editor.onLoadDeferred.then(n.hitch(this,function(){this.own(o(this.editor.editNode,"mousedown",n.hitch(this,"_selectTag")))}))},_selectTag:function(e){if(e&&e.target){var t=e.target;(t.tagName?t.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(t)}},_checkValues:function(e){e&&e.urlInput&&(e.urlInput=e.urlInput.replace(/"/g,"&quot;"));e&&e.textInput&&(e.textInput=e.textInput.replace(/"/g,"&quot;"));return e},_onDblClick:function(e){if(e&&e.target){var t=e.target;if((t.tagName?t.tagName.toLowerCase():"")===this.tag&&i.get(t,"src")){var a=this.editor;this.editor.selection.selectElement(t);a.onDisplayChanged();if(a._updateTimer){a._updateTimer.remove();delete a._updateTimer}a.onNormalizedDisplayChanged();var n=this.button;setTimeout(function(){n.set("disabled",!1);n.loadAndOpenDropDown().then(function(){n.dropDown.focus&&n.dropDown.focus()})},10)}}}});d.registry.createLink=function(){return new h({command:"createLink"})};d.registry.insertImage=function(){return new p({command:"insertImage"})};h.ImgLinkDialog=p;return h})},"dijit/_editor/plugins/ViewSource":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/i18n","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","dojo/window","../../focus","../_Plugin","../../form/ToggleButton","../..","../../registry","dojo/i18n!../nls/commands"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g,f){var b=i("dijit._editor.plugins.ViewSource",_,{stripScripts:!0,stripComments:!0,stripIFrames:!0,stripEventHandlers:!0,readOnly:!1,_fsPlugin:null,toggle:function(){u("webkit")&&(this._vsFocused=!0);this.button.set("checked",!this.button.get("checked"))},_initButton:function(){var e=r.getLocalization("dijit._editor","commands"),t=this.editor;this.button=new m({label:e.viewSource,ownerDocument:t.ownerDocument,dir:t.dir,lang:t.lang,showLabel:!1,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"ViewSource",tabIndex:"-1",onChange:d.hitch(this,"_showSource")});this.button.set("readOnly",!1)},setEditor:function(e){this.editor=e;this._initButton();this.editor.addKeyHandler(l.F12,!0,!0,d.hitch(this,function(e){this.button.focus();this.toggle();e.stopPropagation();e.preventDefault();setTimeout(d.hitch(this,function(){this.editor.focused&&this.editor.focus()}),100)}))},_showSource:function(i){var a,n=this.editor,o=n._plugins;this._sourceShown=i;var r=this;try{this.sourceArea||this._createSourceView();if(i){n._sourceQueryCommandEnabled=n.queryCommandEnabled;n.queryCommandEnabled=function(e){return"viewsource"===e.toLowerCase()};this.editor.onDisplayChanged();a=n.get("value");a=this._filter(a);n.set("value",a);e.forEach(o,function(e){!e||e instanceof b||!e.isInstanceOf(_)||e.set("disabled",!0)});this._fsPlugin&&(this._fsPlugin._getAltViewNode=function(){return r.sourceArea});this.sourceArea.value=a;this.sourceArea.style.height=n.iframe.style.height;this.sourceArea.style.width=n.iframe.style.width;n.iframe.parentNode.style.position="relative";s.set(n.iframe,{position:"absolute",top:0,visibility:"hidden"});s.set(this.sourceArea,{display:"block"});this._resizeHandle=c(window,"resize",d.hitch(this,function(){var e=h.getBox(n.ownerDocument);if("_prevW"in this&&"_prevH"in this){if(e.w===this._prevW&&e.h===this._prevH)return;this._prevW=e.w;this._prevH=e.h}else{this._prevW=e.w;this._prevH=e.h}if(this._resizer){clearTimeout(this._resizer);delete this._resizer}this._resizer=setTimeout(d.hitch(this,function(){delete this._resizer;this._resize()}),10)}));setTimeout(d.hitch(this,this._resize),100);this.editor.onNormalizedDisplayChanged();this.editor.__oldGetValue=this.editor.getValue;this.editor.getValue=d.hitch(this,function(){var e=this.sourceArea.value;return e=this._filter(e)});this._setListener=t.after(this.editor,"setValue",d.hitch(this,function(e){e=e||"";e=this._filter(e);this.sourceArea.value=e}),!0)}else{if(!n._sourceQueryCommandEnabled)return;this._setListener.remove();delete this._setListener;this._resizeHandle.remove();delete this._resizeHandle;if(this.editor.__oldGetValue){this.editor.getValue=this.editor.__oldGetValue;delete this.editor.__oldGetValue}n.queryCommandEnabled=n._sourceQueryCommandEnabled;if(!this._readOnly){a=this.sourceArea.value;a=this._filter(a);n.beginEditing();n.set("value",a);n.endEditing()}e.forEach(o,function(e){e&&e.isInstanceOf(_)&&e.set("disabled",!1)});s.set(this.sourceArea,"display","none");s.set(n.iframe,{position:"relative",visibility:"visible"});delete n._sourceQueryCommandEnabled;this.editor.onDisplayChanged()}setTimeout(d.hitch(this,function(){var e=n.domNode.parentNode;if(e){var t=f.getEnclosingWidget(e);t&&t.resize&&t.resize()}n.resize()}),300)}catch(l){}},updateState:function(){this.button.set("disabled",this.get("disabled"))},_resize:function(){var e=this.editor,t=e.getHeaderHeight(),i=e.getFooterHeight(),a=o.position(e.domNode),n=o.getPadBorderExtents(e.iframe.parentNode),s=o.getMarginExtents(e.iframe.parentNode),r=o.getPadBorderExtents(e.domNode),l={w:a.w-r.w,h:a.h-(t+r.h+i)};if(this._fsPlugin&&this._fsPlugin.isFullscreen){var d=h.getBox(e.ownerDocument);l.w=d.w-r.w;l.h=d.h-(t+r.h+i)}o.setMarginBox(this.sourceArea,{w:Math.round(l.w-(n.w+s.w)),h:Math.round(l.h-(n.h+s.h))})},_createSourceView:function(){var e=this.editor,t=e._plugins;this.sourceArea=n.create("textarea");if(this.readOnly){a.set(this.sourceArea,"readOnly",!0);this._readOnly=!0}s.set(this.sourceArea,{padding:"0px",margin:"0px",borderWidth:"0px",borderStyle:"none"});a.set(this.sourceArea,"aria-label",this.editor.id);n.place(this.sourceArea,e.iframe,"before");u("ie")&&e.iframe.parentNode.lastChild!==e.iframe&&s.set(e.iframe.parentNode.lastChild,{width:"0px",height:"0px",padding:"0px",margin:"0px",borderWidth:"0px",borderStyle:"none"});e._viewsource_oldFocus=e.focus;var i,o,r=this;e.focus=function(){if(r._sourceShown)r.setSourceAreaCaret();else try{if(this._vsFocused){delete this._vsFocused;p.focus(e.editNode)}else e._viewsource_oldFocus()}catch(t){}};for(i=0;i<t.length;i++)if((o=t[i])&&("dijit._editor.plugins.FullScreen"===o.declaredClass||o.declaredClass===g._scopeName+"._editor.plugins.FullScreen")){this._fsPlugin=o;break}if(this._fsPlugin){this._fsPlugin._viewsource_getAltViewNode=this._fsPlugin._getAltViewNode;this._fsPlugin._getAltViewNode=function(){return r._sourceShown?r.sourceArea:this._viewsource_getAltViewNode()}}this.own(c(this.sourceArea,"keydown",d.hitch(this,function(t){if(this._sourceShown&&t.keyCode==l.F12&&t.ctrlKey&&t.shiftKey){this.button.focus();this.button.set("checked",!1);setTimeout(d.hitch(this,function(){e.focus()}),100);t.stopPropagation();t.preventDefault()}})))},_stripScripts:function(e){e&&(e=(e=(e=e.replace(/<\s*script[^>]*>((.|\s)*?)<\\?\/\s*script\s*>/gi,"")).replace(/<\s*script\b([^<>]|\s)*>?/gi,"")).replace(/<[^>]*=(\s|)*[("|')]javascript:[^$1][(\s|.)]*[$1][^>]*>/gi,""));return e},_stripComments:function(e){e&&(e=e.replace(/<!--(.|\s){1,}?-->/g,""));return e},_stripIFrames:function(e){e&&(e=e.replace(/<\s*iframe[^>]*>((.|\s)*?)<\\?\/\s*iframe\s*>/gi,""));return e},_stripEventHandlers:function(e){if(e){var t=e.match(/<[a-z]+?\b(.*?on.*?(['"]).*?\2.*?)+>/gim);if(t)for(var i=0,a=t.length;i<a;i++){var n=t[i],o=n.replace(/\s+on[a-z]*\s*=\s*(['"])(.*?)\1/gim,"");e=e.replace(n,o)}}return e},_filter:function(e){if(e){this.stripScripts&&(e=this._stripScripts(e));this.stripComments&&(e=this._stripComments(e));this.stripIFrames&&(e=this._stripIFrames(e));this.stripEventHandlers&&(e=this._stripEventHandlers(e))}return e},setSourceAreaCaret:function(){var e=this.sourceArea;p.focus(e);if(this._sourceShown&&!this.readOnly)if(e.setSelectionRange)e.setSelectionRange(0,0);else if(this.sourceArea.createTextRange){var t=e.createTextRange();t.collapse(!0);t.moveStart("character",-99999);t.moveStart("character",0);t.moveEnd("character",0);t.select()}},destroy:function(){if(this._resizer){clearTimeout(this._resizer);delete this._resizer}if(this._resizeHandle){this._resizeHandle.remove();delete this._resizeHandle}if(this._setListener){this._setListener.remove();delete this._setListener}this.inherited(arguments)}});_.registry.viewSource=_.registry.viewsource=function(e){return new b({readOnly:"readOnly"in e&&e.readOnly,stripComments:!("stripComments"in e)||e.stripComments,stripScripts:!("stripScripts"in e)||e.stripScripts,stripIFrames:!("stripIFrames"in e)||e.stripIFrames,stripEventHandlers:!("stripEventHandlers"in e)||e.stripEventHandlers})};return b})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(e,t,i,a,n){var o=i("dojox.gfx.path.Path",n.Shape,{constructor:function(i){this.shape=t.clone(e.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=i;this.segmented=!1},setAbsoluteMode:function(e){this._confirmSegmented();this.absolute="string"==typeof e?"absolute"==e:e;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var e=this.bbox,t=this._getRealMatrix();this.bbox=null;for(var i=0,a=this.segments.length;i<a;++i)this._updateWithSegment(this.segments[i],t);var n=this.bbox;this.bbox=e;this.tbbox=n?[{x:n.l,y:n.t},{x:n.r,y:n.t},{x:n.r,y:n.b},{x:n.l,y:n.b}]:null;return this.tbbox},getLastPosition:function(){this._confirmSegmented();return"x"in this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(e,t,i){if(i){var n=a.multiplyPoint(i,e,t);e=n.x;t=n.y}if(this.bbox&&"l"in this.bbox){this.bbox.l>e&&(this.bbox.l=e);this.bbox.r<e&&(this.bbox.r=e);this.bbox.t>t&&(this.bbox.t=t);this.bbox.b<t&&(this.bbox.b=t)}else this.bbox={l:e,b:t,r:e,t:t}},_updateWithSegment:function(t,i){var a,n=t.args,o=n.length;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(a=0;a<o;a+=2)this._updateBBox(n[a],n[a+1],i);this.last.x=n[o-2];this.last.y=n[o-1];this.absolute=!0;break;case"H":for(a=0;a<o;++a)this._updateBBox(n[a],this.last.y,i);this.last.x=n[o-1];this.absolute=!0;break;case"V":for(a=0;a<o;++a)this._updateBBox(this.last.x,n[a],i);this.last.y=n[o-1];this.absolute=!0;break;case"m":var s=0;if(!("x"in this.last)){this._updateBBox(this.last.x=n[0],this.last.y=n[1],i);s=2}for(a=s;a<o;a+=2)this._updateBBox(this.last.x+=n[a],this.last.y+=n[a+1],i);this.absolute=!1;break;case"l":case"t":for(a=0;a<o;a+=2)this._updateBBox(this.last.x+=n[a],this.last.y+=n[a+1],i);this.absolute=!1;break;case"h":for(a=0;a<o;++a)this._updateBBox(this.last.x+=n[a],this.last.y,i);this.absolute=!1;break;case"v":for(a=0;a<o;++a)this._updateBBox(this.last.x,this.last.y+=n[a],i);this.absolute=!1;break;case"c":for(a=0;a<o;a+=6){this._updateBBox(this.last.x+n[a],this.last.y+n[a+1],i);this._updateBBox(this.last.x+n[a+2],this.last.y+n[a+3],i);this._updateBBox(this.last.x+=n[a+4],this.last.y+=n[a+5],i)}this.absolute=!1;break;case"s":case"q":for(a=0;a<o;a+=4){this._updateBBox(this.last.x+n[a],this.last.y+n[a+1],i);this._updateBBox(this.last.x+=n[a+2],this.last.y+=n[a+3],i)}this.absolute=!1;break;case"A":for(a=0;a<o;a+=7)this._updateBBox(n[a+5],n[a+6],i);this.last.x=n[o-2];this.last.y=n[o-1];this.absolute=!0;break;case"a":for(a=0;a<o;a+=7)this._updateBBox(this.last.x+=n[a+5],this.last.y+=n[a+6],i);this.absolute=!1}var r=[t.action];for(a=0;a<o;++a)r.push(e.formatNumber(n[a],!0));if("string"==typeof this.shape.path)this.shape.path+=r.join("");else for(a=0,o=r.length;a<o;++a)this.shape.path.push(r[a])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(e,t){this.tbbox=null;var i,a=this._validSegments[e.toLowerCase()];if("number"==typeof a)if(a){if(t.length>=a){i={action:e,args:t.slice(0,t.length-t.length%a)};this.segments.push(i);this._updateWithSegment(i)}}else{i={action:e,args:[]};this.segments.push(i);this._updateWithSegment(i)}},_collectArgs:function(e,t){for(var i=0;i<t.length;++i){var a=t[i];"boolean"==typeof a?e.push(a?1:0):"number"==typeof a?e.push(a):a instanceof Array?this._collectArgs(e,a):"x"in a&&"y"in a&&e.push(a.x,a.y)}},moveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"M":"m",e);return this},lineTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"L":"l",e);return this},hLineTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"H":"h",e);return this},vLineTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"V":"v",e);return this},curveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"C":"c",e);return this},smoothCurveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"S":"s",e);return this},qCurveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"Q":"q",e);return this},qSmoothCurveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"T":"t",e);return this},arcTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"A":"a",e);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var e=this.shape.path;this.shape.path=[];this._setPath(e);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(i){var a=t.isArray(i)?i:i.match(e.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(a){for(var n="",o=[],s=a.length,r=0;r<s;++r){var l=a[r],d=parseFloat(l);if(isNaN(d)){n&&this._pushSegment(n,o);o=[];n=l}else o.push(d)}this._pushSegment(n,o)}},setShape:function(t){this.inherited(arguments,["string"==typeof t?{path:t}:t]);this.segmented=!1;this.segments=[];e.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI}),s=i("dojox.gfx.path.TextPath",o,{constructor:function(i){"text"in this||(this.text=t.clone(e.defaultTextPath));"fontStyle"in this||(this.fontStyle=t.clone(e.defaultFont))},getText:function(){return this.text},setText:function(t){this.text=e.makeParameters(this.text,"string"==typeof t?{text:t}:t);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(t){this.fontStyle="string"==typeof t?e.splitFontString(t):e.makeParameters(e.defaultFont,t);this._setFont();return this}});return e.path={Path:o,TextPath:s}})},"dojox/gfx/_base":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/Color","dojo/_base/sniff","dojo/_base/window","dojo/_base/array","dojo/dom","dojo/dom-construct","dojo/dom-geometry"],function(e,t,i,a,n,o,s,r,l){var d=t.getObject("dojox.gfx",!0),c=d._base={};d._hasClass=function(e,t){var i=e.getAttribute("className");return i&&(" "+i+" ").indexOf(" "+t+" ")>=0};d._addClass=function(e,t){var i=e.getAttribute("className")||"";(!i||(" "+i+" ").indexOf(" "+t+" ")<0)&&e.setAttribute("className",i+(i?" ":"")+t)};d._removeClass=function(e,t){var i=e.getAttribute("className");i&&e.setAttribute("className",i.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)"),"$1$2"))};c._getFontMeasurements=function(){var e,t,i={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};a("ie")&&((t=n.doc.documentElement.style.fontSize||"")||(n.doc.documentElement.style.fontSize="100%"));var o=r.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},n.body());for(e in i){o.style.fontSize=e;i[e]=16*Math.round(12*o.offsetHeight/16)/12/1e3}a("ie")&&(n.doc.documentElement.style.fontSize=t);n.body().removeChild(o);return i};var u=null;c._getCachedFontMeasurements=function(e){!e&&u||(u=c._getFontMeasurements());return u};var h=null,p={};c._getTextBox=function(e,t,i){var a,o,s,d,c=arguments.length;h||(h=r.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},n.body()));(a=h).className="";(o=a.style).borderWidth="0";o.margin="0";o.padding="0";o.outline="0";if(c>1&&t)for(s in t)s in p||(o[s]=t[s]);c>2&&i&&(a.className=i);a.innerHTML=e;if(a.getBoundingClientRect){var u=a.getBoundingClientRect();d={l:u.left,t:u.top,w:u.width||u.right-u.left,h:u.height||u.bottom-u.top}}else d=l.getMarginBox(a);a.innerHTML="";return d};c._computeTextLocation=function(e,t,i,a){var n={};switch(e.align){case"end":n.x=e.x-t;break;case"middle":n.x=e.x-t/2;break;default:n.x=e.x}var o=a?.75:1;n.y=e.y-i*o;return n};c._computeTextBoundingBox=function(e){if(!d._base._isRendered(e))return{x:0,y:0,width:0,height:0};var t,i=e.getShape(),a=e.getFont()||d.defaultFont,n=e.getTextWidth(),o=d.normalizedLength(a.size);return{x:(t=c._computeTextLocation(i,n,o,!0)).x,y:t.y,width:n,height:o}};c._isRendered=function(e){for(var t=e.parent;t&&t.getParent;)t=t.parent;return null!==t};var _=0;c._getUniqueId=function(){var t;do{t=e._scopeName+"xUnique"+ ++_}while(s.byId(t));return t};var m,g=a("pointer-events")?"touchAction":a("MSPointer")?"msTouchAction":null;c._fixMsTouchAction=g?function(e){e.rawNode.style[g]="none"}:function(){};t.mixin(d,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultStroke:{type:"stroke",color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:(m={},function(e){var t=m[e];if(t)return new t;(t=m[e]=new Function).prototype=d["default"+e];return new t}),normalizeColor:function(e){return e instanceof i?e:new i(e)},normalizeParameters:function(e,t){var i;if(t){var a={};for(i in e)i in t&&!(i in a)&&(e[i]=t[i])}return e},makeParameters:function(e,i){var a=null;if(!i)return t.delegate(e);var n={};for(a in e)a in n||(n[a]=t.clone(a in i?i[a]:e[a]));return n},formatNumber:function(e,t){var i=e.toString();if(i.indexOf("e")>=0)i=e.toFixed(4);else{var a=i.indexOf(".");a>=0&&i.length-a>5&&(i=e.toFixed(4))}return e<0?i:t?" "+i:i},makeFontString:function(e){return e.style+" "+e.variant+" "+e.weight+" "+e.size+" "+e.family},splitFontString:function(e){var t=d.getDefault("Font"),i=e.split(/\s+/);do{if(i.length<5)break;t.style=i[0];t.variant=i[1];t.weight=i[2];var a=i[3].indexOf("/");t.size=a<0?i[3]:i[3].substring(0,a);var n=4;a<0&&("/"==i[4]?n=6:"/"==i[4].charAt(0)&&(n=5));n<i.length&&(t.family=i.slice(n).join(" "))}while(0);return t},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return d._base._getCachedFontMeasurements()["12pt"]/12},pt2px:function(e){return e*d.px_in_pt()},px2pt:function(e){return e/d.px_in_pt()},normalizedLength:function(e){if(0===e.length)return 0;if(e.length>2){var t=d.px_in_pt(),i=parseFloat(e);switch(e.slice(-2)){case"px":return i;case"pt":return i*t;case"in":return 72*i*t;case"pc":return 12*i*t;case"mm":return i*d.mm_in_pt*t;case"cm":return i*d.cm_in_pt*t}}return parseFloat(e)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,equalSources:function(e,t){return e&&t&&e===t},switchTo:function(e){var t="string"==typeof e?d[e]:e;if(t){o.forEach(["Group","Rect","Ellipse","Circle","Line","Polyline","Image","Text","Path","TextPath","Surface","createSurface","fixTarget"],function(e){d[e]=t[e]});"string"==typeof e?d.renderer=e:o.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(e){return d.renderer=d[e]&&d[e].Surface===d.Surface?e:null})}}});return d})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(e,t){var i=e.matrix={},a={};i._degToRad=function(e){return a[e]||(a[e]=Math.PI*e/180)};i._radToDeg=function(e){return e/Math.PI*180};i.Matrix2D=function(e){if(e)if("number"==typeof e)this.xx=this.yy=e;else if(e instanceof Array){if(e.length>0){for(var a=i.normalize(e[0]),n=1;n<e.length;++n){var o=a,s=i.normalize(e[n]);(a=new i.Matrix2D).xx=o.xx*s.xx+o.xy*s.yx;a.xy=o.xx*s.xy+o.xy*s.yy;a.yx=o.yx*s.xx+o.yy*s.yx;a.yy=o.yx*s.xy+o.yy*s.yy;a.dx=o.xx*s.dx+o.xy*s.dy+o.dx;a.dy=o.yx*s.dx+o.yy*s.dy+o.dy}t.mixin(this,a)}}else t.mixin(this,e)};t.extend(i.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});t.mixin(i,{identity:new i.Matrix2D,flipX:new i.Matrix2D({xx:-1}),flipY:new i.Matrix2D({yy:-1}),flipXY:new i.Matrix2D({xx:-1,yy:-1}),translate:function(e,t){return arguments.length>1?new i.Matrix2D({dx:e,dy:t}):new i.Matrix2D({dx:e.x,dy:e.y})},scale:function(e,t){return arguments.length>1?new i.Matrix2D({xx:e,yy:t}):"number"==typeof e?new i.Matrix2D({xx:e,yy:e}):new i.Matrix2D({xx:e.x,yy:e.y})},rotate:function(e){var t=Math.cos(e),a=Math.sin(e);return new i.Matrix2D({xx:t,xy:-a,yx:a,yy:t})},rotateg:function(e){return i.rotate(i._degToRad(e))},skewX:function(e){return new i.Matrix2D({xy:Math.tan(e)})},skewXg:function(e){return i.skewX(i._degToRad(e))},skewY:function(e){return new i.Matrix2D({yx:Math.tan(e)})},skewYg:function(e){return i.skewY(i._degToRad(e))},reflect:function(e,t){if(1==arguments.length){t=e.y;e=e.x}var a=e*e,n=t*t,o=a+n,s=2*e*t/o;return new i.Matrix2D({xx:2*a/o-1,xy:s,yx:s,yy:2*n/o-1})},project:function(e,t){if(1==arguments.length){t=e.y;e=e.x}var a=e*e,n=t*t,o=a+n,s=e*t/o;return new i.Matrix2D({xx:a/o,xy:s,yx:s,yy:n/o})},normalize:function(e){return e instanceof i.Matrix2D?e:new i.Matrix2D(e)},isIdentity:function(e){return 1==e.xx&&0==e.xy&&0==e.yx&&1==e.yy&&0==e.dx&&0==e.dy},clone:function(e){var t=new i.Matrix2D;for(var a in e)"number"==typeof e[a]&&"number"==typeof t[a]&&t[a]!=e[a]&&(t[a]=e[a]);return t},invert:function(e){var t=i.normalize(e),a=t.xx*t.yy-t.xy*t.yx;return t=new i.Matrix2D({xx:t.yy/a,xy:-t.xy/a,yx:-t.yx/a,yy:t.xx/a,dx:(t.xy*t.dy-t.yy*t.dx)/a,dy:(t.yx*t.dx-t.xx*t.dy)/a})},_multiplyPoint:function(e,t,i){return{x:e.xx*t+e.xy*i+e.dx,y:e.yx*t+e.yy*i+e.dy}},multiplyPoint:function(e,t,a){var n=i.normalize(e);return"number"==typeof t&&"number"==typeof a?i._multiplyPoint(n,t,a):i._multiplyPoint(n,t.x,t.y)},multiplyRectangle:function(e,t){var a=i.normalize(e);t=t||{x:0,y:0,width:0,height:0};if(i.isIdentity(a))return{x:t.x,y:t.y,width:t.width,height:t.height};var n=i.multiplyPoint(a,t.x,t.y),o=i.multiplyPoint(a,t.x,t.y+t.height),s=i.multiplyPoint(a,t.x+t.width,t.y),r=i.multiplyPoint(a,t.x+t.width,t.y+t.height),l=Math.min(n.x,o.x,s.x,r.x),d=Math.min(n.y,o.y,s.y,r.y);return{x:l,y:d,width:Math.max(n.x,o.x,s.x,r.x)-l,height:Math.max(n.y,o.y,s.y,r.y)-d}},multiply:function(e){for(var t=i.normalize(e),a=1;a<arguments.length;++a){var n=t,o=i.normalize(arguments[a]);(t=new i.Matrix2D).xx=n.xx*o.xx+n.xy*o.yx;t.xy=n.xx*o.xy+n.xy*o.yy;t.yx=n.yx*o.xx+n.yy*o.yx;t.yy=n.yx*o.xy+n.yy*o.yy;t.dx=n.xx*o.dx+n.xy*o.dy+n.dx;t.dy=n.yx*o.dx+n.yy*o.dy+n.dy}return t},_sandwich:function(e,t,a){return i.multiply(i.translate(t,a),e,i.translate(-t,-a))},scaleAt:function(e,t,a,n){switch(arguments.length){case 4:return i._sandwich(i.scale(e,t),a,n);case 3:return"number"==typeof a?i._sandwich(i.scale(e),t,a):i._sandwich(i.scale(e,t),a.x,a.y)}return i._sandwich(i.scale(e),t.x,t.y)},rotateAt:function(e,t,a){return arguments.length>2?i._sandwich(i.rotate(e),t,a):i._sandwich(i.rotate(e),t.x,t.y)},rotategAt:function(e,t,a){return arguments.length>2?i._sandwich(i.rotateg(e),t,a):i._sandwich(i.rotateg(e),t.x,t.y)},skewXAt:function(e,t,a){return arguments.length>2?i._sandwich(i.skewX(e),t,a):i._sandwich(i.skewX(e),t.x,t.y)},skewXgAt:function(e,t,a){return arguments.length>2?i._sandwich(i.skewXg(e),t,a):i._sandwich(i.skewXg(e),t.x,t.y)},skewYAt:function(e,t,a){return arguments.length>2?i._sandwich(i.skewY(e),t,a):i._sandwich(i.skewY(e),t.x,t.y)},skewYgAt:function(e,t,a){return arguments.length>2?i._sandwich(i.skewYg(e),t,a):i._sandwich(i.skewYg(e),t.x,t.y)}});e.Matrix2D=i.Matrix2D;return i})},"dojox/gfx/shape":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","dojo/_base/kernel","dojo/_base/sniff","dojo/on","dojo/_base/array","dojo/dom-construct","dojo/_base/Color","./matrix"],function(e,t,i,a,n,o,s,r,l,d){function c(e,t){for(var i=e.length-1;t<i;)e[t]=e[++t];e.length=i}var u=e.shape={};u.Shape=i("dojox.gfx.shape.Shape",null,{constructor:function(){this.rawNode=null;this.shape=null;this.matrix=null;this.fillStyle=null;this.strokeStyle=null;this.bbox=null;this.parent=null;this.parentMatrix=null;if(n("gfxRegistry")){var e=u.register(this);this.getUID=function(){return e}}},destroy:function(){n("gfxRegistry")&&u.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var e=this.getBoundingBox();if(!e)return null;var t=this._getRealMatrix(),i=d;return[i.multiplyPoint(t,e.x,e.y),i.multiplyPoint(t,e.x+e.width,e.y),i.multiplyPoint(t,e.x+e.width,e.y+e.height),i.multiplyPoint(t,e.x,e.y+e.height)]},getEventSource:function(){return this.rawNode},setClip:function(e){this.clip=e},getClip:function(){return this.clip},setShape:function(t){this.shape=e.makeParameters(this.shape,t);this.bbox=null;return this},setFill:function(t){if(!t){this.fillStyle=null;return this}var i=null;if("object"==typeof t&&"type"in t)switch(t.type){case"linear":i=e.makeParameters(e.defaultLinearGradient,t);break;case"radial":i=e.makeParameters(e.defaultRadialGradient,t);break;case"pattern":i=e.makeParameters(e.defaultPattern,t)}else i=e.normalizeColor(t);this.fillStyle=i;return this},setStroke:function(i){if(!i){this.strokeStyle=null;return this}("string"==typeof i||t.isArray(i)||i instanceof l)&&(i={color:i});var a=this.strokeStyle=e.makeParameters(e.defaultStroke,i);a.color=e.normalizeColor(a.color);return this},setTransform:function(e){this.matrix=d.clone(e?d.normalize(e):d.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var e=this.getParent();if(e){e._moveChildToFront(this);this._moveToFront()}return this},moveToBack:function(){var e=this.getParent();if(e){e._moveChildToBack(this);this._moveToBack()}return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(e){return e?this.setTransform([this.matrix,e]):this},applyLeftTransform:function(e){return e?this.setTransform([e,this.matrix]):this},applyTransform:function(e){return e?this.setTransform([this.matrix,e]):this},removeShape:function(e){this.parent&&this.parent.remove(this,e);return this},_setParent:function(e,t){this.parent=e;return this._updateParentMatrix(t)},_updateParentMatrix:function(e){this.parentMatrix=e?d.clone(e):null;return this._applyTransform()},_getRealMatrix:function(){for(var e=this.matrix,t=this.parent;t;){t.matrix&&(e=d.multiply(t.matrix,e));t=t.parent}return e}});u._eventsProcessing={on:function(t,i){return o(this.getEventSource(),t,u.fixCallback(this,e.fixTarget,i))},connect:function(e,i,a){"on"==e.substring(0,2)&&(e=e.substring(2));return this.on(e,a?t.hitch(i,a):i)},disconnect:function(e){return e.remove()}};u.fixCallback=function(e,i,n,o){if(!o){o=n;n=null}if(t.isString(o)){if(!(n=n||a.global)[o])throw['dojox.gfx.shape.fixCallback: scope["',o,'"] is null (scope="',n,'")'].join("");return function(t){return i(t,e)?n[o].apply(n,arguments||[]):void 0}}return n?function(t){return i(t,e)?o.apply(n,arguments||[]):void 0}:function(t){return i(t,e)?o.apply(n,arguments):void 0}};t.extend(u.Shape,u._eventsProcessing);u.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(e){var t=e.getParent();t&&t.remove(e,!0);this.children.push(e);return e._setParent(this,this._getRealMatrix())},remove:function(e,t){for(var i=0;i<this.children.length;++i)if(this.children[i]==e){if(t);else{e.parent=null;e.parentMatrix=null}c(this.children,i);break}return this},clear:function(e){for(var t,i=0;i<this.children.length;++i){(t=this.children[i]).parent=null;t.parentMatrix=null;e&&t.destroy()}this.children=[];return this},getBoundingBox:function(){if(this.children){var e=null;s.forEach(this.children,function(t){var i=t.getBoundingBox();if(i){var a=t.getTransform();a&&(i=d.multiplyRectangle(a,i));if(e){e.x=Math.min(e.x,i.x);e.y=Math.min(e.y,i.y);e.endX=Math.max(e.endX,i.x+i.width);e.endY=Math.max(e.endY,i.y+i.height)}else e={x:i.x,y:i.y,endX:i.x+i.width,endY:i.y+i.height}}});if(e){e.width=e.endX-e.x;e.height=e.endY-e.y}return e}return null},_moveChildToFront:function(e){for(var t=0;t<this.children.length;++t)if(this.children[t]==e){c(this.children,t);this.children.push(e);break}return this},_moveChildToBack:function(e){for(var t=0;t<this.children.length;++t)if(this.children[t]==e){c(this.children,t);this.children.unshift(e);break}return this}};u.Surface=i("dojox.gfx.shape.Surface",null,{constructor:function(){this.rawNode=null;this._parent=null;this._nodes=[];this._events=[]},destroy:function(){s.forEach(this._nodes,r.destroy);this._nodes=[];s.forEach(this._events,function(e){e&&e.remove()});this._events=[];this.rawNode=null;if(n("ie"))for(;this._parent.lastChild;)r.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(e){},whenLoaded:function(e,i){var a=t.hitch(e,i);this.isLoaded?a(this):o.once(this,"load",function(e){a(e)})}});t.extend(u.Surface,u._eventsProcessing);u.Rect=i("dojox.gfx.shape.Rect",u.Shape,{constructor:function(t){this.shape=e.getDefault("Rect");this.rawNode=t},getBoundingBox:function(){return this.shape}});u.Ellipse=i("dojox.gfx.shape.Ellipse",u.Shape,{constructor:function(t){this.shape=e.getDefault("Ellipse");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var e=this.shape;this.bbox={x:e.cx-e.rx,y:e.cy-e.ry,width:2*e.rx,height:2*e.ry}}return this.bbox}});u.Circle=i("dojox.gfx.shape.Circle",u.Shape,{constructor:function(t){this.shape=e.getDefault("Circle");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var e=this.shape;this.bbox={x:e.cx-e.r,y:e.cy-e.r,width:2*e.r,height:2*e.r}}return this.bbox}});u.Line=i("dojox.gfx.shape.Line",u.Shape,{constructor:function(t){this.shape=e.getDefault("Line");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var e=this.shape;this.bbox={x:Math.min(e.x1,e.x2),y:Math.min(e.y1,e.y2),width:Math.abs(e.x2-e.x1),height:Math.abs(e.y2-e.y1)}}return this.bbox}});u.Polyline=i("dojox.gfx.shape.Polyline",u.Shape,{constructor:function(t){this.shape=e.getDefault("Polyline");this.rawNode=t},setShape:function(e,t){if(e&&e instanceof Array){this.inherited(arguments,[{points:e}]);t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])}else this.inherited(arguments,[e]);return this},_normalizePoints:function(){var e=this.shape.points,t=e&&e.length;if(t&&"number"==typeof e[0]){for(var i=[],a=0;a<t;a+=2)i.push({x:e[a],y:e[a+1]});this.shape.points=i}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var e=this.shape.points,t=e.length,i=e[0],a={l:i.x,t:i.y,r:i.x,b:i.y},n=1;n<t;++n){i=e[n];a.l>i.x&&(a.l=i.x);a.r<i.x&&(a.r=i.x);a.t>i.y&&(a.t=i.y);a.b<i.y&&(a.b=i.y)}this.bbox={x:a.l,y:a.t,width:a.r-a.l,height:a.b-a.t}}return this.bbox}});u.Image=i("dojox.gfx.shape.Image",u.Shape,{constructor:function(t){this.shape=e.getDefault("Image");this.rawNode=t},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});u.Text=i(u.Shape,{constructor:function(t){this.fontStyle=null;this.shape=e.getDefault("Text");this.rawNode=t},getFont:function(){return this.fontStyle},setFont:function(t){this.fontStyle="string"==typeof t?e.splitFontString(t):e.makeParameters(e.defaultFont,t);this._setFont();return this},getBoundingBox:function(){var t=null;this.getShape().text&&(t=e._base._computeTextBoundingBox(this));return t}});u.Creator={createShape:function(t){switch(t.type){case e.defaultPath.type:return this.createPath(t);case e.defaultRect.type:return this.createRect(t);case e.defaultCircle.type:return this.createCircle(t);case e.defaultEllipse.type:return this.createEllipse(t);case e.defaultLine.type:return this.createLine(t);case e.defaultPolyline.type:return this.createPolyline(t);case e.defaultImage.type:return this.createImage(t);case e.defaultText.type:return this.createText(t);case e.defaultTextPath.type:return this.createTextPath(t)}return null},createGroup:function(){return this.createObject(e.Group)},createRect:function(t){return this.createObject(e.Rect,t)},createEllipse:function(t){return this.createObject(e.Ellipse,t)},createCircle:function(t){return this.createObject(e.Circle,t)},createLine:function(t){return this.createObject(e.Line,t)},createPolyline:function(t){return this.createObject(e.Polyline,t)},createImage:function(t){return this.createObject(e.Image,t)},createText:function(t){return this.createObject(e.Text,t)},createPath:function(t){return this.createObject(e.Path,t)},createTextPath:function(t){return this.createObject(e.TextPath,{}).setText(t)},createObject:function(e,t){return null}};return u})},"dojox/gfx/svg":function(){define(["dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/dom","dojo/_base/declare","dojo/_base/array","dojo/dom-geometry","dojo/dom-attr","dojo/_base/Color","./_base","./shape","./path"],function(e,t,i,a,n,o,s,r,l,d,c,u){var h=d.svg={};h.useSvgWeb=void 0!==window.svgweb;var p=navigator.userAgent,_=t("ios"),m=t("android"),g=t("chrome")||m&&m>=4?"auto":"optimizeLegibility";function f(e,t){return i.doc.createElementNS?i.doc.createElementNS(e,t):i.doc.createElement(t)}function b(e,t,i,a){return e.setAttributeNS?e.setAttributeNS(t,i,a):e.setAttribute(i,a)}function y(e){return h.useSvgWeb?i.doc.createTextNode(e,!0):i.doc.createTextNode(e)}h.xmlns={xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"};h.getRef=function(e){return e&&"none"!=e?e.match(/^url\(#.+\)$/)?a.byId(e.slice(5,-1)):e.match(/^#dojoUnique\d+$/)?a.byId(e.slice(1)):null:null};h.dasharray={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};var v=0;h.Shape=n("dojox.gfx.svg.Shape",c.Shape,{destroy:function(){if(this.fillStyle&&"type"in this.fillStyle){var e=this.rawNode.getAttribute("fill"),t=h.getRef(e);t&&t.parentNode.removeChild(t)}if(this.clip){var i=this.rawNode.getAttribute("clip-path");if(i){var n=a.byId(i.match(/gfx_clip[\d]+/)[0]);n&&n.parentNode.removeChild(n)}}c.Shape.prototype.destroy.apply(this,arguments)},setFill:function(e){if(!e){this.fillStyle=null;this.rawNode.setAttribute("fill","none");this.rawNode.setAttribute("fill-opacity",0);return this}var t,i=function(e){this.setAttribute(e,t[e].toFixed(8))};if("object"==typeof e&&"type"in e){switch(e.type){case"linear":t=d.makeParameters(d.defaultLinearGradient,e);var a=this._setFillObject(t,"linearGradient");o.forEach(["x1","y1","x2","y2"],i,a);break;case"radial":t=d.makeParameters(d.defaultRadialGradient,e);var n=this._setFillObject(t,"radialGradient");o.forEach(["cx","cy","r"],i,n);break;case"pattern":t=d.makeParameters(d.defaultPattern,e);var s=this._setFillObject(t,"pattern");o.forEach(["x","y","width","height"],i,s)}this.fillStyle=t;return this}t=d.normalizeColor(e);this.fillStyle=t;this.rawNode.setAttribute("fill",t.toCss());this.rawNode.setAttribute("fill-opacity",t.a);this.rawNode.setAttribute("fill-rule","evenodd");return this},setStroke:function(t){var i=this.rawNode;if(!t){this.strokeStyle=null;i.setAttribute("stroke","none");i.setAttribute("stroke-opacity",0);return this}("string"==typeof t||e.isArray(t)||t instanceof l)&&(t={color:t});var a=this.strokeStyle=d.makeParameters(d.defaultStroke,t);a.color=d.normalizeColor(a.color);if(a){var n=a.width<0?0:a.width;i.setAttribute("stroke",a.color.toCss());i.setAttribute("stroke-opacity",a.color.a);i.setAttribute("stroke-width",n);i.setAttribute("stroke-linecap",a.cap);if("number"==typeof a.join){i.setAttribute("stroke-linejoin","miter");i.setAttribute("stroke-miterlimit",a.join)}else i.setAttribute("stroke-linejoin",a.join);var o=a.style.toLowerCase();o in h.dasharray&&(o=h.dasharray[o]);if(o instanceof Array){o=e._toArray(o);var s;for(s=0;s<o.length;++s)o[s]*=n;if("butt"!=a.cap){for(s=0;s<o.length;s+=2){o[s]-=n;o[s]<1&&(o[s]=1)}for(s=1;s<o.length;s+=2)o[s]+=n}o=o.join(",")}i.setAttribute("stroke-dasharray",o);i.setAttribute("dojoGfxStrokeStyle",a.style)}return this},_getParentSurface:function(){for(var e=this.parent;e&&!(e instanceof d.Surface);e=e.parent);return e},_setFillObject:function(e,t){var i=h.xmlns.svg;this.fillStyle=e;var a=this._getParentSurface().defNode,n=this.rawNode.getAttribute("fill"),o=h.getRef(n);if(o)if((n=o).tagName.toLowerCase()!=t.toLowerCase()){var s=n.id;n.parentNode.removeChild(n);(n=f(i,t)).setAttribute("id",s);a.appendChild(n)}else for(;n.childNodes.length;)n.removeChild(n.lastChild);else{(n=f(i,t)).setAttribute("id",d._base._getUniqueId());a.appendChild(n)}if("pattern"==t){n.setAttribute("patternUnits","userSpaceOnUse");var r=f(i,"image");r.setAttribute("x",0);r.setAttribute("y",0);r.setAttribute("width",(e.width<0?0:e.width).toFixed(8));r.setAttribute("height",(e.height<0?0:e.height).toFixed(8));b(r,h.xmlns.xlink,"xlink:href",e.src);n.appendChild(r)}else{n.setAttribute("gradientUnits","userSpaceOnUse");for(var l=0;l<e.colors.length;++l){var c=e.colors[l],u=f(i,"stop"),p=c.color=d.normalizeColor(c.color);u.setAttribute("offset",c.offset.toFixed(8));u.setAttribute("stop-color",p.toCss());u.setAttribute("stop-opacity",p.a);n.appendChild(u)}}this.rawNode.setAttribute("fill","url(#"+n.getAttribute("id")+")");this.rawNode.removeAttribute("fill-opacity");this.rawNode.setAttribute("fill-rule","evenodd");return n},_applyTransform:function(){if(this.matrix){var e=this.matrix;this.rawNode.setAttribute("transform","matrix("+e.xx.toFixed(8)+","+e.yx.toFixed(8)+","+e.xy.toFixed(8)+","+e.yy.toFixed(8)+","+e.dx.toFixed(8)+","+e.dy.toFixed(8)+")")}else this.rawNode.removeAttribute("transform");return this},setRawNode:function(e){var t=this.rawNode=e;"image"!=this.shape.type&&t.setAttribute("fill","none");t.setAttribute("fill-opacity",0);t.setAttribute("stroke","none");t.setAttribute("stroke-opacity",0);t.setAttribute("stroke-width",1);t.setAttribute("stroke-linecap","butt");t.setAttribute("stroke-linejoin","miter");t.setAttribute("stroke-miterlimit",4);t.__gfxObject__=this},setShape:function(e){this.shape=d.makeParameters(this.shape,e);for(var t in this.shape)if("type"!=t){var i=this.shape[t];"width"!==t&&"height"!==t||(i=i<0?0:i);this.rawNode.setAttribute(t,i)}this.bbox=null;return this},_moveToFront:function(){this.rawNode.parentNode.appendChild(this.rawNode);return this},_moveToBack:function(){this.rawNode.parentNode.insertBefore(this.rawNode,this.rawNode.parentNode.firstChild);return this},setClip:function(t){this.inherited(arguments);var i=t?"width"in t?"rect":"cx"in t?"ellipse":"points"in t?"polyline":"d"in t?"path":null:null;if(t&&!i)return this;"polyline"===i&&((t=e.clone(t)).points=t.points.join(","));var n,o,s=r.get(this.rawNode,"clip-path");s&&(n=a.byId(s.match(/gfx_clip[\d]+/)[0]))&&n.removeChild(n.childNodes[0]);if(t){if(n){o=f(h.xmlns.svg,i);n.appendChild(o)}else{var l="gfx_clip"+ ++v,d="url(#"+l+")";this.rawNode.setAttribute("clip-path",d);n=f(h.xmlns.svg,"clipPath");o=f(h.xmlns.svg,i);n.appendChild(o);this.rawNode.parentNode.insertBefore(n,this.rawNode);r.set(n,"id",l)}r.set(o,t)}else{this.rawNode.removeAttribute("clip-path");n&&n.parentNode.removeChild(n)}return this},_removeClipNode:function(){var e,t=r.get(this.rawNode,"clip-path");t&&(e=a.byId(t.match(/gfx_clip[\d]+/)[0]))&&e.parentNode.removeChild(e);return e}});h.Group=n("dojox.gfx.svg.Group",h.Shape,{constructor:function(){c.Container._init.call(this)},setRawNode:function(e){this.rawNode=e;this.rawNode.__gfxObject__=this},destroy:function(){this.clear(!0);h.Shape.prototype.destroy.apply(this,arguments)}});h.Group.nodeType="g";h.Rect=n("dojox.gfx.svg.Rect",[h.Shape,c.Rect],{setShape:function(e){this.shape=d.makeParameters(this.shape,e);this.bbox=null;for(var t in this.shape)if("type"!=t&&"r"!=t){var i=this.shape[t];"width"!==t&&"height"!==t||(i=i<0?0:i);this.rawNode.setAttribute(t,i)}if(null!=this.shape.r){this.rawNode.setAttribute("ry",this.shape.r);this.rawNode.setAttribute("rx",this.shape.r)}return this}});h.Rect.nodeType="rect";h.Ellipse=n("dojox.gfx.svg.Ellipse",[h.Shape,c.Ellipse],{});h.Ellipse.nodeType="ellipse";h.Circle=n("dojox.gfx.svg.Circle",[h.Shape,c.Circle],{});h.Circle.nodeType="circle";h.Line=n("dojox.gfx.svg.Line",[h.Shape,c.Line],{});h.Line.nodeType="line";h.Polyline=n("dojox.gfx.svg.Polyline",[h.Shape,c.Polyline],{setShape:function(e,t){if(e&&e instanceof Array){this.shape=d.makeParameters(this.shape,{points:e});t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])}else this.shape=d.makeParameters(this.shape,e);this.bbox=null;this._normalizePoints();for(var i=[],a=this.shape.points,n=0;n<a.length;++n)i.push(a[n].x.toFixed(8),a[n].y.toFixed(8));this.rawNode.setAttribute("points",i.join(" "));return this}});h.Polyline.nodeType="polyline";h.Image=n("dojox.gfx.svg.Image",[h.Shape,c.Image],{setShape:function(e){this.shape=d.makeParameters(this.shape,e);this.bbox=null;var t=this.rawNode;for(var i in this.shape)if("type"!=i&&"src"!=i){var a=this.shape[i];"width"!==i&&"height"!==i||(a=a<0?0:a);t.setAttribute(i,a)}t.setAttribute("preserveAspectRatio","none");b(t,h.xmlns.xlink,"xlink:href",this.shape.src);t.__gfxObject__=this;return this}});h.Image.nodeType="image";h.Text=n("dojox.gfx.svg.Text",[h.Shape,c.Text],{setShape:function(e){this.shape=d.makeParameters(this.shape,e);this.bbox=null;var t=this.rawNode,i=this.shape;t.setAttribute("x",i.x);t.setAttribute("y",i.y);t.setAttribute("text-anchor",i.align);t.setAttribute("text-decoration",i.decoration);t.setAttribute("rotate",i.rotated?90:0);t.setAttribute("kerning",i.kerning?"auto":0);t.setAttribute("text-rendering",g);t.firstChild?t.firstChild.nodeValue=i.text:t.appendChild(y(i.text));return this},getTextWidth:function(){var e=this.rawNode,t=e.parentNode,i=e.cloneNode(!0);i.style.visibility="hidden";var a=0,n=i.firstChild.nodeValue;t.appendChild(i);if(""!=n)for(;!a;)a=i.getBBox?parseInt(i.getBBox().width):68;t.removeChild(i);return a},getBoundingBox:function(){var e=null;if(this.getShape().text)try{e=this.rawNode.getBBox()}catch(t){e={x:0,y:0,width:0,height:0}}return e}});h.Text.nodeType="text";h.Path=n("dojox.gfx.svg.Path",[h.Shape,u.Path],{_updateWithSegment:function(e){this.inherited(arguments);"string"==typeof this.shape.path&&this.rawNode.setAttribute("d",this.shape.path)},setShape:function(e){this.inherited(arguments);this.shape.path?this.rawNode.setAttribute("d",this.shape.path):this.rawNode.removeAttribute("d");return this}});h.Path.nodeType="path";h.TextPath=n("dojox.gfx.svg.TextPath",[h.Shape,u.TextPath],{_updateWithSegment:function(e){this.inherited(arguments);this._setTextPath()},setShape:function(e){this.inherited(arguments);this._setTextPath();return this},_setTextPath:function(){if("string"==typeof this.shape.path){var e=this.rawNode;if(!e.firstChild){var t=f(h.xmlns.svg,"textPath"),i=y("");t.appendChild(i);e.appendChild(t)}var a=e.firstChild.getAttributeNS(h.xmlns.xlink,"href"),n=a&&h.getRef(a);if(!n){var o=this._getParentSurface();if(o){var s=o.defNode;n=f(h.xmlns.svg,"path");var r=d._base._getUniqueId();n.setAttribute("id",r);s.appendChild(n);b(e.firstChild,h.xmlns.xlink,"xlink:href","#"+r)}}n&&n.setAttribute("d",this.shape.path)}},_setText:function(){var e=this.rawNode;if(!e.firstChild){var t=f(h.xmlns.svg,"textPath"),i=y("");t.appendChild(i);e.appendChild(t)}e=e.firstChild;var a=this.text;e.setAttribute("alignment-baseline","middle");switch(a.align){case"middle":e.setAttribute("text-anchor","middle");e.setAttribute("startOffset","50%");break;case"end":e.setAttribute("text-anchor","end");e.setAttribute("startOffset","100%");break;default:e.setAttribute("text-anchor","start");e.setAttribute("startOffset","0%")}e.setAttribute("baseline-shift","0.5ex");e.setAttribute("text-decoration",a.decoration);e.setAttribute("rotate",a.rotated?90:0);e.setAttribute("kerning",a.kerning?"auto":0);e.firstChild.data=a.text}});h.TextPath.nodeType="text";var w,x=((w=/WebKit\/(\d*)/.exec(p))?w[1]:0)>534;h.Surface=n("dojox.gfx.svg.Surface",c.Surface,{constructor:function(){c.Container._init.call(this)},destroy:function(){c.Container.clear.call(this,!0);this.defNode=null;this.inherited(arguments)},setDimensions:function(e,t){if(!this.rawNode)return this;var i=e<0?0:e,a=t<0?0:t;this.rawNode.setAttribute("width",i);this.rawNode.setAttribute("height",a);if(x){this.rawNode.style.width=i;this.rawNode.style.height=a}return this},getDimensions:function(){return this.rawNode?{width:d.normalizedLength(this.rawNode.getAttribute("width")),height:d.normalizedLength(this.rawNode.getAttribute("height"))}:null}});h.createSurface=function(e,t,i){var n=new h.Surface;n.rawNode=f(h.xmlns.svg,"svg");n.rawNode.setAttribute("overflow","hidden");t&&n.rawNode.setAttribute("width",t<0?0:t);i&&n.rawNode.setAttribute("height",i<0?0:i);var o=f(h.xmlns.svg,"defs");n.rawNode.appendChild(o);n.defNode=o;n._parent=a.byId(e);n._parent.appendChild(n.rawNode);d._base._fixMsTouchAction(n);return n};var k={_setFont:function(){var e=this.fontStyle;this.rawNode.setAttribute("font-style",e.style);this.rawNode.setAttribute("font-variant",e.variant);this.rawNode.setAttribute("font-weight",e.weight);this.rawNode.setAttribute("font-size",e.size);this.rawNode.setAttribute("font-family",e.family)}},C=c.Container,T=h.Container={openBatch:function(){this._batch||(this.fragment=h.useSvgWeb?i.doc.createDocumentFragment(!0):i.doc.createDocumentFragment());++this._batch;return this},closeBatch:function(){this._batch=this._batch>0?--this._batch:0;if(this.fragment&&!this._batch){this.rawNode.appendChild(this.fragment);delete this.fragment}return this},add:function(e){if(this!=e.getParent()){this.fragment?this.fragment.appendChild(e.rawNode):this.rawNode.appendChild(e.rawNode);C.add.apply(this,arguments);e.setClip(e.clip)}return this},remove:function(e,t){if(this==e.getParent()){this.rawNode==e.rawNode.parentNode&&this.rawNode.removeChild(e.rawNode);this.fragment&&this.fragment==e.rawNode.parentNode&&this.fragment.removeChild(e.rawNode);e._removeClipNode();C.remove.apply(this,arguments)}return this},clear:function(){for(var e=this.rawNode;e.lastChild;)e.removeChild(e.lastChild);var t=this.defNode;if(t){for(;t.lastChild;)t.removeChild(t.lastChild);e.appendChild(t)}return C.clear.apply(this,arguments)},getBoundingBox:C.getBoundingBox,_moveChildToFront:C._moveChildToFront,_moveChildToBack:C._moveChildToBack},j=h.Creator={createObject:function(e,t){if(!this.rawNode)return null;var i=new e,a=f(h.xmlns.svg,e.nodeType);i.setRawNode(a);i.setShape(t);this.add(i);return i}};e.extend(h.Text,k);e.extend(h.TextPath,k);e.extend(h.Group,T);e.extend(h.Group,c.Creator);e.extend(h.Group,j);e.extend(h.Surface,T);e.extend(h.Surface,c.Creator);e.extend(h.Surface,j);h.fixTarget=function(e,t){e.gfxTarget||(_&&e.target.wholeText?e.gfxTarget=e.target.parentElement.__gfxObject__:e.gfxTarget=e.target.__gfxObject__);return!0};if(h.useSvgWeb){h.createSurface=function(e,t,i){var n=new h.Surface;i=i<0?0:i;if(!(t=t<0?0:t)||!i){var o=s.position(e);t=t||o.w;i=i||o.h}var r=(e=a.byId(e)).id?e.id+"_svgweb":d._base._getUniqueId(),l=f(h.xmlns.svg,"svg");l.id=r;l.setAttribute("width",t);l.setAttribute("height",i);svgweb.appendChild(l,e);l.addEventListener("SVGLoad",function(){n.rawNode=this;n.isLoaded=!0;var e=f(h.xmlns.svg,"defs");n.rawNode.appendChild(e);n.defNode=e;n.onLoad&&n.onLoad(n)},!1);n.isLoaded=!1;return n};h.Surface.extend({destroy:function(){var e=this.rawNode;svgweb.removeChild(e,e.parentNode)}});var S={connect:function(t,i,a){"on"===t.substring(0,2)&&(t=t.substring(2));a=2==arguments.length?i:e.hitch(i,a);this.getEventSource().addEventListener(t,a,!1);return[this,t,a]},disconnect:function(e){this.getEventSource().removeEventListener(e[1],e[2],!1);delete e[0]}};e.extend(h.Shape,S);e.extend(h.Surface,S)}return h})},"ebg/core/core":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/common","dojo/string","dojo/fx","dojo/fx/easing","dojo/parser","dojo/io/iframe","dijit/Tooltip","dojox/uuid/generateRandomUuid","dijit/Dialog","ebg/core/i18n","ebg/webrtc","ebg/webpush","ebg/draggable","ebg/resizable","ebg/popindialog"],function(e,t,i){e.extend(dijit.Dialog,{attr:function(e,t){this.set(e,t)},set:function(t,i){if("content"==t){this.thisDlg=new ebg.popindialog;this.thisDlg.bCloseIsHiding=!0;this.thisDlg.create("dialog_"+this.id,null!==$("main-content")?"main-content":"left-side");this.thisDlg.setTitle(this.title);this.onHide&&(this.thisDlg.onHide=e.hitch(this,this.onHide));this.thisDlg.setContent(i)}},show:function(){void 0!==this.thisDlg&&this.thisDlg.show()},hide:function(){void 0!==this.thisDlg&&this.thisDlg.hide()},destroyRecursive:function(){void 0!==this.thisDlg&&this.thisDlg.destroy(!1)},destroy:function(){void 0!==this.thisDlg&&this.thisDlg.destroy(!1)}});return t("ebg.core.core",null,{constructor:function(){this.subscriptions=[];this.comet_subscriptions=[];this.unload_in_progress=!1;this.bCancelAllAjax=!1;this.tooltips={};this.tooltipsInfos={};this.bHideTooltips=!1;this.screenMinWidth=0;this.currentZoom=1;this.mozScale=1;this.rotateToPosition={};this.connections=[];this.instantaneousMode=!1;this.webrtc=null;this.webrtcmsg_ntf_handle=null;this.room=null;this.already_accepted_room=null;this.rtc_mode=0;this.mediaConstraints={video:!1,audio:!1};this.gameMasculinePlayers=[];this.gameFemininePlayers=[];this.gameNeutralPlayers=[];this.emoticons={":)":"smile",":-)":"smile",":D":"bigsmile",":-D":"bigsmile",":(":"unsmile",":-(":"unsmile",";)":"blink",";-)":"blink",":/":"bad",":-/":"bad",":s":"bad",":-s":"bad",":P":"mischievous",":-P":"mischievous",":p":"mischievous",":-p":"mischievous",":$":"blushing",":-$":"blushing",":o":"surprised",":-o":"surprised",":O":"shocked",":-O":"shocked",o_o:"shocked",O_O:"shocked","8)":"sunglass","8-)":"sunglass"};this.defaultTooltipPosition=["above","below","after","before"];this.webpush=null},ajaxcall:function(t,a,n,o,s,r,l){g_sitecore.ajaxcall_running++;g_sitecore.updateAjaxCallStatus();if("object"!=typeof a){console.error("ajaxcall : params should be an object. param =");console.error(a)}if(void 0===a.action)if(void 0===a.module)if(void 0===a.class){if(a.lock){var d=null;"table"==a.lock?d="table":"player"==a.lock&&(d="player");a.lock=dojox.uuid.generateRandomUuid();e.publish("lockInterface",[{status:"outgoing",uuid:a.lock,type:d}])}var c=e.hitch(this,function(r,d){r&&505==r.code&&("undefined"!=typeof mainsite?mainsite.updateServiceStatus("red"):this.showMessage(__("lang_mainsite",r.error),"error"));if(r&&1==r.status){void 0!==r.profilingd&&($("ajax_call_profiling").innerHTML+=r.profilingd);d.args.content.lock&&e.publish("lockInterface",[{status:"recorded",uuid:d.args.content.lock}]);"object"==typeof r.data&&null!==r.data&&"object"==typeof r.data.data&&null!==r.data.data&&void 0!==r.data.data.tbyt&&(this.number_of_tb_table_its_your_turn=r.data.data.tbyt);if(!this.bCancelAllAjax)try{e.hitch(n,o)(r.data);void 0!==s&&e.hitch(n,s)(!1)}catch(u){console.error("Exception during callback "+o+" after a call to URL "+t);console.error("Exception message : "+u.message);console.error("URL = "+t);console.error("Ajaxcall params :");console.error(a);console.error("Ajaxcall result :");console.error(r);u.message="Error during callback from url "+t+". "+u.message;throw u}}else{var c="";if(null===r){this.showMessage(__("lang_mainsite","Ajaxcall error: empty answer"),"error");this.showMessage(__("lang_mainsite","If your game interface seems unstable, press F5 or <a href='javascript:location.reload(true)'>click here</a>"),"info");console.error("Ajaxcall error: empty answer from "+t);a.noerrortracking||analyticsPush({errorURL:t||"",errorCode:"",errorExpected:"",event:"page_error"})}else{a.noerrortracking||analyticsPush({errorURL:t||"",errorCode:r.code?r.code:"",errorExpected:r.expected?r.expected:"",event:"page_error"});if(800==r.code)e.publish("signalVisitorNotAllowed");else if(801==r.code){if("undefined"!=typeof gotourl)i.stores.universalModals?i.stores.universalModals.push(i.ms.universalmodals.BgaPremiumFeatureModal,{message:r.error,target:document.body}):gotourl("premium?src=notallowed");else if(void 0!==this.metasiteurl){this.showMessage(r.error,"error");setTimeout(e.hitch(this,function(){document.location.href=this.metasiteurl+"/premium?src=redirect"}),2e3)}}else if(806==r.code)this.infoDialog(__("lang_mainsite","Please click the button below to continue."),__("lang_mainsite","Update needed!"),function(){window.location.reload()},!0);else if(114==r.code){if("undefined"!=typeof gotourl){gotourl("account?page=newuser");this.showMessage(r.error,"error")}else if(void 0!==this.metasiteurl){this.showMessage(r.error,"error");setTimeout(e.hitch(this,function(){document.location.href=this.metasiteurl+"/account?page=newuser"}),2e3)}}else if(void 0===l){const e=this.format_string_recursive(r.error,r.args||[]);if(0===toint(r.expected)){this.showMessage(__("lang_mainsite","Unexpected error: ")+e,"error");this.showMessage(__("lang_mainsite","If your game interface seems unstable, press F5 or <a href='javascript:location.reload(true)'>click here</a>"),"info");console.error("Unexpected error:  "+r.error)}else{this.showMessage(e,"error");c=r.error}}}d.args.content.lock&&e.publish("lockInterface",[{status:"updated",uuid:d.args.content.lock}]);this.bCancelAllAjax||void 0!==s&&e.hitch(n,s)(!0,c,null===r?0:r.code)}});if(void 0!==l)var u=e.hitch(n,l);else u=e.hitch(this,function(i,o){if(o.xhr)if(200==o.xhr.status){var r=o.xhr.responseText;if("{"!=(r=r.replace(/^\s+/g,"").replace(/\s+$/g,""))[0]){this.showMessage(__("lang_mainsite","Server syntax error: ")+o.xhr.responseText,"error");this.showMessage(__("lang_mainsite","If your game interface seems unstable, press F5 or <a href='javascript:location.reload(true)'>click here</a>"),"info");console.error("Server syntax error: "+t+" "+i+" / "+o.xhr.responseText);a.noerrortracking||analyticsPush({errorURL:t||"",errorCode:"Server syntax error",errorExpected:0,event:"page_error"})}else{this.showMessage(__("lang_mainsite","Client error: ")+i.toString().replaceAll("${","{")+". During "+o.args.url+" Received: "+o.xhr.responseText.replaceAll("${","{"),"only_to_log");this.showMessage(__("lang_mainsite","If your game interface seems unstable, press F5 or <a href='javascript:location.reload(true)'>click here</a>"),"only_to_log");mainsite.onInvisibleScriptError(i.toString().replaceAll("${","{")+"\n"+i.stack,"","");console.error("Error during callback error: "+t+" / "+i);console.error(o);a.noerrortracking||analyticsPush({errorURL:t||"",errorCode:"Client error",errorExpected:0,event:"page_error"})}}else{console.error("HTTP code "+o.xhr.status+" "+t);this.displayUserHttpError(o.xhr.status);a.noerrortracking||analyticsPush({errorURL:t||"",errorCode:"HTTP"+o.xhr.status,errorExpected:0,event:"page_error"})}else{console.error("Server error: "+i);void 0!==o.error&&this.showMessage(o.error.toString(),"error");a.table||analyticsPush({errorURL:t||"",errorCode:"Server error",errorExpected:0,event:"page_error"})}o.args.content.lock&&e.publish("lockInterface",[{status:"updated",uuid:o.args.content.lock}]);this.bCancelAllAjax||void 0!==s&&e.hitch(n,s)(!0)});var h=e.hitch(this,function(e,t){g_sitecore.ajaxcall_running--;g_sitecore.updateAjaxCallStatus()}),p=null;if("post"!=r&&"iframe"!=r)e.xhrGet({url:t,handleAs:"json",preventCache:!0,content:a,headers:{"X-Request-Token":bgaConfig.requestToken},load:c,error:u,handle:h,timeout:2e4});else if("post"==r){if(void 0!==a.form_id&&null!==a.form_id){a.form_id;p=a.form_id}e.xhrPost({url:t,handleAs:"json",preventCache:!0,content:a,headers:{"X-Request-Token":bgaConfig.requestToken},form:p,load:c,error:u,handle:h,timeout:2e4})}else if("iframe"==r){if(null!==a.form_id){a.form_id;p=a.form_id}e.io.iframe.send({url:t,handleAs:"json",preventCache:!0,content:a,form:p,load:c,error:u,handle:h,timeout:2e4})}}else{console.error("ajaxcall : sorry you cannot use 'class' argument (reserved)");this.showMessage("Ajaxcall : sorry you cannot use 'class' argument (reserved keyword)","error")}else{console.error("ajaxcall : sorry you cannot use 'module' argument (reserved)");this.showMessage("Ajaxcall : sorry you cannot use 'module' argument (reserved keyword)","error")}else{console.error("ajaxcall : sorry you cannot use 'action' argument (reserved)");this.showMessage("Ajaxcall : sorry you cannot use 'action' argument (reserved keyword)","error")}},ajaxpageload:function(t,i,a,n,o){g_sitecore.ajaxcall_running++;g_sitecore.updateAjaxCallStatus();return e.xhrGet({url:t,handleAs:"text",preventCache:!0,content:i,timeout:2e4,load:e.hitch(this,function(i,s){if(window.URL){var r=new URL(s.xhr.responseURL),l=new URL(s.url,window.location.href);if(r.pathname!=l.pathname){gotourl(r.pathname+r.search+r.hash);return}}e.empty(a);e.place(i,a);if($("bga_fatal_error")){if(800==toint($("bga_fatal_error_code").innerHTML))e.publish("signalVisitorNotAllowed");else if(802==toint($("bga_fatal_error_code").innerHTML))if(-1!=t.indexOf("preferences?section")||"preferences"===t.substr(-11)||"support"===t.substr(-7)||"contact"===t.substr(-7));else{var d=$("bga_fatal_error_descr").innerHTML.split(":");gotourl(d[1])}}else e.hitch(n,o)(i.data)}),error:e.hitch(this,function(e,i){if("Request canceled"!=e.message){if(200==i.xhr.status){var a=i.xhr.responseText;if("<"!=(a=a.replace(/^\s+/g,"").replace(/\s+$/g,""))[0])this.showMessage("Server syntax error: "+i.xhr.responseText,"error");else{this.showMessage("Callback error: "+e,"error");console.error("Callback error: "+e)}}else{console.error("HTTP code "+i.xhr.status+" "+t);this.displayUserHttpError(i.xhr.status)}console.error("Error during ajaxpageload. HTTP status code: ",i.xhr.status)}}),handle:e.hitch(this,function(e,t){g_sitecore.ajaxcall_running--;g_sitecore.updateAjaxCallStatus()})})},displayUserHttpError:function(e){if(!g_sitecore.page_is_unloading){var t="";switch(e=toint(e)){case 404:t=__("lang_mainsite","The requested page was not found");break;case 500:t=__("lang_mainsite","The server reported an error.");break;case 407:t=__("lang_mainsite","You need to authenticate with a proxy.");break;case 0:t=__("lang_mainsite","Unable to contact the server. Are you connected ?");break;default:t=__("lang_mainsite","Unknown network error")+" ("+e+")"}this.showMessage(t,"error")}},cancelAjaxCall:function(){this.bCancelAllAjax=!0},format_string:function(t,i){return e.trim(e.string.substitute(t,i))},format_string_recursive:function(t,i){if(null===t){console.error("format_string_recursive called with a null string with args:");console.error(i);return"null_tr_string"}var a="";if(""!=t){var n,o,s=this.clienttranslate_string(t);if(null===s){this.showMessage("Missing translation for `"+t+"`","error");console.error("Missing translation for `"+t+"`","error");return""}if(void 0!==i.i18n)for(n in i.i18n)i[o=i.i18n[n]]=this.clienttranslate_string(i[o]);for(o in i)"i18n"!=o&&"object"==typeof i[o]&&null!==i[o]&&void 0!==i[o].log&&void 0!==i[o].args&&(i[o]=this.format_string_recursive(i[o].log,i[o].args));try{a=e.string.substitute(s,i)}catch(r){void 0===this.prevent_error_rentry&&(this.prevent_error_rentry=0);this.prevent_error_rentry++;const e=`Invalid or missing substitution argument for log message: ${s}: ${r.message}`;this.prevent_error_rentry>=10?console.error("Preventing error rentry => ABORTING"):this.showMessage(e,"error");this.prevent_error_rentry--;console.error(e);a=s}}void 0!==i.type&&("chatmessage"==i.type||"tablechat"==i.type||"privatechat"==i.type||"groupchat"==i.type)||void 0!==i.message&&"${player_name} ${message}"==t||void 0!==i.text&&"${player_name} ${text}"==t||(a=this.applyGenderRegexps(a));return a},applyGenderRegexps:function(t,i){var a=bgaConfig.genderRegexps[e.config.locale.substr(0,2)];if(void 0!==a){var n=a.forMasculine;if(void 0!==n){var o=!1;if(void 0!==i&&1==parseInt(i))o=!0;else for(var s=0;s<this.gameMasculinePlayers.length;s++)t.match(new RegExp(">"+this.gameMasculinePlayers[s]+"<"))&&(o=!0);if(o)for(var r=Object.keys(n),l=Object.values(n),d=0;d<r.length;d++)t=t.replace(new RegExp(replaceAll(r[d],"~",""),"g"),l[d])}var c=a.forFeminine;if(void 0!==c){o=!1;if(void 0!==i&&0==parseInt(i))o=!0;else for(s=0;s<this.gameFemininePlayers.length;s++)t.match(new RegExp(">"+this.gameFemininePlayers[s]+"<"))&&(o=!0);if(o)for(r=Object.keys(c),l=Object.values(c),d=0;d<r.length;d++)t=t.replace(new RegExp(replaceAll(r[d],"~",""),"g"),l[d])}var u=a.forNeutral;if(void 0!==u){o=!1;if(void 0!==i&&null===i)o=!0;else for(s=0;s<this.gameNeutralPlayers.length;s++)t.match(new RegExp(">"+this.gameNeutralPlayers[s]+"<"))&&(o=!0);if(o)for(r=Object.keys(u),l=Object.values(u),d=0;d<r.length;d++)t=t.replace(new RegExp(replaceAll(r[d],"~",""),"g"),l[d])}}return t},clienttranslate_string:function(e){var t=_(e);return t==e?__("lang_mainsite",e):t},register_subs:function(e){this.subscriptions.push(e)},register_centrifuge_subs:function(e){this.comet_subscriptions.push(e);return e},unsubscribe_all:function(){this.subscriptions;this.comet_subscriptions;for(var t=null;this.subscriptions.length>0;){t=this.subscriptions.shift();e.unsubscribe(t)}for(;this.comet_subscriptions.length>0;){sub_id=this.comet_subscriptions.shift();g_sitecore.unsubscribeCentrifugeChannel(sub_id)}},showMessage:function(e,t){g_sitecore.showMessage(e,t)},placeOnObject:function(e,t){this.placeOnObjectPos(e,t,0,0)},placeOnObjectPos:function(t,i,a,n){null===t&&console.error("placeOnObject: mobile obj is null");null===i&&console.error("placeOnObject: target obj is null");if("string"==typeof t)var o=$(t);else o=t;var s=this.disable3dIfNeeded(),r=e.position(i),l=e.position(t),d=e.style(t,"left"),c=e.style(t,"top"),u={x:(r.x-l.x+(r.w-l.w)/2)/this.gameinterface_boundingRectZoom+a,y:(r.y-l.y+(r.h-l.h)/2)/this.gameinterface_boundingRectZoom+n},h=this.getAbsRotationAngle(o.parentNode),p=this.vector_rotate(u,h);d+=p.x;c+=p.y;e.style(t,"top",c+"px");e.style(t,"left",d+"px");this.enable3dIfNeeded(s)},disable3dIfNeeded:function(){if(e.hasClass("ebd-body","mode_3d")){e.removeClass("ebd-body","enableTransitions");var t=$("game_play_area").style.transform;e.removeClass("ebd-body","mode_3d");e.style("game_play_area","transform","rotatex(0deg) translate(0px,0px) rotateZ(0deg)");return t}return null},enable3dIfNeeded:function(t){if(null!==t){e.style("game_play_area","transform",t);e.addClass("ebd-body","mode_3d")}},disableZoomIfNeeded:function(){const e=document.getElementById("overall-content").style.getPropertyValue("--bga-game-zoom"),t=""===e?1:Number(e);1!==t&&document.getElementById("overall-content").style.setProperty("--bga-game-zoom","1");return t},enableZoomIfNeeded:function(e){1!==e&&document.getElementById("overall-content").style.setProperty("--bga-game-zoom",`${e}`)},getComputedTranslateZ:function(e){if(window.getComputedStyle){var t=getComputedStyle(e),i=(t.transform||t.webkitTransform||t.mozTransform).match(/^matrix3d\((.+)\)$/);return i?~~i[1].split(", ")[14]:0}},transformSlideAnimTo3d:function(t,i,a,n,o,s){if(e.hasClass("ebd-body","mode_3d")){if(void 0===o||void 0===s)var r=50;else{var l=Math.sqrt(o*o+s*s);r=Math.max(20,Math.min(80,Math.round(l/2)))}var d=this.getComputedTranslateZ(i);null==a&&(a=500);null==n&&(n=0);"string"==typeof i&&(i=$(i));var c=new e.Animation({curve:[d,d+r],delay:n,duration:a/2,onAnimate:e.hitch(this,function(e){i.style.transform="translateZ("+e+"px)"})}),u=new e.Animation({curve:[d+r,d],delay:n+a/2,duration:a/2,onAnimate:e.hitch(this,function(e){i.style.transform="translateZ("+e+"px)"})}),h=e.fx.combine([t,c,u]);h._pseudoAnimation&&(h._pseudoAnimation.node=t.node);return h}return t},slideToObject:function(t,i,a,n){null===t&&console.error("slideToObject: mobile obj is null");null===i&&console.error("slideToObject: target obj is null");if("string"==typeof t)var o=$(t);else o=t;var s=this.disable3dIfNeeded(),r=e.position(i),l=e.position(t);void 0===a&&(a=500);void 0===n&&(n=0);if(this.instantaneousMode){n=Math.min(1,n);a=Math.min(1,a)}var d=e.style(t,"left"),c=e.style(t,"top"),u={x:r.x-l.x+(r.w-l.w)/2,y:r.y-l.y+(r.h-l.h)/2},h=this.getAbsRotationAngle(o.parentNode),p=this.vector_rotate(u,h);d+=p.x/this.gameinterface_boundingRectZoom;c+=p.y/this.gameinterface_boundingRectZoom;this.enable3dIfNeeded(s);var _=e.fx.slideTo({node:t,top:c,left:d,delay:n,duration:a,unit:"px"});null!==s&&(_=this.transformSlideAnimTo3d(_,o,a,n,p.x,p.y));return _},slideToObjectPos:function(t,i,a,n,o,s){null===t&&console.error("slideToObjectPos: mobile obj is null");null===i&&console.error("slideToObjectPos: target obj is null");null===a&&console.error("slideToObjectPos: target x is null");null===n&&console.error("slideToObjectPos: target y is null");if("string"==typeof t)var r=$(t);else r=t;var l=this.disable3dIfNeeded(),d=e.position(i),c=e.position(t);void 0===o&&(o=500);void 0===s&&(s=0);if(this.instantaneousMode){s=Math.min(1,s);o=Math.min(1,o)}var u=e.style(t,"left"),h=e.style(t,"top"),p={x:(d.x-c.x)/(this.gameinterface_boundingRectZoom??1)+toint(a),y:(d.y-c.y)/(this.gameinterface_boundingRectZoom??1)+toint(n)},_=this.getAbsRotationAngle(r.parentNode),m=this.vector_rotate(p,_);u+=m.x;h+=m.y;this.enable3dIfNeeded(l);var g=e.fx.slideTo({node:t,top:h,left:u,delay:s,duration:o,easing:e.fx.easing.cubicInOut,unit:"px"});null!==l&&(g=this.transformSlideAnimTo3d(g,r,o,s,m.x,m.y));return g},toRadians:function(e){return e*(Math.PI/180)},vector_rotate:function(e,t){if(0==t)return e;var i=-this.toRadians(t);return{x:e.x*Math.cos(i)-e.y*Math.sin(i),y:e.x*Math.sin(i)+e.y*Math.cos(i)}},attachToNewParent:function(t,i,a){"string"==typeof t&&(t=$(t));"string"==typeof i&&(i=$(i));void 0===a&&(a="last");null===t&&console.error("attachToNewParent: mobile obj is null");null===i&&console.error("attachToNewParent: new_parent is null");var n=this.disable3dIfNeeded(),o=e.position(t),s=this.getAbsRotationAngle(t),r=e.clone(t);e.destroy(t);e.place(r,i,a);var l=e.position(r),d=e.style(r,"left"),c=e.style(r,"top"),u=this.getAbsRotationAngle(r),h=this.getAbsRotationAngle(i),p={x:o.x-l.x+(o.w-l.w)/2,y:o.y-l.y+(o.h-l.h)/2},_=this.vector_rotate(p,h);d+=_.x/this.gameinterface_boundingRectZoom;c+=_.y/this.gameinterface_boundingRectZoom;e.style(r,"top",c+"px");e.style(r,"left",d+"px");u!=s&&this.rotateInstantDelta(r,s-u);this.enable3dIfNeeded(n);return r},attachToNewParentNoReplace:function(t,i,a){"string"==typeof t&&(t=$(t));"string"==typeof i&&(i=$(i));void 0===a&&(a="last");null===t&&console.error("attachToNewParent: mobile obj is null");null===i&&console.error("attachToNewParent: new_parent is null");var n=e.clone(t);e.destroy(t);e.place(n,i,a);return n},fadeOutAndDestroy:function(t,i,a){void 0===i&&(i=500);void 0===a&&(a=0);this.instantaneousMode&&(i=Math.min(1,i));const n=e.fadeOut({node:t,duration:i,delay:a});n.promise=new Promise(t=>{e.connect(n,"onEnd",i=>{e.destroy(i);t()});n.play()});return n},rotateInstantTo:function(t,i){"string"==typeof t&&(t=$(t));i=tofloat(i);var a=0;void 0!==this.rotateToPosition[t.id]&&(a=this.rotateToPosition[t.id]);if(i!=a){var n;e.forEach(["transform","WebkitTransform","msTransform","MozTransform","OTransform"],function(t){void 0!==e.body().style[t]&&(n=t)});this.transform=n;e.style(t,this.transform,"rotate("+i+"deg)");this.rotateToPosition[t.id]=i}},rotateInstantDelta:function(e,t){"string"==typeof e&&(e=$(e));t=tofloat(t);void 0!==this.rotateToPosition[e.id]?this.rotateInstantTo(e,this.rotateToPosition[e.id]+t):this.rotateInstantTo(e,t)},rotateTo:function(t,i){"string"==typeof t&&(t=$(t));i=tofloat(i);var a;e.forEach(["transform","WebkitTransform","msTransform","MozTransform","OTransform"],function(t){void 0!==e.body().style[t]&&(a=t)});this.transform=a;var n=0;void 0!==this.rotateToPosition[t.id]&&(n=this.rotateToPosition[t.id]);if(i==n)return;for(;i>n+180;)i-=360;for(;i<n-180;)i+=360;this.rotateToPosition[t.id]=i;const o=new e.Animation({curve:[n,i],onAnimate:e.hitch(this,function(e){t.style[this.transform]="rotate("+e+"deg)"})});o.promise=new Promise(t=>{e.connect(o,"onEnd",()=>t());o.play()});return o},getAbsRotationAngle:function(e){var t=0;"string"==typeof e&&(e=$(e));if(null===e)return 0;if(void 0!==e.id){void 0!==this.rotateToPosition[e.id]&&(t=this.rotateToPosition[e.id]);if("overall-content"==typeof e.id)return 0}return void 0!==e.parentNode?t+this.getAbsRotationAngle(e.parentNode):0},connect:function(t,i,a){null!=t&&this.connections.push({element:t,event:i,handle:e.connect(t,i,this,a)})},disconnect:function(t,i){e.forEach(this.connections,function(a){a.element==t&&a.event==i&&e.disconnect(a.handle)})},connectClass:function(e,t,i){this.connectQuery("."+e,t,i)},connectQuery:function(t,i,a){for(var n=e.query(t),o=0;o<n.length;o++){var s=n[o];this.connections.push({element:s,event:i,handle:e.connect(s,i,this,a)})}},getHtmlFromTooltipinfos:function(e,t){var i='<div class="midSizeDialog">';if(""!=e){i+="<img class='imgtext' src='"+getStaticAssetUrl("img/layout/help_info.png")+"' alt='info' /> <span class='tooltiptext'>"+e+"</span>";""!=t&&(i+="<br/>")}""!=t&&(i+="<img class='imgtext' src='"+getStaticAssetUrl("img/layout/help_click.png")+"' alt='action' /> <span class='tooltiptext'>"+t+"</span>");return i+="</div>"},addTooltip:function(t,i,a,n){"string"!=typeof t&&console.error("Call addTooltip with an id that is not a string !");this.tooltips[t]&&this.tooltips[t].destroy();var o=400;void 0!==n&&(o=n);this.tooltips[t]=new dijit.Tooltip({connectId:[t],label:this.getHtmlFromTooltipinfos(i,a),showDelay:o});this.bHideTooltips&&(this.tooltips[t].onShow=e.hitch(this.tooltips[t],function(){this.close()}));e.connect($(t),"onclick",this.tooltips[t],"close");this.tooltipsInfos[t]={hideOnHoverEvt:null};e.connect(this.tooltips[t],"_onHover",e.hitch(this,function(){null===this.tooltipsInfos[t].hideOnHoverEvt&&$("dijit__MasterTooltip_0")&&(this.tooltipsInfos[t].hideOnHoverEvt=e.connect($("dijit__MasterTooltip_0"),"onmouseenter",this.tooltips[t],"close"))}))},addTooltipHtml:function(t,i,a){i='<div class="midSizeDialog">'+i+"</div>";this.tooltips[t]&&this.tooltips[t].destroy();var n=400;void 0!==a&&(n=a);this.tooltips[t]=new dijit.Tooltip({connectId:[t],label:i,position:this.defaultTooltipPosition,showDelay:n});this.bHideTooltips&&(this.tooltips[t].onShow=e.hitch(this.tooltips[t],function(){this.close()}));e.connect($(t),"onclick",this.tooltips[t],"close");this.tooltipsInfos[t]={hideOnHoverEvt:null};e.connect(this.tooltips[t],"_onHover",e.hitch(this,function(){null===this.tooltipsInfos[t].hideOnHoverEvt&&$("dijit__MasterTooltip_0")&&(this.tooltipsInfos[t].hideOnHoverEvt=e.connect($("dijit__MasterTooltip_0"),"onmouseenter",this.tooltips[t],"close"))}))},switchDisplayTooltips:function(t){this.bHideTooltips=0!=t;if(this.bHideTooltips)for(var i in this.tooltips)this.tooltips[i].onShow=e.hitch(this.tooltips[i],function(){this.close()});else for(var i in this.tooltips)this.tooltips[i].onShow=function(){}},addTooltipToClass:function(t,i,a,n){"."==t[0]&&(t=t.substr(1));for(var o=e.query("."+t),s=0;s<o.length;s++){""==o[s].id&&(o[s].id=dojox.uuid.generateRandomUuid());this.addTooltip(o[s].id,i,a,n)}},addTooltipHtmlToClass:function(t,i,a){"."==t[0]&&(t=t.substr(1));for(var n=e.query("."+t),o=0;o<n.length;o++)""!=n[o].id?this.addTooltipHtml(n[o].id,i,a):console.error("Add tooltip to an element with no id during addTooltipToClass "+t)},applyCommentMarkup:function(e){e=e.replace(/\*(.*?)\*/g,"<b>$1</b>");e=replaceAll(e,"---","<hr/>");e=replaceAll(e,"[red]","<span style='color:red'>");e=replaceAll(e,"[/red]","</span>");e=replaceAll(e,"[green]","<span style='color:green'>");e=replaceAll(e,"[/green]","</span>");e=replaceAll(e,"[blue]","<span style='color:blue'>");e=replaceAll(e,"[/blue]","</span>");e=replaceAll(e,"!!!","<i class='fa  fa-exclamation-triangle'></i>");return e=replaceAll(e,"[tip]","<i class='fa  fa-lightbulb-o'></i>")},confirmationDialog:function(t,i,a,n){void 0===n&&(n=null);void 0===this.confirmationDialogUid&&(this.confirmationDialogUid=0);void 0===this.confirmationDialogUid_called&&(this.confirmationDialogUid_called=0);this.confirmationDialogUid++;var o=new ebg.popindialog;o.create("confirmation_dialog_"+this.confirmationDialogUid,null!==$("main-content")?"main-content":"left-side");o.setTitle(__("lang_mainsite","Are you sure ?"));o.setMaxWidth(500);var s="<div id='confirmation_dialog_"+this.confirmationDialogUid+"'>";s+=t;s+="<br/><br/><div style='text-align: center;'>";s+="<a class='bgabutton bgabutton_gray' id='infirm_btn_"+this.confirmationDialogUid+"' href='#'><span>"+__("lang_mainsite","Please, no")+"</span></a> &nbsp; ";s+="<a class='bgabutton bgabutton_blue' id='confirm_btn_"+this.confirmationDialogUid+"' href='#'><span>"+__("lang_mainsite","I confirm")+"</span></a>";s+="</div></div>";o.setContent(s);o.hideCloseIcon();o.show();e.connect($("confirm_btn_"+this.confirmationDialogUid),"onclick",this,function(e){e.preventDefault();o.destroy();if(this.confirmationDialogUid_called==this.confirmationDialogUid);else{this.confirmationDialogUid_called=this.confirmationDialogUid;i(n)}});e.connect($("infirm_btn_"+this.confirmationDialogUid),"onclick",this,function(e){e.preventDefault();o.destroy();if(null!=a)if(this.confirmationDialogUid_called==this.confirmationDialogUid);else{this.confirmationDialogUid_called=this.confirmationDialogUid;a(n)}})},warningDialog:function(t,i){var a=new ebg.popindialog;a.create("warning_dialog");a.setTitle(__("lang_mainsite","Warning notice"));var n="<div id='warning_dialog'>";n+=t;n+="<br/><br/><div style='text-align: center'>";n+="<a class='bgabutton bgabutton_blue' id='warning_btn' href='#'><span>"+__("lang_mainsite","Duly noted!")+"</span></a>";n+="</div></div>";a.setContent(n);a.show();e.connect($("warning_btn"),"onclick",this,function(e){e.preventDefault();a.destroy();i()})},infoDialog:function(t,a,n,o=!1){if(o)i.bgaConfirm({title:a,description:t,noButton:!1,yesButton:_("Ok")}).then(n);else{var s=new ebg.popindialog;s.create("info_dialog");s.setTitle(a);var r="<div id='info_dialog'>";r+=t;r+="<br/><br/><div style='text-align: center'>";r+="<a class='bgabutton bgabutton_blue' id='info_btn' href='#'><span>"+__("lang_mainsite","Ok")+"</span></a>";r+="</div></div>";s.setContent(r);s.show();e.connect($("info_btn"),"onclick",this,function(e){e.preventDefault();s.destroy();void 0!==n&&n()})}},askForValueDialog:function(t,i,a){var n=new ebg.popindialog;n.create("askforvalue_dialog");n.setTitle(t);void 0===a&&(a="");var o="<div id='askforvalue_dialog'>";o+="<p>"+a+"</p>";o+="<br/><input id='choicedlg_value' type='text' style='width:100%;height:30px'>";o+="<br/>";o+="<a class='bgabutton bgabutton_blue' id='ok_btn' href='#'><span>"+__("lang_mainsite","Ok")+"</span></a>";o+="</div>";n.setContent(o);n.show();$("choicedlg_value").focus();var s=function(t){e.stopEvent(t);n.destroy();var a=$("choicedlg_value").value;i(a)};e.connect($("choicedlg_value"),"onkeyup",this,e.hitch(this,function(e){"Enter"===e.key&&s(e)}));e.connect($("ok_btn"),"onclick",this,e.hitch(this,s))},getRankString:function(e,t){if(null===e||""===e)return __("lang_mainsite","not ranked");var i="";1==(e=toint(e))?i=void 0!==t&&t?__("lang_mainsite","Winner"):__("lang_mainsite","1st"):2==e?i=void 0!==t&&t?__("lang_mainsite","Loser"):__("lang_mainsite","2nd"):3==e?i=void 0!==t&&t?__("lang_mainsite","Loser"):__("lang_mainsite","3rd"):e>3&&(i=void 0!==t&&t?__("lang_mainsite","Loser"):e+__("lang_mainsite","th"));return i},getKarmaLabel:function(e){return 100==(e=toint(e))?{label:_("Perfect"),css:"exceptional"}:e>=90?{label:_("Excellent"),css:"perfect"}:e>=80?{label:_("Very good"),css:"verygood"}:e>=75?{label:_("Good"),css:"good"}:e>=65?{label:_("Average"),css:"average"}:e>=50?{label:_("Not good"),css:"notgood"}:e>=25?{label:_("Bad"),css:"bad"}:e>=0?{label:_("Very bad"),css:"verybad"}:void 0},getObjectLength:function(e){var t=0;for(var i in e)t++;return t},getGameNameDisplayed:function(e){var t=__("lang_mainsite",e+"_displayed");return t==e+"_displayed"?e:t},formatReflexionTime:function(e){var t={string:"-- : --",mn:0,s:0,h:0,positive:!0},i=!0;if((e=Math.round(e))<0){e=-e;i=!1}var a=Math.floor(e/60),n=e-60*a;n<10&&(n="0"+n);var o=Math.floor(a/60),s=Math.floor(a/1440);a-=60*o;t.mn=a;t.s=n;t.h=o;t.positive=i;if(isNaN(a)||isNaN(n))t.string="-- : --";else if(0==o)t.string=i?a+":"+n:"-"+a+":"+n;else if(s<2){a<10&&(a="0"+a);t.string=i?o+"h"+a:"-"+o+"h"+a}else t.string=i?s+" "+__("lang_mainsite","days"):"-"+s+" "+__("lang_mainsite","days");return t},strip_tags:function(e,t){var i="",a=!1,n=[],o=[],s="",r=0,l="",d="",c=function(e,t,i){return i.split(e).join(t)};t&&(o=t.match(/([a-zA-Z0-9]+)/gi));n=(e+="").match(/(<\/?[\S][^>]*>)/gi);for(i in n)if(!isNaN(i)){d=n[i].toString();a=!1;for(l in o){s=o[l];(r=-1)&&(r=d.toLowerCase().indexOf("<"+s+">"));r||(r=d.toLowerCase().indexOf("<"+s+" "));r&&(r=d.toLowerCase().indexOf("</"+s));if(!r){a=!0;break}}a||(e=c(d,"",e))}return e},validURL:function(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)},nl2br:function(e,t){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(t||void 0===t?"":"<br>")+"$2")},htmlentities:function(e,t,i,a){var n=this.get_html_translation_table("HTML_ENTITIES",t),o="";e=null==e?"":e+"";if(!n)return!1;t&&"ENT_QUOTES"===t&&(n["'"]="&#039;");if(a||null==a)for(o in n)n.hasOwnProperty(o)&&(e=e.split(o).join(n[o]));else e=e.replace(/([\s\S]*?)(&(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g,function(e,t,i){for(o in n)n.hasOwnProperty(o)&&(t=t.split(o).join(n[o]));return t+i});return e},html_entity_decode:function(e,t){var i={},a="",n="",o="";n=e.toString();if(!1===(i=this.get_html_translation_table("HTML_ENTITIES",t)))return!1;delete i["&"];i["&"]="&amp;";for(a in i){o=i[a];n=n.split(o).join(a)}return n=n.split("&#039;").join("'")},get_html_translation_table:function(e,t){var i,a,n,o={},s={},r={},l={};r[0]="HTML_SPECIALCHARS";r[1]="HTML_ENTITIES";l[0]="ENT_NOQUOTES";l[2]="ENT_COMPAT";l[3]="ENT_QUOTES";a=isNaN(e)?e?e.toUpperCase():"HTML_SPECIALCHARS":r[e];n=isNaN(t)?t?t.toUpperCase():"ENT_COMPAT":l[t];if("HTML_SPECIALCHARS"!==a&&"HTML_ENTITIES"!==a)throw new Error("Table: "+a+" not supported");o[38]="&amp;";if("HTML_ENTITIES"===a){o[160]="&nbsp;";o[161]="&iexcl;";o[162]="&cent;";o[163]="&pound;";o[164]="&curren;";o[165]="&yen;";o[166]="&brvbar;";o[167]="&sect;";o[168]="&uml;";o[169]="&copy;";o[170]="&ordf;";o[171]="&laquo;";o[172]="&not;";o[173]="&shy;";o[174]="&reg;";o[175]="&macr;";o[176]="&deg;";o[177]="&plusmn;";o[178]="&sup2;";o[179]="&sup3;";o[180]="&acute;";o[181]="&micro;";o[182]="&para;";o[183]="&middot;";o[184]="&cedil;";o[185]="&sup1;";o[186]="&ordm;";o[187]="&raquo;";o[188]="&frac14;";o[189]="&frac12;";o[190]="&frac34;";o[191]="&iquest;";o[192]="&Agrave;";o[193]="&Aacute;";o[194]="&Acirc;";o[195]="&Atilde;";o[196]="&Auml;";o[197]="&Aring;";o[198]="&AElig;";o[199]="&Ccedil;";o[200]="&Egrave;";o[201]="&Eacute;";o[202]="&Ecirc;";o[203]="&Euml;";o[204]="&Igrave;";o[205]="&Iacute;";o[206]="&Icirc;";o[207]="&Iuml;";o[208]="&ETH;";o[209]="&Ntilde;";o[210]="&Ograve;";o[211]="&Oacute;";o[212]="&Ocirc;";o[213]="&Otilde;";o[214]="&Ouml;";o[215]="&times;";o[216]="&Oslash;";o[217]="&Ugrave;";o[218]="&Uacute;";o[219]="&Ucirc;";o[220]="&Uuml;";o[221]="&Yacute;";o[222]="&THORN;";o[223]="&szlig;";o[224]="&agrave;";o[225]="&aacute;";o[226]="&acirc;";o[227]="&atilde;";o[228]="&auml;";o[229]="&aring;";o[230]="&aelig;";o[231]="&ccedil;";o[232]="&egrave;";o[233]="&eacute;";o[234]="&ecirc;";o[235]="&euml;";o[236]="&igrave;";o[237]="&iacute;";o[238]="&icirc;";o[239]="&iuml;";o[240]="&eth;";o[241]="&ntilde;";o[242]="&ograve;";o[243]="&oacute;";o[244]="&ocirc;";o[245]="&otilde;";o[246]="&ouml;";o[247]="&divide;";o[248]="&oslash;";o[249]="&ugrave;";o[250]="&uacute;";o[251]="&ucirc;";o[252]="&uuml;";o[253]="&yacute;";o[254]="&thorn;";o[255]="&yuml;"}"ENT_NOQUOTES"!==n&&(o[34]="&quot;");"ENT_QUOTES"===n&&(o[39]="&#39;");o[60]="&lt;";o[62]="&gt;";for(i in o)o.hasOwnProperty(i)&&(s[String.fromCharCode(i)]=o[i]);return s},ucFirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},setupWebPush:function(){null==this.webpush&&(this.webpush=new ebg.webpush(e.hitch(this,"ajaxcall")));return this.webpush.init()},refreshWebPushWorker:function(){null==this.webpush&&(this.webpush=new ebg.webpush(e.hitch(this,"ajaxcall")));this.webpush.isSupported()&&this.webpush.refresh()},getRTCTemplate:function(e,t,i){var a='<div id="rtc_container_${player_id}" class="rtc_container';if(!e&&!t)return a+'"></div>';t?a+=' rtc_video_container"><div id="videofeed_${player_id}_pulse"></div>'+(i?'<video id="videofeed_${player_id}" class="videofeed" autoplay ${muted}></video>':'<video id="videofeed_${player_id}" class="videofeed videoflipped" autoplay ${muted}></video>')+'<div id="videofeed_${player_id}_name" class="rtc_video_name"></div><div id="videofeed_${player_id}_min" class="rtc_video_control rtc_video_min"></div><div id="videofeed_${player_id}_size" class="rtc_video_control rtc_video_size"></div><div id="videofeed_${player_id}_cam" class="rtc_video_control rtc_video_cam rtc_video_cam_off"></div>':e&&(a+=' rtc_audio_container"><video id="videofeed_${player_id}" class="videofeed" autoplay ${muted}></video>');e&&(a+=i?'<div id="videofeed_${player_id}_spk" class="rtc_video_control rtc_video_spk rtc_video_spk_off"></div>':'<div id="videofeed_${player_id}_mic" class="rtc_video_control rtc_video_mic rtc_video_mic_off"></div>');return a+="</div>"},setupRTCEvents:function(t){var i="undefined"!=typeof current_player_id?current_player_id:this.player_id;if(!1!==this.mediaConstraints.video){e.connect($("rtc_container_"+t),"onclick",this,"onClickRTCVideoMax");e.connect($("videofeed_"+t+"_min"),"onclick",this,"onClickRTCVideoMin");e.connect($("videofeed_"+t+"_size"),"onclick",this,"onClickRTCVideoSize");e.connect($("videofeed_"+t+"_cam"),"onclick",this,"onClickRTCVideoCam");this.addTooltip("videofeed_"+t+"_min","",__("lang_mainsite","Minimize video"));this.addTooltip("videofeed_"+t+"_size","",__("lang_mainsite","Resize video"));t==i?this.addTooltip("videofeed_"+t+"_cam","",__("lang_mainsite","Mute/Unmute your video camera")):this.addTooltip("videofeed_"+t+"_cam","",__("lang_mainsite","Mute/Unmute video"));if($("player_name_"+t)){var a=e.getStyle("player_name_"+t,"color");e.setStyle("videofeed_"+t+"_pulse","borderColor",a);e.setStyle("rtc_container_"+t,"borderColor",a);e.setStyle("rtc_container_"+t,"boxShadow","0px 0px 3px "+a)}if($("player_name_"+t)){a=e.getStyle("player_name_"+t,"color");e.setStyle("videofeed_"+t+"_name","color",a);for(var n="",o=$("player_name_"+t),s=0;s<o.childNodes.length;++s)3===o.childNodes[s].nodeType&&(n+=o.childNodes[s].textContent);$("videofeed_"+t+"_name").innerHTML=n}if($("emblem_"+t)){n=e.getAttr($("emblem_"+t),"alt");$("videofeed_"+t+"_name").innerHTML=n}if(!e.hasClass("ebd-body","mobile_version")){(new ebg.draggable).create(this,"rtc_container_"+t)}}if(!1!==this.mediaConstraints.audio){if(null!=$("videofeed_"+t+"_mic")){e.connect($("videofeed_"+t+"_mic"),"onclick",this,"onClickRTCVideoMic");this.addTooltip("videofeed_"+t+"_mic","",__("lang_mainsite","Mute/Unmute your microphone"))}if(null!=$("videofeed_"+t+"_spk")){e.connect($("videofeed_"+t+"_spk"),"onclick",this,"onClickRTCVideoSpk");this.addTooltip("videofeed_"+t+"_spk","",__("lang_mainsite","Mute/Unmute audio"))}}},getRtcVideoConstraints:function(e){var t=!1;if(2===parseInt(e,10))t={mandatory:{minAspectRatio:1.333,maxAspectRatio:1.334,maxWidth:240,maxFrameRate:30},optional:[]};return t},startRTC:function(){!1===this.mediaConstraints.video&&!1===this.mediaConstraints.audio||require([g_themeurl+"js/webrtcadapter.js"],e.hitch(this,"doStartRTC"))},doStartRTC:function(){this.ajaxcall("/videochat/videochat/getRTCConfig.html",{},this,function(t){var i="undefined"!=typeof current_player_id?current_player_id:this.player_id;if(null!==$("videofeed_"+i)){webrtcConfig.audioSendCodec="";webrtcConfig.audioReceiveCodec="opus/48000";var a=JSON.parse(JSON.stringify(webrtcConfig.pcConfig));void 0!==t.static_turn&&void 0!==t.static_turn.urls&&""!==t.static_turn.urls&&a.iceServers.push(t.static_turn);if(void 0!==t.dynamic_iceservers)try{dynamicConfig=JSON.parse(t.dynamic_iceservers);"ok"===dynamicConfig.s?a=dynamicConfig.v:alert("Error: failed to retrieve RTC ICE servers dynamic configuration")}catch(n){alert("Error: failed to parse RTC ICE servers dynamic configuration")}this.webrtc=new ebg.webrtc(i,this.room,a,webrtcConfig.pcConstraints,this.mediaConstraints,!1,e.hitch(this,"ajaxcall"),e.hitch(this,"onGetUserMediaSuccess"),e.hitch(this,"onGetUserMediaError"),e.hitch(this,"onJoinRoom"),e.hitch(this,"onLeaveRoomImmediate"));this.webrtc.setLocalFeed($("videofeed_"+i));null===this.webrtcmsg_ntf_handle&&(this.webrtcmsg_ntf_handle=e.subscribe("webrtcmsg",this,"ntf_webrtcmsg"))}},function(e){})},onGetUserMediaSuccess:function(){if(null!==this.room){window.onbeforeunload=e.hitch(this,function(e){null!==this.room&&this.doLeaveRoom()});var t="undefined"!=typeof current_player_id?current_player_id:this.player_id;if(null!=$("videofeed_"+t+"_mic")){e.addClass($("videofeed_"+t+"_mic"),"rtc_video_mic_on");e.removeClass($("videofeed_"+t+"_mic"),"rtc_video_mic_off")}if(null!=$("videofeed_"+t+"_cam")){e.addClass($("videofeed_"+t+"_cam"),"rtc_video_cam_on");e.removeClass($("videofeed_"+t+"_cam"),"rtc_video_cam_off")}this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,function(t){if(1==t.videochat_terms_accepted)if(t.already_in||t.joined)for(var i=0;i<t.in_room.length;i++){var a=t.in_room[i];this.onJoinRoom(a,!1)}else if(this.room===this.already_accepted_room)this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,accept:!0,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,function(e){this.already_accepted_room=null;for(var t=0;t<e.in_room.length;t++){var i=e.in_room[t];this.onJoinRoom(i,!1)}},function(e){});else{var n='<div  class="rtc_dialog"><br />';n+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+(!1!==this.mediaConstraints.video?this.room.indexOf("T")>=0?__("lang_mainsite","A Premium user has set up a video chat session for this table!"):__("lang_mainsite","A Premium user has set up a video chat session with you!"):this.room.indexOf("T")>=0?__("lang_mainsite","A Premium user has set up an audio chat session for this table!"):__("lang_mainsite","A Premium user has set up an audio chat session with you!"))+"</i></div><br /><br />";n+='<div style="text-align: center; font-weight: bold;">'+__("lang_mainsite","Do you want to join the call?")+"</div><br /><br />";this.room.indexOf("T")>=0&&(n+=__("lang_mainsite",'If you choose "no" then change your mind, just refresh the page (F5) to get this prompt again!'));n+="</div>";this.confirmationDialog(n,e.hitch(this,function(){null!==this.room&&this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,accept:!0,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,function(e){for(var t=0;t<e.in_room.length;t++){var i=e.in_room[t];this.onJoinRoom(i,!1)}},function(e){})}),e.hitch(this,function(){if(null!==this.room&&this.room.indexOf("T")>=0)this.doLeaveRoom();else if(null!==this.room&&this.room.indexOf("P")>=0){var e=this.room.substr(1).split("_"),t=e[0]==a?e[1]:e[0];this.mediaConstraints.video?this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:t},this,function(e){this.doLeaveRoom()}):this.mediaConstraints.audio&&this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:t},this,function(e){this.doLeaveRoom()})}}))}else{n='<div  class="rtc_dialog"><br />';n+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+(!1!==this.mediaConstraints.video?this.room.indexOf("T")>=0?__("lang_mainsite","A Premium user has set up a video chat session for this table!"):__("lang_mainsite","A Premium user has set up a video chat session with you!"):this.room.indexOf("T")>=0?__("lang_mainsite","A Premium user has set up an audio chat session for this table!"):__("lang_mainsite","A Premium user has set up an audio chat session with you!"))+"</i></div><br /><br />";n+="<b>"+__("lang_mainsite","You are about to enter a real time chat room on Board Game Arena for the first time.")+"</b><br /><br />";n+=__("lang_mainsite","Please note that any interaction between players in a real time chat room is private to and the sole responsability of those players.")+"<br /><br />";n+=__("lang_mainsite","Board Game Arena doesn't record real time chat activity, but you should be aware that any player in the chat room has the possibility to make such recordings. Thus, you shouldn't do or say anything that you wouldn't want on record (or on Youtube).")+"<br /><br />";n+=__("lang_mainsite","You should also be aware that real time chat, be it voice or video, consumes more bandwidth than classic web browsing. It is your responsability to monitor your usage and check that it matches your contract with your internet provider so as not to incur unexpected fees.")+"<br /><br />";n+="<b>"+__("lang_mainsite","By accepting to proceed, you state that you are an adult according to the laws of your country or that you received explicit permission to use this service from an adult legally responsible for you, and you recognise and attest that Board Game Arena won't be liable for any inconvenience or damage directly or indirectly linked to the use of this service.")+"</b>";n+="</div>";this.confirmationDialog(n,e.hitch(this,function(){null!==this.room&&this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,accept:!0,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,function(e){for(var t=0;t<e.in_room.length;t++){var i=e.in_room[t];this.onJoinRoom(i,!1)}},function(e){})}),e.hitch(this,function(){this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,accept:!1,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,function(e){this.clearRTC()},function(e){})}))}},function(e){})}},onGetUserMediaError:function(){var e='<div class="rtc_dialog"><br />';e+="<b>"+__("lang_mainsite","Sorry, Board Game Arena failed to get access to your local camera/microphone...")+"</b><br /><br />";e+=__("lang_mainsite","If you denied authorisation by mistake, please refresh the page to start over.")+" ";e+=__("lang_mainsite","If that fails, you should check your browser permissions in your browser's <i>%s</i> local configuration.").replace("%s","")+"<br /><br />";e+=__("lang_mainsite","Otherwise, please check that your camera/microphone is correctly plugged in, and that you are using a WebRTC capable browser: ");e+='<a href="http://iswebrtcreadyyet.com/" target="_blank">http://iswebrtcreadyyet.com/</a>';e+="</div>";this.warningDialog(e,function(){})},onJoinRoom:function(t,i){null==this.webrtc||this.webrtc.isInRoom(t)||this.webrtc.addToRoom(t);if(this.webrtc.room.indexOf("T")>=0)if(null!==$("rtc_container_"+t)||null===$("emblem_"+t)&&null===$("rtc_placeholder_"+t)){if(null!=$("videofeed_"+t+"_mic")){e.addClass($("videofeed_"+t+"_mic"),"rtc_video_mic_off");e.removeClass($("videofeed_"+t+"_mic"),"rtc_video_mic_on")}if(null!=$("videofeed_"+t+"_cam")){e.addClass($("videofeed_"+t+"_cam"),"rtc_video_cam_off");e.removeClass($("videofeed_"+t+"_cam"),"rtc_video_cam_on")}}else{e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!0),{player_id:t,muted:""}),null!==$("rtc_placeholder_"+t)?$("rtc_placeholder_"+t):$("table_rtc_placeholder"));null!==$("emblem_"+t)&&this.placeOnObject($("rtc_container_"+t),$("emblem_"+t));this.setupRTCEvents(t);void 0!==this.gamedatas&&t==this.gamedatas.gamestate.active_player&&$("videofeed_"+t+"_pulse")&&e.addClass("videofeed_"+t+"_pulse","rtc_video_pulsating")}else if(this.webrtc.room.indexOf("P")>=0&&null==$("rtc_container_"+t)&&null!==$("chatwindowlogs_zone_privatechat_"+t)){e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!0),{player_id:t,muted:""}),$("chatwindowlogs_privatechat_"+t));if(this.mediaConstraints.video)e.addClass($("rtc_container_"+t),"rtc_video_container_privatechat");else if(this.mediaConstraints.audio){e.style($("rtc_container_"+t),"top","-13px");e.style($("rtc_container_"+t),"left","110px")}this.setupRTCEvents(t)}this.webrtc.maybeConnect(t,i);this.webrtc.isAudioMuted&&this.webrtc.toggleAudioMute()},onClickRTCVideoMax:function(t){e.stopEvent(t);var i=t.currentTarget,a=i.id.split("_")[2];this.maximizeRTCVideo(i,a)},maximizeRTCVideo:function(t,i){if(e.hasClass(t,"rtc_video_container")){e.addClass(t,"rtc_video_container_free");e.removeClass(t,"rtc_video_container");var a=e.hasClass(t,"rtc_video_container_privatechat");if(void 0!==a&&a){e.addClass(t,"rtc_video_container_free_privatechat");e.removeClass(t,"rtc_video_container_privatechat");n=e.marginBox("videofeed_"+i);e.style(t,"width",n.w+"px");e.style(t,"height",n.h+"px")}else{var n=e.marginBox("videofeed_"+i);e.style(t,"width",n.w+"px");e.style(t,"height",n.h+"px")}$("rtc_placeholder_"+i)?e.style("rtc_placeholder_"+i,"zIndex",497):$("rtc_container_"+i)&&e.style("rtc_container_"+i,"zIndex",497);(new ebg.resizable).create(this,"videofeed_"+i,"videofeed_"+i+"_size",!0,!1,!0)}},onClickRTCVideoMin:function(t){e.stopEvent(t);var i=t.currentTarget.parentNode,a=i.id.split("_")[2],n=e.hasClass($("rtc_container_"+a).parentNode,"chatwindowlogs"),o=e.hasClass(i,"rtc_video_container_free_privatechat");e.addClass(i,"rtc_video_container");e.removeClass(i,"rtc_video_container_free");e.style(i,"width","");e.style(i,"height","");e.style(i,"left","");e.style(i,"top","");e.style($("videofeed_"+a),"width","");e.style($("videofeed_"+a),"height","");if(null===$("emblem_"+a)||n||o){if(n&&!o){e.style($("rtc_container_"+a),"top","-6px");e.style($("rtc_container_"+a),"left","115px")}}else this.placeOnObject($("rtc_container_"+a),$("emblem_"+a));null!==$("rtc_placeholder_"+a)?e.style("rtc_placeholder_"+a,"zIndex",""):$("rtc_container_"+a)&&e.style("rtc_container_"+a,"zIndex","");if(o){e.addClass(i,"rtc_video_container_privatechat");e.removeClass(i,"rtc_video_container_free_privatechat")}},onClickRTCVideoSize:function(t){e.stopEvent(t)},onClickRTCVideoMic:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1];if(this.webrtc.toggleAudioMute(i)){e.addClass(t.currentTarget,"rtc_video_mic_off");e.removeClass(t.currentTarget,"rtc_video_mic_on")}else{e.addClass(t.currentTarget,"rtc_video_mic_on");e.removeClass(t.currentTarget,"rtc_video_mic_off")}},onClickRTCVideoSpk:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1];if(this.webrtc.toggleAudioMute(i)){e.addClass(t.currentTarget,"rtc_video_spk_off");e.removeClass(t.currentTarget,"rtc_video_spk_on")}else{e.addClass(t.currentTarget,"rtc_video_spk_on");e.removeClass(t.currentTarget,"rtc_video_spk_off")}},onClickRTCVideoCam:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1];if(this.webrtc.toggleVideoMute(i)){e.addClass(t.currentTarget,"rtc_video_cam_off");e.removeClass(t.currentTarget,"rtc_video_cam_on")}else{e.addClass(t.currentTarget,"rtc_video_cam_on");e.removeClass(t.currentTarget,"rtc_video_cam_off")}},onLeaveRoom:function(t,i){if(null!=this.webrtc&&this.webrtc.isInRoom(t)){var a=$("rtc_container_"+t);if(!0===i)e.destroy(a);else{var n=e.fadeOut({node:a,duration:1e3,delay:500});e.connect(n,"onEnd",function(t){e.destroy(t)});n.play()}this.webrtc.removeFromRoom(t)}},onLeaveRoomImmediate:function(e){this.onLeaveRoom(e,!0)},doLeaveRoom:function(e){this.clearRTC();null!=this.room&&this.ajaxcall("/videochat/videochat/leaveRoom.html",{room:this.room,lock:!1},this,function(t){this.room=null;this.rtc_mode=0;this.mediaConstraints={video:!1,audio:!1};void 0!==e&&e()},function(e){})},clearRTC:function(){null!=this.webrtc&&this.webrtc.hangup();this.webrtc=null;e.unsubscribe(this.webrtcmsg_ntf_handle);this.webrtcmsg_ntf_handle=null;e.query(".rtc_container").forEach(function(t,i,a){e.destroy(t)});e.query(".audiovideo_active").removeClass("audiovideo_active").addClass("audiovideo_inactive")},ntf_webrtcmsg:function(e){null!=this.webrtc&&void 0!==e.args.message&&this.webrtc.onMessageReceived(e.args)},addSmileyToText:function(e){var t=this.emoticons,i=[],a=/[[\]{}()*+?.\\|^$\-,&#\s]/g;for(var n in t)t.hasOwnProperty(n)&&i.push("(( +|^)"+n.replace(a,"\\$&")+"( +|$|\\s))");return(e=e.replace(new RegExp(i.join("|"),"g"),function(e){var i=e.trim();return void 0!==t[i]?e.replace(i,'<div class="icon20_textalign"><div class="bgasmiley bgasmiley_'+t[i]+'"></div></div>'):e})).replace(new RegExp(i.join("|"),"g"),function(e){var i=e.trim();return void 0!==t[i]?e.replace(i,'<div class="icon20_textalign"><div class="bgasmiley bgasmiley_'+t[i]+'"></div></div>'):e})},getSmileyClassToCodeTable:function(){var e={};for(var t in this.emoticons)void 0===e[this.emoticons[t]]&&(e[this.emoticons[t]]=t);return e},makeClickableLinks:function(e,t){void 0===t&&(t=!0);if(t){if(-1!=e.indexOf("boardgamearena.com")){var i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*boardgamearena\.com[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;return this.makeBgaLinksLocalLinks(e.replace(i,'<a class="bga-link" href="$1">$1</a>'))}return this.makeBgaLinksLocalLinks(e)}var a=["yucata.de","boiteajeux","tabletopia","happymeeple","dominion.games","wakan.pl","boardspace.net","brettspielwelt.de","littlegolem.net","vassalengine.org","sovranti","interlude.games","game-park","playwithmeeps.com"],n=["hanab.live","hanabi.live","hanabi.cards","codenames.marplebot.com","longwave.web.app","setwithfriends.com","oneword.games","boredgames.gg","freeboardgames.org","colonist.io","turnhero.com","citadelsgame.herokuapp.com","berserk-games","tabletopsimulator.com"],o="normal";for(var s in a)-1!=e.toLowerCase().indexOf(a[s])&&(o="spam");for(var s in n)-1!=e.toLowerCase().indexOf(n[s])&&(o="spam_illegal");if("normal"==o){i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;return this.makeBgaLinksLocalLinks(e.replace(i,'<a href="$1" class="bga-link" target="_blank">$1</a>'))}if("spam"==o)return this.makeBgaLinksLocalLinks(e);if("spam_illegal"==o){e+="\n"+_("WARNING: this service is not approved by game designers/publishers. We strongly discourage you to use it or to promote it on BGA. Thanks!");return this.makeBgaLinksLocalLinks(e)}},makeBgaLinksLocalLinks:function(e){return e=(e=(e=(e=(e=(e=e.replace("forum.boardgamearena.com","SAVE_FORUM_URL_FROM_LOCAL")).replace("doc.boardgamearena.com","SAVE_DOC_URL_FROM_LOCAL")).replace(/(https?):\/\/[-a-zA-Z.]*boardgamearena\.com\//gim,"/")).replace(/((https?):\/\/)[-a-zA-Z.]*.([0-9].boardgamearena\.com)/gim,"$1$3")).replace("SAVE_FORUM_URL_FROM_LOCAL","forum.boardgamearena.com")).replace("SAVE_DOC_URL_FROM_LOCAL","doc.boardgamearena.com")},ensureEbgObjectReinit:function(e){"object"==typeof e&&null!==e&&void 0!==e.destroy&&e.destroy()},getRankClassFromElo:function(e){return 1300==(e=parseFloat(e))?__("lang_mainsite","Beginner"):e<1400?__("lang_mainsite","Apprentice"):e<1500?__("lang_mainsite","Average"):e<1600?__("lang_mainsite","Good"):e<1800?__("lang_mainsite","Strong"):e<2e3?__("lang_mainsite","Expert"):__("lang_mainsite","Master")},getColorFromElo:function(e){return 1300==(e=parseFloat(e))||e<1400?"#74bed1":e<1500?"#84b8de":e<1600?"#94acd6":e<1800?"#9ba5d0":e<2e3?"#a99bc9":"#b593c4"},getRankClassFromEloUntranslated:function(e){return 1300==(e=parseFloat(e))?"beginner":e<1400?"apprentice":e<1500?"average":e<1600?"good":e<1800?"strong":e<2e3?"expert":"master"},eloToBarPercentage:function(e,t=!1){e=parseFloat(e);if(t){let t=1300;e>1300&&(t=1400);e>=1400&&(t=1500);e>=1500&&(t=1600);e>=1600&&(t=1800);e>=1800&&(t=2e3);return this.eloToBarPercentage(t)}return e<1400?(e-1300)/4:e>2100?100:Math.min(100,25+(e-1400)/600*75)},formatElo:function(e){return parseInt(Math.floor(Math.max(0,parseFloat(e)-1300)))},formatEloDecimal:function(e){return Math.round(100*(e-1300))/100},getEloLabel:function(e,t,i,a=!1,n=!1){void 0===t&&(t=!1);void 0===i&&(i=!0);let o=t?"gamerank_mini":"",s=t?"mini":"",r=this.getRankClassFromEloUntranslated(e),l=i?this.formatElo(e):this.formatEloDecimal(e),d=a?this.getRankClassFromElo(e):l,c=n?`title="${d}"`:"";n&&(d="");return`<div class="gamerank gamerank_${r} ${o}">\n                        <span class="icon20 icon20_rankw${s}" ${c}></span> <span class="gamerank_value ${a?"gamerank_value_textual":""}">${d}</span>\n                    </div>`},getArenaLabel:function(e,t){var i=this.arenaPointsDetails(e),a='<div class="myarena_league league_'+i.league+'">';if(5!=i.league)a+='<div class="arena_label">'+i.points+"</div>";else if(void 0!==t){a+='<div class="arena_label">'+t+"</div>";a+='<div class="arena_points">'+Math.round(i.arelo)+"</div>"}return a+="</div>"},insertParamIntoCurrentURL:function(e,t){e=escape(e);t=escape(t);var i=document.location.search.substr(1).split("&");if(""==i)document.location.search="?"+e+"="+t;else{for(var a,n=i.length;n--;)if((a=i[n].split("="))[0]==e){a[1]=t;i[n]=a.join("=");break}n<0&&(i[i.length]=[e,t].join("="));document.location.search=i.join("&")}},playerawardsCollapsedAlignement:function(){if(void 0===this.onresizePlayerAwardsEvent){this.onresizePlayerAwardsEvent=e.connect(window,"onresize",this,e.hitch(this,"playerawardsCollapsedAlignement"));e.query(".show_awards_details").connect("onclick",this,function(t){e.stopEvent(t);for(var i=t.currentTarget.parentNode;null!==i&&!e.hasClass(i,"playerawards");)i=i.parentNode;if(null!==i){e.removeClass(i,"playerawards_collapsed");e.destroy(t.currentTarget)}})}if(0==e.query(".playerawards_collapsed").length){if(void 0!==this.onresizePlayerAwardsEvent){e.disconnect(this.onresizePlayerAwardsEvent);delete this.onresizePlayerAwardsEvent}}else e.query(".playerawards_collapsed").forEach(e.hitch(this,"playerawardCollapsedAlignement"))},playerawardCollapsedAlignement:function(t){var i=-1,a=!1;""!=t.id?e.query("#"+t.id+" .trophy_large").forEach(e.hitch(this,function(t){var n=e.position(t);if(n.y!=i){a=!a;i=n.y}e.removeClass(t,"oddawardline evenawardline");e.addClass(t,a?"oddawardline":"evenawardline")})):console.error("Please specity an ID to playerawards to support playerawardCollapsedAlignement")},arenaPointsDetails:function(e,t){var i={0:__("lang_mainsite","Bronze league"),1:__("lang_mainsite","Silver league"),2:__("lang_mainsite","Gold league"),3:__("lang_mainsite","Platinum league"),4:__("lang_mainsite","Diamond league"),5:__("lang_mainsite","Elite league")},a={0:__("lang_mainsite","Bronze"),1:__("lang_mainsite","Silver"),2:__("lang_mainsite","Gold"),3:__("lang_mainsite","Platinum"),4:__("lang_mainsite","Diamond"),5:__("lang_mainsite","Elite")},n=toint(Math.floor(e/100)),o=toint(Math.floor(e%100)),s=e%1*1e4,r=void 0===i[n]?"Error: unknow league "+n:i[n],l=void 0===a[n]?"Error: unknow league "+n:a[n],d="?";if(void 0!==t){d=5==n?"":n>=t-2?a[5]:a[toint(n)+1]}return{league:n,league_name:r??"?",league_shortname:l??"?",league_promotion_shortname:d??"",points:o,arelo:s}},arenaPointsHtml:function(t){let i="",a="",n="",o="";const s={0:10,1:10,2:10,3:10,4:10,5:0}[t.league];if(0==s){i+=Math.round(t.arelo)+" "+_("points");n=30+70*(Math.min(2100,Math.max(1200,t.arelo))-1200)/900;o=n;n="width:"+Math.round(n)+"%"}else{const n=Math.floor(100/s*100)/100;for(let e=0;e<s;e++){const a=e<t.points;i+=`<div class="arena_point_wrap arena_point_wrap_${e}" style="width: ${n}%"><div class="icon32 icon_arena arena_white"${a?' style="opacity:0;"':""}></div><div class="icon32 icon_arena arena_shadow"${a?"":' style="opacity:0;"'}></div><div class="icon32 icon_arena arena_colored"${a?"":' style="opacity:0;"'}></div></div>`}const o=s-t.points;void 0!==t.league_promotion_shortname&&null!==t.league_promotion_shortname||(t.league_promotion_shortname="?");a=1==o?e.string.substitute(_("1 point to ${league}"),{points:o,league:t.league_promotion_shortname}).replace("1",'<span class="remain_arena_points">1</span>'):e.string.substitute(_("${points} points to ${league}"),{points:'<span class="remain_arena_points">'+o+"</span>",league:t.league_promotion_shortname})}return{bar_content:i,bottom_infos:a,bar_pcent:n,bar_pcent_number:o}}})})},"ebg/core/common":function(){define(["dojo","dojo/date","svelte/index"],function(e,t,i){getStaticAssetUrl=function(e){var t="./"+e;if(null===g_staticassets){console.error("Error: g_staticassets is null",e);return g_themeurl+e}var i=g_staticassets.find(function(e){return e.file==t});return void 0!==i?g_themeurl.substr(0,g_themeurl.length-12)+i.version+"/"+e:g_themeurl+e};endnotif=function(){e.publish("notifEnd",null)};bga_format=function(e,t){for(const i in t){if(1!==i.length)continue;const a={"{":"}","[":"]","(":")"}[i]||i,n=e=>["-","[","]","{","}","(",")","*","+","?",".",",","\\","^","$","|","#"," "].includes(e)?"\\"+e:e,o=new RegExp(`${n(i)}(.*?)${n(a)}`,"g");let s=t[i];if("function"!=typeof s){const e=s;s=t=>`<span class="${e}">${t}</span>`}e=e.replace(o,(e,t)=>s(t))}return e};time_format=function(e,t=!1){if(e<60)return e+" mn";if(e<75)return"1h";if(e<105)return"1h30";var i=Math.round(e/60);if(i<24)return i+" h";var a=Math.round(i/24);if(1==a)return" "+__("lang_mainsite","one day");if(a<60)return a+" "+__("lang_mainsite","days");if(a<366){return Math.round(a/30.5)+" "+__("lang_mainsite","months")}if(t){var n=new Date;n.setMinutes(n.getMinutes()+e);return n.toLocaleDateString("en-US",{month:"long",year:"numeric"})}var o=Math.round(a/365.25);return 1==o?__("lang_mainsite","one year"):o+" "+__("lang_mainsite","years")};time_ago_format=function(e){if(isNaN(e))return"";const t="zh"==dojoConfig.locale?"zh-tw":dojoConfig.locale;if(!Intl||!Intl.RelativeTimeFormat)return new Date(new Date-6e4*e).toLocaleString();const i=new Intl.RelativeTimeFormat(t,{style:"long"});if(e<60)return i.format(-1*e,"minute");if(e<75)return i.format(-1,"hour");if(e<105)return __("lang_mainsite","${hour}h${mn} ago").replace("${hour}","1").replace("${mn}","30");var a=Math.round(e/60);if(a<24)return i.format(-1*a,"hour");var n=Math.round(a/24);if(n<60)return i.format(-1*n,"day");if(n<366){var o=Math.round(n/30.5);return i.format(-1*o,"month")}var s=Math.round(n/365.25);return i.format(-1*s,"year")};date_format=function(t,i,a,n){var o=new Date,s=new Date(1e3*t);void 0===n&&(n=!1);var r=!1;"undefined"!=typeof globalUserInfos&&void 0!==globalUserInfos.date_use_iso&&(r=globalUserInfos.date_use_iso);var l="";n&&(l=" ("+mainsite.timezone.replace("_"," ")+")");var d=Math.abs(o.getTime()-s.getTime())/1e3,c=s.getTime()>=o.getTime();void 0===a&&(a=!1);if(a)return e.string.substitute(r?"${Y}-${M}-${D}":__("lang_mainsite","${M}/${D}/${Y}"),{M:zeroFill(s.getMonth()+1,2),D:zeroFill(s.getDate(),2),Y:1900+s.getYear()});if(d<3600){var u=Math.round(d/60);return c?e.string.substitute(__("lang_mainsite","in ${mn} min"),{mn:u}):e.string.substitute(__("lang_mainsite","${mn} min ago"),{mn:u})}if(d<14400){if(i){var h=Math.floor(d/3600);u=zeroFill(Math.round((d-3600*h)/60),2);return c?e.string.substitute(__("lang_mainsite","in ${hour}h${mn}"),{hour:h,mn:u}):e.string.substitute(__("lang_mainsite","${hour}h${mn} ago"),{hour:h,mn:u})}h=Math.round(d/3600);return c?1==h?__("lang_mainsite","in one hour"):e.string.substitute(__("lang_mainsite","in ${hour} hours"),{hour:h}):1==h?__("lang_mainsite","one hour ago"):e.string.substitute(__("lang_mainsite","${hour} hours ago"),{hour:h})}if(s.getYear()==o.getYear()&&s.getMonth()==o.getMonth()&&s.getDate()==o.getDate())return e.string.substitute(__("lang_mainsite","today at ${H}:${m}"),{H:zeroFill(s.getHours(),2),m:zeroFill(s.getMinutes(),2)})+l;var p=e.date.add(o,"day",1);if(s.getYear()==p.getYear()&&s.getMonth()==p.getMonth()&&s.getDate()==p.getDate())return e.string.substitute(__("lang_mainsite","tomorrow at ${H}:${m}"),{H:zeroFill(s.getHours(),2),m:zeroFill(s.getMinutes(),2)})+l;var _=e.date.add(o,"day",-1);return s.getYear()==_.getYear()&&s.getMonth()==_.getMonth()&&s.getDate()==_.getDate()?e.string.substitute(__("lang_mainsite","yesterday at ${H}:${m}"),{H:zeroFill(s.getHours(),2),m:zeroFill(s.getMinutes(),2)})+l:e.string.substitute(r?__("lang_mainsite","${Y}-${M}-${D} at ${H}:${m}"):__("lang_mainsite","${M}/${D}/${Y} at ${H}:${m}"),{M:zeroFill(s.getMonth()+1,2),D:zeroFill(s.getDate(),2),Y:1900+s.getYear(),H:zeroFill(s.getHours(),2),m:zeroFill(s.getMinutes(),2)})+l};date_format_simple=function(t){var i=new Date(1e3*t),a=!1;"undefined"!=typeof globalUserInfos&&void 0!==globalUserInfos.date_use_iso&&(a=globalUserInfos.date_use_iso);return e.string.substitute(a?__("lang_mainsite","${Y}-${M}-${D} at ${H}:${m}"):__("lang_mainsite","${M}/${D}/${Y} at ${H}:${m}"),{M:zeroFill(i.getMonth()+1,2),D:zeroFill(i.getDate(),2),Y:1900+i.getYear(),H:zeroFill(i.getHours(),2),m:zeroFill(i.getMinutes(),2)})};daytime_format=function(t){var i=new Date(1e3*t);return e.string.substitute("${H}:${m}",{H:zeroFill(i.getHours(),2),m:zeroFill(i.getMinutes(),2)})};isset=function(e){return void 0!==e};toint=function(e){return null===e?null:parseInt(e,10)};tofloat=function(e){return null===e?null:parseFloat(e)};zeroFill=function(e,t){return(t-=e.toString().length)>0?new Array(t+(/\./.test(e)?2:1)).join("0")+e:e};ucFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};format_number=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")};playSound=function(e){if(soundManager.flashMedia&&soundManager.flashMedia.doPlay&&"function"==typeof soundManager.flashMedia.doPlay){if(soundManager.bMuteSound)return;try{void 0!==soundManager.volume?soundManager.doPlay({id:e,volume:soundManager.volume}):soundManager.doPlay({id:e})}catch(t){}}soundManager.html5&&soundManager.doPlay({id:e})};playSoundFile=function(e){soundManager.html5&&soundManager.doPlayFile(e)};stopSound=function(e){if(soundManager.flashMedia&&soundManager.flashMedia.doPlay&&"function"==typeof soundManager.flashMedia.doPlay)try{soundManager.stop({id:e})}catch(t){}soundManager.html5&&soundManager.stop({id:e})};_=function(e){return i.services.i18n.translateString(e)};__=function(e,t){return i.services.i18n.translateString(t,e)};getLocationDescriptionFromResult=function(e){var t="";for(var i in e.address_components){""!=t&&(t+=", ");t+=e.address_components[i].long_name}return t};analyseLocationDescriptionFromResult=function(e){var t={city:"",area1:"",area2:"",country:""};for(var i in e.address_components)for(var a in e.address_components[i].types)"administrative_area_level_1"==e.address_components[i].types[a]?t.area1=e.address_components[i].long_name:"administrative_area_level_2"==e.address_components[i].types[a]?t.area2=e.address_components[i].long_name:"locality"==e.address_components[i].types[a]?t.city=e.address_components[i].long_name:"country"==e.address_components[i].types[a]&&(t.country=e.address_components[i].short_name);return t};id_to_path=function(e){return Math.floor(e/1e9)+"/"+Math.floor(e/1e6)+"/"+Math.floor(e/1e3)};playerDeviceToIcon=function(e){return"desktop"==e?"circle":"tablet"==e?"tablet":"mobile"};jzTimezoneDetector={};jzTimezoneDetector.HEMISPHERE_SOUTH="SOUTH";jzTimezoneDetector.HEMISPHERE_NORTH="NORTH";jzTimezoneDetector.HEMISPHERE_UNKNOWN="N/A";jzTimezoneDetector.olson={};jzTimezoneDetector.TimeZone=function(e,t,i){this.utc_offset=e;this.olson_tz=t;this.uses_dst=i};jzTimezoneDetector.TimeZone.prototype.display=function(){this.ambiguity_check();var e="<b>UTC-offset</b>: "+this.utc_offset+"<br/>";e+="<b>Zoneinfo key</b>: "+this.olson_tz+"<br/>";return e+="<b>Zone uses DST</b>: "+(this.uses_dst?"yes":"no")+"<br/>"};jzTimezoneDetector.TimeZone.prototype.ambiguity_check=function(){var e=jzTimezoneDetector.olson.ambiguity_list[this.olson_tz];if(void 0!==e)for(var t=e.length,i=0;i<t;i++){var a=e[i];if(jzTimezoneDetector.date_is_dst(jzTimezoneDetector.olson.dst_start_dates[a])){this.olson_tz=a;return}}};jzTimezoneDetector.date_is_dst=function(e){var t=e.getMonth()>5?jzTimezoneDetector.get_june_offset():jzTimezoneDetector.get_january_offset(),i=jzTimezoneDetector.get_date_offset(e);return 0!==toint(t-i)};jzTimezoneDetector.get_date_offset=function(e){return-e.getTimezoneOffset()};jzTimezoneDetector.get_timezone_info=function(){var e=jzTimezoneDetector.get_january_offset(),t=jzTimezoneDetector.get_june_offset(),i=e-t;return i<0?{utc_offset:e,dst:1,hemisphere:jzTimezoneDetector.HEMISPHERE_NORTH}:i>0?{utc_offset:t,dst:1,hemisphere:jzTimezoneDetector.HEMISPHERE_SOUTH}:{utc_offset:e,dst:0,hemisphere:jzTimezoneDetector.HEMISPHERE_UNKNOWN}};jzTimezoneDetector.get_january_offset=function(){return jzTimezoneDetector.get_date_offset(new Date(2011,0,1,0,0,0,0))};jzTimezoneDetector.get_june_offset=function(){return jzTimezoneDetector.get_date_offset(new Date(2011,5,1,0,0,0,0))};jzTimezoneDetector.determine_timezone=function(){var e=jzTimezoneDetector.get_timezone_info(),t="";e.hemisphere==jzTimezoneDetector.HEMISPHERE_SOUTH&&(t=",s");var i=e.utc_offset+","+e.dst+t;return{timezone:jzTimezoneDetector.olson.timezones[i],key:i}};jzTimezoneDetector.olson.timezones={"-720,0":new jzTimezoneDetector.TimeZone("-12:00","Etc/GMT+12",!1),"-660,0":new jzTimezoneDetector.TimeZone("-11:00","Pacific/Pago_Pago",!1),"-600,1":new jzTimezoneDetector.TimeZone("-11:00","America/Adak",!0),"-660,1,s":new jzTimezoneDetector.TimeZone("-11:00","Pacific/Apia",!0),"-600,0":new jzTimezoneDetector.TimeZone("-10:00","Pacific/Honolulu",!1),"-570,0":new jzTimezoneDetector.TimeZone("-10:30","Pacific/Marquesas",!1),"-540,0":new jzTimezoneDetector.TimeZone("-09:00","Pacific/Gambier",!1),"-540,1":new jzTimezoneDetector.TimeZone("-09:00","America/Anchorage",!0),"-480,1":new jzTimezoneDetector.TimeZone("-08:00","America/Los_Angeles",!0),"-480,0":new jzTimezoneDetector.TimeZone("-08:00","Pacific/Pitcairn",!1),"-420,0":new jzTimezoneDetector.TimeZone("-07:00","America/Phoenix",!1),"-420,1":new jzTimezoneDetector.TimeZone("-07:00","America/Denver",!0),"-360,0":new jzTimezoneDetector.TimeZone("-06:00","America/Guatemala",!1),"-360,1":new jzTimezoneDetector.TimeZone("-06:00","America/Chicago",!0),"-360,1,s":new jzTimezoneDetector.TimeZone("-06:00","Pacific/Easter",!0),"-300,0":new jzTimezoneDetector.TimeZone("-05:00","America/Bogota",!1),"-300,1":new jzTimezoneDetector.TimeZone("-05:00","America/New_York",!0),"-270,0":new jzTimezoneDetector.TimeZone("-04:30","America/Caracas",!1),"-240,1":new jzTimezoneDetector.TimeZone("-04:00","America/Halifax",!0),"-240,0":new jzTimezoneDetector.TimeZone("-04:00","America/Santo_Domingo",!1),"-240,1,s":new jzTimezoneDetector.TimeZone("-04:00","America/Asuncion",!0),"-210,1":new jzTimezoneDetector.TimeZone("-03:30","America/St_Johns",!0),"-180,1":new jzTimezoneDetector.TimeZone("-03:00","America/Godthab",!0),"-180,0":new jzTimezoneDetector.TimeZone("-03:00","America/Argentina/Buenos_Aires",!1),"-180,1,s":new jzTimezoneDetector.TimeZone("-03:00","America/Montevideo",!0),"-120,0":new jzTimezoneDetector.TimeZone("-02:00","America/Noronha",!1),"-120,1":new jzTimezoneDetector.TimeZone("-02:00","Etc/GMT+2",!0),"-60,1":new jzTimezoneDetector.TimeZone("-01:00","Atlantic/Azores",!0),"-60,0":new jzTimezoneDetector.TimeZone("-01:00","Atlantic/Cape_Verde",!1),"0,0":new jzTimezoneDetector.TimeZone("00:00","Etc/UTC",!1),"0,1":new jzTimezoneDetector.TimeZone("00:00","Europe/London",!0),"60,1":new jzTimezoneDetector.TimeZone("+01:00","Europe/Berlin",!0),"60,0":new jzTimezoneDetector.TimeZone("+01:00","Africa/Lagos",!1),"60,1,s":new jzTimezoneDetector.TimeZone("+01:00","Africa/Windhoek",!0),"120,1":new jzTimezoneDetector.TimeZone("+02:00","Asia/Beirut",!0),"120,0":new jzTimezoneDetector.TimeZone("+02:00","Africa/Johannesburg",!1),"180,1":new jzTimezoneDetector.TimeZone("+03:00","Europe/Moscow",!0),"180,0":new jzTimezoneDetector.TimeZone("+03:00","Asia/Baghdad",!1),"210,1":new jzTimezoneDetector.TimeZone("+03:30","Asia/Tehran",!0),"240,0":new jzTimezoneDetector.TimeZone("+04:00","Asia/Dubai",!1),"240,1":new jzTimezoneDetector.TimeZone("+04:00","Asia/Yerevan",!0),"270,0":new jzTimezoneDetector.TimeZone("+04:30","Asia/Kabul",!1),"300,1":new jzTimezoneDetector.TimeZone("+05:00","Asia/Yekaterinburg",!0),"300,0":new jzTimezoneDetector.TimeZone("+05:00","Asia/Karachi",!1),"330,0":new jzTimezoneDetector.TimeZone("+05:30","Asia/Kolkata",!1),"345,0":new jzTimezoneDetector.TimeZone("+05:45","Asia/Kathmandu",!1),"360,0":new jzTimezoneDetector.TimeZone("+06:00","Asia/Dhaka",!1),"360,1":new jzTimezoneDetector.TimeZone("+06:00","Asia/Omsk",!0),"390,0":new jzTimezoneDetector.TimeZone("+06:30","Asia/Rangoon",!1),"420,1":new jzTimezoneDetector.TimeZone("+07:00","Asia/Krasnoyarsk",!0),"420,0":new jzTimezoneDetector.TimeZone("+07:00","Asia/Jakarta",!1),"480,0":new jzTimezoneDetector.TimeZone("+08:00","Asia/Shanghai",!1),"480,1":new jzTimezoneDetector.TimeZone("+08:00","Asia/Irkutsk",!0),"525,0":new jzTimezoneDetector.TimeZone("+08:45","Australia/Eucla",!0),"525,1,s":new jzTimezoneDetector.TimeZone("+08:45","Australia/Eucla",!0),"540,1":new jzTimezoneDetector.TimeZone("+09:00","Asia/Yakutsk",!0),"540,0":new jzTimezoneDetector.TimeZone("+09:00","Asia/Tokyo",!1),"570,0":new jzTimezoneDetector.TimeZone("+09:30","Australia/Darwin",!1),"570,1,s":new jzTimezoneDetector.TimeZone("+09:30","Australia/Adelaide",!0),"600,0":new jzTimezoneDetector.TimeZone("+10:00","Australia/Brisbane",!1),"600,1":new jzTimezoneDetector.TimeZone("+10:00","Asia/Vladivostok",!0),"600,1,s":new jzTimezoneDetector.TimeZone("+10:00","Australia/Sydney",!0),"630,1,s":new jzTimezoneDetector.TimeZone("+10:30","Australia/Lord_Howe",!0),"660,1":new jzTimezoneDetector.TimeZone("+11:00","Asia/Kamchatka",!0),"660,0":new jzTimezoneDetector.TimeZone("+11:00","Pacific/Noumea",!1),"690,0":new jzTimezoneDetector.TimeZone("+11:30","Pacific/Norfolk",!1),"720,1,s":new jzTimezoneDetector.TimeZone("+12:00","Pacific/Auckland",!0),"720,0":new jzTimezoneDetector.TimeZone("+12:00","Pacific/Tarawa",!1),"765,1,s":new jzTimezoneDetector.TimeZone("+12:45","Pacific/Chatham",!0),"780,0":new jzTimezoneDetector.TimeZone("+13:00","Pacific/Tongatapu",!1),"840,0":new jzTimezoneDetector.TimeZone("+14:00","Pacific/Kiritimati",!1)};jzTimezoneDetector.olson.dst_start_dates={"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"Atlantic/Stanley":new Date(2011,8,4,7,0,0,0),"America/Asuncion":new Date(2011,9,2,3,0,0,0),"America/Santiago":new Date(2011,9,9,3,0,0,0),"America/Campo_Grande":new Date(2011,9,16,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2011,2,13,2,0,0,0),"America/New_York":new Date(2011,2,13,7,0,0,0),"Asia/Gaza":new Date(2011,2,26,23,0,0,0),"Asia/Beirut":new Date(2011,2,27,1,0,0,0),"Europe/Minsk":new Date(2011,2,27,3,0,0,0),"Europe/Istanbul":new Date(2011,2,27,7,0,0,0),"Asia/Damascus":new Date(2011,3,1,2,0,0,0),"Asia/Jerusalem":new Date(2011,3,1,6,0,0,0),"Africa/Cairo":new Date(2011,3,29,4,0,0,0),"Asia/Yerevan":new Date(2011,2,27,4,0,0,0),"Asia/Baku":new Date(2011,2,27,8,0,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"Pacific/Fiji":new Date(2010,11,29,23,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0)};jzTimezoneDetector.olson.ambiguity_list={"America/Denver":["America/Denver","America/Mazatlan"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Asuncion":["Atlantic/Stanley","America/Asuncion","America/Santiago","America/Campo_Grande"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":["Asia/Gaza","Asia/Beirut","Europe/Minsk","Europe/Istanbul","Asia/Damascus","Asia/Jerusalem","Africa/Cairo"],"Asia/Yerevan":["Asia/Yerevan","Asia/Baku"],"Pacific/Auckland":["Pacific/Auckland","Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles","America/Santa_Isabel"],"America/New_York":["America/Havana","America/New_York"],"America/Halifax":["America/Goose_Bay","America/Halifax"],"America/Godthab":["America/Miquelon","America/Godthab"]};return{}});setCaretPosition=function(e,t){if(e.setSelectionRange){e.focus();e.setSelectionRange(t,t)}else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",t);i.select()}};playerDeviceToIcon=function(e){return"desktop"==e?"circle":"tablet"==e?"tablet":"mobile"};replaceAll=function(e,t,i){var a=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return e.replace(new RegExp(a,"g"),i)};array_unique=function(e){var t={};return e.filter(function(e){return!t.hasOwnProperty(e)&&(t[e]=!0)})};extractDomain=function(e){return e.indexOf("://")>-1?e.split("/")[0]+"/"+e.split("/")[1]+"/"+e.split("/")[2]:e.split("/")[0]};removeAccents=function(e){for(var t=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}],i=0;i<t.length;i++)e=e.replace(t[i].letters,t[i].base);return e};getPlayerAvatar=function(e,t,i){t||(t="000000");if(!/^[1-9]\d*$/.test(e)){e=0;t="000000"}i||(i=50);var a=t.match(/^_def_(\d+)$/);if(a){var n=a[1];n.length<4&&(n=("0000"+n).slice(-4));return g_themeurl+"../../data/avatar/defaults/default-"+n+({32:"_32",50:"_50",92:"_92",184:""}[i]||"")+".jpg"}return 0===e||"000000"==t||"x00000"==t?g_themeurl+"../../data/avatar/default_"+i+".jpg":g_themeurl+"../../data/avatar/"+id_to_path(e)+"/"+e+"_"+i+".jpg?h="+t};getGroupAvatar=function(e,t,i,a){if(!/^[1-9]\d*$/.test(e)){e=0;t="000000"}a||(a=50);if(t&&"000000"!=t){const i=Math.floor(e/1e3);return g_themeurl+"../../data/grouparms/"+i+"/group_"+e+"_"+a+".jpg?h="+t}return"tournament"==i?g_themeurl+"../../data/grouparms/noimage_tournament_"+a+".png":g_themeurl+"../../data/grouparms/noimage_"+a+".jpg"};getMediaUrl=function(e,t,i=null,a="default",n=null){let o="";n&&(o="?h="+n);let s="png";["banner","display"].includes(t)&&(s="jpg");let r="";i&&(r="_"+i);a||(a="default");"default"===a&&"box"===t&&(a="en");return g_themeurl+"../../data/gamemedia/"+e+"/"+t+"/"+a+r+"."+s+o};analyticsPush=function(e){dataLayer&&dataLayer.push(e)}},"dojo/date":function(){define(["./has","./_base/lang"],function(e,t){var i={getDaysInMonth:function(e){var t=e.getMonth();return 1==t&&i.isLeapYear(e)?29:[31,28,31,30,31,30,31,31,30,31,30,31][t]},isLeapYear:function(e){var t=e.getFullYear();return!(t%400&&(t%4||!(t%100)))},getTimezoneName:function(e){var t,i=e.toString(),a="",n=i.indexOf("(");if(n>-1)a=i.substring(++n,i.indexOf(")"));else{var o=/([A-Z\/]+) \d{4}$/;if(t=i.match(o))a=t[1];else{o=/ ([A-Z\/]+)$/;(t=(i=e.toLocaleString()).match(o))&&(a=t[1])}}return"AM"==a||"PM"==a?"":a},compare:function(e,t,i){e=new Date(+e);t=new Date(+(t||new Date));if("date"==i){e.setHours(0,0,0,0);t.setHours(0,0,0,0)}else if("time"==i){e.setFullYear(0,0,0);t.setFullYear(0,0,0)}return e>t?1:e<t?-1:0},add:function(e,t,i){var a=new Date(+e),n=!1,o="Date";switch(t){case"day":break;case"weekday":var s,r,l=i%5;if(l){s=l;r=parseInt(i/5)}else{s=i>0?5:-5;r=i>0?(i-5)/5:(i+5)/5}var d=e.getDay(),c=0;6==d&&i>0?c=1:0==d&&i<0&&(c=-1);var u=d+s;0!=u&&6!=u||(c=i>0?2:-2);i=7*r+s+c;break;case"year":o="FullYear";n=!0;break;case"week":i*=7;break;case"quarter":i*=3;case"month":n=!0;o="Month";break;default:o="UTC"+t.charAt(0).toUpperCase()+t.substring(1)+"s"}o&&a["set"+o](a["get"+o]()+i);n&&a.getDate()<e.getDate()&&a.setDate(0);return a},difference:function(e,t,a){a=a||"day";var n=(t=t||new Date).getFullYear()-e.getFullYear(),o=1;switch(a){case"quarter":var s=e.getMonth(),r=t.getMonth(),l=Math.floor(s/3)+1,d=Math.floor(r/3)+1;o=(d+=4*n)-l;break;case"weekday":var c=Math.round(i.difference(e,t,"day")),u=parseInt(i.difference(e,t,"week")),h=c%7;if(0==h)c=5*u;else{var p=0,_=e.getDay(),m=t.getDay();u=parseInt(c/7);h=c%7;var g=new Date(e);g.setDate(g.getDate()+7*u);var f=g.getDay();if(c>0)switch(!0){case 6==_:p=-1;break;case 0==_:p=0;break;case 6==m:p=-1;break;case 0==m:case f+h>5:p=-2}else if(c<0)switch(!0){case 6==_:p=0;break;case 0==_:p=1;break;case 6==m:p=2;break;case 0==m:p=1;break;case f+h<0:p=2}c+=p;c-=2*u}o=c;break;case"year":o=n;break;case"month":o=t.getMonth()-e.getMonth()+12*n;break;case"week":o=parseInt(i.difference(e,t,"day")/7);break;case"day":o/=24;case"hour":o/=60;case"minute":o/=60;case"second":o/=1e3;case"millisecond":o*=t.getTime()-e.getTime()}return Math.round(o)}};t.mixin(t.getObject("dojo.date",!0),i);return i})},"ebg/core/i18n":function(){define(["dojo/_base/declare","svelte/index"],function(e,t){return e("ebg.core.i18n",null,{setJsBundlesVersion:function(e){return t.services.i18n.setJsBundlesVersion(e)},loadBundle:function(e){return t.services.i18n.loadBundle(e)},getTranslation:function(e,i){return t.services.i18n.translateString(e,i)},setActiveBundle:function(e){return t.services.i18n.setActiveBundle(e)},getSimpleTranslation:function(e,i){return t.services.i18n.translateString(e,null,i)}})})},"ebg/webrtc":function(){define(["dojo","dojo/_base/declare","ebg/peerconnect","ebg/scriptlogger"],function(e,t){return t("ebg.webrtc",null,{constructor:function(e,t,i,a,n,o,s,r,l,d,c){this.player_id=e;this.room=t;this.in_room=[];this.logger=new ebg.scriptlogger("webrtc",s,"[P"+this.player_id+"@"+this.room+"]");this.logger.log("(ebg.webrtc)      WebRTC object created for player "+this.player_id+" and room "+this.room);this.connections=[];this.pcConfig=i;this.pcConstraints=a;this.mediaConstraints=n;this.stereo=!1;this.ajaxcall_callback=s;this.getUserMediaSuccess_callback=r;this.getUserMediaError_callback=l;this.onJoinRoom_callback=d;this.onLeaveRoom_callback=c;this.localVideo=null;this.localStream=null;this.isAudioMuted=!1;this.isVideoMuted=!1;g_sitecore.recordMediaStats(this.player_id,"start");this.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},isInRoom:function(e){for(var t=0;t<this.in_room.length;t++)if(e==this.in_room[t]){this.logger.log("(ebg.webrtc)      Player "+e+" is in the room");return!0}this.logger.log("(ebg.webrtc)      Player "+e+" is not in the room");return!1},addToRoom:function(e){this.logger.log("(ebg.webrtc)      Player "+e+" is added to the room");this.in_room.push(e)},removeFromRoom:function(e){this.logger.log("(ebg.webrtc)      Player "+e+" is removed from the room");for(var t=0;t<this.in_room.length;t++)if(e==this.in_room[t]){this.in_room.splice(t);return!0}return!1},setMediaConstraints:function(e){this.logger.log("(ebg.webrtc)      Setting the following media constraints "+JSON.stringify(e));this.mediaConstraints=e},setLocalFeed:function(e){this.logger.log("(ebg.webrtc)      Setting the local feed with the following HTML video node: "+e.id);this.localVideo=e;this.doGetUserMedia()},doGetUserMedia:function(){if(!1!==this.mediaConstraints.video||!1!==this.mediaConstraints.audio)try{navigator.getUserMedia(this.mediaConstraints,e.hitch(this,"onUserMediaSuccess"),e.hitch(this,"onUserMediaError"));this.logger.log("(ebg.webrtc)      Requested access to local media with mediaConstraints: "+JSON.stringify(this.mediaConstraints))}catch(t){this.logger.log("(ebg.webrtc)      getUserMedia() call failed with exception "+JSON.stringify(t));this.logger.flush();this.getUserMediaError_callback()}else this.logger.log("(ebg.webrtc)      According to media constraints, no media to get: aborting getUserMedia")},onUserMediaSuccess:function(e){this.logger.log("(ebg.webrtc)      User has granted access to local media");this.localVideo.srcObject=e;!e.stop&&e.getTracks&&(e.stop=function(){this.getTracks().forEach(function(e){e.stop()})});this.localStream=e;this.getUserMediaSuccess_callback()},onUserMediaError:function(e){this.logger.log("(ebg.webrtc)      Failed to get access to local media with error: "+JSON.stringify(e));this.logger.flush();this.getUserMediaError_callback()},maybeConnect:function(t,i){void 0===this.connections[t]&&(this.connections[t]=new ebg.peerconnect(t,this.pcConfig,this.pcConstraints,this.mediaConstraints,this.stereo,this.localStream,this.logger,e.hitch(this,"sendPlayerMessage")));if(!1===i){this.player_id>t&&this.connections[t].doCall();this.player_id<t&&this.connections[t].requestCall()}},hangup:function(){this.logger.log("(ebg.webrtc)      Hanging up & closing all connections");if(null!=this.localStream){this.localStream.stop();this.localStream=null}for(var e=0;e<this.in_room.length;e++){var t=this.in_room[e];if(void 0!==this.connections[t]){this.logger.log("(ebg.webrtc)      Closing connection with player "+t);g_sitecore.recordMediaStats(t,"stop");this.connections[t].stop();this.connections.splice(t)}else this.logger.log("(ebg.webrtc)      No current connection with player "+t)}g_sitecore.recordMediaStats(this.player_id,"stop");this.sendRoomMessage("bye");this.logger.flush()},handleRemoteHangup:function(e){this.logger.log("(ebg.webrtc)      Player "+e+" signaled remote hang up on his end");if(void 0!==this.connections[e]){this.logger.log("(ebg.webrtc)      Closing connection with player "+e);this.connections[e].stop();this.connections.splice(e)}else this.logger.log("(ebg.webrtc)      No current connection with player "+e);g_sitecore.recordMediaStats(e,"stop");this.onLeaveRoom_callback(e)},toggleVideoMute:function(e){var t=null;e==this.player_id?t=this.localStream:void 0!==this.connections[e]&&(t=this.connections[e].remoteStream);if(null==t){this.logger.log("(ebg.webrtc)      No video stream to mute for player "+e+": aborting");return!0}var a=t.getVideoTracks();if(0===a.length){this.logger.log("(ebg.webrtc)      No local video available: aborting");return!0}if(this.isVideoMuted){for(i=0;i<a.length;i++)a[i].enabled=!0;this.logger.log("(ebg.webrtc)      Video unmuted")}else{for(i=0;i<a.length;i++)a[i].enabled=!1;this.logger.log("(ebg.webrtc)      Video muted")}this.isVideoMuted=!this.isVideoMuted;return this.isVideoMuted},toggleAudioMute:function(e){var t=null;e==this.player_id?t=this.localStream:void 0!==this.connections[e]&&(t=this.connections[e].remoteStream);if(null==t){this.logger.log("(ebg.webrtc)      No audio stream to mute for player "+e+": aborting");return!0}var a=t.getAudioTracks();if(0===a.length){this.logger.log("(ebg.webrtc)      No local audio available: aborting");return!0}if(this.isAudioMuted){for(i=0;i<a.length;i++)a[i].enabled=!0;this.logger.log("(ebg.webrtc)      Audio unmuted")}else{for(i=0;i<a.length;i++)a[i].enabled=!1;this.logger.log("(ebg.webrtc)      Audio muted")}this.isAudioMuted=!this.isAudioMuted;return this.isAudioMuted},sendPlayerMessage:function(e,t){this.logger.log("(ebg.webrtc)      Client sending player message "+JSON.stringify(t));t=JSON.stringify(t);this.ajaxcall_callback("/videochat/videochat/relayPlayerMessage.html",{player_id:e,room:this.room,message:t,lock:!1},this,function(e){},function(e){},"post")},sendRoomMessage:function(e){this.logger.log("(ebg.webrtc)      Client sending room message "+JSON.stringify(e));e=JSON.stringify(e);this.ajaxcall_callback("/videochat/videochat/relayRoomMessage.html",{room:this.room,message:e,lock:!1},this,function(e){},function(e){})},onMessageReceived:function(e,t){if(null!=this.localStream)if(this.player_id==e.to){var i=e.from,a=JSON.parse(e.message);this.logger.log("(ebg.webrtc)      Client received message from player "+i+": "+JSON.stringify(a));this.isInRoom(i)||"bye"==a||this.onJoinRoom_callback(i,!0);void 0!==this.connections[i]?"bye"==a?this.handleRemoteHangup(i):this.connections[i].handleMessage(a):this.logger.log("(ebg.webrtc)      Message received but no connection with player "+i+" (should never happen)")}else this.logger.log("(ebg.webrtc)      Received message dropped (destined to another player"+e.to+")");else this.logger.log("(ebg.webrtc)      Received message dropped (no localStream)")}})})},"ebg/peerconnect":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.peerconnect",null,{constructor:function(e,t,i,a,n,o,s,r){this.peerId=e;this.localStream=o;this.remoteVideo=null;this.remoteStream=null;this.pc=null;this.started=!1;this.logger=s;this.sendPlayerMessage_callback=r;this.pcConfig=t;this.pcConstraints=i;this.mediaConstraints=a;this.stereo=n;this.offerConstraints={mandatory:{},optional:[]};this.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},maybeStart:function(){if(!0!==this.started){this.logger.log("(ebg.peerconnect) Starting peer connection...");this.pc=this.createPeerConnection();if(null!==this.pc){try{this.pc.addStream(this.localStream)}catch(e){this.logger.log("(ebg.peerconnect) PeerConnection.addStream failed with exception: "+e.message+(e.stack?" | "+e.stack:""));this.logger.flush()}this.started=!0;this.logger.log("(ebg.peerconnect) Peer connection started")}else this.logger.log("(ebg.peerconnect) Peer connection failed")}else this.logger.log("(ebg.peerconnect) Peer connection already started")},requestCall:function(){this.logger.log("(ebg.peerconnect) Sending call request to peer "+this.peerId);this.sendPlayerMessage_callback(this.peerId,"new client requesting offer")},doCall:function(){this.maybeStart();if(this.started){var t=this.mergeConstraints(this.offerConstraints,this.sdpConstraints);this.logger.log("(ebg.peerconnect) Sending offer to peer "+this.peerId+", with constraints "+JSON.stringify(t));try{this.pc.createOffer(e.hitch(this,"setLocalSessionDescription"),e.hitch(this,"handleCreateOfferError"),t)}catch(i){this.logger.log("(ebg.peerconnect) PeerConnection.createOffer failed with exception: "+i.message+(i.stack?" | "+i.stack:""));this.logger.flush()}}},mergeConstraints:function(e,t){var i=e;for(var a in t.mandatory)i.mandatory[a]=t.mandatory[a];i.optional.concat(t.optional);return i},handleCreateOfferError:function(e){try{this.logger.log("(ebg.peerconnect) Create offer error: "+JSON.stringify(e))}catch(t){this.logger.log("(ebg.peerconnect) Exception raised while logging handleCreateOfferError: "+t.message)}this.logger.flush()},doAnswer:function(){if(this.started){this.isInitiator=!1;this.logger.log("(ebg.peerconnect) Sending answer to peer "+this.peerId);try{this.pc.createAnswer(e.hitch(this,"setLocalSessionDescription"),e.hitch(this,"onCreateAnswerError"),this.sdpConstraints)}catch(t){this.logger.log("(ebg.peerconnect) PeerConnection.createAnswer failed with exception: "+t.message+(t.stack?" | "+t.stack:""));this.logger.flush()}}else this.logger.log("(ebg.peerconnect) Connection must be started before sending an answer")},onCreateAnswerError:function(e){this.logger.log("(ebg.peerconnect) Create answer error: "+JSON.stringify(e));this.logger.flush()},stop:function(){if(this.started){this.logger.log("(ebg.peerconnect) Closing peer connection...");this.started=!1;this.getConnectionDetails(this.pc).then(e.hitch(this,function(e){this.logger.log("(ebg.peerconnect) ICE connection details: "+JSON.stringify(e));this.logger.flush()}));try{this.pc.close()}catch(t){this.logger.log("(ebg.peerconnect) PeerConnection.close failed with exception: "+t.message+(t.stack?" | "+t.stack:""));this.logger.flush()}finally{this.pc=null;this.logger.log("(ebg.peerconnect) Peer connection closed")}}else this.logger.log("(ebg.peerconnect) Connection must be started before stopping it")},handleMessage:function(t){this.logger.log("(ebg.peerconnect) Client handling message from player "+this.peerId+": "+JSON.stringify(t));if(null===t)this.logger.log("(ebg.peerconnect) Message is null");else if("new client requesting offer"===t){this.logger.log("(ebg.peerconnect) Request received, sending an offer");this.started&&this.stop();this.maybeStart();this.doCall()}else if("offer"===t.type){this.logger.log("(ebg.peerconnect) Registering offer and sending an answer");this.started&&this.stop();this.maybeStart();if(this.started){if(this.stereo){t.sdp=addStereo(t.sdp);t.sdp=maybePreferAudioSendCodec(t.sdp)}try{this.pc.setRemoteDescription(new RTCSessionDescription(t),e.hitch(this,"onSetRemoteSessionDescriptionSuccess"),e.hitch(this,"onSetRemoteSessionDescriptionError"))}catch(a){this.logger.log("(ebg.peerconnect) PeerConnection.setRemoteDescription failed with exception: "+a.message+(a.stack?" | "+a.stack:""));this.logger.flush()}this.doAnswer()}else this.logger.log("(ebg.peerconnect) No peerconnection available. Aborting.")}else if("answer"===t.type){this.logger.log("(ebg.peerconnect) Registering answer");if(this.started){if(this.stereo){t.sdp=addStereo(t.sdp);t.sdp=maybePreferAudioSendCodec(t.sdp)}try{this.pc.setRemoteDescription(new RTCSessionDescription(t),e.hitch(this,"onSetRemoteSessionDescriptionSuccess"),e.hitch(this,"onSetRemoteSessionDescriptionError"))}catch(a){this.logger.log("(ebg.peerconnect) PeerConnection.setRemoteDescription failed with exception: "+a.message+(a.stack?" | "+a.stack:""));this.logger.flush()}}else this.logger.log("(ebg.peerconnect) No peerconnection available. Aborting.")}else if("candidate"===t.type){this.logger.log("(ebg.peerconnect) Registering candidate");if(this.started){var i=new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate});try{this.pc.addIceCandidate(i,e.hitch(this,"onAddIceCandidateSuccess"),e.hitch(this,"onAddIceCandidateError"))}catch(a){this.logger.log("(ebg.peerconnect) PeerConnection.addIceCandidate failed with exception: "+a.message+(a.stack?" | "+a.stack:""));this.logger.flush()}}else this.logger.log("(ebg.peerconnect) No peerconnection available. Aborting.")}else this.logger.log("(ebg.peerconnect) Unknown message type")},onSetLocalSessionDescriptionSuccess:function(){this.logger.log("(ebg.peerconnect) Set local session description successfully");!0===webrtcConfig.iceTricklingEnabled&&this.sendLocalSessionDescription()},onSetLocalSessionDescriptionError:function(e){this.logger.log("(ebg.peerconnect) Failed to set local session description with error: "+JSON.stringify(e));this.logger.flush()},onSetRemoteSessionDescriptionSuccess:function(){this.logger.log("(ebg.peerconnect) Set remote session description successfully")},onSetRemoteSessionDescriptionError:function(e){this.logger.log("(ebg.peerconnect) Failed to set remote session description with error: "+JSON.stringify(e));this.logger.flush()},onAddIceCandidateSuccess:function(){this.logger.log("(ebg.peerconnect) Added ice candidate successfully")},onAddIceCandidateError:function(e){this.logger.log("(ebg.peerconnect) Failed to add ice candidate with error: "+JSON.stringify(e));this.logger.flush()},createPeerConnection:function(){var t=null;try{(t=new RTCPeerConnection(this.pcConfig,this.pcConstraints)).onicecandidate=e.hitch(this,"handleIceCandidate");t.onaddstream=e.hitch(this,"handleRemoteStreamAdded");t.onremovestream=e.hitch(this,"handleRemoteStreamRemoved");t.onsignalingstatechange=e.hitch(this,"onSignalingStateChanged");t.oniceconnectionstatechange=e.hitch(this,"onIceConnectionStateChanged");for(var i=JSON.parse(JSON.stringify(this.pcConfig)),a=0;a<i.iceServers.length;a++)if(void 0!==i.iceServers[a].credential){i.iceServers[a].username="********";i.iceServers[a].credential="********"}this.logger.log("(ebg.peerconnect) Created RTCPeerConnnection with config "+JSON.stringify(i)+" and constraints "+JSON.stringify(this.pcConstraints))}catch(n){this.logger.log("(ebg.peerconnect) Failed to create PeerConnection with exception: "+n.message+(n.stack?" | "+n.stack:""));this.logger.flush();alert("Error: failed to create the audio/video connection. Maybe you are using Edge? To use audio/video on BGA, we recommend Firefox or Chrome.")}return t},handleIceCandidate:function(e){if(null===e.candidate){this.logger.log("(ebg.peerconnect) End of candidates");!1===webrtcConfig.iceTricklingEnabled&&this.sendLocalSessionDescription()}else if(!0===webrtcConfig.iceTricklingEnabled){this.logger.log("(ebg.peerconnect) Handling ICE candidate");this.sendPlayerMessage_callback(this.peerId,{type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate})}},handleRemoteStreamAdded:function(e){this.logger.log("(ebg.peerconnect) Remote stream added");this.remoteVideo=$("videofeed_"+this.peerId);if(null!==this.remoteVideo){this.remoteVideo.srcObject=e.stream;this.remoteStream=e.stream}else this.logger.log("(ebg.peerconnect) No remote video object available. Aborting.")},handleRemoteStreamRemoved:function(e){this.logger.log("(ebg.peerconnect) Remote stream removed")},onSignalingStateChanged:function(e){null!==this.pc?this.logger.log("(ebg.peerconnect) Signaling state changed to: "+this.pc.signalingState):this.logger.log("(ebg.peerconnect) onSignalingStateChanged fired, but peerconnect object is null!")},onIceConnectionStateChanged:function(t){if(null!==this.pc){this.logger.log("(ebg.peerconnect) ICE connection state changed to: "+this.pc.iceConnectionState);if("connected"==this.pc.iceConnectionState||"completed"==this.pc.iceConnectionState){this.getConnectionDetails(this.pc).then(e.hitch(this,function(e){this.logger.log("(ebg.peerconnect) ICE connection details: "+JSON.stringify(e));this.logger.flush()}));if(null!=$("videofeed_"+this.peerId+"_spk")){e.addClass($("videofeed_"+this.peerId+"_spk"),"rtc_video_spk_on");e.removeClass($("videofeed_"+this.peerId+"_spk"),"rtc_video_spk_off")}if(null!=$("videofeed_"+this.peerId+"_cam")){e.addClass($("videofeed_"+this.peerId+"_cam"),"rtc_video_cam_on");e.removeClass($("videofeed_"+this.peerId+"_cam"),"rtc_video_cam_off")}}else{if(null!=$("videofeed_"+this.peerId+"_spk")){e.addClass($("videofeed_"+this.peerId+"_spk"),"rtc_video_spk_off");e.removeClass($("videofeed_"+this.peerId+"_spk"),"rtc_video_spk_on")}if(null!=$("videofeed_"+this.peerId+"_cam")){e.addClass($("videofeed_"+this.peerId+"_cam"),"rtc_video_cam_off");e.removeClass($("videofeed_"+this.peerId+"_cam"),"rtc_video_cam_on")}}}else this.logger.log("(ebg.peerconnect) onIceConnectionStateChanged fired, but peerconnect object is null!")},getConnectionDetails:function(e){var t={};if(window.chrome){var i=["googLocalAddress","googLocalCandidateType","googRemoteAddress","googRemoteCandidateType","bytesReceived","bytesSent"];return new Promise(function(a,n){e.getStats(function(e){var o=e.result().filter(function(e){return"true"==e.stat("googActiveConnection")})[0];if(!o)return n("Something is wrong...");i.forEach(function(e){t[e.replace("goog","")]=o.stat(e)});a(t)})})}return e.getStats(null).then(function(e){var i=e[Object.keys(e).filter(function(t){return e[t].selected})[0]],a=e[i.localCandidateId],n=e[i.remoteCandidateId];t.LocalAddress=[a.ipAddress,a.portNumber].join(":");t.RemoteAddress=[n.ipAddress,n.portNumber].join(":");t.LocalCandidateType=a.candidateType;t.RemoteCandidateType=n.candidateType;t.bytesReceived=i.bytesReceived;t.bytesSent=i.bytesSent;return t})},setLocalSessionDescription:function(t){try{this.pc.setLocalDescription(t,e.hitch(this,"onSetLocalSessionDescriptionSuccess"),e.hitch(this,"onSetLocalSessionDescriptionError"))}catch(i){this.logger.log("(ebg.peerconnect) PeerConnection.setLocalDescription failed with exception: "+i.message+(i.stack?" | "+i.stack:""));this.logger.flush()}},sendLocalSessionDescription:function(){this.logger.log("(ebg.peerconnect) Sending message with session description "+JSON.stringify(this.pc.localDescription));this.sendPlayerMessage_callback(this.peerId,this.pc.localDescription)}})})},"ebg/scriptlogger":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.scriptlogger",null,{constructor:function(e,t,i){this.logName=e;this.logBuffer=null;this.identifier=i;this.ajaxcall_callback=t;this.log("Client side "+this.logName+" log follows.")},log:function(e){if(null===this.logBuffer)this.logBuffer=e;else{var t=new Date,i=(void 0===this.identifier?"":this.identifier+" ")+t.getUTCFullYear()+("0"+(t.getUTCMonth()+1)).slice(-2)+("0"+t.getUTCDate()).slice(-2)+"-"+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)+":"+("00"+t.getUTCMilliseconds()).slice(-3)+"-UTC";this.logBuffer+="   "+i+" "+e}this.logBuffer+="\n"},flush:function(){this.ajaxcall_callback("/web/scriptlogger/"+this.logName+".html",{log:this.logBuffer,lock:!1},this,function(e){},function(e){this.logName},"post");this.logBuffer=null;this.log("Client side "+this.logName+" log follows.")}})})},"ebg/webpush":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.webpush",null,{constructor:function(t){this.ajaxcall_callback=t;this.serviceWorkerRegistered=!1;this.permissionAlreadyGranted=!1;this.permissionGranted=!1;this.pushSubscription=null;var i="/data/themereleases/";g_themeurl.substr(g_themeurl.indexOf(i)+20,11);this.l_serviceworker_url="/theme/js/bgaserviceworker.js";this.browser="";e.isChrome?this.browser="Google Chrome v"+e.isChrome:e.isIE?this.browser="Internet Explorer v"+e.isIE:e.isFF?this.browser="Mozilla Firefox v"+e.isFF:e.isSafari?this.browser="Safari v"+e.isSafari:e.isMozilla?this.browser="Mozilla v"+e.isMozilla:e.isOpera&&(this.browser="Opera v"+e.isOpera)},init:function(){if(!this.isSupported())return Promise.reject(new Error("Web push is not supported"));this.isAuthorized()&&(this.permissionAlreadyGranted=!0);return this.registerServiceWorker().then(e.hitch(this,function(){return this.askPermission()})).then(e.hitch(this,function(){return this.subscribeUserToPush()})).then(e.hitch(this,function(e){return this.savePushSubscription(e)}))},refresh:function(){if(!this.isSupported())return Promise.reject(new Error("Web push is not supported"));var t=location.href.split("/")[2],i=g_sitecore.domain,a="https://"+i+"/";try{navigator.serviceWorker.getRegistrations().then(e.hitch(this,function(e){for(var n=!1,o=0;o<e.length;++o){var s=e[o];s.scope;if(s.scope!=a){s.unregister();s.scope}else n=!0}n||t!=i||this.registerServiceWorker()}))}catch(n){console.error("Exception unregistering obsolete service workers: "+n.message)}},revoke:function(){},isSupported:function(){return"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")&&("serviceWorker"in navigator&&("PushManager"in window&&"Notification"in window))},isAuthorized:function(){return"granted"==Notification.permission},registerServiceWorker:function(){return navigator.serviceWorker.register(this.l_serviceworker_url,{scope:"../../"}).then(function(e){this.serviceWorkerRegistered=!0;e.update();return e}).then(null,function(e){this.serviceWorkerRegistered=!1;console.error("Unable to register service worker.",e)})},askPermission:function(){return new Promise(function(e,t){var i=Notification.requestPermission(function(t){e(t)});i&&i.then(e,t)}).then(function(e){if("granted"===e)this.permissionGranted=!0;else{this.permissionGranted=!1;console.error("We weren't granted permission.")}})},subscribeUserToPush:function(){return navigator.serviceWorker.register(this.l_serviceworker_url,{scope:"../../"}).then(function(e){var t={userVisibleOnly:!0,applicationServerKey:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(t),a=new Uint8Array(i.length),n=0;n<i.length;++n)a[n]=i.charCodeAt(n);return a}("BKh3NNRk5O5wx1_qS_TlvqadCSZ_GmdwpYYfsVMurznZ03mn0wgvh-lK84IMaljkLFfYEQpxN_e4mwrUwYAfbwU")};return e.pushManager.subscribe(t)}).then(function(e){JSON.stringify(e);return e})},savePushSubscription:function(e){this.pushSubscription=JSON.parse(JSON.stringify(e));this.ajaxcall_callback("/player/profile/savePushSubscription.html",{isnewbrowser:!this.permissionAlreadyGranted,browser:this.browser,endpoint:this.pushSubscription.endpoint,auth:this.pushSubscription.keys.auth,p256dh:this.pushSubscription.keys.p256dh,lock:!1},this,function(e){},function(e){},"post")}})})},"ebg/draggable":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.draggable",null,{constructor:function(){this.page=null;this.item_id=null;this.item_div=null;this.mouse_x_origin=null;this.mouse_y_origin=null;this.element_x_origin=null;this.element_y_origin=null;this.is_dragging=!1;this.is_disabled=!1;this.dragging_handler=null;this.dragging_handler_touch=null;this.bUseAutomaticZIndex=!0;this.automatic_z_index=!1;this.bGrid=!1;this.bSnap=!1;this.snapCallback=null;this.gridSize=10;this.draggedThisTime=!1;this.zoomFactorOriginalElement=1;this.parentRotation=0;this.event_handlers=[]},create:function(t,i,a){this.page=t;this.item_id=i;this.item_div=$(i);if(a){this.event_handlers.push(e.connect($(a),"onmousedown",this,"onMouseDown"));this.event_handlers.push(e.connect($(a),"ontouchstart",this,"onMouseDown"));e.style($(a),"cursor","move")}else{this.event_handlers.push(e.connect(this.item_div,"onmousedown",this,"onMouseDown"));this.event_handlers.push(e.connect(this.item_div,"ontouchstart",this,"onMouseDown"));e.style(this.item_div,"cursor","move")}this.event_handlers.push(e.connect($("ebd-body"),"onmouseup",this,"onMouseUp"));this.event_handlers.push(e.connect($("ebd-body"),"ontouchend",this,"onMouseUp"))},destroy:function(){for(var t in this.event_handlers)e.disconnect(this.event_handlers[t])},changeDraggableItem:function(e){this.item_id=e;this.item_div=$(e)},onMouseDown:function(t){e.stopEvent(t);if(!this.is_disabled){this.mouse_x_origin=t.pageX;this.mouse_y_origin=t.pageY;this.element_x_origin=e.style(this.item_div,"left");this.element_y_origin=e.style(this.item_div,"top");this.is_dragging=!0;this.parentRotation=this.page.getAbsRotationAngle(this.item_div.parentNode);this.dragging_handler&&e.disconnect(this.dragging_handler);this.dragging_handler_touch&&e.disconnect(this.dragging_handler_touch);this.dragging_handler=e.connect($("ebd-body"),"onmousemove",this,"onMouseMove");this.dragging_handler_touch=e.connect($("ebd-body"),"ontouchmove",this,"onMouseMove");for(var i=1,a=this.item_div;a.parentNode;){var n=e.style(a,"zoom");"number"!=typeof n&&"string"!=typeof n||(i*=n);var o=e.style(a,"transform");if("none"!=o&&"matrix("==o.substr(0,7)){var s=o.substr(7).split(",")[0],r=o.substr(7).split(",")[2],l=Math.sqrt(s*s+r*r);l>1e-4&&(i*=l)}if((a=a.parentNode).id&&"game_play_area"==a.id||"BODY"===a.tagName)break}this.zoomFactorOriginalElement=i;this.draggedThisTime=!1;this.onStartDragging(this.item_id,this.element_x_origin,this.element_y_origin)}},onMouseUp:function(t){if(!this.is_disabled&&!0===this.is_dragging){var i={x:t.pageX-this.mouse_x_origin,y:t.pageY-this.mouse_y_origin},a=this.page.vector_rotate(i,this.parentRotation);if(void 0!==this.page.gameinterface_zoomFactor){a.x=a.x/this.page.gameinterface_zoomFactor;a.y=a.y/this.page.gameinterface_zoomFactor}if(1!=this.zoomFactorOriginalElement){a.x=a.x/this.zoomFactorOriginalElement;a.y=a.y/this.zoomFactorOriginalElement}var n=a.x+this.element_x_origin,o=a.y+this.element_y_origin;this.bGrid&&(n=Math.round(n/this.gridSize)*this.gridSize);this.bGrid&&(o=Math.round(o/this.gridSize)*this.gridSize);this.is_dragging=!1;e.disconnect(this.dragging_handler);e.disconnect(this.dragging_handler_touch);e.removeClass(this.item_div,"dragging_in_progress");this.onEndDragging(this.item_id,n,o,this.draggedThisTime);this.dragging_handler=null;this.dragging_handler_touch=null;if(this.automatic_z_index){e.style(this.item_id,"zIndex","auto");this.automatic_z_index=!1}var s=Math.abs(n-this.element_x_origin)<10&&Math.abs(o-this.element_y_origin)<10;this.element_x_origin,this.element_y_origin;s&&"touchend"==t.type&&this.item_div.click()}},onMouseMove:function(t){if(!this.is_disabled&&!0===this.is_dragging){var i={x:t.pageX-this.mouse_x_origin,y:t.pageY-this.mouse_y_origin},a=this.page.vector_rotate(i,this.parentRotation);if(void 0!==this.page.gameinterface_zoomFactor){a.x=a.x/this.page.gameinterface_zoomFactor;a.y=a.y/this.page.gameinterface_zoomFactor}if(1!=this.zoomFactorOriginalElement){a.x=a.x/this.zoomFactorOriginalElement;a.y=a.y/this.zoomFactorOriginalElement}var n=a.x+this.element_x_origin,o=a.y+this.element_y_origin;if(this.bSnap&&0==this.parentRotation){var s=this.snapCallback(n,o);n=s.x;o=s.y}else if(this.bGrid){o=Math.round(o/this.gridSize)*this.gridSize;n=Math.round(n/this.gridSize)*this.gridSize}e.style(this.item_div,"left",n+"px");e.style(this.item_div,"top",o+"px");if(0==this.draggedThisTime){e.addClass(this.item_div,"dragging_in_progress");this.draggedThisTime=!0;if(this.bUseAutomaticZIndex&&"auto"==e.style(this.item_id,"zIndex")){this.automatic_z_index=!0;e.style(this.item_id,"zIndex",1e3)}}this.onDragging(this.item_id,n,o,n-this.element_x_origin,o-this.element_y_origin);e.stopEvent(t)}},disable:function(t){this.is_disabled=!0;this.item_div&&(t?e.style(this.item_div,"cursor",t):e.style(this.item_div,"cursor","default"))},enable:function(){this.is_disabled=!1;this.item_div&&e.style(this.item_div,"cursor","move")},onStartDragging:function(e,t,i){},onEndDragging:function(e,t,i,a){},onDragging:function(e,t,i,a,n){}})})},"ebg/resizable":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.resizable",null,{constructor:function(){this.page=null;this.item_id=null;this.item_div=null;this.mouse_x_origin=null;this.mouse_y_origin=null;this.element_x_origin=null;this.element_y_origin=null;this.is_dragging=!1;this.is_disabled=!1;this.element_w_origin=null;this.element_h_origin=null;this.dragging_handler=null;this.width_resize=!0;this.height_resize=!0;this.resize_parent=!1;this.automatic_z_index=!0},create:function(t,i,a,n,o,s){this.page=t;this.item_id=i;this.item_div=$(i);!1===n&&(this.width_resize=!1);!1===o&&(this.height_resize=!1);!0===s&&(this.resize_parent=!0);a?e.connect($(a),"onmousedown",this,"onMouseDown"):e.connect(this.item_div,"onmousedown",this,"onMouseDown");e.connect($("ebd-body"),"onmouseup",this,"onMouseUp")},onMouseDown:function(t){e.stopEvent(t);if(!this.is_disabled){var i=e.marginBox(this.item_div);this.element_w_origin=i.w;this.element_h_origin=i.h;this.mouse_x_origin=t.pageX;this.mouse_y_origin=t.pageY;var a=e.marginBox(this.item_div);this.element_x_origin=a.l;this.element_y_origin=a.t;this.is_dragging=!0;this.dragging_handler&&e.disconnect(this.dragging_handler);this.dragging_handler=e.connect($("ebd-body"),"onmousemove",this,"onMouseMove");this.onStartDragging(this.item_id,this.element_x_origin,this.element_y_origin);if("auto"==e.style(this.item_id,"zIndex")){this.automatic_z_index=!0;e.style(this.item_id,"zIndex",1e3)}}},onMouseUp:function(t){if(!this.is_disabled&&!0===this.is_dragging){var i=t.pageX-this.mouse_x_origin+this.element_x_origin,a=t.pageY-this.mouse_y_origin+this.element_y_origin;this.is_dragging=!1;e.disconnect(this.dragging_handler);this.onEndDragging(this.item_id,i,a);this.automatic_z_index&&e.style(this.item_id,"zIndex","auto")}},onMouseMove:function(t){t.preventDefault();if(!this.is_disabled&&!0===this.is_dragging){if(this.width_resize){var i=t.pageX-this.mouse_x_origin;e.style(this.item_div,"width",this.element_w_origin+i+"px")}if(this.height_resize){var a=t.pageY-this.mouse_y_origin;e.style(this.item_div,"height",this.element_h_origin+a+"px")}if(this.resize_parent&&this.item_div.parentNode){var n=e.marginBox(this.item_div);e.style(this.item_div.parentNode,"width",n.w+"px");e.style(this.item_div.parentNode,"height",n.h+"px")}this.onDragging(this.item_id,i,a)}},disable:function(t){this.is_disabled=!0;this.item_div&&(t?e.style(this.item_div,"cursor",t):e.style(this.item_div,"cursor","default"))},enable:function(){this.is_disabled=!1;this.item_div&&e.style(this.item_div,"cursor","move")},onStartDragging:function(e,t,i){},onEndDragging:function(e,t,i){},onDragging:function(e,t,i){}})})},"ebg/popindialog":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.popindialog",null,{constructor:function(){this.id=null;this.target_id=null;this.container_id="ebd-body";this.resizeHandle=null;this.closeHandle=null;this.bCloseIsHiding=!1;this.onShow=null;this.onHide=null;this.jstpl_standard_popin='<div id="popin_${id}" class="standard_popin"><h2 id="popin_${id}_title" class="standard_popin_title"></h2><a href="#" target="_blank" id="popin_${id}_help" class="standard_popin_helpicon"><i class="fa fa-question-circle-o fa-2x" aria-hidden="true"></i></a><a href="#" id="popin_${id}_close" class="standard_popin_closeicon"><i class="fa fa-times-circle fa-2x" aria-hidden="true"></i></a><div id="popin_${id}_contents" class="clear"></div></div>'},create:function(t,i){this.id=t;this.target_id=i;void 0===this.target_id&&(this.target_id=null!==$("main-content")?"main-content":"left-side");e.destroy("popin_"+this.id+"_underlay");e.place('<div id="popin_'+this.id+'_underlay" class="standard_popin_underlay"></div>',this.container_id);e.destroy("popin_"+this.id);e.place(e.string.substitute(this.jstpl_standard_popin,{id:this.id}),this.container_id);e.style("popin_"+this.id+"_help","display","none");this.closeHandle=e.connect($("popin_"+this.id+"_close"),"onclick",this,function(t){e.stopEvent(t);this.bCloseIsHiding?this.hide():this.destroy()});this.resizeHandle=e.connect(window,"onresize",this,"adjustSizeAndPosition")},destroy:function(t){if(null!=this.id){void 0===t&&(t=!0);e.disconnect(this.resizeHandle);if(t){if($("popin_"+this.id)){var i=e.fadeOut({node:"popin_"+this.id});e.connect(i,"onEnd",this,function(t){$("popin_"+this.id)&&e.destroy("popin_"+this.id)});i.play()}if($("popin_"+this.id+"_underlay")){var a=e.fadeOut({node:"popin_"+this.id+"_underlay"});e.connect(a,"onEnd",this,function(t){$("popin_"+this.id+"_underlay")&&e.destroy("popin_"+this.id+"_underlay");this.id=null});a.play()}}else{$("popin_"+this.id)&&e.destroy("popin_"+this.id);$("popin_"+this.id+"_underlay")&&e.destroy("popin_"+this.id+"_underlay")}}},replaceCloseCallback:function(t){e.disconnect(this.closeHandle);this.closeHandle=e.connect($("popin_"+this.id+"_close"),"onclick",this,t)},hideCloseIcon:function(){e.style("popin_"+this.id+"_close","display","none")},setTitle:function(e){if(null===this.id){console.error("You should CREATE this popindialog first");throw"You should CREATE this popindialog first"}$("popin_"+this.id+"_title").innerHTML=e},setZIndex:function(t){e.style("popin_"+this.id,"z-index",t)},setMaxWidth:function(t){if(null===this.id){console.error("You should CREATE this popindialog first");throw"You should CREATE this popindialog first"}e.style("popin_"+this.id,"maxWidth",t+"px")},setHelpLink:function(t){$("popin_"+this.id+"_help").href=t;e.style("popin_"+this.id+"_help","display","block")},setContent:function(e){if(null===this.id){console.error("You should CREATE this popindialog first");throw"You should CREATE this popindialog first"}$("popin_"+this.id+"_contents").innerHTML=e},adjustSizeAndPosition:function(){$("popin_"+this.id)&&"none"!=e.style("popin_"+this.id,"display")&&this.show(!1)},show:function(t){if(null===this.id){console.error("You should CREATE this popindialog first");throw"You should CREATE this popindialog first"}void 0===t&&(t=!0);e.style("popin_"+this.id+"_underlay","opacity","0");e.style("popin_"+this.id+"_underlay","display","block");e.style("popin_"+this.id,"opacity","0");e.style("popin_"+this.id,"display","inline-block");e.style("popin_"+this.id,"transform","");var i=e.position(this.container_id),a=e.position(this.target_id),n=e.position("popin_"+this.id),o=(e.style("popin_"+this.id,"top"),e.window.getBox()),s=43;"undefined"!=typeof gameui&&(s=65);var r=Math.max(o.t+s,(o.h-n.h)/2+o.t);e.style("popin_"+this.id,"top",r+"px");var l=a.x+a.w/2-n.w/2;l<0&&(l=Math.max(0,o.w/2-n.w/2));e.style("popin_"+this.id,"left",l+"px");if(e.hasClass("ebd-body","mobile_version")&&l+n.w>i.w){e.style("popin_"+this.id,"left","5px");var d=i.w/(n.w+10);e.style("popin_"+this.id,"transform","scale("+d+")");e.style("popin_"+this.id,"transform-origin","left center")}e.style("popin_"+this.id+"_underlay","width",i.w+"px");e.style("popin_"+this.id+"_underlay","height",i.h-s+"px");if(t){e.fadeIn({node:"popin_"+this.id+"_underlay"}).play();var c=e.animateProperty({node:"popin_"+this.id+"_underlay",properties:{opacity:.7}});e.connect(c,"onEnd",this,function(t){var i=e.position(this.container_id);e.style("popin_"+this.id+"_underlay","width",i.w+"px");e.style("popin_"+this.id+"_underlay","height",i.h-s+"px")});c.play();e.fadeIn({node:"popin_"+this.id}).play()}else{e.style("popin_"+this.id+"_underlay","opacity",.7);e.style("popin_"+this.id,"opacity",1)}null!==this.onShow&&this.onShow()},hide:function(t){if(null===this.id){console.error("You should CREATE this popindialog first");throw"You should CREATE this popindialog first"}void 0===t&&(t=!0);if(t){if($("popin_"+this.id+"_underlay")){e.fadeOut({node:"popin_"+this.id+"_underlay"}).play();var i=e.animateProperty({node:"popin_"+this.id+"_underlay",properties:{opacity:0}});e.connect(i,"onEnd",this,function(t){e.style("popin_"+this.id+"_underlay","display","none");e.style("popin_"+this.id,"display","none")});i.play()}$("popin_"+this.id)&&e.fadeOut({node:"popin_"+this.id}).play()}else{if($("popin_"+this.id+"_underlay")){e.style("popin_"+this.id+"_underlay","opacity",0);e.style("popin_"+this.id+"_underlay","display","none")}if($("popin_"+this.id)){e.style("popin_"+this.id,"opacity",0);e.style("popin_"+this.id,"display","none")}}null!==this.onHide&&this.onHide()}})})},"ebg/gamenotif":function(){define(["dojo","dojo/_base/declare","sentry"],function(e,t,i){return t("ebg.gamenotif",null,{constructor:function(){this.queue=[];this.next_log_id=0;this.game=null;this.dispatchedNotificationUids=[];this.checkSequence=!1;this.last_packet_id=0;this.channelLastPacketId={};this.notificationResendInProgress=!1;this.synchronous_notifs={};this.waiting_from_notifend=null;this.ignoreNotificationChecks={};this.moveSyncBuffer={};this.debugnotif_i=1;this.currentNotifCallback=null;this.onPlaceLogOnChannel=null;this.lastMsgTime=0;e.subscribe("notifEnd",this,"onSynchronousNotificationEnd")},onNotification:function(t){i.addBreadcrumb({category:"Notification",message:"Received centrifuge packet",level:"info",data:t});"string"==typeof t&&(t=e.fromJson(t));if("/table"===t.channel.substr(0,6)&&t.data){t.data.forEach(e=>{var t=null;e&&e.args&&e.args._notified_privately&&(t=e.args._notified_privately);if(t&&this.game&&t.includes(Number(this.game.player_id))){e.type="dummyTableNotif";e.log="";e.args=[]}});t.data.forEach(e=>{e&&e.args&&e.args._notified_privately&&delete e.args._notified_privately})}try{let i="/table"===t.channel.substr(0,6);if("/player"===t.channel.substr(0,7)&&void 0!==t.table_id&&null!==t.table_id&&(null===this.game||toint(this.game.table_id)!==toint(t.table_id)))return;let a=this.getChannelKey(t.channel),n=this.getLastPacketIdForChannel(a);if("single"===t.packet_type);else if("sequence"===t.packet_type&&this.checkSequence){if(!this.ensurePrevpacketDependenciesAreMet(t,a))return}else if("resend"===t.packet_type)toint(t.packet_id)>toint(n)&&t.packet_id;else if("history"===t.packet_type)for(const e in t.data){const i=t.data[e].type;if("chatmessage"===i||"wouldlikethink"===i);else{t.data[e].args.originalType=t.data[e].type;t.data[e].type="history_history";null!==this.game&&(t.data[e].gamenameorig=this.game.game_name)}}else t.packet_type;this.setLastPacketIdForChannel(a,t.packet_id,i);const o=t.data.length;for(let e=0;e<o;e++){t.data[e].channelorig=t.channel;void 0!==t.gamename&&(t.data[e].gamenameorig=t.gamename);void 0!==t.time&&(t.data[e].time=t.time);void 0!==t.move_id&&i&&(t.data[e].move_id=t.move_id)}if(t.chatmessage||"history"===t.packet_type||"single"===t.packet_type)for(let e=0;e<o;e++)this.dispatchNotification(t.data[e]);else{if(!t.move_id){for(let a=0;a<o;a++){t.data[a].bIsTableMsg=i;i&&t.move_id&&(t.data[a].move_id=t.move_id);i&&t.table_id&&(t.data[a].table_id=t.table_id);this.queue.push(t.data[a]);t.data[a].lock_uuid&&e.publish("lockInterface",[{status:"queued",bIsTableMsg:i,uuid:t.data[a].lock_uuid}])}this.queue.length;this.dispatchNotifications();return}this.pushToSyncBuffer(t,i)}}catch(a){let t="";$("logs")&&e.style("logs","display","block");this.currentNotifCallback&&(t+="During notification "+this.currentNotifCallback+"\n");t+=a.message+"\n";t+=a.stack||a.stacktrace||"no_stack_avail";this.game?this.game.onScriptError(t,"",""):mainsite.onScriptError(t,"","")}},resynchronizeNotifications:function(e){if(!this.notificationResendInProgress){this.notificationResendInProgress=!0;var t=this.game.game_name,i=e?1:0;void 0!==globalThis.g_replayFrom&&(i=0);this.game.ajaxcall("/"+t+"/"+t+"/notificationHistory.html",{table:this.game.table_id,from:toint(this.last_packet_id)+1,privateinc:1,history:i},this,function(e){0==e.data.length&&void 0!==globalThis.g_replayFrom&&this.game.onEndOfReplay();var t=[];for(var a in e.data)t.push(a);t.sort(function(t,i){return e.data[i]-e.data[t]});if("undefined"!=typeof gameui&&0==gameui.log_history_loading_status.downloaded){gameui.log_history_loading_status.downloaded=1;gameui.log_history_loading_status.total=t.length;gameui.updateLoaderPercentage()}this.logs_to_load=e.data;this.logs_to_load_sortedNotifsKeys=t;this.logs_to_load_loadhistory=i;this.logs_to_load_bMaskStillActive=!0;this.logs_to_load_bFirst=!0;this.pullResynchronizeLogsToDisplay()},function(e){this.notificationResendInProgress=!1})}},pullResynchronizeLogsToDisplay:function(){for(var t,i=0;i<10;i++){if(void 0===(t=this.logs_to_load_sortedNotifsKeys.shift())){if(this.logs_to_load_loadhistory&&this.game&&$("move_nbr")&&toint($("move_nbr").innerHTML)>1){var a="/"+this.game.gameserver+"/"+this.game.game_name+"?table="+this.game.table_id+"&replayLastTurn=1&replayLastTurnPlayer="+this.game.player_id;this.addToLog('<p style="text-align:center;"><a href="'+a+'" class="bgabutton bgabutton_gray replay_last_move_button"><span class="flex gap-2 items-center"><img class="h-6 w-6" src="'+getStaticAssetUrl("img/mainsite/archive_history.png")+'" alt="history"/><span>'+__("lang_mainsite","Replay last moves")+"</span></span></a></p>",!1,!1,"replay_last_moves")}gameui.log_history_loading_status.loaded=gameui.log_history_loading_status.total;gameui.updateLoaderPercentage();return}if(this.game&&void 0!==globalThis.g_replayFrom){bLast=t==this.logs_to_load.length-1;if(this.logs_to_load_bFirst)this.logs_to_load_bFirst=!1;else if(null!==this.logs_to_load[t].move_id){this.logs_to_load[t].data.unshift({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"end_replaywaitingdelay",uid:this.archive_uuid+10});this.logs_to_load[t].data.unshift({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"replaywaitingdelay",uid:this.archive_uuid+11})}if(this.logs_to_load_bMaskStillActive&&toint(this.logs_to_load[t].move_id)>=toint(globalThis.g_replayFrom)){this.logs_to_load_bMaskStillActive=!1;this.logs_to_load[t].data.unshift({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"end_replayinitialwaitingdelay",uid:this.archive_uuid+20});this.logs_to_load[t].data.unshift({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"replayinitialwaitingdelay",uid:this.archive_uuid+21})}bLast&&this.game&&void 0!==globalThis.g_replayFrom&&this.logs_to_load[t].data.push({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"replay_has_ended",uid:this.archive_uuid+30})}this.onNotification(this.logs_to_load[t])}if("undefined"!=typeof gameui){gameui.log_history_loading_status.loaded=parseInt(t)+1;gameui.updateLoaderPercentage()}setTimeout(e.hitch(this,"pullResynchronizeLogsToDisplay"),0)},pushToSyncBuffer:function(e,t){const i=e.move_id;if(void 0===i)return;void 0===this.moveSyncBuffer[i]&&(this.moveSyncBuffer[i]={packets:[],dependencies:{}});const a=this.moveSyncBuffer[i];this.mergeMoveDependencies(a,this.determineMoveChannelDependencies(e));a.packets.push({notifs:e,bIsTableMsg:!0===t});a.packets.filter(e=>!0===e.bIsTableMsg).length>0&&this.areMoveDependenciesSatisfied(a)?this.flushMoveBuffer(i):(a.dependencies,this.channelLastPacketId,a.hasPublicPacket)},flushMoveBuffer:function(e){const t=this.moveSyncBuffer[e];if(t&&t.packets&&0!==t.packets.length){this.processSynchronizedMoveNotifications(t.packets);delete this.moveSyncBuffer[e]}},mergeMoveDependencies:function(e,t){if(e){e.dependencies||(e.dependencies={});if(t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(i.startsWith("/player/p")&&!this.game||Object.prototype.hasOwnProperty.call(e.dependencies,i)||(e.dependencies[i]=t[i]))}},areMoveDependenciesSatisfied:function(e){if(!e||!e.dependencies)return!0;for(const t in e.dependencies)if(Object.prototype.hasOwnProperty.call(e.dependencies,t)&&!1===e.dependencies[t])return!1;return!0},processSynchronizedMoveNotifications:function(t){if(!t||0===t.length)return;const i=[],a=[];for(let e=0;e<t.length;e++){const n=t[e];n&&n.notifs&&(n.bIsTableMsg?i.push(n):a.push(n))}const n=[];for(let e=0;e<a.length;e++){const t=a[e],i=t.notifs.data?t.notifs.data:[];for(let e=0;e<i.length;e++){const a=i[e];t.notifs.move_id&&void 0===a.move_id&&(a.move_id=t.notifs.move_id);t.notifs.table_id&&void 0===a.table_id&&(a.table_id=t.notifs.table_id);a.bIsTableMsg=!1;n.push(a)}}if(0===i.length){this.enqueueRemainingBufferedNotifications(n);this.queue.length;this.dispatchNotifications();return}let o=0;for(let s=0;s<i.length;s++){const t=i[s].notifs,a=t&&t.data?t.data:[];for(let i=0;i<a.length;i++){const s=a[i];if(!this.isReplayTimingNotification(s)){this.mergePlayerNotifsForCounter(n,o);o++}s.bIsTableMsg=!0;t.move_id&&(s.move_id=t.move_id);t.table_id&&(s.table_id=t.table_id);this.queue.push(s);s.lock_uuid&&e.publish("lockInterface",[{status:"queued",bIsTableMsg:!0,uuid:s.lock_uuid}])}}this.mergePlayerNotifsForCounter(n,o);this.enqueueRemainingBufferedNotifications(n);this.queue.length;this.dispatchNotifications()},mergePlayerNotifsForCounter:function(t,i){if(t)for(let a=0;a<t.length;a++){const n=t[a];if(n&&!n._queued&&(void 0!==n.synchro&&toint(n.synchro)===toint(i))){n._queued=!0;void 0===n.bIsTableMsg&&(n.bIsTableMsg=!1);this.queue.push(n);n.lock_uuid&&e.publish("lockInterface",[{status:"queued",bIsTableMsg:!0===n.bIsTableMsg,uuid:n.lock_uuid}])}}},enqueueRemainingBufferedNotifications:function(t){if(t)for(let i=0;i<t.length;i++){const a=t[i];if(a&&!a._queued){a._queued=!0;void 0===a.bIsTableMsg&&(a.bIsTableMsg=!1);this.queue.push(a);a.lock_uuid&&e.publish("lockInterface",[{status:"queued",bIsTableMsg:!0===a.bIsTableMsg,uuid:a.lock_uuid}])}}},ensurePrevpacketDependenciesAreMet:function(e,t){if(!e||!e.prevpacket)return!0;for(const a in e.prevpacket){if(!Object.prototype.hasOwnProperty.call(e.prevpacket,a))continue;const n=this.resolvePrevpacketChannelKey(a,e,t);if(!n||n===t)continue;if(void 0===this.channelLastPacketId[n])continue;const o=this.getLastPacketIdForChannel(n),s=toint(e.prevpacket[a]);if(!isNaN(s)&&s>o){console.error("Notification dependency not yet satisfied.",{sourceChannelKey:t,dependencyChannelKey:n,expected:s,lastKnown:o});i.captureMessage("Notification dependency not yet satisfied.");this.resynchronizeNotifications(!1);return!1}}return!0},resolvePrevpacketChannelKey:function(e,t,i){if(null==e)return null;if(0===e||"0"===e)return t&&t.table_id?`/table/t${t.table_id}`:t&&t.channel&&"/table"===t.channel.substr(0,6)?this.getChannelKey(t.channel):null;const a=toint(e);return isNaN(a)?null:`/player/p${a}`},determineMoveChannelDependencies:function(e){const t={};if(!e||!e.prevpacket)return t;const i=this.getChannelKey(e.channel);for(const a in e.prevpacket){if(!Object.prototype.hasOwnProperty.call(e.prevpacket,a))continue;const n=this.resolvePrevpacketChannelKey(a,e,i);if(!n||void 0===this.channelLastPacketId[n])continue;const o=toint(e.prevpacket[a]);if(isNaN(o))continue;const s=this.getLastPacketIdForChannel(n);t[n]=o<=s}return t},isReplayTimingNotification:function(e){return!(!e||!e.type)&&["replaywaitingdelay","end_replaywaitingdelay","replayinitialwaitingdelay","end_replayinitialwaitingdelay"].indexOf(e.type)>=0},getChannelKey:function(e){return e||"unknown"},getLastPacketIdForChannel:function(e){void 0===this.channelLastPacketId[e]&&(this.channelLastPacketId[e]=1);return this.channelLastPacketId[e]},setLastPacketIdForChannel:function(e,t,i){if("string"==typeof t||"number"==typeof t){this.channelLastPacketId[e]=toint(t);i&&(this.last_packet_id=toint(t))}},dispatchNotifications:function(){this.waiting_from_notifend,this.queue.length;$("logs")&&e.style("logs","display","none");for(var t=!1,a=!1;this.queue.length>0;){if(null!==this.waiting_from_notifend){this.waiting_from_notifend;e.style("logs","display","block");return a}var n=this.queue.shift();n.type;if(n.uid&&this.dispatchedNotificationUids.includes(n.uid))i.captureMessage("Message already received: skipped");else{t=this.dispatchNotification(n,t);a=!0;if(void 0!==this.synchronous_notifs[n.type]){$("synchronous_notif_icon")&&e.style("synchronous_notif_icon","display","inline");e.style("logs","display","block");return a}"undefined"!=typeof gameui&&gameui&&gameui.onEndOfNotificationDispatch&&gameui.onEndOfNotificationDispatch();if(void 0!==this.bStopAfterOneNotif&&this.bStopAfterOneNotif)break}}a&&this.game&&this.game.onNotificationPacketDispatched();$("logs")&&e.style("logs","display","block");return a},formatLog:function(e,t){var i="";if(""!=e)if(this.game){if(void 0!==t){const a="function"==typeof structuredClone?structuredClone(t):JSON.parse(JSON.stringify(t)),n=this.playerNameFilterGame(a);i=this.game.format_string_recursive(e,n)}}else{t=this.playerNameFilter(t);i=mainsite.format_string_recursive(e,t)}return i},dispatchNotification:function(t,i){this.currentNotifCallback=t.type;if("undefined"!=typeof mainsite&&mainsite.filterNotification(t))return!1;if(t.uid&&this.dispatchedNotificationUids.includes(t.uid))return!1;const a=document.getElementById("debug_output");if(a){var n='<div>< <i><a href="#" id="replay_notif_'+this.debugnotif_i+'">'+t.type+'</a></i><br/><div class="notifparams" id="debugnotif_'+this.debugnotif_i+'">'+e.toJson(t.args)+"</div></div>";a.insertAdjacentHTML("afterbegin",n);e.connect($("replay_notif_"+this.debugnotif_i),"onclick",this,"debugReplayNotif");this.debugnotif_i++}t.bIsTableMsg&&!this.game&&"tablechat"!=t.type&&"tableInfosChanged"!=t.type&&"refuseGameStart"!=t.type&&"newRTCMode"!=t.type&&(t.log="");"undefined"!=typeof mainsite&&"privatechat"==t.type&&"player"==mainsite.chatDetached.type&&toint(t.args.player_id)!=toint(mainsite.chatDetached.id)&&toint(t.args.target_id)!=toint(mainsite.chatDetached.id)&&(t.log="");if("undefined"!=typeof mainsite&&mainsite.bUnderage&&"chat"==t.type&&"/chat/general"==t.channelorig)return!1;var o=!!this.ignoreNotificationChecks[t.type]&&this.ignoreNotificationChecks[t.type](t);"history_history"==t.type&&(o=!!this.ignoreNotificationChecks[t.args.originalType]&&this.ignoreNotificationChecks[t.args.originalType](t));if(void 0!==t.log&&void 0!==t.args&&!o)if(""!=t.log||"startWriting"==t.type||"stopWriting"==t.type){var s=!1;null!==this.onPlaceLogOnChannel&&void 0!==t.channelorig&&(s=this.onPlaceLogOnChannel(e.clone(t)));if(!s){var r=t.args.logaction;n=this.formatLog(t.log,t.args);"undefined"!=typeof mainsite&&(n=mainsite.makeClickableLinks(n,!0));if("chatmessage"!=t.type&&"wouldlikethink"!=t.type||null===this.game){var l=this.addToLog(n,t.args.seemore,r,null!==this.game,"chat"==t.type||"groupchat"==t.type||"chatmessage"==t.type||"tablechat"==t.type||"privatechat"==t.type||"startWriting"==t.type||"stopWriting"==t.type,"history_history"==t.type||void 0!==t.loadprevious,t.time);void 0!==t.move_id&&e.publish("addMoveToLog",[l,t.move_id])}else this.addToLog(n,t.args.seemore)}}else(this.log_notification_name,1)&&this.log_notification_name&&this.addToLog("<i>("+t.type+")</i>","");if(void 0!==t.move_id&&$("move_nbr")){if($("move_nbr").innerHTML!=t.move_id){$("move_nbr").innerHTML=t.move_id;$("images_status_text")&&null!==t.move_id&&($("images_status_text").innerHTML=_("Move")+" "+t.move_id);this.game&&this.game.onNextMove(t.move_id)}this.game&&this.game.onMove();if(this.game&&1==this.game.instantaneousMode&&void 0!==globalThis.g_replayFrom)if(toint(t.move_id)>=toint(globalThis.g_replayFrom)){this.game.instantaneousMode=!1;e.query(".dijitDialog").forEach(e.destroy);e.query(".dijitDialogUnderlayWrapper").forEach(e.destroy);setTimeout(e.hitch(this,function(){this.game.setLoader(100)}),1500);this.game.setLoader(100)}else{var d=Math.floor(100*toint(t.move_id)/toint(globalThis.g_replayFrom));this.game.setLoader(d)}}t.lock_uuid&&e.publish("lockInterface",[{status:"dispatched",uuid:t.lock_uuid,bIsTableMsg:t.bIsTableMsg}]);if(void 0!==this.synchronous_notifs[t.type]){null!==this.waiting_from_notifend&&console.error("Setting a synchronous notification while another one is in progress !");t.uid;this.waiting_from_notifend=t;var c=this.synchronous_notifs[t.type];if(c>0){(this.game&&1==this.game.instantaneousMode||o)&&(c=1);setTimeout("endnotif()",c)}else o&&setTimeout("endnotif()",1)}if("string"==typeof t.uid&&t.uid&&"archivewaitingdelay"!=t.uid.substr(0,19)){globalThis.g_last_msg_dispatched_uid=t.uid;this.dispatchedNotificationUids.push(t.uid);this.dispatchedNotificationUids.length>50&&this.dispatchedNotificationUids.shift()}!o&&e.publish(t.type,[t]);void 0===this.synchronous_notifs[t.type]&&t.lock_uuid&&e.publish("lockInterface",[{status:"updated",uuid:t.lock_uuid,bIsTableMsg:t.bIsTableMsg}]);if(o);else if(this.game&&1==this.game.instantaneousMode);else if(this.game&&void 0!==this.game.bDisableSoundOnMove&&this.game.bDisableSoundOnMove);else if("chatmessage"==t.type||"tablechat"==t.type||"privatechat"==t.type||"groupchat"==t.type){var u=0;"undefined"!=typeof current_player_id&&(u=current_player_id);"undefined"!=typeof gameui&&void 0!==gameui.player_id&&(u=gameui.player_id);void 0!==t.args.text&&null===t.args.text||void 0!==t.args.player_id&&t.args.player_id==u||playSound("chatmessage")}else if(!i&&null!==this.game&&"playerstatus"!=t.type&&t.log){i=!0;"undefined"!=typeof gameui&&gameui.bDisableNextMoveOnNextSound?gameui.bDisableNextMoveOnNextSound=!1:playSound("move")}this.game&&this.game.adaptStatusBar();this.currentNotifCallback=null;return i},addChatToLog:function(t,i,a,n){void 0===a&&(a=!0);void 0===n&&(n="");if($("chatlogs")){var o=this.next_log_id;this.next_log_id++;var s="chatlogs",r=15e3;if(this.game&&this.game.instantaneousMode){r=0;s="logs"}var l='<div class="roundedbox roundedboxenlighted log logchat '+n+'" id="log_'+o+'"><div class="roundedbox_top"><div class="roundedbox_topleft"></div><div class="roundedbox_topmain"></div><div class="roundedbox_topright"></div></div><div class="roundedbox_main"></div><div class="roundedbox_bottom"><div class="roundedbox_bottomleft"></div><div class="roundedbox_bottommain"></div><div class="roundedbox_bottomright"></div></div><div class="roundedboxinner">';i&&(this.game?l+='<a href="'+this.game.metasiteurl+"/"+i+'" target="_blank" class="seemore"><div class="icon16 icon16_seemore"></div></a>':l+='<a href="'+i+'" class="seemore"><div class="icon16 icon16_seemore"></div></a>');this.game?l+=this.game.addSmileyToText(t):l+=mainsite.addSmileyToText(t);a&&(l+='<div class="translate_icon" id="logtr_'+o+'" title="'+_("Translate with Google")+'"></div>');l+="</div></div>";e.place(l,s,"first");a&&$("logtr_"+o)&&e.connect($("logtr_"+o),"onclick",this,"onTranslateLog");var d="log_"+o;e.style(d,"display","none");e.fx.chain([e.fx.wipeIn({node:d}),e.animateProperty({node:$(d),delay:5e3,properties:{color:{end:"#000000"},onEnd:function(t){e.style(t,"display","block")}}})]).play();r>0&&setTimeout(e.hitch(this,function(){var t=e.clone($(d));e.destroy(d);e.place(t,"logs","first");e.style(t,"position","relative");e.style(t,"top","-10px");e.animateProperty({node:t,delay:200,properties:{top:{end:0,unit:"px"}}}).play();$("logtr_"+o)&&e.connect($("logtr_"+o),"onclick",this,"onTranslateLog")}),r)}},onTranslateLog:function(e){e.preventDefault();e.stopPropagation();var t=e.currentTarget.parentElement,i=t.innerHTML;i=(i=(i=(i=(i=(i=i.replace(/<!--PNS.*--PNE-->/gi,"")).replace(/<b><a.*a><\/b> /gi,"")).replace(/<a href.*<br>/gi,"")).replace(/<span.*span> /gi,"")).replace(/<div.*div>/gi,"")).replace(/&nbsp;/gi," ");var a=encodeURIComponent(i),n=dojoConfig.locale;switch(n){case"zh":n="zh-TW";break;case"zh-cn":n="zh-CN";break;case"he":n="iw"}var o="translateChat",s=a;s+=" "+a.length;s+=" "+n;if(this.game){s="[P"+this.game.player_id+"@T"+this.game.table_id+"] "+s;this.game.ajaxcall("/web/scriptlogger/"+o+".html",{log:s,lock:!1},this,function(e){},function(e){},"post")}else{var r=t.parentElement.parentElement.id,l=r.split("_")[2],d=r.split("_")[3];"privatechat"!=l&&"table"!=l&&(l="generalchat");s="[P"+current_player_id+"@"+("table"==l?"T"+d:l)+"] "+s;mainsite.ajaxcall("/web/scriptlogger/"+o+".html",{log:s,lock:!1},this,function(e){},function(e){e||mainsite},"post")}window.open("http://translate.google.com/#auto/"+n+"/"+a)},addToLog:function(t,i,a,n,o,s,r){void 0===o&&(o=!1);void 0===s&&(s=!1);var l="";o&&(l="spectator_chat");if($("logs")){var d=this.next_log_id;this.next_log_id++;var c='<div class="log '+l+'" id="log_'+d+'"><div class="roundedbox">';i&&(this.game?c+='<a href="'+this.game.metasiteurl+"/"+i+'" target="_blank" class="seemore"><div class="icon16 icon16_seemore"></div></a>':c+='<a href="'+i+'" class="seemore"><div class="icon16 icon16_seemore"></div></a>');o&&"undefined"!=typeof mainsite?c+=mainsite.addSmileyToText(t):o&&this.game?c+=this.game.addSmileyToText(t):c+=t;o&&(n||(c+='<div class="translate_icon '+(i?"translate_icon_seemore":"")+'" id="logtr_'+d+'" title="'+_("Translate with Google")+'"></div>'));if(null==this.game&&a){c+='<div class="logaction"><a href="#" id="logaction_'+d+'">['+(t=this.formatLog(a.log,a.args))+"]</a></div>"}c+="</div>";if(void 0!==r){var u=this.lastMsgTime,h=r;if(Math.floor(u/60)!=Math.floor(h/60)){var p=new Date(1e3*u),m=new Date(1e3*h);if(p.toLocaleDateString()!=m.toLocaleDateString())var g=m.toLocaleDateString()+" "+m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});else g=m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});c+='<div class="timestamp">'+g+"</div>";this.lastMsgTime=h}}c+="</div>";e.place(c,"logs","first");n||$("logtr_"+d)&&e.connect($("logtr_"+d),"onclick",this,"onTranslateLog");null==this.game&&a&&$("logaction_"+d)&&e.connect($("logaction_"+d),"onclick",this,function(t){e.stopEvent(t);a.action_analytics&&analyticsPush(a.action_analytics);mainsite.ajaxcall(a.action,a.action_arg,this,function(){})});var f="log_"+d;e.style(f,"display","none");if(s){e.style(f,"color","black");e.style(f,"display","block")}else e.fx.chain([e.fx.wipeIn({node:f}),e.animateProperty({node:$(f),delay:5e3,properties:{color:{end:"#000000"},onEnd:function(t){e.style(t,"display","block")}}})]).play()}else if(null!==this.onPlaceLogOnChannel){var b={channelorig:"/chat/general",args:{},log:t,type:"service",time:Math.min((new Date).getTime()/1e3)};bNotifSend=this.onPlaceLogOnChannel(b)}return d},playerNameFilter:function(e){if(e.player_name&&e.player_id){var t="";e.is_admin&&"0"!=e.is_admin&&(t=' style="color: red;"');e.player_name='<b><a href="/player?id='+e.player_id+'" class="playername"'+t+">"+e.player_name+"</a></b>"}return e},playerNameFilterGame:function(e){if(void 0!==e){if(this.game)for(argname in e)if("i18n"!=argname&&"object"==typeof e[argname])null!==e[argname]&&void 0!==e[argname].log&&void 0!==e[argname].args&&(e[argname].args=this.playerNameFilterGame(e[argname].args));else if(argname.match(/^player_name(\d+)?$/)){var t="",i="";for(var a in this.game.gamedatas.players)if(this.game.gamedatas.players[a].name==e[argname]){t=this.game.gamedatas.players[a].color;i="";this.game.gamedatas.players[a].color_back&&(i="background-color:#"+this.game.gamedatas.players[a].color_back+";");break}e[argname]=""!=t?'\x3c!--PNS--\x3e<span class="playername" style="color:#'+t+";"+i+'">'+e[argname]+"</span>\x3c!--PNE--\x3e":'\x3c!--PNS--\x3e<span class="playername">'+e[argname]+"</span>\x3c!--PNE--\x3e"}return e}},setSynchronous:function(e,t){this.synchronous_notifs[e]=void 0===t?-1:t},setSynchronousDuration:function(e){this.game&&this.game.instantaneousMode&&(e=1);setTimeout("endnotif()",e)},isSynchronousNotifProcessed:function(){return null!==this.waiting_from_notifend},setIgnoreNotificationCheck:function(e,t){this.ignoreNotificationChecks[e]=t},onSynchronousNotificationEnd:function(){if(null!==this.waiting_from_notifend){this.waiting_from_notifend.uid;this.waiting_from_notifend.lock_uuid&&e.publish("lockInterface",[{status:"updated",uuid:this.waiting_from_notifend.lock_uuid,bIsTableMsg:this.waiting_from_notifend.bIsTableMsg}]);$("synchronous_notif_icon")&&e.style("synchronous_notif_icon","display","none");this.waiting_from_notifend=null;"undefined"!=typeof gameui&&gameui&&gameui.onEndOfNotificationDispatch&&gameui.onEndOfNotificationDispatch();void 0!==this.bStopAfterOneNotif&&this.bStopAfterOneNotif||this.dispatchNotifications()}else{console.error("Received a notifEnd message while not waiting for a notification !!");i.captureMessage("Received a notifEnd message while not waiting for a notification !!")}},debugReplayNotif:function(t){t.preventDefault();var i=t.currentTarget.id.substr(13),a={};a.type=$("replay_notif_"+i).innerHTML;var n=$("debugnotif_"+i).innerHTML;a.args=e.fromJson(n);this.dispatchNotification(a,!1)}})})},"ebg/core/mainsite":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/gamenotif","dojo/back","dojo/hash","dojox/dtl/filter/strings","ebg/core/sitecore","ebg/chatinput","ebg/lazyload","ebg/invitefriends","ebg/acceptgamestart"],function(e,t,i){gotourl=function(e){mainsite.gotourl(e)};return t("ebg.core.mainsite",ebg.core.sitecore,{constructor:function(){this.currentUrl=null;this.forget_next_navigation_step=!1;this.websitemodule=null;this.general_input=new ebg.chatinput;this.current_table_id=null;this.current_table_subscription=null;this.current_seal=null;this.next_module_load_id=0;this.disableNextHashChange=!1;this.bCurrentModuleLoaded=!1;this.friendList=[];this.gamefilter=[];this.groupList={};this.allGroupList={};this.allLanguagesList={};this.friendLocalStatus={};this.pma=!1;this.credentials;this.asyncTableInfos={};this.afterPlayerTableInfos={};this.acceptGameStart=null;this.bAnimatePageTitle=!1;this.bAnimatePageTitleForGameStart=!1;this.ajaxPageLoadInProgress=null;this.messageEventQueue=[]},create:function(t){g_i18n.setJsBundlesVersion(this.jsbundlesversion);g_i18n.setActiveBundle("lang_mainsite");this.init_core();this.onMetasiteLogin(t);e.connect($("ebd-body"),"onclick",this,"onClickOnPage");e.connect(window,"popstate",this,"onPopState");this.attachToNewParentNoReplace("connect_status","connect_status_wrapper");this.attachToNewParentNoReplace("overall_messages_wrapper_source","overall_messages_wrapper");this.bChatDetached=null!==this.chatDetached.type;var a=window.addEventListener?"addEventListener":"attachEvent";(0,window[a])("attachEvent"==a?"onmessage":"message",e.hitch(this,function(e){e.origin.startsWith("https://forum.boardgamearena.com")&&(this.websitemodule&&this.websitemodule.isInstanceOf(ebg.site.forum)?this.websitemodule.processEvent(e):this.messageEventQueue.push(e))}),!1);if(!this.bChatDetached){e.subscribe("gotourl",this,"onGoToUrl");e.subscribe("updateAudienceStats",this,"onUpdateConnectedNumber")}this.initCentrifuge();e.connect(window,"onresize",this,e.hitch(this,"adaptMainMenu"));this.adaptMainMenu();e.connect(window,"onclick",this,"onCloseAllDropdown");this.addTooltip("toggleSound","",__("lang_mainsite","Switch the sound on/off"));this.register_subs(e.subscribe("playerstatus",this,"onPlayerStatusChanged"));require.on("error",e.hitch(this,function(e){if("object"==typeof e.info){var t=e.info[0];if(void 0===t)this.showMessage("Sorry, we cannot load your page","error");else{var i=t.indexOf("/js/modules/site/");if(-1!=i){var a=t.indexOf(".js?");i+=17;-1!=a&&(t=t.substr(0,a));var n=t.substr(i);this.showMessage("Page not found: "+n,"error");this.gotourl(this.homepage);return}this.showMessage("Sorry, we cannot load "+t,"error")}}else{this.showMessage("Page not found","error");this.gotourl(this.homepage)}}));this.bChatDetached||this.loadpagefromhash(!0);e.subscribe("signalVisitorNotAllowed",this,"onNotAllowed");if(this.bChatDetached){if("global"==this.chatDetached.type){if(current_player_id>0){this.general_input.create(this,"general_chatinput","/chat/chat/say.html",__("lang_mainsite","Discuss with everyone"));this.subscribeCentrifugeChannel("/chat/general",this.notifqueue,"onNotification")}}else if("table"==this.chatDetached.type){this.general_input.create(this,"general_chatinput","/table/table/say.html",_("Discuss at this table"));this.general_input.baseparams={table:this.chatDetached.id};this.subscribeCentrifugeChannel("/table/t"+this.chatDetached.id,this.notifqueue,"onNotification")}else if("player"==this.chatDetached.type){this.general_input.create(this,"general_chatinput","/player/player/say.html",_("Discuss with")+" "+this.chatDetached.chatname);this.general_input.baseparams={to:this.chatDetached.id};this.subscribeCentrifugeChannel("/player/p"+current_player_id,this.notifqueue,"onNotification")}else if("group"==this.chatDetached.type){this.general_input.create(this,"general_chatinput","/group/group/say.html",_("Discuss with the group"));this.general_input.baseparams={to:this.chatDetached.id};this.subscribeCentrifugeChannel("/group/g"+this.chatDetached.id,this.notifqueue,"onNotification")}this.setPageTitle(this.chatDetached.chatname)}else{this.general_input.detachType="global";this.general_input.bIncreaseHeightToTop=!1;this.general_input.detachId=0;this.general_input.callbackAfterChat=e.hitch(this,function(t){var i=["Carcassonne","Love Letter","Lost Cities","Builders","Batisseurs"];for(var a in i){var n=i[a];-1!=t.msg.toLowerCase().indexOf(n.toLowerCase())&&this.showMessage(e.string.substitute(_("Do not wait and play ${game} now: ${action}."),{game:n,action:'<a href="/premium?src=chatprompt">'+_("Go Premium")+"</a>"}),"info")}});this.general_input.create(this,"general_chatinput","/chat/chat/say.html",__("lang_mainsite","Discuss with everyone"))}i.stores.userInfos.subscribe(()=>{});i.stores.userPrefs.subscribe(()=>{});i.stores.gameTags.subscribe(()=>{});i.stores.games.subscribe(()=>{});i.stores.friends.subscribe(()=>{});i.stores.tables.subscribe(()=>{});i.stores.notifications.subscribe(()=>{});i.stores.discussions.subscribe(()=>{});i.stores.menuStates.subscribe(()=>{});i.stores.recentSearches.subscribe(()=>{});i.stores.deviceMode.subscribe(()=>{});this.menuBar=new i.ms.menubar.BgaMenuBar({target:$("menubar-holder")});this.bgaPlayerMenu=new i.ms.playermenu.BgaPlayerMenu({target:$("overall-content")});e.connect($("lang_redirection_button"),"onclick",this,"onLanguageRedirection");"undefined"!=typeof globalUserInfos&&globalUserInfos.ask_stay_connected&&"no"!=localStorage.getItem("stay_connected_"+current_player_id)&&i.stores.toasts.create({type:"StayConnected"});if(!this.bChatDetached){this.register_subs(e.subscribe("updatePlayerTableStatus",this,"onUpdatePlayerTableStatus"));this.register_subs(e.subscribe("shouldAcceptGameStart",this,"onShouldAcceptGameStart"));this.register_subs(e.subscribe("updatePlayerNotifCount",this,"onUpdatePlayerNotifCount"));this.register_subs(e.subscribe("friendUpdate",this,"onFriendUpdate"));this.register_subs(e.subscribe("groupUpdate",this,"onGroupUpdate"));void 0!==soundManager.onChangeSound&&this.register_subs(e.subscribe("changeSound",soundManager,"onChangeSound"));this.register_subs(e.subscribe("gameStateChange",this,"onGameStateChange"));this.register_subs(e.subscribe("gameStateMultipleActiveUpdate",this,"onGameStateChangeMultipleActive"));this.register_subs(e.subscribe("tableInfosChanged",this,"onTableInfosChanged"));this.register_subs(e.subscribe("invitedOfflinePlayer",this,"onInvitedOfflinePlayer"));this.register_subs(e.subscribe("tournamentStarts",this,"onTournamentStarts"));$("go_to_table")&&e.connect($("go_to_table"),"onclick",this,"onGoToTable");$("go_to_table_id")&&e.connect($("go_to_table_id"),"onclick",this,function(t){e.stopEvent(t)});$("go_to_player")&&e.connect($("go_to_player"),"onclick",this,"onGoToPlayer");$("go_to_player_id")&&e.connect($("go_to_player_id"),"onclick",this,function(t){e.stopEvent(t)})}if($("register_email_change")){e.connect($("register_email_change"),"onclick",this,"onRegisterEmailChange");e.connect($("register_email_not_received"),"onclick",this,"onRegisterEmailNotReceived")}e.connect($("overall_footer_topbutton"),"onclick",function(){window.scroll(0,0)});$("overall_loading")&&e.destroy("overall_loading");this.onMetasiteLoginAfterInit(t);if(this.rtc_mode>0&&null!==this.rtc_room&&this.rtc_room.indexOf("P")>=0){var n=this.rtc_room.substr(1).split("_"),o=n[0]==current_player_id?n[1]:n[0];this.createChatBarWindow({type:"privatechat",id:o,label:"",game_name:"",url:"",channel:"/player/p"+o,window_id:"privatechat_"+o,subscribe:!1,start:"expanded"},!1);this.expandChatWindow("privatechat_"+o);this.setNewRTCMode(null,o,this.rtc_mode)}$("newsletter_optin_footer")&&e.connect($("newsletter_optin_footer"),"onclick",this,"onClickNewsLetterOptin");if(e.isChrome&&(66==e.isChrome||67==e.isChrome)&&current_player_id>0){var s="chromebug66",r="";if(this.isTouchDevice){if("welcome"==this.currentUrl)r='Google Chrome versions 66 and 67 has an annoying bug with BGA (<a href="https://forum.boardgamearena.com/viewtopic.php?f=3&t=12617">see details here</a>). We recommend you to upgrade to version 68 and above to use BGA.'}else if("welcome"==this.currentUrl&&1!=window.devicePixelRatio)r='Google Chrome versions 66 and 67 has an annoying bug with BGA (<a href="https://forum.boardgamearena.com/viewtopic.php?f=3&t=12617">see details here</a>). We recommend you to upgrade to version 68 and above to use BGA.';if(""!=r){var l="<div class='head_error' id='"+s+"' style='display:block;'><div class='head_infomsg_close' id='close_"+s+"'><i class='fa fa-close' aria-hidden='true'></i></div><div class='head_infomsg_item'>"+r+"</div></div>";e.place(l,"welcome_first_row","before");e.connect($("close_"+s),"onclick",this,function(t){e.style(t.currentTarget.parentElement.id,"display","none")})}}var d={37:"left",38:"up",39:"right",40:"down",65:"a",66:"b"},c=["up","up","down","down","left","right","left","right","b","a"],u=0;self.addEventListener("keydown",function(e){if(d[e.keyCode]==c[u]){if(++u==c.length){t.id>0&&this.ajaxcall("/award/award/giveKonamiCodeAward.html",{},this,function(){});u=0}}else u=0}.bind(this))},onClickNewsLetterOptin:function(e){if(!(current_player_id<=0)){e.preventDefault();e.stopPropagation();this.ajaxcall("/player/profile/newsletter.html",{value:1},this,function(){this.showMessage(__("lang_mainsite",'You successfully subcribed to our newsletter. You can change this anytime by going to <a href="%s">your email preferences</a>.').replace("%s","/preferences?section=email"),"info")})}},onMetasiteLogin:function(t){if(t.id>0){e.removeClass("ebd-body","not_logged_user");e.addClass("ebd-body","logged_user")}else{e.removeClass("ebd-body","logged_user");e.addClass("ebd-body","not_logged_user")}this.current_player_name=t.name;current_player_id=t.id;this.current_player_id=current_player_id;this.auto_join_game="join"===t.homepage;this.homepage=t.homepage;this.gamefilter=t.gamefilter;this.preferences=t.preferences;this.playerTableStatus=t.playerTableStatus;this.asyncStatus=t.async_status;this.unreadNews=t.unread_news;this.latestChat=t.latest_chat;this.tutorial=t.tutorial_seen;this.loadPageAfterCreate=t.locked_url;this.timezone=t.timezone;this.credentials=t.centrifuge_cred;this.notifyOnGeneralChat=t.notifyGeneralChat;this.updateServiceStatus(this.status);if(void 0!==this.socket){this.socket.disconnect();this.initCentrifuge()}try{i.saveFingerprint().catch(e=>{})}catch(a){}},onInvitedOfflinePlayer:function(e){void 0===this.invitedOfflinePlayerToConfirm&&(this.invitedOfflinePlayerToConfirm={});void 0===this.invitedOfflinePlayerToConfirm[e.args.table]&&(this.invitedOfflinePlayerToConfirm[e.args.table]={});void 0===this.invitedOfflinePlayerToConfirm[e.args.table][e.args.player_id]&&(this.invitedOfflinePlayerToConfirm[e.args.table][e.args.player_id]=e.args)},initCentrifuge:function(){this.socket=new Centrifuge(bgaConfig.centrifugeConfiguration.endpoints,{data:{user_id:""+current_player_id,username:this.current_player_name,credentials:this.credentials},emulationEndpoint:bgaConfig.centrifugeConfiguration.emulationEndpoint});this.socket.connect();this.socket.on("connected",()=>this.onCentrifugeConnectionStatusChanged("connect")).on("error",e=>this.onCentrifugeConnectionStatusChanged(e.error.code,`${e.error.message} (error no: ${e.error.code})`)).on("disconnected",e=>this.onCentrifugeConnectionStatusChanged(e.code,`${e.reason} (error no: ${e.code})`));this.subscribeCentrifugeChannel("bgamsg",this.notifqueue,"onNotification");this.subscribeCentrifugeChannel("/general/emergency",this.notifqueue,"onNotification");if(!this.bChatDetached){current_player_id>0&&this.subscribeCentrifugeChannel("/chat/general",this.notifqueue,"onNotification");this.subscribeCentrifugeChannel("/player/p"+current_player_id,this.notifqueue,"onNotification")}},onMetasiteLoginAfterInit:function(t){this.setFriendList(t.friends);this.setGroupList(t.groups,t.all_groups,t.red_thumbs_given,t.red_thumbs_taken);this.setLanguagesList(t.all_lang);this.setPma(t.pma);this.setRtcMode(t.rtc_mode,t.rtc_room);for(var a in t.groups)1!=t.groups[a]&&mainsite.createChatBarWindow({type:"group",id:a,label:t.groups[a],group_avatar:t.group_avatars[a],group_type:t.group_types[a],url:"/group?id="+a,channel:"/group/g"+a,window_id:"group_"+a,start:"expanded"},!0);this.timeZoneUpdate();for(var a in this.playerTableStatus){"tournament"==this.playerTableStatus[a].status&&this.updatePlayerTableStatus(this.playerTableStatus[a]);"expected"==this.playerTableStatus[a].status&&i.stores.toasts.create({type:"TableInvitation",props:{tableId:+this.playerTableStatus[a].table_id}})}for(var a in this.playerTableStatus)"tournament"!=this.playerTableStatus[a].status&&this.updatePlayerTableStatus(this.playerTableStatus[a]);this.updateAsyncInfos(this.asyncStatus);""!=this.loadPageAfterCreate&&(-1!=this.currentUrl.indexOf("account?page=registration")||-1!=this.currentUrl.indexOf("account?page=newpassword")||-1!=this.currentUrl.indexOf("account?page=lostpassword")||-1!=this.currentUrl.indexOf("account?page=confirmemail")||-1!=this.currentUrl.indexOf("table?table=")||-1!=this.currentUrl.indexOf("preferences?section")||"preferences"===this.currentUrl.substr(-11)||0==this.currentUrl.indexOf("premium?")||"premium"==this.currentUrl||0==this.currentUrl.indexOf("offer?")||"offer"==this.currentUrl||0==this.currentUrl.indexOf("support?")||"support"==this.currentUrl||setTimeout(e.hitch(this,function(){gotourl(this.loadPageAfterCreate)}),500));mainsite.bUnderage=t.underage;mainsite.bUnderage&&e.addClass("ebd-body","player_is_underage");this.showUnReadChatMessages();this.updateHeadlinesNbrNotification();this.showSplashedPlayerNotifications(t.playernotif_splashed)},onPlayerStatusChanged:function(e){var t=e.args.player_id,i=e.args.player_status;void 0===this.friendList[t]||null==this.friendList[t]||(this.friendLocalStatus[t]="offline"==i?"offline":"online")},onCloseAllDropdown:function(t){e.query(".dropdown_expanded").removeClass("dropdown_expanded")},updateHeadlinesNbrNotification:function(){var e=0;for(var t in this.unreadNews)e++;void 0!==mainsite.bVisitedHeadlinesPage&&(e=0);i.stores.menuStates.setNewsNotificationNumber(e)},setFriendList:function(e){this.friendList=e;for(var t in this.friendList)0!=this.friendList[t]&&(this.friendLocalStatus[t]="online")},onPopState:function(e){if(this.websitemodule&&"function"==typeof this.websitemodule.onPopState)try{this.websitemodule.onPopState();return}catch(t){console.error(t)}this.loadpagefromhash()},onClickOnPage:function(e){if("undefined"!==e.button&&0!==e.button)return;const t=e.target.closest("a[href]");if(!t)return;if(t.origin!==document.location.origin)return;if(void 0!==t.target&&""!=t.target&&"_parent"!=t.target)return;if(t.classList.contains("force_reload"))return;const a=t.hash,n=t.pathname+t.search;if(!n.match(/^\/[0-9]+/)&&!n.match(/\/(play|troubleshoot|tutorial.*)$/)&&!0!==e.ctrlKey&&!0!==e.metaKey)if(n==document.location.pathname+document.location.search){if(a===document.location.hash){e.stopPropagation();e.preventDefault()}}else{i.stores.universalModals&&i.stores.universalModals.clear();e.stopPropagation();e.preventDefault();gotourl(n+a)}},gotourl:function(e){"/"!=e[0]&&(e="/"+e);history.pushState(null,"",e);this.loadpagefromhash()},gotourl_forcereload:function(e){window.location.hash;window.location.hash=="#!"+e?this.__gotourl(e):this.gotourl(e)},__gotourl:function(t,a){void 0===a&&(a=!1);var n=this.currentUrl;this.currentUrl=t;i.stores.menuStates.setCurrentUrl(t);var o=t,s="",r=o.split("#");if(r.length>=2&&r[1].length>0){s=r[1];o=r[0]}var l,d="";if((u=o.split("?")).length>=2&&u[1].length>0){for(var c=1;c<u.length;c++){c>1&&(d+="%3F");d+=u[c]}l=u[0]}else l=o;var u,h="";if((u=l.split("/")).length>=2){l=u[0];h=u[1]}try{var p=e.queryToObject(d)}catch(g){p={}}p.refreshtemplate=1;"forum"==l&&""!=h?p.originalquery=h:"doc"!=l&&"page"!=l||""==h||(p.pageid=h);""!=s&&(p.original_hash=s);var m=l;""==m&&(m=this.homepage);require(["ebg/site/"+m],e.hitch(this,function(){if(this.websitemodule){if(this.websitemodule.isModuleActive()){if(!1===this.websitemodule.onOnUnload()){this.currentUrl=n;history.pushState(null,"",n);return}this.websitemodule.onPostUnLoad()}this.websitemodule=null}this.removeBackButton();window.scroll(0,0);e.style("main-content","visibility","visible");let t=ebg.site[m];if(t){this.websitemodule=new t;var i=!this.websitemodule.doesNeedServerSideLoad();i?$("main-content").innerHTML="":a||e.place('<div id="loading"><div class="loading_icon"></div></div>',$("main-content"),"only");var o=this.changeActiveMenuItem(m);this.next_module_load_id++;var s=this.next_module_load_id,r=function(){if(s==this.next_module_load_id){window.scroll(0,0);this.websitemodule;"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")&&this.refreshWebPushWorker();if(null===this.websitemodule)return;this.websitemodule.onLoad(p,this.messageEventQueue);this.messageEventQueue=[];if(null===this.websitemodule)return;this.websitemodule.onPostLoad();""!=head_infomsg&&this.websitemodule.showMessage(head_infomsg,"info");""!=head_errmsg&&this.websitemodule.showMessage(head_errmsg,"error");head_infomsg="";head_errmsg="";if(e.hasClass("ebd-body","flag_confirm_sponsorship")){this.websitemodule.showMessage(_("The sponsorsphip has been registered for your account. You can now close this page."),"info");e.removeClass("ebd-body","sponsorship_flag")}if(e.hasClass("ebd-body","flag_invalid_sponsorship")){this.websitemodule.showMessage(_("The referral has not been registered (it may have been registered already, or the link may have expired)"),"info");e.removeClass("ebd-body","flag_invalid_sponsorship")}this.updateBanner();this.updatePremiumEmblemLinks();if($("module-metadata")&&$("module-metadata").dataset.url)for(var t=$("module-metadata").dataset.url,i=e.query("link"),a=0;a<i.length;a++){var n=i[a];if("canonical"==n.rel){var r=t;n.href=r}}if($("module-metadata")&&$("module-metadata").dataset.description){document.querySelector('meta[name="description"]').setAttribute("content",$("module-metadata").dataset.description);document.querySelector('meta[property="og:description"]').setAttribute("content",$("module-metadata").dataset.description)}var l=location.pathname+location.search+location.hash;analyticsPush({page_name:l,page_siteSection:o,event:"page_view"})}else this.next_module_load_id};if(null!==this.ajaxPageLoadInProgress){this.ajaxPageLoadInProgress.isResolved()||this.ajaxPageLoadInProgress.cancel();this.ajaxPageLoadInProgress=null}if(i||a){e.hitch(this,r)()}else this.ajaxPageLoadInProgress=this.ajaxpageload("/"+m,p,"main-content",this,r)}else{this.showMessage("Page not found: "+m,"error");this.gotourl(this.homepage)}}))},loadpagefromhash:function(e){window.location.pathname,window.location.search,window.location.hash;void 0===e&&(e=!1);if(""==window.location.hash||"#!"!=window.location.hash.substr(0,2)){for(var t=window.location.pathname+window.location.search+window.location.hash;"/"==t[0];)t=t.substr(1);e?this.__gotourl(t,!0):this.__gotourl(t)}else window.location.href="/"+window.location.hash.substr(2)},onGoToUrl:function(t){if(void 0===t.ignore_if_new_version){var i="";if(t.url)i=t.url;else{var a=t.module,n=t.args;i=a+"?"+e.objectToQuery(n)}this.gotourl(i)}},onNotAllowed:function(){var e=dojox.dtl.filter.strings.urlencode(this.currentUrl);this.showMessage(_("To go further, you must log in or create an account (in 10 seconds)!"),"info");this.gotourl("account?warn&redirect="+e)},setPageTitle:function(e,t=null){i.stores.menuStates.setPageTitle(t||e);document.title=e+"  "+$("websitename").innerHTML},onNotification:function(e){},onLogin:function(t){t.preventDefault();var i={};i.redirect=this.currentUrl;var a="account?"+e.objectToQuery(i);this.gotourl(a)},onLogout:function(e){e.preventDefault();this.ajaxcall("/account/account/logout.html",{},this,function(e){this.showMessage(_("You have been disconnected from ")+"Board Game arena","info");var t=new Date;t.setTime(t.getTime()+12e4);document.cookie="social_disable_autoconnect=1;expires="+t.toUTCString()+";domain=."+location.hostname+";path=/";this.afterLogout()})},afterLogout:function(){setTimeout(function(){window.location.href="/"},1e3);sessionStorage.removeItem("bga-fp")},onGoToCurrentTable:function(e){e.preventDefault();var t=$("current_table_id").innerHTML;this.gotourl("table?table="+t+"&nr=true")},onUpdateConnectedNumber:function(e){$("players_connected")&&($("players_connected").innerHTML=e.args.online);$("players_waiting")&&($("players_waiting").innerHTML=e.args.waiting);$("players_playing")&&($("players_playing").innerHTML=e.args.playing);var t=e.args.status;this.updateServiceStatus(t)},updateServiceStatus:function(t){if($("server_status_global")){e.removeClass("server_status_global","server_status_green server_status_orange server_status_red server_status_overload server_status_maintenance");e.addClass("server_status_global","server_status_"+t)}var i="";"green"==t?i=__("lang_mainsite","Service is normal"):"orange"==t?i=__("lang_mainsite","Our service is having an issue at now.")+"<br/>"+__("lang_mainsite","Note: All penalties received for leaving games will be canceled."):"red"==t?i=__("lang_mainsite","Our service is facing a major issue at now.")+"<br/>"+__("lang_mainsite","Note: All penalties received for leaving games will be canceled."):"overload"==t?i=__("lang_mainsite","Our service is currently experiencing a very high load due to exceptional circumstances.")+"<br/>"+__("lang_mainsite","You may experience some issues or slowdowns, and some features may be temporarily disabled.")+"<br/>"+__("lang_mainsite","Thanks for your patience and understanding!"):"maintenance"==t&&(i=__("lang_mainsite","Service in maintenance : the administrators are working to improve or fix the service.")+"<br/>"+__("lang_mainsite","New tables creation may be blocked. Thanks for your patience."));$("server_status_details")&&($("server_status_details").innerHTML=i);if("green"!=t){$("server_status_warning_message").innerHTML='<a class="bga-link" href="/serverstatus">'+i+"</a>";e.style("server_status_warning_message","display","block")}else e.style("server_status_warning_message","display","none")},onUpdatePlayerNotifCount:function(e){e.args.splash&&this.showSplashedPlayerNotifications(e.args.splash);e.args.read&&this.onNewsRead(e.args.read)},onFriendUpdate:function(e){e.args.friend&&(e.args.add?this.friendList[e.args.friend]=1:this.friendList[e.args.friend]=null)},onGroupUpdate:function(e){if(e.args.add){this.groupList[e.args.group]=1;this.allGroupList[e.args.group]=1;this.groupToCentrifugeSubs[e.args.group]=this.subscribeCentrifugeChannel("/group/g"+e.args.group,this.notifqueue,"onNotification")}else{this.groupList[e.args.group]=null;this.allGroupList[e.args.group]=null;if(!this.bChatDetached){this.unsubscribeCentrifugeChannel(this.groupToCentrifugeSubs[e.args.group]);this.groupToCentrifugeSubs[e.args.group]=null}}},onUpdatePlayerTableStatus:function(e){this.updatePlayerTableStatus(e.args)},onTournamentStarts:function(e){if(e.args.realtime){e.args.change=1;e.args.status="tournament";this.updatePlayerTableStatus(e.args)}},onShouldAcceptGameStart:function(e){e.args.table_id;this.showAcceptGameStart(e.args.table_id)},updatePlayerTableStatus:function(t){void 0===t.async&&(t.async=0);void 0===t.matchmaking&&(t.matchmaking=0);if(1==toint(t.change)){if("play"==t.status)if(0==t.async){if(0==t.matchmaking&&!this.auto_join_game){var i=null;0==t.matchmaking&&(i=this.subscribeCentrifugeChannel("/table/t"+t.table_id,this.notifqueue,"onNotification"));var a=!1;void 0!==t.actives&&(a=0!=t.actives.length);void 0===t.testonly&&(this.asyncTableInfos[t.table_id]={status:a?"play":"open",myturn:0,actives:[],over_times:[],game_name:_(t.game_name+"_displayed"),sub:i});this.updateAsyncCounters()}void 0!==t.bReadyToStart&&t.bReadyToStart&&(void 0!==t.testonly?this.showAcceptGameStart(t.table_id,"debug"):this.showAcceptGameStart(t.table_id))}else{i=null;0==t.matchmaking&&(i=this.subscribeCentrifugeChannel("/table/t"+t.table_id,this.notifqueue,"onNotification"));this.asyncTableInfos[t.table_id]={status:"asyncopen",myturn:0,actives:[],over_times:[],game_name:_(t.game_name+"_displayed"),sub:i};this.updateAsyncCounters()}else if("expected"==t.status){t.you_are_expected=_("You are expected on table");if(void 0!==t.admin&&null!=t.admin&&""!=t.admin){var n='<a href="/player?id='+t.admin_id+'" class="playername">'+t.admin+"</a>";t.you_are_expected=e.string.substitute(_("${player_name} invited you on table"),{player_name:n})}t.refuse=_("Refuse invitation");t.accept="";t.raw_game_name=t.game_name;t.game_name=this.getGameNameDisplayed(t.game_name);t.tournament&&e.query(".standard_invitation").forEach(e.destroy);var o=_("Accept");if(t.tournament){t.refuse_visibility="none";t.additional_class="expected_on_tournament";o=_("Join my tournament game");e.query(".tournament_remaining_to_play").style("display","none")}else{t.refuse_visibility="inline";t.additional_class="standard_invitation"}t.accept=" &nbsp;&nbsp;<a href='/table?table="+t.table_id+"&acceptinvit' class='bgabutton bgabutton_blue' >"+o+"</a> ";t.acceptbtn="<a href='/table?table="+t.table_id+"&acceptinvit' class='bgabutton bgabutton_blue' >"+o+"</a>"}else if("tournament"==t.status){t.you_are_participating=_("You are participating to a Realtime tournament in progress:");t.see_details=_("See details");t.you_still_have=_("You have remaining games to play, please stay online.");e.place(`\n                        <div id='tournament_banner_${t.tournament_id}' class='expected_banner'>\n                                ${t.you_are_participating} <a class='bga-link' href='/tournament?id=${t.tournament_id}'><span>${t.game_name} ${t.championship_name} ${t.tournament_name}</span></a>\n                                <div class='tournament_remaining_to_play'><i class='fa fa-exclamation-triangle fa-2x imgtext'></i>&nbsp; ${t.you_still_have}</div>\n                        </div>`,"tournament_inprogress_banners")}else if("afterplayed"==t.status){const e=this.subscribeCentrifugeChannel("/table/t"+t.table_id,this.notifqueue,"onNotification");this.afterPlayerTableInfos[t.table_id]={status:"afterplayed",sub:e}}}else if("play"==t.status){if(0==t.async){if(this.asyncTableInfos[t.table_id]){this.asyncTableInfos[t.table_id].sub&&(void 0!==t.bKeepAfterPlayed&&t.bKeepAfterPlayed?this.afterPlayerTableInfos[t.table_id]={status:"afterplayed",sub:this.asyncTableInfos[t.table_id].sub}:this.unsubscribeCentrifugeChannel(this.asyncTableInfos[t.table_id].sub));delete this.asyncTableInfos[t.table_id];this.updateAsyncCounters()}}else if(this.asyncTableInfos[t.table_id]){this.asyncTableInfos[t.table_id].sub&&(void 0!==t.bKeepAfterPlayed&&t.bKeepAfterPlayed?this.afterPlayerTableInfos[t.table_id]={status:"afterplayed",sub:this.asyncTableInfos[t.table_id].sub}:this.unsubscribeCentrifugeChannel(this.asyncTableInfos[t.table_id].sub));delete this.asyncTableInfos[t.table_id];this.updateAsyncCounters()}}else if("expected"==t.status)$("table_expected_banner_"+t.table_id)&&e.destroy($("table_expected_banner_"+t.table_id));else if("afterplayed"==t.status&&this.afterPlayerTableInfos[t.table_id]){this.afterPlayerTableInfos[t.table_id].sub&&this.unsubscribeCentrifugeChannel(this.afterPlayerTableInfos[t.table_id].sub);delete this.afterPlayerTableInfos[t.table_id]}},onRefuseInvitation:function(e){e.preventDefault();var t=e.currentTarget.id.substr(16);"rightcolumn_"==t.substr(0,12)&&(t=t.substr(12));this.ajaxcall("/table/table/refuseInvitation.html",{table:t},this,function(e){})},updateAsyncInfos:function(e){for(var t in e){for(var i=this.subscribeCentrifugeChannel("/table/t"+t,this.notifqueue,"onNotification"),a=e[t].actives,n=0,o=0;o<a.length;o++)toint(a[o])==current_player_id&&(n=1);this.asyncTableInfos[t]={status:e[t].status,myturn:n,actives:a,over_times:e[t].over_times,game_name:_(e[t].game_name+"_displayed"),sub:i};"setup"==e[t].status&&this.showAcceptGameStart(t)}this.updateAsyncCounters()},updateAsyncCounters:function(){var e=0;for(var t in this.asyncTableInfos)if("asyncopen"==this.asyncTableInfos[t].status||"asyncinit"==this.asyncTableInfos[t].status||"asyncplay"==this.asyncTableInfos[t].status){0;if("asyncplay"==this.asyncTableInfos[t].status){0;if(1==toint(this.asyncTableInfos[t].myturn)){e++;this.asyncTableInfos[t]}}}else{0;"play"==this.asyncTableInfos[t].status&&0;this.asyncTableInfos[t];0}if(toint(e)>0){this.bAnimatePageTitle=!0;this.onUpdatePageTitleAnimation()}else this.bAnimatePageTitle=!1},onUpdatePageTitleAnimation:function(){if(!("tableview"===this.active_menu_label)){var t={" ":" "," ":" "," ":" "," ":" "};if(this.bAnimatePageTitle||this.bAnimatePageTitleForGameStart){var i="new";t[a=document.title.substr(0,2)]&&(i=t[a]);document.title="new"==i?" "+document.title:i+document.title.substr(2);setTimeout(e.hitch(this,"onUpdatePageTitleAnimation"),1e3)}else{var a;t[a=document.title.substr(0,2)]&&(document.title=document.title.substr(2))}}},onGameStateChange:function(t){if(("activeplayer"==t.args.type||"manager"==t.args.type)&&this.asyncTableInfos[t.table_id]){var i=!1;if(toint(t.args.active_player)==current_player_id&&0==this.asyncTableInfos[t.table_id].myturn){this.asyncTableInfos[t.table_id].myturn=1;i=!0}else if(toint(t.args.active_player)!=current_player_id&&1==this.asyncTableInfos[t.table_id].myturn){this.asyncTableInfos[t.table_id].myturn=0;i=!0}i&&this.updateAsyncCounters();this.asyncTableInfos[t.table_id].actives=[toint(t.args.active_player)];e.publish("updateActivePlayers",[])}},onGameStateChangeMultipleActive:function(t){if(this.asyncTableInfos[t.table_id]){var i=!1;this.asyncTableInfos[t.table_id].actives=[];for(var a=t.args,n=0;n<a.length;n++){toint(a[n])==current_player_id&&(i=!0);this.asyncTableInfos[t.table_id].actives.push(toint(a[n]))}if(i&&0==this.asyncTableInfos[t.table_id].myturn){this.asyncTableInfos[t.table_id].myturn=1;this.updateAsyncCounters()}else if(!i&&1==this.asyncTableInfos[t.table_id].myturn){this.asyncTableInfos[t.table_id].myturn=0;this.updateAsyncCounters()}e.publish("updateActivePlayers",[])}},onTableInfosChanged:function(t){if(this.asyncTableInfos[t.args.id]){if("asyncplay"==t.args.status&&"asyncplay"!=this.asyncTableInfos[t.args.id]){this.asyncTableInfos[t.args.id].status="asyncplay";this.updateAsyncCounters();e.publish("updateActivePlayers",[])}else t.args.status;if("tableReady"==t.args.reload_reason)this.showAcceptGameStart(t.args.id);else if(!("playerJoinGame"!=t.args.reload_reason&&"expectedPlayerJoinGame"!=t.args.reload_reason||"open"!=t.args.status&&"init"!=t.args.status)){playSound("joinTable");if("playerJoinGame"==t.args.reload_reason&&current_player_id==t.args.admin_id){var i=0;for(var a in t.args.players)"play"==t.args.players[a].table_status&&i++;if(i>1&&i>=t.args.max_player){void 0===this.notified_about_tableready_to_autostart&&(this.notified_about_tableready_to_autostart={});if(!t.args.from_matchmaking&&void 0===this.notified_about_tableready_to_autostart[t.args.id]){var n='<a href="/table?table='+t.args.id+'">'+this.getGameNameDisplayed(t.args.game_name)+"</a>";this.showMessage(e.string.substitute(_("Your ${game_name} table has enough players to start!"),{game_name:n}),"info");setTimeout(e.hitch(this,function(){this.ajaxcall("/table/table/startgame.html",{table:t.args.id,autostart:!0},this,function(e){})}),500);this.notified_about_tableready_to_autostart[t.args.id]=!0}}else if(i>1&&i>=t.args.min_player){void 0===this.notified_about_tableready_to_start&&(this.notified_about_tableready_to_start={});if(void 0===this.notified_about_tableready_to_start[t.args.id]){n='<a href="/table?table='+t.args.id+'">'+this.getGameNameDisplayed(t.args.game_name)+"</a>";var o='<a href="#" class="bgabutton bgabutton_blue" id="startnow_table_'+t.args.id+'"> '+_("Start it now")+"</a>";this.showMessage(e.string.substitute(_("Your ${game_name} table has enough players to start!")+" "+o,{game_name:n}),"info");e.connect($("startnow_table_"+t.args.id),"onclick",this,e.hitch(function(e){var t=e.currentTarget.id.split("_")[2];mainsite.autoredirectedWhenTableStarts=t;this.ajaxcall("/table/table/startgame.html",{table:t},this,function(e){})}));this.notified_about_tableready_to_start[t.args.id]=!0}}}}}},showAcceptGameStart:function(e,t){if(null!==this.acceptGameStart){if(this.acceptGameStart.table_id==e)return;this.acceptGameStart.destroy();this.acceptGameStart=null}this.acceptGameStart=new ebg.acceptgamestart;void 0!==t&&"debug"==t&&(this.acceptGameStart.debug=!0);this.acceptGameStart.create(this,e)},updateBanner:function(){},updatePremiumEmblemLinks:function(){this.addTooltipToClass("emblempremium",__("lang_mainsite","Premium member: this player helps us to develop this service :)"),__("lang_mainsite","Support Board Game Arena: go Premium!"));e.query(".emblempremium").connect("onclick",this,function(){gotourl("premium?src=bannerlink")})},timeZoneUpdate:function(){if(current_player_id>0){var e=jzTimezoneDetector.determine_timezone().timezone;if(this.timezone!=e.olson_tz){this.timezone=e.olson_tz;this.ajaxcall("/account/account/changeTimeZone.html",{zone:e.olson_tz},this,function(e){})}}},filterNotification:function(e){if("tableCreateYell"==e.type){var t=e.args.game_id;if(!this.gamefilter[t])return!0}return!1},onGoToTable:function(e){e.preventDefault();gotourl("table?table="+$("go_to_table_id").value+"&nr=true");$("go_to_table_id").value=""},onGoToPlayer:function(e){e.preventDefault();gotourl("player?id="+$("go_to_player_id").value);$("go_to_player_id").value=""},onLanguageRedirection:function(t){e.stopEvent(t);$("lang_redirection_code").innerHTML;var i="//"+$("websitebaseurl").innerHTML+window.location.pathname+window.location.search+window.location.hash;window.location.href=i},getScriptErrorModuleInfos:function(){return"U="+current_player_id},adaptMainMenu:function(){var t=e.hasClass("ebd-body","mobile_version");e.removeClass("ebd-body","mobile_version");e.addClass("ebd-body","desktop_version");if(e.position("ebd-body").w<900){e.removeClass("ebd-body","desktop_version");e.addClass("ebd-body","mobile_version")}var a=e.hasClass("ebd-body","mobile_version");if(t&&!a){this.onAdaptScreen(!1);i.stores.deviceMode.checkState()}else if(!t&&a){this.onAdaptScreen(!0);i.stores.deviceMode.checkState()}},onAdaptScreen:function(e){},setBackButton:function(){e.addClass("topbar","with_back_button")},removeBackButton:function(){e.removeClass("topbar","with_back_button")},onRegisterEmailNotReceived:function(t){if(!e.hasClass(t.currentTarget,"didnreceive_link_to_follow")){e.stopEvent(t);e.destroy("register_email_not_received");e.style("register_email_didnt_receive_option","display","block");e.connect($("register_email_retry"),"onclick",this,"onRegisterEmailRetry")}},onRegisterEmailChange:function(t){e.stopEvent(t);e.destroy("register_email_change");e.style("register_email_change_wrap","display","block");e.connect($("register_email_change_action"),"onclick",this,"onRegisterEmailChangeAction")},onRegisterEmailChangeAction:function(t){e.stopEvent(t);var i=$("register_email_change_value").value;""!=i?this.ajaxcall("/account/account/changeRegistrationEmail.html",{email:i},this,function(e){window.location.reload()},function(e){},"post"):this.showMessage(_("You have to specify an email adress"),"error")},onRegisterEmailRetry:function(t){e.stopEvent(t);this.ajaxcall("/account/account/retryRegistrationEmail.html",{},this,function(e){window.location.reload()},function(e){},"post")},showUnReadChatMessages:function(){if(!this.bChatDetached){var e=1,t={channel:"/chat/general",packet_type:"single",data:[]};mainsite.createChatBarWindow({type:"general",id:0,label:_("General messages"),url:null,channel:"/chat/general",window_id:"general",start:"collapsed"},!1);for(var i in mainsite.latestChat.general){if("normal"==(n=mainsite.latestChat.general[i]).type)this.bUnderage||t.data.push({args:n,bIsTableMsg:!1,lock_uuid:"dummy",log:"${player_name} ${text}",type:"chat",time:n.time,loadprevious:!0,uid:e++});else if("emergency"==n.type){var a={channel:"/general/emergency",packet_type:"single",data:[]};a.data.push({args:n,bIsTableMsg:!1,lock_uuid:"dummy",log:"${player_name} ${text}",type:"chat",time:n.time,loadprevious:!0,uid:e++});this.notifqueue.onNotification(a)}}this.notifqueue.onNotification(t);if(mainsite.latestChat.priv){t={channel:"/player/p"+current_player_id,packet_type:"single",data:[]};for(var i in mainsite.latestChat.priv){0;var n=mainsite.latestChat.priv[i];t.data.push({args:n,bIsTableMsg:!1,lock_uuid:"dummy",log:"${player_name} ${text}",type:"privatechat",time:n.time,uid:e++})}this.notifqueue.onNotification(t)}if(mainsite.latestChat.table)for(var o in mainsite.latestChat.table){t={channel:"/table/t"+o,packet_type:"single",data:[]};for(var i in mainsite.latestChat.table[o]){0;(n=mainsite.latestChat.table[o][i]).mread=null;n.is_new=1;t.data.push({args:n,bIsTableMsg:!1,lock_uuid:"dummy",log:"${player_name} ${text}",type:"tablechat",time:n.time,uid:e++})}this.notifqueue.onNotification(t)}}},initEasterEggHunt:function(){var t=null;"undefined"!=typeof globalUserInfos&&void 0!==globalUserInfos.easter_eggs_hunt&&(t=globalUserInfos.easter_eggs_hunt);t&&t.active&&e.query(".easter-eggs").forEach(e.hitch(this,function(i){var a=i.getAttribute("data-egg-num");if(!t.eggs[a]){i.classList.add("easter-eggs--ungathered");this.disconnect(i,"onclick");this.connect(i,"onclick",function(n){e.stopEvent(n);i.style.pointerEvents="none";var o=i.getAttribute("data-egg-id");if(o&&a&&!0!==t.eggs[a]){t.eggs[a]=!0;i.classList.add("easter-eggs--gathering");setTimeout(e.hitch(this,function(){this.ajaxcall("/award/award/gatherEgg.html",{id:o},this,function(){},function(e){t.eggs[a]=!e})}),1e3);setTimeout(function(){i.classList.add("easter-eggs--gathered")},3e3)}})}}))}})})},"ebg/core/sitecore":function(){define(["dojo","dojo/_base/declare","svelte/index","dojo/has","ebg/core/core","ebg/core/soundManager","dijit/form/Select","dijit/TooltipDialog","dojox/dtl/filter/htmlstrings","ebg/gamenotif","ebg/chatinput","ebg/thumb"],function(e,t,i){return t("ebg.core.sitecore",ebg.core.core,{constructor:function(){this.ajaxcall_running=0;g_sitecore=this;this.notifqueue=new ebg.gamenotif;this.active_menu_label="";this.next_headmsg_id=1;this.centrifuge_is_connected=!1;this.page_is_unloading=!1;this.centrifuge_subscriptions={};this.reportErrorTimeout=!1;this.next_log_id=0;this.chatbarWindows={};this.jstpl_chatwindow=['<div id="chatwindow_${id}" class="chatwindow chatwindowtype_${type}">','<div id="chatwindowexpanded_${id}" class="chatwindowexpanded">','<div class="dropshadow"></div>','<div id="chatbarinput_${id}" class="chatbarinput"></div>','<div id="chatbarbelowinput_${id}" class="chatbarbelowinput">','<div id="chatbarinput_stopnotif_${id}" class="chatbarinput_stopnotif">','<input type="checkbox" checked="checked" id="chatbarinput_stopnotif_box_${id}" />','<span id="chatbarinput_stopnotif_label_${id}">${stop_notif_label}</span>',"</div>","<div",' id="chatbarinput_startaudiochat_${id}"',' class="chatwindow_startaudiochat chatbarbelowinput_item audiovideo_inactive">','<i class="fa fa-microphone"></i>',"</div>","<div",' id="chatbarinput_startvideochat_${id}"',' class="chatwindow_startvideochat chatbarbelowinput_item audiovideo_inactive">','<i class="fa fa-video-camera"></i>',"</div>",'<div id="chatbarinput_predefined_${id}" class="chatbarbelowinput_item">','<div class="chatbarinput_predefined icon20 icon20_meeple_wb"></div>',"</div>",'<div id="chatbarinput_showcursor_${id}" class="chatbarbelowinput_item chatbarbelowinput_item_showcursor">','<i class="fa fa-hand-pointer-o"></i>',"</div>",'<div id="chatbar_startchat_${id}" class="chatbar_startchat">','<a class="bgabutton bgabutton_blue" id="startchat_accept_${id}">${start_chat}</a><br />','<a class="bgabutton bgabutton_red" id="startchat_block_${id}">${block_chat}</a>',"</div>","</div>",'<div id="chatwindowlogs_${id}" class="chatwindowlogs">','<div id="chatwindowlogstitlebar_${id}" class="chatwindowlogstitlebar">','<div class="chatwindowlogstitle" id="chatwindowlogstitle_${id}">','<span id="is_writing_now_title_${id}" class="is_writing_now">','<i class="fa fa-pencil fa-blink"></i>&nbsp;<span',' id="is_writing_now_expl_title_${id}"',' class="is_writing_now_expl"></span>',"</span>",'<span id="chatwindowlogstitle_content_${id}">${title}</span>',"</div>",'<div id="chatwindowicon_${id}" class="chatwindowicon">','<div class="avatarwrap emblemwrap">${avatar}</div>',"</div>",'<div id="chatwindowcollapse_${id}" class="chatwindowcollapse icon20 icon20_collapse_white"></div>','<div id="chatwindowremove_${id}" class="chatwindowremove icon20 icon20_remove_white"></div>',"</div>",'<div id="chatwindowlogs_zone_${id}" class="chatwindowlogs_zone">','<div id="chatwindowlogs_endzone_${id}" class="chatwindowlogs_endzone"></div>',"</div>",'<div id="chatwindowmorelogs_${id}" class="chatwindowmorelogs roundedbox">','<a class="bga-link" id="chatwindowmorelogslink_${id}" href="#">${more_logs_label}</a>',"</div>","</div>","</div>",'<div id="chatwindowpreview_${id}" class="chatwindowpreview"></div>','<div id="chatwindowcollapsed_${id}" class="chatwindowcollapsed">','<div class="chatwindowcollapsedtitle">','<span id="chatwindownewmsgcount_${id}" class="chatwindownewmsgcount"></span>','<span id="is_writing_now_${id}" class="is_writing_now">','<i class="fa fa-pencil fa-blink"></i>&nbsp;<span',' id="is_writing_now_expl_${id}"',' class="is_writing_now_expl"></span>',"</span>",'<span id="chatwindowtitlenolink_${id}">${titlenolink}</span>',"</div>",'<div id="chatwindowremovc_${id}" class="chatwindowremovec icon20 icon20_remove"></div>','<div class="chatwindowavatar">','<div class="avatarwrap emblemwrap emblemwrap_l">${avatar}</div>','<div id="chatMindownewmsgcount_${id}" class="chatwindownewmsgcount chatMindownewmsgcount"></div>','<i class="bubblecaret fa fa-caret-up"></i>',"</div>","</div>","</div>"].join("");this.dockedChatInitialized=!1;this.groupToCentrifugeSubs={};this.window_visibility="visible";this.premiumMsgAudioVideo=null;var e=new URLSearchParams(window.location.search);if(e.has("media_rating")&&e.has("room")){var t=e.get("media_rating"),i=e.get("room");"video"!=t&&"audio"!=t||g_sitecore.displayRatingContent(t,{room_id:i,media:t,rating:null,issue:null,text:null})}this.badWordList=["youporn","redtube","pornotube","pornhub","xtube","a-hole","dumb","fool","imbecile","nutcase","dipstick","lunatic","weirdo","dork","dope","dimwit","half-wit","oaf","bimbo","jerk","numskull","numbskull","goof","suck","moron","morons","idiot","idi0t","rape","rapist","hitler","4r5e","5h1t","5hit","a55","anal","anus","ar5e","arrse","arse","ass","ass-fucker","asses","assfucker","assfukka","asshole","assholes","asswhole","a_s_s","b!tch","b00bs","b17ch","b1tch","ballbag","ballsack","bastard","beastial","beastiality","bellend","bestial","bestiality","bi+ch","biatch","bitch","bitcher","bitchers","bitches","bitchin","bitching","blow job","blowjob","blowjobs","boiolas","bollock","bollok","boner","boob","boobs","booobs","boooobs","booooobs","booooooobs","breasts","buceta","bugger","bum","bunny fucker","butt","butthole","buttmuch","buttplug","c0ck","c0cksucker","carpet muncher","cawk","chink","cipa","cl1t","clit","clitoris","clits","cnut","cock","cock-sucker","cockface","cockhead","cockmunch","cockmuncher","cocks","cocksuck ","cocksucked ","cocksucker","cocksucking","cocksucks ","cocksuka","cocksukka","cokmuncher","coksucka","coon","cox","crap","cum","cummer","cumming","cums","cumshot","cunilingus","cunillingus","cunnilingus","cunt","cuntlick ","cuntlicker ","cuntlicking ","cunts","cyalis","cyberfuc","cyberfuck ","cyberfucked ","cyberfucker","cyberfuckers","cyberfucking ","d1ck","damn","dick","dickhead","dildo","dildos","dink","dinks","dirsa","dlck","dog-fucker","doggin","dogging","donkeyribber","doosh","duche","dyke","ejaculate","ejaculated","ejaculates ","ejaculating ","ejaculatings","ejaculation","ejakulate","f u c k","f u c k e r","f4nny","fag","fagging","faggitt","faggot","faggs","fagot","fagots","fags","fanny","fannyflaps","fannyfucker","fanyy","fatass","fcuk","fcuker","fcuking","feck","fecker","felching","fellate","fellatio","fingerfuck ","fingerfucked ","fingerfucker ","fingerfuckers","fingerfucking ","fingerfucks ","fistfuck","fistfucked ","fistfucker ","fistfuckers ","fistfucking ","fistfuckings ","fistfucks ","flange","fook","fooker","fucka","fucked","fucker","fuckers","fuckhead","fuckheads","fuckings","fuckingshitmotherfucker","fuckme ","fucks","fuckwhit","fuckwit","fudge packer","fudgepacker","fuk","fuker","fukker","fukkin","fuks","fukwhit","fukwit","fux","fux0r","f_u_c_k","gangbang","gangbanged ","gangbangs ","gaylord","gaysex","goatse","God","god-dam","god-damned","goddamn","goddamned","hardcoresex ","heshe","hoar","hoare","hoer","homo","hore","horniest","horny","hotsex","jack-off ","jackoff","jap","jerk-off ","jism","jiz ","jizm ","jizz","kawk","knob","knobead","knobed","knobend","knobhead","knobjocky","knobjokey","kock","kondum","kondums","kum","kummer","kumming","kums","kunilingus","l3i+ch","l3itch","labia","lmfao","lust","lusting","m0f0","m0fo","m45terbate","ma5terb8","ma5terbate","masochist","master-bate","masterb8","masterbat*","masterbat3","masterbate","masterbation","masterbations","masturbate","mo-fo","mof0","mofo","mothafuck","mothafucka","mothafuckas","mothafuckaz","mothafucked ","mothafucker","mothafuckers","mothafuckin","mothafucking ","mothafuckings","mothafucks","mother fucker","motherfuck","motherfucked","motherfucker","motherfuckers","motherfuckin","motherfucking","motherfuckings","motherfuckka","motherfucks","muff","mutha","muthafecker","muthafuckker","muther","mutherfucker","n1gga","n1gger","nazi","nigg3r","nigg4h","nigga","niggah","niggas","niggaz","nigger","niggers ","nob","nob jokey","nobhead","nobjocky","nobjokey","numbnuts","nutsack","orgasim ","orgasims ","orgasm","orgasms ","p0rn","pecker","penis","penisfucker","phonesex","phuck","phuk","phuked","phuking","phukked","phukking","phuks","phuq","pigfucker","pimpis","piss","pissed","pisser","pissers","pisses ","pissflaps","pissin ","pissing","pissoff ","poop","porn","porno","pornography","pornos","prick","pricks ","pron","pube","pusse","pussi","pussies","pussy","pussys ","rectum","retards","rimjaw","rimming","s hit","s.o.b.","sadist","schlong","screwing","scroat","scrote","scrotum","semen","sex","sh!+","sh!t","sh1t","shag","shagger","shaggin","shagging","shemale","shi+","shit","shitdick","shite","shited","shitey","shitfuck","shitfull","shithead","shiting","shitings","shits","shitted","shitter","shitters ","shitting","shittings","shitty ","skank","slut","sluts","smegma","smut","snatch","son-of-a-bitch","spac","spunk","s_h_i_t","t1tt1e5","t1tties","teets","teez","testical","testicle","tit","titfuck","tits","titt","tittie5","tittiefucker","titties","tittyfuck","tittywank","titwank","tosser","turd","tw4t","twat","twathead","twatty","twunt","twunter","v14gra","v1gra","vulva","w00se","wang","wank","wanker","wanky","whoar","whore","willies","willy","xrated","xxx","encul","baiser","nique","niquer","salope","pute","fuck","f*ck","f**k","noob"];this.tutorialHighlightedQueue=[];this.browser_inactivity_time=0;this.bInactiveBrowser=!1;this.red_thumbs_given={};this.red_thumbs_taken={};this.reconnecting=!1;this.setIgnoreReloadNotifications(!1)},init_core:function(){e.version.toString();this.premiumMsgAudioVideo=__("lang_mainsite","Premium feature: audio or video calls can be started by Premium players.")+'<br /><a href="/premium?src=avchat">'+__("lang_mainsite","To be able to start a live chat with fellow players, go Premium!")+"</a><br />"+__("lang_mainsite","(browser compatibility: %s)").replace("%s","Chrome, Firefox, Opera");e.removeClass("ebd-body","page_is_loading");$("head_infomsg")&&e.empty("head_infomsg");this.takeIntoAccountAndroidIosRequestDesktopWebsite(document);if("undefined"!=typeof mainsite&&mainsite.dockedChat&&(void 0===this.chatDetached||null===this.chatDetached.type)){this.notifqueue.onPlaceLogOnChannel=e.hitch(this,"onPlaceLogOnChannel");this.initChatDockedSystem()}if("undefined"!=typeof gameui&&gameui.dockedChat){this.notifqueue.onPlaceLogOnChannel=e.hitch(this,"onPlaceLogOnChannel");this.initChatDockedSystem()}this.isTouchDevice="ontouchstart"in window||navigator.msMaxTouchPoints>0;this.isTouchDevice?e.addClass("ebd-body","touch-device"):e.addClass("ebd-body","notouch-device");this.predefinedTextMessages={tbleave:"Sorry I will continue to play later.",goodmove:"Sorry I have an emergency: I'm back in few seconds...",gm:"Good move!",think:"I would like to think a little, thank you",stillthinkin:"Yeah, still there, just thinking.",stillthere:"Hey, are you still there?",gg:"Good Game!",glhf:"Good luck, have fun!",hf:"Have fun!",tftg:"Thanks for the game!"};this.predefinedTextMessages_untranslated={"Sorry I will continue to play later.":"tbleave","Sorry I have an emergency: I'm back in few seconds...":"goodmove","Good move!":"gm","Yeah, still there, just thinking.":"stillthinkin","Hey, are you still there?":"stillthere","I would like to think a little, thank you":"think","Good Game!":"gg","Good luck, have fun!":"glhf","Have fun!":"hf","Thanks for the game!":"tftg"};this.predefinedTextMessages_target_translation={tbleave:__("lang_mainsite","Sorry I will continue to play later."),goodmove:__("lang_mainsite","Sorry I have an emergency: I'm back in few seconds..."),gm:__("lang_mainsite","Good move!"),think:__("lang_mainsite","I would like to think a little, thank you"),stillthinkin:__("lang_mainsite","Yeah, still there, just thinking."),stillthere:__("lang_mainsite","Hey, are you still there?"),gg:__("lang_mainsite","Good Game!"),glhf:__("lang_mainsite","Good luck, have fun!"),test:__("lang_mainsite","We detect an insult in your chat input."),hf:__("lang_mainsite","Have fun!"),tftg:__("lang_mainsite","Thanks for the game!")};$("seemorelogs_btn")&&e.connect($("seemorelogs_btn"),"onclick",this,"onSeeMoreLogs");this.initMonitoringWindowVisibilityChange();var t=$("servicetime").innerHTML,a=new Date,n=60*a.getHours()+a.getMinutes();this.timezoneDelta=Math.round((n-t)/60);this.timezoneDelta<0&&(this.timezoneDelta+=24);this.register_subs(e.subscribe("ackmsg",this,"onAckMsg"));this.register_subs(e.subscribe("force_browser_reload",this,"onForceBrowserReload"));this.register_subs(e.subscribe("premium_status_change",this,"onPremiumStatusChange"));this.register_subs(e.subscribe("userMembershipStatusChange",this,"onPremiumStatusChange"));this.register_subs(e.subscribe("debugPing",this,"onDebugPing"));this.register_subs(e.subscribe("newRequestToken",this,"onNewRequestToken"));if(1==soundManager.bMuteSound&&null!==$("toggleSound_icon")){e.removeClass("toggleSound_icon","fa-volume-up");e.addClass("toggleSound_icon","fa-volume-off")}if($("toggleSound")){e.connect($("toggleSound"),"onclick",this,"onToggleSound");e.connect($("toggleSound"),"onmouseover",this,"onDisplaySoundControls");e.connect($("toggleSound"),"onmouseout",this,"onHideSoundControls")}if($("soundVolumeControl")){e.connect($("soundVolumeControl"),"onmouseup",this,"onSoundVolumeControl");e.connect($("soundVolumeControl"),"ontouchend",this,"onSoundVolumeControl")}if($("soundControls")){e.connect($("soundControls"),"onmouseover",this,"onStickSoundControls");e.connect($("soundControls"),"onmouseout",this,"onUnstickSoundControls")}{let e=!0;i.stores.userVolume.subscribe(t=>{t.volume,t.volumeMuted;localStorage.setItem("sound_muted",t.volumeMuted?"1":"0");localStorage.setItem("sound_volume",t.volume);this.onSetSoundVolume(!e);e=!1})}this.bgaUniversalModals=new i.ms.universalmodals.BgaUniversalModals({target:document.body});this.bgaToastHolder=new i.ms.toasts.BgaToastHolder({target:document.body});setInterval(e.hitch(this,"inactivityTimerIncrement"),6e4);document.onmousemove=e.hitch(this,"resetInactivityTimer");document.onkeypress=e.hitch(this,"resetInactivityTimer");$("pilink")&&e.connect($("pilink"),"onclick",this,function(t){e.stopEvent(t);this.ajaxcall("/player/player/pilink.html",{},this,function(e){})})},unload:function(){var e=void 0!==this.current_player_id?this.current_player_id:this.player_id;this.recordMediaStats(e,"stop");this.page_is_unloading=!0},updateAjaxCallStatus:function(){i.stores.menuStates.setIsPageLoading(this.ajaxcall_running>0)},showMessage:function(t,i){this.next_headmsg_id;if("only_to_log"!=i){var a="head_infomsg_"+this.next_headmsg_id,n="<div class='bga-link-inside head_"+i+"' id='"+a+"' style='display:none;'><div class='head_infomsg_close' id='close_"+a+"'><i class='fa fa-close' aria-hidden='true'></i></div><div class='head_infomsg_item'>"+t+"</div></div>";this.next_headmsg_id++;e.place(n,"head_infomsg");e.connect($("close_"+a),"onclick",this,function(t){e.style(t.currentTarget.parentElement.id,"display","none")});e.fx.chain([e.fx.wipeIn({node:a,duration:500}),e.fx.wipeOut({node:a,delay:5e3,duration:500})]).play()}"error"!=i&&"only_to_log"!=i||g_sitecore.notifqueue.addToLog(t)},changeActiveMenuItem:function(t){i.stores.menuStates.setActivePageName(t);menu_label_mappings={preferences:"welcome",playernotif:"welcome",welcomestudio:"welcome",start:"welcome",legal:"welcome",message:"welcome",gameinprogress:"welcome",table:"lobby",lobby:"lobby",newtable:"lobby",gamereview:"lobby",tournament:"lobby",newtournament:"lobby",tournamentlist:"lobby",gamepanel:"gamelist",games:"gamelist",player:"community",playerstat:"community",group:"community",newgroup:"community",community:"community",report:"community",newreport:"community",moderated:"community",translation:"community",translationhq:"community",map:"community",grouplist:"community",contribute:"community",sponsorship:"community",moderator:"community",bug:"community",bugs:"community",faq:"community",gamepublishers:"community",team:"community",troubleshootmainsite:"community",sandbox:"community",penalty:"community",karmalimit:"community",club:"premium",premium:"premium",contact:"community",reviewer:"community",giftcodes:"premium",shop:"shop",shopsupport:"shopsupport",prestige:"competition",gameranking:"competition",award:"competition",gamestats:"competition",leaderboard:"competition",page:"doc",news:"headlines",controlpanel:"controlpanel",linkmoderation:"controlpanel",moderation:"controlpanel",studio:"studio",studiogame:"controlpanel",administration:"controlpanel",banners:"controlpanel",projects:"projects",startwannaplay:"welcome",startsteps:"welcome",halloffame:"halloffame"};menu_label_mappings[t]&&(t=menu_label_mappings[t]);if(""!=this.active_menu_label){this.active_menu_label;$("navbutton_"+this.active_menu_label)&&e.removeClass("navbutton_"+this.active_menu_label,"navigation-button-active");i.stores.menuStates.setActiveMenuItem(null)}this.active_menu_label=t;if(""!=t){$("navbutton_"+t)&&e.addClass("navbutton_"+t,"navigation-button-active");i.stores.menuStates.setActiveMenuItem(t)}return t},subscribeCentrifugeChannel:function(e,t,i){if(this.socket){if(void 0===this.centrifuge_subscriptions[e]){const a=t||this.notifqueue,n=i||"onNotification",o=this.socket.newSubscription(e);o.on("publication",e=>a[n](e.data)).subscribe();this.centrifuge_subscriptions[e]=o;this.centrifuge_subscriptions[e].count=0}this.centrifuge_subscriptions[e].count,this.centrifuge_subscriptions[e].count;this.centrifuge_subscriptions[e].count++;return e}},subscribeCentrifugeChannels:function(e,t,i){if(this.socket){for(const a in e)this.subscribeCentrifugeChannel(e[a],t,i);return e}},unsubscribeCentrifugeChannel:function(e){if(this.socket&&void 0!==this.centrifuge_subscriptions[e]){this.centrifuge_subscriptions[e].count,this.centrifuge_subscriptions[e].count;this.centrifuge_subscriptions[e].count--;if(this.centrifuge_subscriptions[e].count<=0){this.centrifuge_subscriptions[e].unsubscribe();this.centrifuge_subscriptions[e].removeAllListeners();this.socket.removeSubscription(this.centrifuge_subscriptions[e]);delete this.centrifuge_subscriptions[e]}}},reconnectAllSubscriptions:function(){},onCentrifugeConnectionStatusChanged:function(t,i,a="ms"){if(this.page_is_unloading)e.style("connect_status","display","none");else{if(Number.isInteger(t)){if(11===t)return;if(t>=3500){this.socket.connect();return}if(2===t){this.reconnecting=!0;return}}if("connect"==t){e.style("connect_status","display","none");this.centrifuge_is_connected=!0;if(this.reconnecting&&"gs"===a){this.notifqueue.resynchronizeNotifications();this.reconnecting=!1}}else if("connect_error"==t){e.style("connect_status","display","block");this.centrifuge_is_connected=!1;$("connect_status_text").innerHTML=__("lang_mainsite","Disconnected from game server !");console.error("Disconnected from game server : "+i);g_sitecore.notifqueue.addToLog($("connect_status_text").innerHTML)}else if("connect_timeout"==t){e.style("connect_status","display","block");this.centrifuge_is_connected=!1;$("connect_status_text").innerHTML=__("lang_mainsite","Disconnected from game server !");$("connect_status_text").innerHTML+=" (timeout)";g_sitecore.notifqueue.addToLog($("connect_status_text").innerHTML)}else if("reconnect"==t){e.style("connect_status","display","none");this.centrifuge_is_connected=!0;g_sitecore.notifqueue.addToLog(__("lang_mainsite","You are connected again."));this.reconnectAllSubscriptions()}else if("reconnect_error"==t){e.style("connect_status","display","block");this.centrifuge_is_connected=!1;$("connect_status_text").innerHTML=__("lang_mainsite","Disconnected from game server !");console.error("Disconnected from game server : "+i);g_sitecore.notifqueue.addToLog($("connect_status_text").innerHTML)}else if("reconnect_failed"==t){e.style("connect_status","display","block");this.centrifuge_is_connected=!1;$("connect_status_text").innerHTML=__("lang_mainsite","Disconnected from game server !");$("connect_status_text").innerHTML+=" (reconnect failed)";g_sitecore.notifqueue.addToLog($("connect_status_text").innerHTML)}}},leaveTable:function(t,i){this.ajaxcall("/table/table/quitgame.html",{table:t,neutralized:!0,s:"table_quitgame"},this,function(e){i()},function(a,n,o){if(a&&(803==o||804==o)){var s=new ebg.popindialog;s.create("quitConfirmContent");s.setTitle(__("lang_mainsite","Quit game in progress"));s.setZIndex(1e4);s.tableModule=this;var r='<div id="quitConfirmContent">';if(803==o){r+=__("lang_mainsite","You are about to quit a game in progress.")+"<br/>";r+=__("lang_mainsite","This will cost you some <img src='theme/img/common/rank.png' class='imgtext'/> for this game, and 1 <div class='icon20 icon20_penaltyleave'></div> [-4 to -20] for your reputation.<br/><br/>");r+='<b style="color:red">'+__("lang_mainsite","A bad reputation may prevent you to chat or to join some games!")+"</b><br/><br/>";r+=`\n                                    <span>${__("lang_mainsite","Before deciding to quit a game in progess, especially if your opponent is not playing, please consider the following alternatives")}:</span>\n                                    <ul>\n                                        <li class="list-disc ml-6"">${__("lang_mainsite","You can vote to abandon/concede the game collectively to avoid losing ELO or Karma points")}</li>\n                                        <li class="list-disc ml-6"">${__("lang_mainsite","You can vote to change the game to turn-based mode to allow out-of-time players to return to the table later and continue playing")}</li>\n                                        <li class="list-disc ml-6"">${__("lang_mainsite","You can choose to eject out-of-time players from the game (causing them to lose ELO and Karma)")}</li>\n                                    </ul>\n                                <br/>`}else{r+=__("lang_mainsite","You are about to quit a Training game in progress.")+"<br/>";r+=__("lang_mainsite","Because this is a Training game, this will have no consequence (no penalty whatsoever).")}r+="<p><a class='bgabutton bgabutton_blue' id='quitgame_cancel' href='#'>"+__("lang_mainsite","Cancel")+"</a>&nbsp;&nbsp;&nbsp;<a class='bgabutton bgabutton_gray' id='quitgame_confirm' href='#'>"+__("lang_mainsite","Leave game")+"</a></p>";r+="</div>";s.setContent(r);s.show();e.connect($("quitgame_cancel"),"onclick",e.hitch(s,function(e){e.preventDefault();this.destroy()}));e.connect($("quitgame_confirm"),"onclick",e.hitch(s,function(e){e.preventDefault();this.destroy();this.tableModule.ajaxcall("/table/table/quitgame.html",{table:t,s:"table_quitdlg"},this,function(e){i()})}))}})},onSeeMoreLogs:function(t){t.preventDefault();var i=toint(e.style($("logs"),"maxHeight")),a=i+600;e.style($("logs"),"maxHeight",a+"px");e.style($("seemorelogs"),"top",a-24+"px");this.onIncreaseContentHeight(600)},onIncreaseContentHeight:function(){},onScriptError:function(t,i,a){if(!this.page_is_unloading){console.error(t);console.error("url="+i);console.error("line="+a);"function"==typeof this.setLoader&&this.setLoader(100,100);if(!1!==this.reportJsError&&-1==i.search("cloudfront.net")&&"ResizeObserver loop limit exceeded"!==t&&"ResizeObserver loop completed with undelivered notifications."!==t&&"Script error."!==t){var n=t+"\nScript: "+i+"\nUrl: "+window.location+"\n";$("bga_release_id")&&(n+="BGA version "+$("bga_release_id").innerHTML+"\n");n+=this.getScriptErrorModuleInfos()+"\n";n+=navigator.userAgent+"\n";if("show"==this.reportJsError){var o=this.nl2br(n,!1);this.showMessage("Javascript error:<br/>"+o,"error")}if(!this.reportErrorTimeout){this.reportErrorTimeout=!0;setTimeout(e.hitch(this,function(){this.reportErrorTimeout=!1}),6e4);this.ajaxcall("/web/scripterror",{log:n},this,function(e){})}}}},onInvisibleScriptError:function(e,t,i){let a=this.reportJsError;this.reportJsError="log";this.onScriptError(e.toString().replaceAll("${","{"),t,i);this.reportJsError=a},initChatDockedSystem:function(){var t={id:"stacked",type:"stacked",title:'<div class="icon20 icon20_speak"></div>',titlenolink:'<span style="font-size:120%">+</span>',avatar:'<i class="fa fa-ellipsis-h" aria-hidden="true"></i>',more_logs_label:__("lang_mainsite","Scroll down to see new messages"),stop_notif_label:__("lang_mainsite","Notify chat messages"),start_chat:__("lang_mainsite","Accept chat"),block_chat:__("lang_mainsite","Block player")};e.place(this.format_string(this.jstpl_chatwindow,t),"chatbarstackedmenu","first");e.place('<div id="stackedmenu"></div>',"chatwindowcollapsed_stacked");e.connect($("chatwindowcollapsed_stacked"),"onclick",this,"onToggleStackMenu");this.adaptChatbarDock();e.connect(window,"onresize",this,e.hitch(this,function(e){this.stackOrUnstackIfNeeded()}));this.dockedChatInitialized=!0},extractChannelInfosFromNotif:function(t){var i=t.channelorig,a=e.hasClass("ebd-body","mobile_version");if("/table/t"==i.substr(0,8)){var n=i.substr(8),o="";if(void 0!==t.gamenameorig){var s=this.getGameNameDisplayed(t.gamenameorig)+" #"+n;o=t.gamenameorig}else if(void 0!==t.args.game_name_ori){s=this.getGameNameDisplayed(t.args.game_name_ori)+" #"+n;o=t.args.game_name_ori}else if(void 0!==t.args.game_name){s=this.getGameNameDisplayed(t.args.game_name)+" #"+n;o=t.args.game_name}else s="Table #"+n;return"chat"==t.type||"groupchat"==t.type||"chatmessage"==t.type||"tablechat"==t.type||"privatechat"==t.type||"startWriting"==t.type||"stopWriting"==t.type||"newRTCMode"==t.type||"undefined"==typeof gameui?{type:"table",id:n,game_name:o,label:s,url:"/table?table="+n,channel:i,window_id:"table_"+n,subscription:!0,start:"collapsed"}:{type:"tablelog",id:n,game_name:o,label:__("lang_mainsite","Game log"),url:"#",channel:i,window_id:"tablelog_"+n,subscription:!0,notifymethod:"title",start:"collapsed"}}if("/group/g"==i.substr(0,8)){return{type:"group",id:c=i.substr(8),group_avatar:t.args.group_avatar,group_type:t.args.group_type,label:void 0===t.args.group_name?"":t.args.group_name,url:void 0===t.args.seemore?"":"/"+t.args.seemore,channel:"/group/g"+c,window_id:"group_"+c,start:"collapsed"}}if("/chat/general"==i.substr(0,13))return{type:"general",id:0,label:__("lang_mainsite","General messages"),url:null,channel:"/chat/general",window_id:"general",start:"collapsed"};if("/player/p"==i.substr(0,9)){if("privatechat"==t.type||"startWriting"==t.type||"stopWriting"==t.type||"newRTCMode"==t.type){if("undefined"!=typeof current_player_id)if(current_player_id==t.args.player_id)var r=t.args.target_id,l=t.args.target_name,d=t.args.target_avatar;else r=t.args.player_id,l=t.args.player_name,d=t.args.avatar;else if(this.player_id)if(this.player_id==t.args.player_id)r=t.args.target_id,l=t.args.target_name,d=t.args.target_avatar;else r=t.args.player_id,l=t.args.player_name,d=t.args.avatar;else r=t.args.player_id,l=t.args.player_name,d=t.args.avatar;return{type:"privatechat",id:r,label:l,avatar:d,url:"/player?id="+r,channel:"/player/p"+r,window_id:"privatechat_"+r,subscription:!1,start:"collapsed"}}if("groupchat"===t.type){var c;return{type:"group",id:c=t.args.group_id,group_avatar:t.args.group_avatar,group_type:t.args.group_type,label:void 0===t.args.group_name?"":t.args.group_name,url:void 0===t.args.seemore?"":"/"+t.args.seemore,channel:"/group/g"+c,window_id:"group_"+c,start:"collapsed"}}if(void 0!==t.gamenameorig&&"undefined"!=typeof gameui){return{type:"tablelog",id:n=gameui.table_id,label:__("lang_mainsite","Game log"),url:"#",channel:"/table/t"+n,window_id:"tablelog_"+n,subscription:!0,notifymethod:"title",start:"collapsed"}}}else if("/general/emergency"==i.substr(0,18))return{type:"emergency",id:0,label:__("lang_mainsite","Important notice"),url:null,channel:"/general/emergency",window_id:"emergency",start:a?"collapsed":"expanded"};return"startWriting"==t.type||"stopWriting"==t.type?null:{type:"general",id:0,label:__("lang_mainsite","General messages"),url:null,channel:"/chat/general",window_id:"general",start:"collapsed"}},getChatInputArgs:function(e){if("table"==e.type){var t="";void 0!==e.game_name&&(t='<img src="'+getMediaUrl(e.game_name,"icon")+'" alt="" class="game_icon emblem" />');var i="";"undefined"!=typeof gameui&&void 0!==gameui.debug_from_chat&&gameui.debug_from_chat&&void 0!==e.game_name&&(i="/"+e.game_name+"/"+e.game_name+"/say.html");"undefined"!=typeof gameui&&void 0!==gameui.chat_on_gs_side&&gameui.chat_on_gs_side&&void 0!==e.game_name&&(i="/"+e.game_name+"/"+e.game_name+"/say.html");return{type:"table",id:e.id,action:"/table/table/say.html",doubleaction:i,label:__("lang_mainsite","Discuss at this table"),param:{table:e.id},channel:"/table/t"+e.id,avatar:t}}if("tablelog"==e.type)return null;if("general"==e.type)return{type:"global",id:0,action:"/chat/chat/say.html",label:__("lang_mainsite","Discuss with everyone"),param:{},channel:null,avatar:'<i class="fa fa-comments" aria-hidden="true"></i>'};if("privatechat"==e.type)return{type:"player",id:e.id,action:"/table/table/say_private.html",label:__("lang_mainsite","Discuss with")+" "+e.label,param:{to:e.id},channel:"/player/p"+e.id,avatar:'<img src="'+getPlayerAvatar(e.id,e.avatar,50)+'" alt="" class="emblem" />'};if("emergency"==e.type)return null;if("group"==e.type){Math.floor(e.id/1e3);var a=e.avatar_src?e.avatar_src:getGroupAvatar(e.id,e.group_avatar,e.group_type,50);return{type:"group",id:e.id,action:"/group/group/say.html",label:__("lang_mainsite","Discuss with the group"),param:{to:e.id},channel:"/group/g"+e.id,avatar:'<img src="'+a+'" alt="" class="emblem" />'}}return null},onPlaceLogOnChannel:function(t){if(!this.dockedChatInitialized)return!1;var i=this.extractChannelInfosFromNotif(t);if(null===i)return!0;var a=i.window_id,n=e.hasClass("ebd-body","mobile_version"),o=!0;if("playerQuitGame"==t.args.reload_reason&&!(this.current_player_id in t.args.players)&&t.args.was_expected){this.closeChatWindow(a);return!0}if(null!==this.notifqueue.game)if("playtable"==i.type||"table"==i.type||"tablelog"==i.type);else if("privatechat"!=t.type&&"newRTCMode"!=t.type&&"startWriting"!=t.type&&"emergency"!=i.type)return!1;var s=null!==this.notifqueue.game,r="chat"==t.type||"groupchat"==t.type||"chatmessage"==t.type||"tablechat"==t.type||"privatechat"==t.type||"stopWriting"==t.type||"startWriting"==t.type,l=!1,d=!1;if(r&&void 0!==t.args.text&&null===t.args.text){t.log="~ "+__("lang_mainsite","${player_name} left the chat")+" ~";l=!0;d=!0}var c=!0;if("history_history"==t.type||void 0!==t.loadprevious){c=!1;if(void 0!==t.loadprevious&&t.loadprevious&&r&&void 0!==t.args.is_new&&1==t.args.is_new){c=!0;t.args.mread=null}}void 0!==t.donotpreview&&(c=!1);"chat"==t.type&&"/chat/general"==t.channelorig&&"undefined"!=typeof mainsite&&0==mainsite.notifyOnGeneralChat&&(c=!1);s&&(r||(o=!1));if(r&&"chatmessage"==t.type&&void 0!==t.args.message&&void 0!==t.gamenameorig&&void 0===t.args.message.log&&"werewolves"==t.gamenameorig&&-1!=t.args.message.indexOf("$$$"))return!0;if(void 0!==this.chatbarWindows[a]){if("startWriting"==t.type){void 0!==this.chatbarWindows[a].is_writing_now[t.args.player_name]&&clearTimeout(this.chatbarWindows[a].is_writing_now[t.args.player_name]);this.chatbarWindows[a].is_writing_now[t.args.player_name]=setTimeout(e.hitch(this,function(){if(void 0!==this.chatbarWindows[a]){delete this.chatbarWindows[a].is_writing_now[t.args.player_name];this.onUpdateIsWritingStatus(a)}}),8e3);this.onUpdateIsWritingStatus(a);return!0}if(r&&void 0!==t.args.player_id){this.chatbarWindows[a].is_writing_now[t.args.player_name];clearTimeout(this.chatbarWindows[a].is_writing_now[t.args.player_name]);delete this.chatbarWindows[a].is_writing_now[t.args.player_name];this.onUpdateIsWritingStatus(a)}}else if("startWriting"==t.type||"stopWriting"==t.type)return!0;var u=this.next_log_id;this.next_log_id++;var h=!1;void 0!==i.subscription&&i.subscription&&i.subscription&&(h=!0);if(void 0===this.chatbarWindows[i.window_id]&&l)return!0;var p=this.createChatBarWindow(i,h);if("newRTCMode"==t.type&&void 0!==t.args.table_id)if(t.args.rtc_mode>0&&null!==this.room&&this.room.indexOf("P")>=0){var _='<div  class="rtc_dialog"><br />';_+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+(!1!==this.mediaConstraints.video?__("lang_mainsite","A Premium user has set up a video chat session for this table!"):__("lang_mainsite","A Premium user has set up an audio chat session for this table!"))+"</i></div><br /><br />";_+='<div style="text-align: center; font-weight: bold;">'+__("lang_mainsite","But you are already taking part in another live chat session!")+"<br /><br /> "+__("lang_mainsite","Do you want to join the call?")+" ("+__("lang_mainsite","you will be disconnected from your current live chat session to join the new one")+")</div><br /><br />";_+="</div>";this.confirmationDialog(_,e.hitch(this,function(){var i=this.room.substr(1).split("_"),a=i[0]==N?i[1]:i[0];this.mediaConstraints.video?this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:a},this,e.hitch(this,function(e){this.already_accepted_room="T"+t.args.table_id;this.setNewRTCMode(t.args.table_id,null,t.args.rtc_mode,t.args.room_creator)})):this.mediaConstraints.audio&&this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:a},this,e.hitch(this,function(e){this.already_accepted_room="T"+t.args.table_id;this.setNewRTCMode(t.args.table_id,null,t.args.rtc_mode,t.args.room_creator)}))}),e.hitch(this,function(){}))}else(null===this.room||this.room.indexOf("T")>=0)&&this.setNewRTCMode(t.args.table_id,null,t.args.rtc_mode,t.args.room_creator);if("newRTCMode"==t.type&&void 0!==t.args.player_id)if(t.args.rtc_mode>0&&null!==this.room&&this.room.indexOf("T")>=0){_='<div  class="rtc_dialog"><br />';_+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+(!1!==this.mediaConstraints.video?__("lang_mainsite","A Premium user has set up a video chat session with you!"):__("lang_mainsite","A Premium user has set up an audio chat session with you!"))+"</i></div><br /><br />";_+='<div style="text-align: center; font-weight: bold;">'+__("lang_mainsite","But you are already taking part in another live chat session!")+"<br /><br /> "+__("lang_mainsite","Do you want to join the call?")+" ("+__("lang_mainsite","you will be disconnected from your current live chat session to join the new one")+")</div><br /><br />";_+="</div>";this.confirmationDialog(_,e.hitch(this,function(){this.room.substr(1);this.doLeaveRoom(e.hitch(this,function(){this.already_accepted_room="P"+Math.min(t.args.player_id,t.args.target_id)+"_"+Math.max(t.args.player_id,t.args.target_id);this.expandChatWindow(i.window_id);this.setNewRTCMode(null,t.args.target_id,t.args.rtc_mode,t.args.room_creator)}))}),e.hitch(this,function(){this.mediaConstraints.video?this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:t.args.target_id},this,function(e){this.mediaChatRating=!1}):this.mediaConstraints.audio&&this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:t.args.target_id},this,function(e){this.mediaChatRating=!1})}))}else if(null===this.room||this.room.indexOf("P")>=0){this.expandChatWindow(i.window_id);this.setNewRTCMode(null,t.args.target_id,t.args.rtc_mode,t.args.room_creator)}if(p&&"groupchat"==t.type&&void 0!==t.args.gamesession&&t.args.gamesessionadmin!=this.getCurrentPlayerId()){var m=e.clone(t);m.log='<p style="text-align:center"><a id="quit_playingsession_'+t.args.group_id+'" href="#" class="bgabutton bgabutton_gray">'+__("lang_mainsite","Quit this playing session")+"</a></p>";m.donotpreview=!0;this.onPlaceLogOnChannel(m);e.connect($("quit_playingsession_"+t.args.group_id),"onclick",this,e.hitch(this,function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(20);this.ajaxcall("/community/community/quitGroup.html",{id:i},this,function(){},function(e){});this.closeChatWindow("group_"+i)}))}var g=t.args.logaction;if(r&&void 0!==t.args.text&&void 0!==this.predefinedTextMessages_untranslated[t.args.text]){t.args.text=__("lang_mainsite",t.args.text);d=!0}if(r){var f=!1;"/chat/general"==t.channelorig&&(f=!0);r&&void 0!==t.args.text&&null!=t.args.text?t.args.text=this.makeClickableLinks(t.args.text,f):r&&void 0!==t.args.message&&void 0===t.args.message.log&&(t.args.message=this.makeClickableLinks(t.args.message,f))}_=this.notifqueue.formatLog(t.log,t.args);var b="",y="";if(null==this.notifqueue.game){if(g){var v=this.notifqueue.formatLog(g.log,g.args);b='<div class="logaction"><a href="#" id="logaction_'+u+'">['+v+"]</a></div>";y='<div class="logaction"><a href="#" id="logactionp_'+u+'">['+v+"]</a></div>"}}else r||(_=this.notifqueue.game.applyGenderRegexps(_));r&&void 0!==t.args.text&&this.isBadWorkInChat(t.args.text)&&(b+='<div  class="logaction">'+__("lang_mainsite","Insult? Aggressive attitude? Please do not respond or you will be moderated too.")+" "+__("lang_mainsite","Block this player (thumb down) and report him/her to moderators.")+"</div>");var w,x="",k=this.chatbarWindows[a].lastMsgTime,C=t.time,T=new Date(1e3*C);w=T.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});var j=new Date(1e3*k),S=C-k;if(Math.floor(k/60)!=Math.floor(C/60)){if(j.toLocaleDateString()!=T.toLocaleDateString()){x+='<div class="timestamp">'+T.toLocaleDateString()+"</div>"}this.chatbarWindows[a].lastMsgTime=C}var M="",A=!1,E="";if(r){M+=" chatlog";var N=void 0!==this.current_player_id?this.current_player_id:this.player_id;if(void 0!==t.args.player_id&&t.args.player_id==N){M+=" ownchatlog";A=!0}if(void 0!==this.chatbarWindows[a].lastMsgAuthor&&this.chatbarWindows[a].lastMsgAuthor==t.args.player_id&&S<60){0;M+=" sameauthor"}this.chatbarWindows[a].lastMsgAuthor=t.args.player_id;if(void 0!==t.args.mread&&!A)if(t.args.mread);else{M+=" newmessage";void 0!==t.args.id&&(E=' id="newmessage_'+a.substr(0,1)+"_"+t.args.id+'"')}l?M+=" leavechat":d&&(M+=" predefinedchat")}x+='<div class="roundedbox log bga-link-inside'+M+'" id="dockedlog_'+u+'"><div class="roundedboxinner"'+E+">";r&&(_=this.addSmileyToText(_).replace(/(?:\r\n|\r|\n)/g,"<br>"));var L=_;if(""!=w){var D="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",P="";if("privatechat"==t.type&&void 0!==t.args.mread&&A)if(t.args.mread){P='<i class="fa fa-check message_read" aria-hidden="true"></i>';D+="&nbsp;&nbsp;"}else{P='<i class="fa fa-check message_unread" id="privmsg_read_'+t.args.id+'" aria-hidden="true"></i>';D+="&nbsp;&nbsp;"}r||(D+="&nbsp;&nbsp;");_+=D+'<div class="msgtime">'+w+" "+P+"</div>"}x+=_+b;!r||A||d||(x+='<div class="translate_icon " id="logtr_'+a+"_"+u+'" title="'+__("lang_mainsite","Translate with Google")+'"></div>');r&&d&&!l&&(x+='<div class="predefinedchat_icon " title="'+__("lang_mainsite","Predefined message translated in each player's language")+'"></div>');x+="</div></div>";var I=e.style("chatwindowlogs_zone_"+a,"height"),R=$("chatwindowlogs_zone_"+a).scrollTop+I>=$("chatwindowlogs_zone_"+a).scrollHeight-10;void 0!==t.loadprevious&&$("load_previous_message_wrap_"+a)?e.place(x,"load_previous_message_wrap_"+a,"before"):e.place(x,"chatwindowlogs_endzone_"+a,"before");this.addTooltipToClass("message_read",__("lang_mainsite","This message has been read"),"");this.addTooltipToClass("message_unread",__("lang_mainsite","This message has not been read yet"),"");null==this.notifqueue.game?g&&$("logaction_"+u)&&e.connect($("logaction_"+u),"onclick",this,function(t){e.stopEvent(t);g.action_analytics&&analyticsPush(g.action_analytics);mainsite.ajaxcall(g.action,g.action_arg,this,function(){})}):r&&void 0!==t.args.player_id&&$("ban_spectator_"+t.args.player_id)&&e.style("ban_spectator_"+t.args.player_id,"display","inline");void 0===t.loadprevious&&(R?$("chatwindowlogs_zone_"+a).scrollTop=$("chatwindowlogs_zone_"+a).scrollHeight:e.style("chatwindowmorelogs_"+a,"display","block"));r&&$("logtr_"+a+"_"+u)&&e.connect($("logtr_"+a+"_"+u),"onclick",this.notifqueue,"onTranslateLog");var F="dockedlog_"+u;if(void 0===t.loadprevious){e.style(F,"display","none");e.fx.chain([e.fx.wipeIn({node:F,onAnimate:function(e){R&&($("chatwindowlogs_zone_"+a).scrollTop=$("chatwindowlogs_zone_"+a).scrollHeight)},onEnd:function(e){R&&($("chatwindowlogs_zone_"+a).scrollTop=$("chatwindowlogs_zone_"+a).scrollHeight)}}),e.animateProperty({node:F,delay:5e3,properties:{color:{end:"#000000"},onEnd:function(t){e.style(t,"display","block")}}})]).play()}else $(F)&&e.style(F,"color","#000000");if("title"==this.chatbarWindows[a].notifymethod){var O=L.split("\x3c!--"),B="",H=!0;for(var z in O){var q=O[z];if("PNS--\x3e"==q.substr(0,6))B+=H?q:"\x3c!--"+q;else{H||(q="\x3c!--"+q);B+=dojox.dtl.filter.htmlstrings.striptags(q)}H&&(H=!1)}$("chatwindowtitlenolink_"+a).innerHTML=B}var G=this.chatbarWindows[a].status;if(c&&("collapsed"==G||"stacked"==G)){if("collapsed"==G){if("general"==a);else if("normal"==this.chatbarWindows[a].notifymethod||n&&"tablechat"==t.type){e.addClass("chatwindow_"+a,"newmessage");var W=$("chatwindownewmsgcount_"+a).innerHTML;if(""==W){$("chatwindownewmsgcount_"+a).innerHTML=1;$("chatMindownewmsgcount_"+a).innerHTML=1}else if(toint(W)<=8){$("chatwindownewmsgcount_"+a).innerHTML=toint(W)+1;$("chatMindownewmsgcount_"+a).innerHTML=toint(W)+1}else{$("chatwindownewmsgcount_"+a).innerHTML="9+";$("chatMindownewmsgcount_"+a).innerHTML="9+"}}if(!n){e.place('<div><div id="logprev_'+u+'" class="chatwindowpreviewmsg bga-link-inside">'+L+y+"</div></div>","chatwindowpreview_"+a);var U=e.query("#chatwindowpreview_"+a+" .chatwindowpreviewmsg");if(U.length>5){var V=U.length;for(var z in U){if(V<=5)break;e.destroy(U[z]);V--}}}}else"stacked"==G&&(n||e.place('<div id="logprev_'+u+'" class="chatwindowpreviewmsg bga-link-inside">'+_+y+"</div>","chatwindowpreview_stacked"));if(!n){F="logprev_"+u;e.style(F,"display","none");e.fx.wipeIn({node:F}).play();this.fadeOutAndDestroy(F,500,5e3)}null==this.notifqueue.game&&g&&$("logactionp_"+u)&&e.connect($("logactionp_"+u),"onclick",this,function(t){e.stopEvent(t);g.action_analytics&&analyticsPush(g.action_analytics);mainsite.ajaxcall(g.action,g.action_arg,this,function(){})})}["privatechat","tablechat","groupchat"].includes(t.type)&&(void 0===this.chatbarWindows[a].first_msg_timestamp?this.chatbarWindows[a].first_msg_timestamp=toint(t.time):this.chatbarWindows[a].first_msg_timestamp=Math.min(t.time,this.chatbarWindows[a].first_msg_timestamp));if(l&&"leavelast"==t.args.type){$("chatbarinput_"+a+"_input").disabled=!0;$("chatbarinput_"+a+"_input").placeholder=__("lang_mainsite","There is no one left in this chat")}return o},onUpdateIsWritingStatus:function(t){var i=0,a="";for(var n in this.chatbarWindows[t].is_writing_now)if(n!=this.current_player_name){""==a?a=n:a+=", "+n;i++}if(0==i){e.style("chatwindowtitlenolink_"+t,"display","inline");e.style("is_writing_now_"+t,"display","none");e.style("chatwindowlogstitle_content_"+t,"display","inline");e.style("is_writing_now_title_"+t,"display","none")}else{$("is_writing_now_expl_"+t).innerHTML=e.string.substitute(__("lang_mainsite","${player} is writing something ..."),{player:a});$("is_writing_now_expl_title_"+t).innerHTML=e.string.substitute(__("lang_mainsite","${player} is writing something ..."),{player:a});e.style("chatwindowtitlenolink_"+t,"display","none");e.style("is_writing_now_"+t,"display","inline");e.style("chatwindowlogstitle_content_"+t,"display","none");e.style("is_writing_now_title_"+t,"display","inline")}},createChatBarWindow:function(t,i){if(!this.dockedChatInitialized)return!1;var a=e.hasClass("ebd-body","mobile_version"),n=t.window_id,o=t.label;if(void 0!==this.chatbarWindows[n]){if("collapsed"==this.chatbarWindows[n].status)return!1;if("expanded"==this.chatbarWindows[n].status)return!1;if("stacked"==this.chatbarWindows[n].status)return!1}this.stackChatWindowsIfNeeded(t.start);null!==t.url&&(o='<a href="'+t.url+'" class="chatwindowtitlelink no-underline" id="chatwindowtitlelink_'+n+'"">'+o+"</a>");var s="normal";void 0!==t.notifymethod&&(s=t.notifymethod);var r=!1;void 0!==t.autoShowOnKeyPress&&(r=t.autoShowOnKeyPress);this.chatbarWindows[n]={status:t.start,title:o,input:new ebg.chatinput,subscription:null,notifymethod:s,autoShowOnKeyPress:r,lastMsgTime:0,lastMsgAuthor:0,is_writing_now:{}};this.chatbarWindows[n].input.callbackBeforeChat=e.hitch(this,"onCallbackBeforeChat");this.chatbarWindows[n].input.callbackAfterChat=e.hitch(this,"onCallbackAfterChat");this.chatbarWindows[n].input.callbackAfterChatError=e.hitch(this,"callbackAfterChatError");this.adaptChatbarDock();var l=this.getChatInputArgs(t),d=n.split("_")[0],c="";if(null==l||void 0===l.avatar||""==l.avatar){c='<i class="fa fa-comment" aria-hidden="true"></i>';null===l&&"tablelog"==t.type&&(c='<i class="fa fa-history" aria-hidden="true"></i>')}else c=l.avatar;"undefined"!=typeof gameui&&"table"==t.type&&t.id==gameui.table_id&&(c='<i class="fa fa-comment" aria-hidden="true"></i>');"emergency"==t.type&&(c='<img src="'+getStaticAssetUrl("img/logo/logo.png")+'" alt="" class="bga_logo emblem" />');var u={id:n,title:o,type:d,titlenolink:t.label,more_logs_label:__("lang_mainsite","Scroll down to see new messages"),stop_notif_label:__("lang_mainsite","Notify chat messages"),avatar:c,start_chat:__("lang_mainsite","Accept chat"),block_chat:__("lang_mainsite","Block player")};e.place(this.format_string(this.jstpl_chatwindow,u),"chatbardock","first");e.addClass("chatwindow_"+n,t.start);if("expanded"==t.start){e.style("chatwindowexpanded_"+n,"display","block");a||e.style("chatwindowcollapsed_"+n,"display","none");e.style("chatwindowpreview_"+n,"display","none");a&&this.makeSureChatBarIsOnTop(n)}if($("chatbarinput_stopnotif_general")){this.addTooltip("chatbarinput_stopnotif_general","",__("lang_mainsite","Uncheck this box if you don't want to be notified when there is a new message in the global chat."));e.connect($("chatbarinput_stopnotif_box_general"),"onclick",this,"onChangeStopNotifGeneralBox");e.connect($("chatbarinput_stopnotif_label_general"),"onclick",this,"onChangeStopNotifGeneralLabel");if("undefined"!=typeof mainsite&&(0==mainsite.notifyOnGeneralChat||mainsite.bUnderage)){bDisplayPreview=!1;$("chatbarinput_stopnotif_box_general").checked=""}}e.connect($("startchat_accept_"+n),"onclick",this,"onStartChatAccept");e.connect($("startchat_block_"+n),"onclick",this,"onStartChatBlock");if(null!==l){this.chatbarWindows[n].input.create(this,"chatbarinput_"+n,l.action,l.label);this.chatbarWindows[n].input.writingNowChannel=l.channel;this.chatbarWindows[n].input.baseparams=l.param;void 0!==l.doubleaction&&""!=l.doubleaction&&(this.chatbarWindows[n].input.post_url_bis=l.doubleaction);e.connect($("chatbarinput_predefined_"+n),"onclick",this,"onShowPredefined")}else e.addClass("chatwindowlogs_zone_"+n,"chatwindowlogs_zone_big");if(["privatechat","table","group"].includes(d)){var h='<div id="load_previous_message_wrap_'+n+'" class="load_previous_message">                                <a class="bga-link" href="#" id="load_previous_message_'+n+'">'+__("lang_mainsite","Load previous messages")+"</a>                            </div>";e.place(h,"chatwindowlogs_endzone_"+n,"before");e.connect($("load_previous_message_"+n),"onclick",this,"onLoadPreviousMessages")}e.connect($("chatwindowremove_"+n),"onclick",this,"onCloseChatWindow");e.connect($("chatwindowcollapse_"+n),"onclick",this,"onCollapseChatWindow");e.connect($("chatwindowlogstitlebar_"+n),"onclick",this,"onCollapseChatWindow");e.connect($("chatwindowcollapsed_"+n),"onclick",this,"onExpandChatWindow");e.connect($("chatwindowremovc_"+n),"onclick",this,"onCloseChatWindow");e.connect($("chatwindowmorelogslink_"+n),"onclick",this,"onScrollDown");e.connect($("chatbar_inner"),"onclick",this,"onCollapseAllChatWindow");e.connect(this.chatbarWindows[n].input,"onChatInputKeyUp",this,"onDockedChatInputKey");e.connect($("chatbarinput_"+n+"_input"),"onclick",this,"onDockedChatFocus");i&&(this.chatbarWindows[n].subscription=this.subscribeCentrifugeChannel(t.channel,this.notifqueue,"onNotification"));if("table"==d||"privatechat"==d){if("undefined"!=typeof mainsite&&mainsite.pma||"undefined"!=typeof gameui&&gameui.pma){e.query("#chatbarinput_startaudiochat_"+n).connect("onclick",this,"onStartStopAudioChat");this.addTooltip("chatbarinput_startaudiochat_"+n,"",__("lang_mainsite","Audio call"));e.query("#chatbarinput_startvideochat_"+n).connect("onclick",this,"onStartStopVideoChat");this.addTooltip("chatbarinput_startvideochat_"+n,"",__("lang_mainsite","Video call"))}else{this.addTooltip("chatbarinput_startaudiochat_"+n,this.premiumMsgAudioVideo,"");e.query("#chatbarinput_startaudiochat_"+n).connect("onclick",this,function(t){e.stopEvent(t);this.showMessage(_(this.premiumMsgAudioVideo),"info")});this.addTooltip("chatbarinput_startvideochat_"+n,this.premiumMsgAudioVideo,"");e.query("#chatbarinput_startvideochat_"+n).connect("onclick",this,function(t){e.stopEvent(t);this.showMessage(_(this.premiumMsgAudioVideo),"info")})}this.mediaConstraints.video?e.query("#chatbarinput_startvideochat_"+n).removeClass("audiovideo_inactive").addClass("audiovideo_active"):this.mediaConstraints.audio&&e.query("#chatbarinput_startaudiochat_"+n).removeClass("audiovideo_inactive").addClass("audiovideo_active")}return!0},onStartChatAccept:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(17);e.removeClass("chatwindow_"+i,"startchat_toconfirm")},onStartChatBlock:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(16),a=t.currentTarget.id.substr(28),n=new ebg.thumb;n.create(this,t.currentTarget.id,a,0);n.bForceThumbDown=!0;n.onGiveThumbDown(t);this.closeChatWindow(i)},onChangeStopNotifGeneralBox:function(e){var t=$("chatbarinput_stopnotif_box_general").checked?1:0;this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"notifyGeneralChat",value:t},this,function(){this.showMessage(__("lang_mainsite","Preference updated!"),"info")});"undefined"!=typeof mainsite&&(mainsite.notifyOnGeneralChat=t)},onChangeStopNotifGeneralLabel:function(t){e.stopEvent(t);$("chatbarinput_stopnotif_box_general").checked?$("chatbarinput_stopnotif_box_general").checked="":$("chatbarinput_stopnotif_box_general").checked="checked";this.onChangeStopNotifGeneralBox(t)},checkAVFrequencyLimitation:function(){var e=sessionStorage.getItem("timeToWaitNextAV"),t=sessionStorage.getItem("lastAVAttemptTimestamp");if(!e||!t)return!1;var i=Date.now(),a=Math.round((i-t)/1e3);if(a>=120){sessionStorage.removeItem("timeToWaitNextAV");sessionStorage.removeItem("AVAttemptNumber");sessionStorage.removeItem("lastAVAttemptTimestamp");return!1}var n=e-a;if(n>0){this.showMessage(__("lang_mainsite","You need to wait %s seconds before launching an audio/video chat again.").replace("%s",n),"info");return!0}return!1},setAVFrequencyLimitation:function(){var e=sessionStorage.getItem("AVAttemptNumber")?sessionStorage.getItem("AVAttemptNumber"):0;e++;sessionStorage.setItem("AVAttemptNumber",e);var t=Date.now();sessionStorage.setItem("lastAVAttemptTimestamp",t);var i=Math.min(10*e,60);sessionStorage.setItem("timeToWaitNextAV",i)},onStartStopAudioChat:function(t){e.stopEvent(t);if(null!==this.room||!this.checkAVFrequencyLimitation()){var i=t.target.id.split("_")[2];void 0===i&&(i=t.target.parentNode.id.split("_")[2]);if("table"==i){if(null!==this.room&&this.room.indexOf("T")<0){this.showMessage(__("lang_mainsite","You must end your other live chat sessions before starting a new one."),"error");return}var a="undefined"!=typeof current_player_id?current_player_id:this.player_id;if("undefined"!=typeof mainsite&&null===$("active_player_"+a)){this.showMessage(__("lang_mainsite","You are not currently playing at this table (you haven't joined yet, you have quit or the game has ended)."),"error");return}var n=t.target.id.split("_")[3];void 0===n&&(n=t.target.parentNode.id.split("_")[3]);if(null===this.room){var o='<div  class="rtc_dialog"><br />';o+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+__("lang_mainsite","You are launching an audio chat session for this table!")+"</i></div>";o+="</div>";this.confirmationDialog(o,e.hitch(this,function(){this.ajaxcall("/table/table/startStopAudio.html",{target_table:n,target_player:null},this,function(e){})}),e.hitch(this,function(){}))}else{this.setAVFrequencyLimitation();this.ajaxcall("/table/table/startStopAudio.html",{target_table:n,target_player:null},this,function(e){this.mediaChatRating&&g_sitecore.displayRatingContent("audio",{room_id:e.room_id,media:"audio",rating:null,issue:null,text:null})})}}if("privatechat"==i){if(null!==this.room&&this.room.indexOf("P")<0){this.showMessage(__("lang_mainsite","You must end your other live chat sessions before starting a new one."),"error");return}void 0===(a=t.target.id.split("_")[3])&&(a=t.target.parentNode.id.split("_")[3]);if(null===this.room){o='<div  class="rtc_dialog"><br />';o+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+__("lang_mainsite","You are launching an audio chat session with another player!")+"</i></div>";o+="</div>";this.confirmationDialog(o,e.hitch(this,function(){this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:a},this,function(e){})}),e.hitch(this,function(){}))}else{this.setAVFrequencyLimitation();this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:a},this,function(e){this.mediaChatRating&&g_sitecore.displayRatingContent("audio",{room_id:e.room_id,media:"audio",rating:null,issue:null,text:null})})}}}},onStartStopVideoChat:function(t){e.stopEvent(t);var i=t.target.id.split("_")[2];void 0===i&&(i=t.target.parentNode.id.split("_")[2]);if("table"==i){if(null!==this.room&&this.room.indexOf("T")<0){this.showMessage(__("lang_mainsite","You must end your other live chat sessions before starting a new one."),"error");return}var a="undefined"!=typeof current_player_id?current_player_id:this.player_id;if("undefined"!=typeof mainsite&&null===$("active_player_"+a)){this.showMessage(__("lang_mainsite","You are not currently playing at this table (you haven't joined yet, you have quit or the game has ended)."),"error");return}var n=t.target.id.split("_")[3];void 0===n&&(n=t.target.parentNode.id.split("_")[3]);var o='<div  class="rtc_dialog"><br />';o+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+__("lang_mainsite","You are launching a video chat session for this table!")+"</i></div>";o+="</div>";null===this.room?this.confirmationDialog(o,e.hitch(this,function(){this.ajaxcall("/table/table/startStopVideo.html",{target_table:n,target_player:null},this,function(e){})}),e.hitch(this,function(){})):this.ajaxcall("/table/table/startStopVideo.html",{target_table:n,target_player:null},this,function(e){this.mediaChatRating&&g_sitecore.displayRatingContent("video",{room_id:e.room_id,media:"video",rating:null,issue:null,text:null})})}if("privatechat"==i){if(null!==this.room&&this.room.indexOf("P")<0){this.showMessage(__("lang_mainsite","You must end your other live chat sessions before starting a new one."),"error");return}void 0===(a=t.target.id.split("_")[3])&&(a=t.target.parentNode.id.split("_")[3]);o='<div  class="rtc_dialog"><br />';o+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+__("lang_mainsite","You are launching a video chat session with another player!")+"</i></div>";o+="</div>";null===this.room?this.confirmationDialog(o,e.hitch(this,function(){this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:a},this,function(e){})}),e.hitch(this,function(){})):this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:a},this,function(e){this.mediaChatRating&&g_sitecore.displayRatingContent("video",{room_id:e.room_id,media:"video",rating:null,issue:null,text:null})})}},setNewRTCMode:function(t,i,a,n){if(null!==a){this.rtc_mode=a;if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&!this.isSpectator){var o="undefined"!=typeof current_player_id?current_player_id:this.player_id,s=!1,r=0!=a;if(this.mediaConstraints.audio!=r){this.mediaConstraints.audio=r;s=!0}var l=this.getRtcVideoConstraints(a);if(JSON.stringify(this.mediaConstraints.video)!=JSON.stringify(l)){this.mediaConstraints.video=l;s=!0}if(s&&null!==this.webrtc){this.clearRTC();this.room=null}if(null===this.room&&(this.mediaConstraints.audio||this.mediaConstraints.video)){if(null!==t){this.room="T"+t;if("undefined"!=typeof gameui&&null==$("rtc_container_"+o)){e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!1),{player_id:o,muted:"muted"}),$("rtc_placeholder_"+o));this.setupRTCEvents(o)}if("undefined"!=typeof mainsite&&null!=$("active_player_"+o)&&null!=$("emblem_"+o)&&null==$("rtc_container_"+o)){e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!1),{player_id:o,muted:"muted"}),$("table_rtc_placeholder"));this.placeOnObject($("rtc_container_"+o),$("emblem_"+o));this.setupRTCEvents(o)}}else if(null!==i){this.room="P"+Math.min(o,i)+"_"+Math.max(o,i);if(null!==$("chatwindowlogs_privatechat_"+i)&&null==$("rtc_container_"+o)){e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!1),{player_id:o,muted:"muted"}),$("chatwindowlogs_privatechat_"+i));if(this.mediaConstraints.video){e.style($("rtc_container_"+o),"top","-6px");e.style($("rtc_container_"+o),"left","115px");e.style($("rtc_container_"+o),"zIndex","496")}else if(this.mediaConstraints.audio){e.style($("rtc_container_"+o),"top","-13px");e.style($("rtc_container_"+o),"left","135px")}this.setupRTCEvents(o)}}n==o&&(this.already_accepted_room=this.room);var d=null!==t?"table_"+t:"privatechat_"+i;if(this.mediaConstraints.video){e.query("#chatbarinput_startvideochat_"+d).removeClass("audiovideo_inactive").addClass("audiovideo_active");e.query("#playersaroundtable_startvideochat_"+d).removeClass("audiovideo_inactive").addClass("audiovideo_active")}else if(this.mediaConstraints.audio){e.query("#chatbarinput_startaudiochat_"+d).removeClass("audiovideo_inactive").addClass("audiovideo_active");e.query("#playersaroundtable_startaudiochat_"+d).removeClass("audiovideo_inactive").addClass("audiovideo_active")}this.startRTC()}}}},onLoadPreviousMessages:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(22),a=i.split("_")[0],n=i.split("_")[1];this.loadPreviousMessage(a,n)},loadPreviousMessage:function(e,t){var i=e+"_"+t,a=null;void 0!==this.chatbarWindows[i].first_msg_timestamp&&(a=this.chatbarWindows[i].first_msg_timestamp);this.ajaxcall("/table/table/chatHistory.html",{type:e,id:t,before:a},this,"loadPreviousMessageCallback",function(e){},"get")},loadPreviousMessageCallback:function(t){if(void 0===i)var i=this.player_id;var a=t.type,n=t.id;if(t.status){if("underage"==t.status){this.showMessage(_("Sorry, you are not authorized to discuss with this player"),"error");this.closeChatWindow(a+"_"+n);return}if("admin"==t.status){var o=__("lang_mainsite","Our ${contact_page} is the best way to get in touch with us :)");o=o.replace("${contact_page}",__("lang_mainsite","Contact page"));this.showMessage(o,"error");this.closeChatWindow(a+"_"+n);gotourl("support");return}t.status;"newchat"==t.status&&e.place('<div class="whiteblock"><i class="fa fa-exclamation-triangle"></i> '+_("Unsollicited messages may lead to be blocked and affect your reputation.")+"</div>","chatwindowlogs_endzone_"+a+"_"+n,"before");"newchattoconfirm"==t.status&&e.addClass("chatwindow_"+a+"_"+n,"startchat_toconfirm")}this.chatbarWindows[a+"_"+n].lastMsgAuthor=null;var s=$("chatwindowlogs_zone_"+a+"_"+n).scrollHeight,r=!1;for(var l in t.history){r=!0;if("privatechat"==a){var d={channel:"/player/p"+i,channelorig:"/player/p"+i,args:t.history[l],bIsTableMsg:!1,lock_uuid:"dummy",log:"${player_name} ${text}",type:"privatechat",time:t.history[l].time,mread:t.history[l].mread,loadprevious:!0,uid:0};this.onPlaceLogOnChannel(d)}else if("table"==a){d={channel:"/table/t"+n,channelorig:"/table/t"+n,args:t.history[l],bIsTableMsg:!0,lock_uuid:"dummy",log:"${player_name} ${text}",type:"tablechat",time:t.history[l].time,loadprevious:!0,uid:0};this.onPlaceLogOnChannel(d)}else if("group"==a){d={channel:"/group/g"+n,channelorig:"/group/g"+n,args:t.history[l],lock_uuid:"dummy",log:"${player_name} ${text}",type:"groupchat",time:t.history[l].time,loadprevious:!0,uid:0};this.onPlaceLogOnChannel(d)}else console.error("unknow previous message type: "+a)}e.place("load_previous_message_wrap_"+a+"_"+n,"chatwindowlogs_zone_"+a+"_"+n,"first");r||e.destroy("load_previous_message_"+a+"_"+n);var c=$("chatwindowlogs_zone_"+a+"_"+n).scrollHeight;c>s&&($("chatwindowlogs_zone_"+a+"_"+n).scrollTop+=toint(c-s))},stackOrUnstackIfNeeded:function(){var t=this.countStackedWindows(),i=e.hasClass("ebd-body","mobile_version");if(t>0){if(this.getNeededChatbarWidth()+(i?80:300)<=e.position("chatbar").w-50)for(var a in this.chatbarWindows)if("stacked"==this.chatbarWindows[a].status){this.unstackChatWindow(a,"automatic");return}}this.stackChatWindowsIfNeeded();i&&e.query("#chatbar .expanded .chatwindowlogs_zone").forEach(function(e){setTimeout(function(){e.scrollTop=e.scrollHeight},1)})},onUnstackChatWindow:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(15);this.unstackChatWindow(i);e.style("stackedmenu","display","none")},unstackChatWindow:function(t,i){void 0===i&&(i="normal");this.stackChatWindowsIfNeeded("expanded");this.expandChatWindow(t);"automatic"==i&&this.collapseChatWindow(t);$("stackmenu_item_"+t)&&e.destroy("stackmenu_item_"+t)},stackChatWindowsIfNeeded:function(t){var i=e.hasClass("ebd-body","mobile_version");if("none"!=e.style("chatbar","display")){"undefined"==typeof save_spaces_nbr&&(save_spaces_nbr=null);var a=e.position("chatbar").w-50,n=this.getNeededChatbarWidth();"collapsed"==t&&(n+=i?64:176);"expanded"==t&&(n+=i?64:220);n>a&&this.stackOneChatWindow()&&this.stackChatWindowsIfNeeded(t)}},stackOneChatWindow:function(){var t=null;for(var i in this.chatbarWindows){"collapsed"==this.chatbarWindows[i].status&&(t=i)}if(null===t)for(var i in this.chatbarWindows){"expanded"==this.chatbarWindows[i].status&&(t=i)}if(null===t||!this.chatbarWindows[t]){console.error("Cannot find any chatwindow to stack!!!");return!1}this.chatbarWindows[t].status="stacked";e.removeClass("chatwindow_"+t,["collapsed","expanded","stacked"]);e.addClass("chatwindow_"+t,"stacked");this.updateChatBarStatus();e.style("chatwindowexpanded_"+t,"display","none");e.style("chatwindowcollapsed_"+t,"display","none");e.style("chatwindowpreview_"+t,"display","none");var a=$("chatwindowtitlenolink_"+t).innerHTML;e.place('<div class="stackmenu_item" id="stackmenu_item_'+t+'">'+a+"</div>","stackedmenu");e.connect($("stackmenu_item_"+t),"onclick",this,"onUnstackChatWindow");this.adaptChatbarDock();return!0},getNeededChatbarWidth:function(){var t=e.hasClass("ebd-body","mobile_version"),i=0,a=0,n=t?64:280,o=t?64:176,s=0;for(var r in this.chatbarWindows){"tablelog"==r.substr(0,8)&&e.hasClass("ebd-body","desktop_version")&&!e.hasClass("ebd-body","new_gameux")||("expanded"==this.chatbarWindows[r].status?i++:"collapsed"==this.chatbarWindows[r].status&&a++);"table_"==r.substr(0,6)&&e.hasClass("ebd-body","desktop_version")&&"undefined"!=typeof gameui&&("expanded"==this.chatbarWindows[r].status?s+=412-n:"collapsed"==this.chatbarWindows[r].status&&(s+=312-o))}return 2+i*n+a*o+s},adaptChatbarDock:function(){if($("chatwindowcollapsed_stacked")){var t=this.getNeededChatbarWidth();if(t>0){e.addClass("chatbardock","chatbardock_visible");e.style("chatbardock","width",t+"px")}else e.removeClass("chatbardock","chatbardock_visible");this.countStackedWindows()>0?e.style("chatwindowcollapsed_stacked","display","block"):e.style("chatwindowcollapsed_stacked","display","none")}},countStackedWindows:function(){var e=0;for(var t in this.chatbarWindows)"stacked"==this.chatbarWindows[t].status&&e++;return e},closeChatWindow:function(t){if(this.chatbarWindows[t]){this.makeSureChatBarIsOnBottom(t);null!==this.chatbarWindows[t].subscription&&g_sitecore.unsubscribeCentrifugeChannel(this.chatbarWindows[t].subscription);e.destroy("chatwindow_"+t);delete this.chatbarWindows[t];this.updateChatBarStatus();this.stackOrUnstackIfNeeded();this.adaptChatbarDock()}},onCloseChatWindow:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(17),a=i.split("_")[0],n=i.split("_")[1];this.ackUnreadMessage(i,"unsub");if(null!==this.room&&this.room.indexOf("P")>=0){var o="undefined"!=typeof current_player_id?current_player_id:this.player_id;if("table"==a&&this.room=="T"+n){this.doLeaveRoom();this.closeChatWindow(i)}else"privatechat"==a&&this.room=="P"+n+"_"+o||"privatechat"==a&&this.room=="P"+o+"_"+n?this.mediaConstraints.video?this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:n},this,function(e){this.closeChatWindow(i)}):this.mediaConstraints.audio&&this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:n},this,function(e){this.closeChatWindow(i)}):this.closeChatWindow(i)}else this.closeChatWindow(i)},onCollapseChatWindow:function(t){if("chatwindowtitlelink"==t.target.id.substr(0,19))return!0;e.stopEvent(t);if("chatwindowcollapse"==t.currentTarget.id.substr(0,18))var i=t.currentTarget.id.substr(19);else i=t.currentTarget.id.substr(23);this.collapseChatWindow(i)},collapseChatWindow:function(t,i){this.chatbarWindows[t].status="collapsed";e.removeClass("chatwindow_"+t,["collapsed","expanded","stacked"]);e.addClass("chatwindow_"+t,"collapsed");this.updateChatBarStatus();e.style("chatwindowexpanded_"+t,"display","none");e.style("chatwindowcollapsed_"+t,"display","block");e.style("chatwindowpreview_"+t,"display","block");this.stackOrUnstackIfNeeded();this.adaptChatbarDock();void 0!==this.autoChatWhilePressingKey&&dijit.popup.close(this.autoChatWhilePressingKey);void 0!==i&&i||this.makeSureChatBarIsOnBottom(t)},onExpandChatWindow:function(e){var t=e.currentTarget.id.substr(20);if("expanded"!=this.chatbarWindows[t].status){this.expandChatWindow(t);this.ackUnreadMessage(t)}else this.collapseChatWindow(t)},onCollapseAllChatWindow:function(t){if("chatbar_inner"==t.target.id){e.stopEvent(t);for(var i in this.chatbarWindows)"expanded"==this.chatbarWindows[i].status&&this.collapseChatWindow(i)}},updateChatBarStatus:function(){e.query(".chatwindow.expanded").length>0?e.addClass("chatbar","at_least_one_expanded"):e.removeClass("chatbar","at_least_one_expanded")},expandChatWindow:function(t,i){var a=e.hasClass("ebd-body","mobile_version");if("expanded"==this.chatbarWindows[t].status);else{if(a)for(var n in this.chatbarWindows)"expanded"==this.chatbarWindows[n].status&&this.collapseChatWindow(n,!0);this.chatbarWindows[t].autoCollapseAfterMessage=!(void 0===i||!i);this.chatbarWindows[t].status="expanded";e.removeClass("chatwindow_"+t,["collapsed","expanded","stacked"]);e.addClass("chatwindow_"+t,"expanded");this.updateChatBarStatus();e.style("chatwindowexpanded_"+t,"display","block");a?e.style("chatwindowcollapsed_"+t,"display","block"):e.style("chatwindowcollapsed_"+t,"display","none");e.style("chatwindowpreview_"+t,"display","none");e.removeClass("chatwindow_"+t,"newmessage");$("chatwindownewmsgcount_"+t).innerHTML="";$("chatwindowlogs_zone_"+t).scrollTop=$("chatwindowlogs_zone_"+t).scrollHeight;this.stackOrUnstackIfNeeded();this.adaptChatbarDock();a&&this.makeSureChatBarIsOnTop(t)}$("chatbarinput_"+t+"_input")&&$("chatbarinput_"+t+"_input").focus()},makeSureChatBarIsOnTop:function(t){if(!e.hasClass("ebd-body","chatbar_ontop")){var i=e.position("chatbar");e.addClass("ebd-body","chatbar_ontop");var a=e.position("chatbar");e.style("chatbar","top",i.y+"px");e.style("chatbar","bottom","auto");var n=e.fx.slideTo({node:"chatbar",top:a.y,left:0,delay:0,duration:200,unit:"px"});e.connect(n,"onEnd",function(){e.style("chatbar","bottom","");e.style("chatbar","top","");e.style("chatbar","position","")});n.play();if(i.y==a.y)e.style("chatwindowexpanded_"+t,"opacity",1);else{e.style("chatwindowexpanded_"+t,"opacity",0);e.fadeIn({node:"chatwindowexpanded_"+t,duration:200,delay:180,onEnd:function(t){e.style(t,"opacity","")}}).play()}}},makeSureChatBarIsOnBottom:function(t){if(e.hasClass("ebd-body","chatbar_ontop")){var i=e.position("chatbar");e.removeClass("ebd-body","chatbar_ontop");var a=e.position("chatbar");e.style("chatbar","top","auto");e.style("chatbar","bottom",a.y-i.y+"px");e.animateProperty({node:"chatbar",delay:0,properties:{bottom:{end:"0",unit:"px"}},onEnd:function(t){e.style("chatbar","top","");e.style("chatbar","bottom","");e.style("chatbar","position","")}}).play();e.style("chatwindowexpanded_"+t,"opacity",1)}},onScrollDown:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(23);e.style("chatwindowmorelogs_"+i,"display","none");$("chatwindowlogs_zone_"+i).scrollTop=$("chatwindowlogs_zone_"+i).scrollHeight},onToggleStackMenu:function(t){e.stopEvent(t);"block"==e.style("stackedmenu","display")?e.style("stackedmenu","display","none"):e.style("stackedmenu","display","block")},onCallbackBeforeChat:function(e,t){if(void 0!==e.table&&"undefined"!=this.chatbarWindows["table_"+e.table]){"undefined"!=this.chatbarWindows["table_"+e.table].autoCollapseAfterMessage&&this.chatbarWindows["table_"+e.table].autoCollapseAfterMessage&&this.collapseChatWindow("table_"+e.table);if(void 0!==this.discussblock){this.showMessage(_("A player at the table blocked you."),"error");return!1}}if(this.isBadWorkInChat(e.msg)){var i=__("lang_mainsite","We detect a word in your chat input that may be considered as an insult/profanity/aggressive attitude by others.")+"\n\n";i+=__("lang_mainsite","BGA has a zero-tolerance policy about insults and aggressive attitudes, whatever the reason.")+"\n\n";i+=__("lang_mainsite","If another player reports you, you will be ban from BGA.")+"\n\n";i+=__("lang_mainsite","If someone is provoking you, DO NOT RESPOND, block this player (thumb down on his/her profile) and report this players to moderators.")+"\n\n";i+=__("lang_mainsite","Insults on both side = Moderation of both side.")+"\n\n";i+=__("lang_mainsite","Do you really want to send your message and risk a moderation?");return confirm(i)}if("/chat/chat/say.html"==t&&"undefined"!=typeof mainsite&&mainsite.tutorialShowOnce(21)){i=__("lang_mainsite","You are using Board Game Arena global chat: your message will be visible by all players")+"\n\n";i+=__("lang_mainsite","There is a zero-tolerance policy on this chat for insults, advertising, or any content that may not be appropriate for all audience, or may be interpreted as an aggression.")+"\n\n";i+=__("lang_mainsite","Players who do not respect these rules will be banned immediately with no warning.")+"\n\n";i+=__("lang_mainsite","Do you confirm you want to send this message?");return confirm(i)}return!0},isBadWorkInChat:function(e){if(null===e)return!1;var t=" "+e.toLowerCase()+" ";for(var i in this.badWordList)if(-1!=t.indexOf(" "+this.badWordList[i].replace("-"," ")+" "))return!0;return!1},onCallbackAfterChat:function(e){void 0!==this.autoChatWhilePressingKey&&dijit.popup.close(this.autoChatWhilePressingKey)},callbackAfterChatError:function(e){void 0!==e.table&&"undefined"!=this.chatbarWindows["table_"+e.table]&&"undefined"!=this.chatbarWindows["table_"+e.table].autoCollapseAfterMessage&&this.chatbarWindows["table_"+e.table].autoCollapseAfterMessage&&this.expandChatWindow("table_"+e.table,!0)},onDockedChatFocus:function(e){var t=e.target.id.substr(13).slice(0,-6);this.ackUnreadMessage(t)},onDockedChatInputKey:function(t){var i=t.target.id.substr(13).slice(0,-6);this.ackUnreadMessage(i);if(this.chatbarWindows[i].autoShowOnKeyPress&&!this.chatbarWindows[i].autoCollapseAfterMessage&&void 0===this.autoChatWhilePressingKey&&e.hasClass("ebd-body","desktop_version")){var a='<div class="icon20 icon20_suggestion"></div> ';a+="<b>"+__("lang_mainsite","Did you know?")+"</b>";a+="<hr/><div style='max-width:200px'>";a+=__("lang_mainsite","You can type messages anytime during a game to start chatting without opening this chat window manually.");a+="</div>";this.autoChatWhilePressingKey=new dijit.TooltipDialog({id:"autoChatWhilePressingKey",content:a,closable:!0});var n=t.target;dijit.popup.open({popup:this.autoChatWhilePressingKey,around:$(n),orient:["before-centered","before","below","below-alt","above","above-alt"]})}},onShowPredefined:function(t){var i=t.currentTarget.id.substr(24),a=t.currentTarget.id,n=!1;if(void 0===this.chatbarWindows[i].predefinedMessages){n=!0;var o=this.getSmileyClassToCodeTable(),s="";s+='<div style="max-width:350px">';if(null!==this.notifqueue.game&&"table_"==i.substr(0,6)){for(var r in this.predefinedTextMessages)"tbleave"==r&&e.hasClass("ebd-body","playmode_realtime")||(s+="<p class='predefined_textmessage' id='predefined_textmessage_"+i+"-"+r+"'>"+__("lang_mainsite",this.predefinedTextMessages[r])+"</p>");s+="<hr/>"}for(var l in o){s+="<div class='predefined_message' id='predefined_message_"+i+"-"+l+"'>";s+=this.addSmileyToText(o[l]);s+="</div>"}s+="</div>";this.chatbarWindows[i].predefinedMessages=new dijit.TooltipDialog({id:"predefinedMessages_"+i,content:s,closable:!0});this.chatbarWindows[i].predefinedMessagesOpen=!1}if(0==this.chatbarWindows[i].predefinedMessagesOpen){this.chatbarWindows[i].predefinedMessagesOpen=!0;dijit.popup.open({popup:this.chatbarWindows[i].predefinedMessages,around:$(a),orient:["after-centered","after","below","below-alt","above","above-alt"]})}else{this.chatbarWindows[i].predefinedMessagesOpen=!1;dijit.popup.close(this.chatbarWindows[i].predefinedMessages)}var d=e.hasClass("ebd-body","mobile_version");e.style("chatbarinput_predefined_"+i+"_dropdown","zIndex",d?10510:1051);if(n){e.query("#chatbarinput_predefined_"+i+"_dropdown .predefined_message").connect("onclick",this,"onInsertPredefinedMessage");e.query("#chatbarinput_predefined_"+i+"_dropdown .predefined_textmessage").connect("onclick",this,"onInsertPredefinedTextMessage")}},onInsertPredefinedMessage:function(e){var t=e.currentTarget.id.substr(19).split("-"),i=t[0],a=t[1],n=this.getSmileyClassToCodeTable();this.chatbarWindows[i].input.addContentToInput(n[a]);$("chatbarinput_"+i+"_input").focus();this.chatbarWindows[i].predefinedMessagesOpen=!1;dijit.popup.close(this.chatbarWindows[i].predefinedMessages)},onInsertPredefinedTextMessage:function(e){var t=e.currentTarget.id.substr(23).split("-"),i=t[0],a=t[1],n=this.predefinedTextMessages[a];this.chatbarWindows[i].input.addContentToInput(n);$("chatbarinput_"+i+"_input").focus();this.chatbarWindows[i].input.input_div.value==n&&this.chatbarWindows[i].input.sendMessage();this.chatbarWindows[i].predefinedMessagesOpen=!1;dijit.popup.close(this.chatbarWindows[i].predefinedMessages)},setGroupList:function(e,t,i,a){this.groupList=e;this.red_thumbs_given={};this.red_thumbs_taken={};void 0!==t&&(this.allGroupList=t);this.red_thumbs_given=void 0!==i&&"object"==typeof i?i:{};this.red_thumbs_taken=void 0!==a&&"object"==typeof a?a:{};if(!this.bChatDetached){var n={};for(var o in e)n[o]="/group/g"+o;this.groupToCentrifugeSubs=this.subscribeCentrifugeChannels(n,this.notifqueue,"onNotification")}},setLanguagesList:function(e){this.allLanguagesList=e},setPma:function(e){this.pma=e},setRtcMode:function(e,t){this.rtc_mode=e;this.rtc_room=t},takeIntoAccountAndroidIosRequestDesktopWebsite:function(e){var t,i,a=navigator.userAgent,n=/ mobile/i.test(a),o=!(!/ gecko/i.test(a)||!/ firefox\//i.test(a)),s="was"===(i="wasmobile",(e.cookie.match("(^|; )"+i+"=([^;]*)")||0)[2]),r="user-scalable=yes, maximum-scale=2";if(n&&!s)e.cookie="wasmobile=was";else if(!n&&s)if(o){(t=e.createElement("meta")).setAttribute("content",r);t.setAttribute("name","viewport");e.getElementsByTagName("head")[0].appendChild(t)}else void 0===e.getElementsByName("viewport")[0]||e.getElementsByName("viewport")[0].setAttribute("content",r)},getCurrentPlayerId:function(){return"undefined"!=typeof current_player_id?current_player_id:this.player_id},tutorialShowOnce:function(e,t){void 0===t&&(t=!0);if("undefined"!=typeof current_player_id){if(toint(current_player_id)<0)return!1}else if(this.isSpectator)return!1;if(e<0||e>=256){console.error("Invalid tutorial id: "+e);return!1}var i=Math.floor(e/64),a=1<<e%64;if(void 0!==this.tutorial)var n=this.tutorial;else n=this.metasite_tutorial;if(n[i]&a){if(t){n[i]=n[i]&~a;this.ajaxcall("/table/table/markTutorialAsSeen.html",{id:e},this,function(e){})}return!0}return!1},highligthElementwaitForPopinToClose:function(){if(e.query(".standard_popin").length>0)setTimeout(e.hitch(this,"highligthElementwaitForPopinToClose"),1e3);else{this.bHighlightPopinTimeoutInProgress=!1;this.onElementTutorialNext()}},highlightElementTutorial:function(t,i,a){void 0===a&&(a="");if($("tutorial-overlay"))this.tutorialHighlightedQueue.push({id:t,text:i,optclass:a});else if(e.query(".standard_popin").length>0){this.tutorialHighlightedQueue.push({id:t,text:i,optclass:a});if(void 0===this.bHighlightPopinTimeoutInProgress||0==this.bHighlightPopinTimeoutInProgress){this.highligthElementwaitForPopinToClose();this.bHighlightPopinTimeoutInProgress=!0}}else{e.place('<div id="tutorial-overlay" class="tutorial-overlay"></div>',"ebd-body","first");e.connect($("tutorial-overlay"),"onclick",this,"onElementTutorialNext");var n={node:"tutorial-overlay",duration:1e3},o=this;this.highlightFadeInInProgress=!0;n.onEnd=e.hitch(this,function(){this.highlightFadeInInProgress=!1;$("newArchiveComment")&&e.destroy("newArchiveComment");dijit.byId("currentTutorialDialog")&&dijit.byId("currentTutorialDialog").destroy();var a="<div id='newArchiveComment' class='newArchiveComment'>                                    <div class='archiveComment_before'><p class='archiveComment_before_inner'><i class='fa fa-graduation-cap'></i></p></div>                                    <div id='newArchiveCommentTextDisplay'>"+this.applyCommentMarkup(i)+"</div>                                    <div id='newArchiveCommentDisplayControls'><a href='#' id='newArchiveCommentNext' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Continue")+"</a>                                    </div>                                </div>";this.currentTutorialDialog=new dijit.TooltipDialog({id:"currentTutorialDialog",content:a,closable:!0});if(null!==t&&$(t))dijit.popup.open({popup:this.currentTutorialDialog,around:$(t),orient:["below","above","after","before"]});else{var n=e.position("ebd-body").w/2-215;dijit.popup.open({popup:this.currentTutorialDialog,x:n,y:180,orient:["below","above","after","before"]});e.query(".dijitTooltipConnector").style("display","none")}$("newArchiveCommentNext")&&e.connect($("newArchiveCommentNext"),"onclick",o,"onElementTutorialNext")});if(null!=t){var s=e.window.getBox(),r=e.position(t),l=!1;(r.y<0||r.y+r.h>s.h)&&(l=!0);l&&window.scrollBy({top:r.y-200,behavior:"smooth"});e.addClass(t,"above-overlay");this.current_hightlighted_additional_class=a;""!=a&&e.addClass(t,a);"static"==e.style(t,"position")&&e.addClass(t,"above-overlay-relative")}e.fadeIn(n).play()}},onElementTutorialNext:function(t){void 0!==t&&e.stopEvent(t);if(void 0===this.highlightFadeInInProgress||!this.highlightFadeInInProgress){if(null!==this.currentTutorialDialog){dijit.popup.close(this.currentTutorialDialog);this.currentTutorialDialog=null}if($("tutorial-overlay")){var i={node:"tutorial-overlay",duration:500};this.highlightFadeInInProgress=!0;i.onEnd=e.hitch(this,function(){this.highlightFadeInInProgress=!1;e.destroy("tutorial-overlay");""!=this.current_hightlighted_additional_class&&e.query(".above-overlay").removeClass(this.current_hightlighted_additional_class);e.query(".above-overlay").removeClass("above-overlay");e.query(".above-overlay-relative").removeClass("above-overlay-relative");if(this.tutorialHighlightedQueue.length>0){var t=this.tutorialHighlightedQueue.shift();this.highlightElementTutorial(t.id,t.text,t.optclass)}});e.fadeOut(i).play()}else if(this.tutorialHighlightedQueue.length>0){var a=this.tutorialHighlightedQueue.shift();this.highlightElementTutorial(a.id,a.text,a.optclass)}}},websiteWindowVisibilityChange:function(e){var t="visible",i="hidden",a={focus:t,focusin:t,pageshow:t,blur:i,focusout:i,pagehide:i};(e=e||window.event).type in a?this.window_visibility=a[e.type]:this.window_visibility=document.hidden?"hidden":"visible"},ackUnreadMessage:function(t,i){var a=t.split("_")[0],n=t.split("_")[1],o=!1;void 0!==i&&"unsub"==i&&"table"==a&&(o=!0);if(("privatechat"==a||"table"==a)&&(e.query("#chatwindowlogs_zone_"+t+" .newmessage").length>0||o)){var s=[];e.query("#chatwindowlogs_zone_"+t+" .newmessage .roundedboxinner").forEach(function(e){s.push(e.id.substr(13))});if("privatechat"==a){var r=n;this.ackMessagesWithPlayer(r,s)}else if("table"==a){var l=n;this.ackMessagesOnTable(l,s,o)}e.query("#chatwindowlogs_zone_"+t+" .newmessage").removeClass("newmessage")}},ackMessagesWithPlayer:function(e,t){this.ajaxcall("/table/table/chatack.html",{player:e,list:t.join(";")},this,function(t){i.stores.discussions.ackMessagesWithPlayer(e)},function(e){},"get")},ackMessagesOnTable:function(e,t,i){var a={table:e,list:t.join(";")};i&&(a.bUnsub=i);this.ajaxcall("/table/table/chatack.html",a,this,function(e){},function(e){},"get")},onAckMsg:function(t){for(var i in t.args.msgs){var a=t.args.msgs[i];if($("privmsg_read_"+a)){e.removeClass("privmsg_read_"+a,"message_unread");e.addClass("privmsg_read_"+a,"message_read")}}},initMonitoringWindowVisibilityChange:function(){var t="hidden";if(t in document)e.connect(document,"visibilitychange",this,"websiteWindowVisibilityChange");else if((t="mozHidden")in document)e.connect(document,"mozvisibilitychange",this,"websiteWindowVisibilityChange");else if((t="webkitHidden")in document)e.connect(document,"webkitvisibilitychange",this,"websiteWindowVisibilityChange");else if((t="msHidden")in document)e.connect(document,"msvisibilitychange",this,"websiteWindowVisibilityChange");else if("onfocusin"in document){e.connect(document,"onfocusin",this,"websiteWindowVisibilityChange");e.connect(document,"onfocusout",this,"websiteWindowVisibilityChange")}else{e.connect(window,"onpageshow",this,"websiteWindowVisibilityChange");e.connect(window,"onpagehide",this,"websiteWindowVisibilityChange");e.connect(window,"onfocus",this,"websiteWindowVisibilityChange");e.connect(window,"onblur",this,"websiteWindowVisibilityChange")}void 0!==document[t]&&this.websiteWindowVisibilityChange({type:document[t]?"blur":"focus"})},playingHoursToLocal:function(e,t){if(-1==e.indexOf(":00"))return e;var i=toint(e.substr(0,e.indexOf(":")))+this.timezoneDelta;return void 0!==t&&t?{start_hour:i%24+":00",end_hour:(i+12)%24+":00"}:i%24+":00 &rarr; "+(i+12)%24+":00"},showSplashedPlayerNotifications:function(t){void 0===this.splashNotifToDisplay&&(this.splashNotifToDisplay=[]);for(var i in t){var a=t[i];$("splash_trophy_"+a.id)||this.splashNotifToDisplay.push(a)}"none"==e.style("splashedNotifications_overlay","display")&&this.displayNextSplashNotif()},displayNextSplashNotif:function(){const t=this.splashNotifToDisplay.shift();try{const o=this.splashNotifToDisplay.length;if(void 0===t){e.fadeOut({node:"splashedNotifications_overlay",duration:500,onEnd:()=>e.style("splashedNotifications_overlay","display","none")}).play();return}if(this.splashNotifRead&&this.splashNotifRead[t.id]){this.displayNextSplashNotif();return}let s=500;if("none"==e.style("splashedNotifications_overlay","display")){e.style("splashedNotifications_overlay","display","block");e.fadeIn({node:"splashedNotifications_overlay",duration:1e3}).play();s=1e3}if([16,21,17,30].includes(toint(t.news_type))){if(e.byId("splash_trophy_"+t.id))throw new Error("Splash notification already exists");const r=t.args[3];if(toint(r)>1e3){var i=t.args[17],a=t.args[18];t.base_img=getStaticAssetUrl("img/awards/"+r+"_"+a+".png");var n=Math.floor(i/1e3);t.addimg='<img src="'+g_themeurl+"../../data/grouparms/"+n+"/group_"+i+'_112.jpg?h=t" onerror="this.onerror=null; this.src=\''+g_themeurl+"../../data/grouparms/noimage_tournament_112.png'\";/>";t.trophy_name=t.jargs.championship_name+" "+t.jargs.tournament_name+": "+__("lang_mainsite",t.trophy_name)}else{t.base_img=getStaticAssetUrl("img/awards/"+r+".png");t.addimg="";t.trophy_name=__("lang_mainsite",t.trophy_name);t.trophy_name=t.trophy_name.replace("%s",format_number(t.trophy_name_arg));t.trophy_descr=__("lang_mainsite",t.trophy_descr);t.trophy_descr=t.trophy_descr.replace("%s",format_number(t.trophy_name_arg))}t.shadow_img=getStaticAssetUrl("img/awards/award_shadow.png");t.game_name="";if(void 0!==t.jargs.game_name){t.game_name=__("lang_mainsite",t.jargs.game_name+"_displayed");t.trophy_descr=""}t.continuelbl=__("lang_mainsite","Continue");t.prestige=format_number(t.args[16]);t.skiplbl=o>0?e.string.substitute(_("Skip ${nbr} more"),{nbr:o}):"";const l=`\n                        <div id="splash_trophy_${t.id}" class="splash_block">\n                            <div id="splash_background_${t.id}" class="splash_background"></div>\n                            <div id="splash_central_${t.id}" class="splash_central">\n                                <div class="trophyimg_wrap">\n                                    <div id="splash_trophy_imgwrap_${t.id}" class="trophyimg_image">\n                                        <img class="trophyimg_shadow"  src="${t.shadow_img}"></img>\n                                        <div id="splash_trophyimg_${t.id}" class="trophyimg trophyimg_xlarge" style="background-image: url('${t.base_img}')">${t.addimg}</div>\n                                    </div>\n                                    <div id="trophy_prestige_${t.id}" class="trophy_prestige">\n                                        <div class="xp_container" style="font-size:14px;">+${t.prestige} XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div>\n                                    </div>\n                                </div>\n                                <div class="splash_intro">\n                                    ${__("lang_mainsite","You get a new trophy")}\n                                </div>\n                                <div class="splash_gamename gamename">${t.game_name}</div>\n                                <div class="splash_trophyname">${t.trophy_name}</div>\n                                <div class="splash_descr">${t.trophy_descr}</div>\n                            </div>\n                            <div id="continue_btn_${t.id}" class="bgabutton bgabutton_always_big bgabutton_blue">${t.continuelbl}</div>\n                            <a id="skip_wrap_${t.id}" class="skip_wrap no-underline" href="#">${t.skiplbl}</a>\n                        </div>\n                        `;e.place(l,splashedNotifications_overlay);let d=40;container=document.getElementsByClassName("splash_trophyname")[0];for(;d>20&&container.scrollHeight>100;){d-=1;container.style.fontSize=d+"px"}e.style("splash_central_"+t.id,"opacity",0);e.style("continue_btn_"+t.id,"opacity",0);e.style("skip_wrap_"+t.id,"opacity",0);e.style("splash_background_"+t.id,"left","100%");e.style("trophy_prestige_"+t.id,"opacity",0);e.fx.chain([e.animateProperty({delay:s,node:"splash_background_"+t.id,properties:{left:0,unit:"%"},onEnd:()=>playSound("new_trophy")}),e.fadeIn({node:"splash_central_"+t.id,duration:700}),e.fadeIn({node:"trophy_prestige_"+t.id,duration:700}),e.fx.combine([e.fadeIn({node:"continue_btn_"+t.id,duration:700}),e.fadeIn({node:"skip_wrap_"+t.id,duration:700})])]).play();e.connect($("continue_btn_"+t.id),"onclick",this,"onDisplayNextSplashNotif");e.connect($("skip_wrap_"+t.id),"onclick",this,"onSkipAllSplashNotifs")}else if(28==toint(t.news_type)){const i=t.args[1];t.game_name=__("lang_mainsite",t.jargs.game_name+"_displayed");t.continuelbl=__("lang_mainsite","Continue");const a=t.args[10],n=t.args[11],o=this.arenaPointsDetails(a/1e4,t.jargs.league_nbr),r=this.arenaPointsDetails(n/1e4,t.jargs.league_nbr);t.shadow_img=getStaticAssetUrl("img/awards/award_shadow.png");t.base_img=getStaticAssetUrl("img/awards/"+(100+o.league)+".png");t.league_name=o.league_name;t.league_id=o.league;const l=this.arenaPointsHtml(o);t.arena_points_html=l.bar_content;t.arena_bottom_infos=l.bottom_infos;t.arenabarpcent=l.bar_pcent;let d,c;if(toint(n)<=toint(a)){d=r.points;c=o.points}else{d=r.points;c=o.points;r.league>o.league&&(d=10)}const u=`\n                    <div id="splash_trophy_${t.id}" class="splash_block splash_arena_points">\n                        <div id="splash_background_arena" class="splash_background"></div>\n                        <div id="splash_central_arena" class="splash_central">\n                            <div id="splash_trophy_imgwrap_arena" class="leagueimg_image">\n                                <img class="trophyimg_shadow" src="${t.shadow_img}"></img>\n                                <div id="splash_trophyimg_arena" class="trophyimg trophyimg_xlarge" style="background-image: url('${t.base_img}')"></div>\n                            </div>\n                            <div id="splash_arena_bar"></div>\n                            <div class="splash_intro">\n                                ${t.game_name} \n                                ${t.league_name}\n                            </div>\n                            <div class="progressbar progressbar_arena arena_${t.league_id} progressbar_nolabel">\n                                <div id="arena_bar" class="progressbar_bar">\n                                    <div id="progressbar_arena_width" class="progressbar_arena_width progressbar_content" style="${t.arenabarpcent}">\n                                        <div id="arena_bar_container" class="arena_bar_container arena_container">\n                                            ${t.arena_points_html}\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div id="arena_bar_bottom_infos" class="progressbar_bottom_infos">\n                                ${t.arena_bottom_infos}\n                            </div>\n                            <div id="arena_world_rank_wrap" class="arena_world_rank_wrap" style="display:none;">\n                                ${__("lang_mainsite","World rank")}: \n                                <span id="arena_world_rank" class="arena_world_rank"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></span>\n                            </div>\n                        </div>\n                        <div id="continue_btn_${t.id}" class="bgabutton bgabutton_always_big bgabutton_blue">\n                            ${t.continuelbl}\n                        </div>\n                    </div>\n                    `;e.place(u,splashedNotifications_overlay);e.style("splash_central_arena","opacity",0);e.style("continue_btn_"+t.id,"opacity",0);e.style("splash_background_arena","left","100%");this.transform="transform";const h=[e.animateProperty({delay:s,node:"splash_background_arena",properties:{left:0,unit:"%"}}),e.fadeIn({node:"splash_central_arena",duration:700})];if(5==o.league){const a=this.arenaPointsHtml(r);if(r.arelo!=o.arelo){let i="";if(r.arelo>o.arelo){const e=r.arelo-o.arelo;i="+"+Math.round(e)+" "+__("lang_mainsite","points")}else{const e=r.arelo-o.arelo;i=Math.round(e)+" "+__("lang_mainsite","points")}const n=document.querySelector(`#splash_trophy_${t.id} .arena_bar_container`),s=document.querySelector(`#splash_trophy_${t.id} .progressbar_arena_width`),d=new e.Animation({curve:[o.arelo,r.arelo],duration:1e3,onBegin:()=>playSound("elochange"),onAnimate:e=>{n.innerHTML=Math.round(e)+" "+__("lang_mainsite","points");const t=l.bar_pcent_number+(a.bar_pcent_number-l.bar_pcent_number)*(e-o.arelo)/(r.arelo-o.arelo);s.style.width=t+"%"},onEnd:()=>{document.querySelector(`#splash_trophy_${t.id} .progressbar_bar`).innerHTML+=`<div class="arena_container_bar_details">${i}</div>`}});h.push(d)}const n=document.querySelector(`#splash_trophy_${t.id} .arena_world_rank_wrap`),s=new e.Animation({curve:[20,1],delay:300,onBegin:()=>n.style.display="block",onAnimate:e=>n.style.transform=`scale(${e})`,onEnd:()=>playSound("gain_arena"),duration:500});h.push(s);this.ajaxcall("/lobby/lobby/getPlayerWorldRanking.html",{game:i,isArena:!0},this,e=>document.querySelector(`#splash_trophy_${t.id} .arena_world_rank`).innerHTML=this.getRankString(e.rank))}else if(d>c){soundManager.loadSound&&soundManager.loadSound("gain_arena");for(let i=c;i<d;i++){document.querySelector(`#splash_trophy_${t.id} .arena_point_wrap_${i} .arena_shadow`).style.opacity=1;const a=document.querySelector(`#splash_trophy_${t.id} .arena_point_wrap_${i} .arena_colored`),n=new e.Animation({curve:[20,1],onBegin:()=>a.style.opacity="1",onAnimate:e=>a.style.transform=`scale(${e})`,onEnd:()=>{playSound("gain_arena");const e=document.querySelector(`#splash_trophy_${t.id} .splash_block .remain_arena_points`);if(e){e.innerHTML=toint(e.innerHTML)-1;0==toint(e.innerHTML)&&(document.querySelector(`#splash_trophy_${t.id} .progressbar_bottom_infos`).innerHTML='<i class="fa fa-check"></i> '+__("lang_mainsite","Completed!"))}},duration:500});h.push(n)}}else if(d<c){soundManager.loadSound&&soundManager.loadSound("lose_arena");for(let i=c;i>d;i--){document.querySelector(`#splash_trophy_${t.id} .arena_point_wrap_${i-1} .arena_white`).style.opacity=1;document.querySelector(`#splash_trophy_${t.id} .arena_point_wrap_${i-1} .arena_shadow`).style.opacity=0;const a=document.querySelector(`#splash_trophy_${t.id} .arena_point_wrap_${i-1} .arena_colored`),n=this.slideToObjectPos(a,a.parentNode,0,500);e.connect(n,"onEnd",t=>{e.destroy(t);playSound("lose_arena");const i=e.query(".splash_block .remain_arena_points")[0];i&&(i.innerHTML=toint(i.innerHTML)+1)});h.push(n)}}h.push(e.fadeIn({node:"continue_btn_"+t.id,duration:700}));e.fx.chain(h).play();e.connect($("continue_btn_"+t.id),"onclick",this,"onDisplayNextSplashNotif")}else if(31==toint(t.news_type)){e.style("splashedNotifications_overlay","display","none");const i=t.args[20];setTimeout(()=>gotourl("penalty?id="+i+"&n="+t.id),500)}else if(32==toint(t.news_type)){e.style("splashedNotifications_overlay","display","none");const i=t.args[21];setTimeout(()=>gotourl("karmalimit?limit="+i+"&n="+t.id),500)}else if(50==toint(t.news_type)){e.style("splashedNotifications_overlay","display","none");const i=t.jargs.alert;setTimeout(()=>gotourl("redthumbwarning?alert="+i+"&n="+t.id),500)}else{console.error("Unknow notification to splashed reveived: "+t.news_type);this.displayNextSplashNotif()}}catch(o){console.error(o);if(t){this.ajaxcall("/message/board/markread.html",{id:t.id},this,()=>{});e.addClass("splash_trophy_"+t.id,"to_be_destroyed");this.fadeOutAndDestroy("splash_trophy_"+t.id)}this.displayNextSplashNotif()}},onNewsRead:function(t){if($("splash_trophy_"+t))if(e.hasClass("splash_trophy_"+t,"to_be_destroyed"));else{this.fadeOutAndDestroy("splash_trophy_"+t);this.displayNextSplashNotif()}else{this.splashNotifRead||(this.splashNotifRead={});this.splashNotifRead[t]=!0}},onDisplayNextSplashNotif:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[2];this.markSplashNotifAsRead(i,!1)},onSkipAllSplashNotifs:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[2];this.markSplashNotifAsRead(i,!0)},markSplashNotifAsRead:function(t,i){if(i){var a=t+";";for(var n in this.splashNotifToDisplay)a+=this.splashNotifToDisplay[n].id+";";this.ajaxcall("/message/board/markreads.html",{ids:a},this,function(){});this.splashNotifToDisplay=[]}else this.ajaxcall("/message/board/markread.html",{id:t},this,function(){});e.addClass("splash_trophy_"+t,"to_be_destroyed");this.fadeOutAndDestroy("splash_trophy_"+t);this.displayNextSplashNotif()},inactivityTimerIncrement:function(){this.browser_inactivity_time+=1;if(this.browser_inactivity_time>120&&0==this.bInactiveBrowser){this.bInactiveBrowser=!0;"undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room&&this.doLeaveRoom();if(this.socket){this.socket.disconnect();this.infoDialog(__("lang_mainsite","Please click the button below to continue."),__("lang_mainsite","Are you still there?"),function(){window.location.reload()},!0)}}},resetInactivityTimer:function(){this.browser_inactivity_time=0},onPremiumStatusChange:function(e){const t="undefined"!=typeof globalUserInfos&&globalUserInfos.user_infos&&"1"==globalUserInfos.user_infos.is_premium,i=e.args.premium&&e.args&&e.args.premium;if(t!=i){globalUserInfos.user_infos.is_premium;setTimeout(()=>{window.location.reload()},1e3)}},setIgnoreReloadNotifications:function(e){this.ignoreReloadNotifications=e},onForceBrowserReload:function(t){if(t.args.ignorable&&this.ignoreReloadNotifications)this.ignoreReloadNotifications;else{var i=Math.floor(Math.random()*t.args.spread);t.args.immediate?this.doForceBrowserReload(!0):setTimeout(e.hitch(this,"doForceBrowserReload"),1e3*i)}},doForceBrowserReload:function(e=!1){if(this.socket){this.socket.disconnect();if(e){window.location.reload();return}this.warningDialog(__("lang_mainsite","Due to a BGA upgrade, we have to ask you to reload this page to continue."),function(){window.location.reload()})}},ignoreReloadNotifications:function(e){this.ignoreReloadNotifications=!0},onDebugPing:function(){var e="_";$("bga_release_id")&&(e=$("bga_release_id").innerHTML);this.ajaxcall("/table/table/debugPing.html",{bgaversion:e},this,function(e){})},onNewRequestToken:function(e){void 0!==e.args.request_token&&void 0!==bgaConfig.requestToken&&(bgaConfig.requestToken=e.args.request_token)},onMuteSound:function(t=!0){if(1==localStorage.getItem("sound_muted")){soundManager.bMuteSound=!0;if(null!==$("toggleSound_icon")){e.removeClass("toggleSound_icon","fa-volume-up");e.addClass("toggleSound_icon","fa-volume-off")}null!==$("soundVolumeControl")&&($("soundVolumeControl").value=0)}else{soundManager.bMuteSound=!1;if(null!==$("toggleSound_icon")){e.addClass("toggleSound_icon","fa-volume-up");e.removeClass("toggleSound_icon","fa-volume-off")}null!==$("soundVolumeControl")&&($("soundVolumeControl").value=100*soundManager.volume);t&&playSound("tac")}},onSetSoundVolume:function(e=!0){var t=localStorage.getItem("sound_volume");soundManager.volume=t/100;this.onMuteSound(e)},onToggleSound:function(e){e.preventDefault();i.stores.userVolume.update(e=>{e.volumeMuted=!e.volumeMuted;return e})},onDisplaySoundControls:function(t){clearTimeout(this.hideSoundControlsTimer);this.displaySoundControlsTimer=setTimeout(e.hitch(this,"displaySoundControls"),200)},displaySoundControls:function(t){e.hasClass("soundControls","soundControlsHidden")&&e.removeClass("soundControls","soundControlsHidden")},onHideSoundControls:function(t){clearTimeout(this.displaySoundControlsTimer);this.hideSoundControlsTimer=setTimeout(e.hitch(this,"hideSoundControls"),200)},hideSoundControls:function(){null===$("soundControls")||e.hasClass("soundControls","stickySoundControls")||e.hasClass("soundControls","soundControlsHidden")||e.addClass("soundControls","soundControlsHidden")},onStickSoundControls:function(e){clearTimeout(this.hideSoundControlsTimer)},onUnstickSoundControls:function(e){this.onHideSoundControls(e)},onSoundVolumeControl:function(e){if(null!==$("soundVolumeControl")){var t=$("soundVolumeControl").value;$("soundVolumeControl").blur();i.stores.userVolume.update(e=>{e.volume=+t;return e})}},displayRatingContent:function(t,i){this.rating_step1=new ebg.popindialog;this.rating_step1.create("rating_step1");"video"==t?this.rating_step1.setTitle(__("lang_mainsite","Rate this BGA video chat")):"audio"==t?this.rating_step1.setTitle(__("lang_mainsite","Rate this BGA audio chat")):"support"==t?this.rating_step1.setTitle(__("lang_mainsite","Rate your conversation with BGA")):this.rating_step1.setTitle(__("lang_mainsite","Rate this BGA game adaptation"));this.playerRating=i;var a="<div id='rating_step1'>";a+='<div class="stars_list">';if("support"==t){a+='<a href="#" id="rating_1" class="fa fa-5x rating_star">&#128544;</a> ';a+='<a href="#" id="rating_2" class="fa fa-5x rating_star">&#128577;</a> ';a+='<a href="#" id="rating_3" class="fa fa-5x rating_star">&#128528;</a> ';a+='<a href="#" id="rating_4" class="fa fa-5x rating_star">&#128515;</a> ';a+='<a href="#" id="rating_5" class="fa fa-5x rating_star">&#129321;</a> '}else for(var n=1;n<=5;n++)a+='<i id="rating_'+n+'" class="fa fa-star-o fa-5x rating_star"></i>';a+="</div>";a+='<div id="rating_explanation">&nbsp;</div>';a+='<div id="rating_constent" class="mx-5 text-center text-sm text-gray-600">'+_("By rating this game, you agree that your username, table number and comment will be shared on the plateform.")+"</div>";a+="<div id='rating_skip' class='mt-2 text-center'>";a+="support"==t?"<a href='#' class='bgabutton bgabutton_blue' id='confirm_rating'>"+__("lang_mainsite","Confirm")+"</a>":"<a href='#' class='bgabutton bgabutton_gray' id='skip_rating'>"+__("lang_mainsite","Skip")+"</a>";a+="</div>";a+="</div>";this.rating_step1.setContent(a);this.rating_step1.show();var o="onGameRatingEnter";"video"===t?o="onVideoRatingEnter":"audio"===t?o="onAudioRatingEnter":"support"===t&&(o="onSupportRatingEnter");if("support"!==t){e.query(".rating_star").connect("onmouseenter",this,o);e.query(".rating_star").connect("onmouseleave",this,"onRatingLeave")}var s="onGameRatingClick";"audio"===t?s="onAudioRatingClick":"video"===t?s="onVideoRatingClick":"support"===t&&(s="onSupportRatingClick");e.query(".rating_star").connect("onclick",this,s);if("support"==t){this.processRatingEnter(this.playerRating.rating,"support");e.connect($("confirm_rating"),"onclick",this,function(){this.rating_step1.hide();this.sendRating(t);this.showMessage(_("Thanks for your feeback! Let's go back to games!"),"info");gotourl("welcome")})}else e.connect($("skip_rating"),"onclick",this,function(){this.rating_step1.hide();this.sendRating(t)})},sendRating:function(e){var t="/table/table/rateGame.html";if("audio"==e||"video"==e){this.mediaChatRating=!1;t="/videochat/videochat/rateChat.html"}"support"==e&&(t="/support/support/rateSupport.html");this.ajaxcall(t,this.playerRating,this,function(e){})},onGameRatingEnter:function(e){var t=e.currentTarget.id.substr(7);this.processRatingEnter(t,"game")},onVideoRatingEnter:function(e){var t=e.currentTarget.id.substr(7);this.processRatingEnter(t,"video")},onAudioRatingEnter:function(e){var t=e.currentTarget.id.substr(7);this.processRatingEnter(t,"audio")},onSupportRatingEnter:function(e){var t=e.currentTarget.id.substr(7);this.processRatingEnter(t,"support")},processRatingEnter:function(t,i){if("support"==i){e.query(".rating_star").style("opacity","0.5");e.style("rating_"+t,"opacity","1")}else{for(var a=1;a<=t;a++){e.removeClass("rating_"+a,"fa-star-o");e.addClass("rating_"+a,"fa-star")}for(;a<=5;a++){e.removeClass("rating_"+a,"fa-star");e.addClass("rating_"+a,"fa-star-o")}}if(1==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The game adaptation is unplayable"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The video chat is unusable"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The audio chat is unusable"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","My experience has been bad. BGA should do better."))}else if(2==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","I can play but there are some major problems"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","I can use the video chat but there are some major problems"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","I can use the audio chat but there are some major problems"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","I am disappointed, I expected a better support."))}else if(3==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","Acceptable but could be way better"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","Acceptable but could be way better"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","Acceptable but could be way better"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","My experience has been standard. Nothing special."))}else if(4==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The game adaptation is good, but some details must be fixed"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The video chat is good, but some minor issues should be fixed"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The audio chat is good, but some minor issues should be fixed"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","Really good experience, thank you!"))}else if(5==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The game adaptation is PERFECT"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The video chat is EXCELLENT"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The audio chat is EXCELLENT"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","My experience has been stellar! A big hug to the team!"))}},onRatingLeave:function(t){t.currentTarget.id.substr(11);for(var i=1;i<=5;i++){e.removeClass("rating_"+i,"fa-star");e.addClass("rating_"+i,"fa-star-o")}$("rating_explanation").innerHTML="&nbsp;"},onVideoRatingClick:function(e){this.completeRatingClick(e,"video")},onAudioRatingClick:function(e){this.completeRatingClick(e,"audio")},onGameRatingClick:function(e){this.completeRatingClick(e,"game")},onSupportRatingClick:function(e){var t=e.currentTarget.id.substr(7);this.playerRating.rating=t;this.processRatingEnter(t,"support")},completeRatingClick:function(e,t){e.currentTarget.id.substr(7);var i=e.currentTarget.id.substr(7);this.playerRating.rating=i;this.sendRating(t);this.rating_step1.hide();5==i?"game"===t?this.gamecanapprove?this.showGameRatingDialog_step4():this.gameisalpha?this.showMessage(_("Thanks for your feedback!"),"info"):this.showRatingDialog_step3(t):this.showMessage(_("Thanks for your feedback!"),"info"):this.showRatingDialog_step2(t)},showRatingDialog_step2:function(t){this.rating_step2=new ebg.popindialog;this.rating_step2.create("rating_step2");this.rating_step2.setTitle(__("lang_mainsite","What is the main thing we must improve?"));var i="<div id='rating_step2'>";if("game"==t){i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_bugs'><i class='fa fa-bug'></i> "+__("lang_mainsite","Fix the bugs!")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_ux'><i class='fa fa fa-hand-o-up'></i> "+__("lang_mainsite","Improve the interface")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_expansion'><i class='fa fa fa-puzzle-piece'></i> "+__("lang_mainsite","Add game expansions")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_dislike'><i class='fa fa fa-meh-o'></i> "+__("lang_mainsite","Nothing: I just dislike the game itself")+"</a></p>"}if("audio"==t||"video"==t){i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_quality'><i class='fa fa-bar-chart'></i> "+__("lang_mainsite","Audio or video quality could be better")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_ux'><i class='fa fa fa-hand-o-up'></i> "+__("lang_mainsite","Improve the interface")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_someonemissing'><i class='fa fa-user-times'></i> "+__("lang_mainsite","It worked but someone was missing")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_didntwork'><i class='fa fa fa-bug'></i> "+__("lang_mainsite","Sorry, it didn't work at all")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_dislike'><i class='fa fa fa-meh-o'></i> "+__("lang_mainsite","Nothing: I just disliked the experience")+"</a></p>"}i+="<div id='rating_skip' class='mt-2 text-center'>";i+="<a href='#' class='bgabutton bgabutton_gray' id='skip_rating_2'>"+__("lang_mainsite","Skip")+"</a>";i+="</div>";i+="</div>";this.rating_step2.setContent(i);this.rating_step2.show();var a="onGameRatingClickIssue";"audio"===t?a="onAudioRatingClickIssue":"video"===t&&(a="onVideoRatingClickIssue");e.query(".rating_issue").connect("onclick",this,a);e.connect($("skip_rating_2"),"onclick",this,function(){this.rating_step2.hide();this.sendRating(t);"game"===t?this.showMessage(_("Thanks for helping us to make this game adaptation better!"),"info"):this.showMessage(_("Thanks for helping us to make the audio/video chat better!"),"info")})},onAudioRatingClickIssue:function(e){this.completeRatingClickIssue(e,"audio")},onVideoRatingClickIssue:function(e){this.completeRatingClickIssue(e,"video")},onGameRatingClickIssue:function(e){this.completeRatingClickIssue(e,"game")},completeRatingClickIssue:function(e,t){var i=e.currentTarget.id.substr(6);this.playerRating.issue=i;this.sendRating(t);this.rating_step2.hide();"game"==t?this.showRatingDialog_step3(t):this.showMessage(_("Thanks for your feedback!"),"info")},showRatingDialog_step3:function(t){this.rating_step3=new ebg.popindialog;this.rating_step3.create("rating_step3");"support"===t?this.rating_step3.setTitle(__("lang_mainsite","One last thing: any message for our team?")):"game"==t&&this.gameisalpha?this.rating_step3.setTitle(__("lang_mainsite","Do you have any other feedback to give?")):this.rating_step3.setTitle(__("lang_mainsite","One last thing: any message for the developer?"));var i="<div id='rating_step3'>";if("game"==t&&this.gameisalpha){i+="<div style='text-align:center'>";i+="<br />";i+=__("lang_mainsite","Did you run into an issue while playing?");i+="<br />";i+="<a href='/bug?id=0&table="+this.table_id+"' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Report a bug")+"</a>";i+="<br />";i+=__("lang_mainsite","Do you have an idea to improve the adaptation?");i+="<br />";i+="<a href='/bug?id=0&table="+this.table_id+"&suggest' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Make a suggestion")+"</a>";i+="<br />";if(""!=this.game_group){i+=__("lang_mainsite","Or you would like to discuss something with the community?");i+="<br />";i+="<a href='/group?id="+this.game_group+"' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Discuss with the group")+"</a>";i+="<br />"}i+="</div>"}else{i+="<p><textarea id='rating_comment'></textarea></p>";i+="<div style='text-align:center'>";i+="<a href='#' class='bgabutton bgabutton_blue' id='rating_post_comment'>"+__("lang_mainsite","Send message")+"</a>";i+="</div>"}i+="<div id='rating_skip' class='mt-2 text-center'>";i+="<a href='#' class='bgabutton bgabutton_gray' id='skip_rating_3'>"+__("lang_mainsite","Skip")+"</a>";i+="</div>";if("game"==t&&!this.gameisalpha){i+="<div id='rating_alternative'>";i+=__("lang_mainsite","You may alternatively want to <a href='%s'>report a bug</a>").replace("%s","/bug?id=0&table="+this.table_id);i+="</div>"}i+="</div>";this.rating_step3.setContent(i);this.rating_step3.show();var a=__("lang_mainsite","Thanks for helping us to make this game adaptation better!");"audio"!=t&&"video"!=t||(a=__("lang_mainsite","Thanks for helping us to make the audio/video chat better!"));"support"==t&&(a=__("lang_mainsite","Thanks for helping us to improve our player support!"));null!==$("rating_post_comment")&&e.connect($("rating_post_comment"),"onclick",this,function(){this.playerRating.text=$("rating_comment").value;this.rating_step3.hide();this.sendRating(t);this.showMessage(_(a),"info")});null!==$("skip_rating_3")&&e.connect($("skip_rating_3"),"onclick",this,function(){this.rating_step3.hide();this.sendRating(t);this.showMessage(_(a),"info")})},showGameRatingDialog_step4:function(){this.rating_step4=new ebg.popindialog;this.rating_step4.create("rating_step4");this.rating_step4.setTitle(__("lang_mainsite","You are a reviewer!"));var t="<div id='rating_step4'>";t+="<p>"+__("lang_mainsite","You have given a 5 star rating. Do you want to approve this game for beta?")+"</p>";t+="<div style='text-align:center'>";t+="<a href='#' class='bgabutton bgabutton_blue' id='rating_go_approve'>"+__("lang_mainsite","Ok, let's go!")+"</a>";t+="</div>";t+="<div id='rating_skip' class='mt-2 text-center'>";t+="<a href='#' class='bgabutton bgabutton_gray' id='skip_rating_4'>"+__("lang_mainsite","Skip")+"</a>";t+="</div>";t+="</div>";this.rating_step4.setContent(t);this.rating_step4.show();e.connect($("rating_go_approve"),"onclick",this,function(){this.rating_step4.hide();window.location="/reviewer?game="+this.game_name+"&approve"});e.connect($("skip_rating_4"),"onclick",this,function(){this.rating_step4.hide();this.showRatingDialog_step3("game")})},recordMediaStats:function(e,t){this.room&&this.ajaxcall("/videochat/videochat/recordStat.html",{player:e,room:this.room,startStop:t,media:this.mediaConstraints.video?"video":"audio"},this,function(e){},function(e){})}})})},"ebg/core/soundManager":function(){define(["dojo","dojo/_base/declare","ebg/core/core"],function(e,t){return t("ebg.core.soundManager",null,{constructor:function(){this.html5=!0;this.useOgg=!0;this.bMuteSound=!1;this.soundMode=0;this.initOk=!1;this.volume=.8},init:function(){if(!!document.createElement("audio").canPlayType){this.html5=!0;this.initHtml5Audio()}return this.html5},initHtml5Audio:function(){if(!!document.createElement("audio").canPlayType){var e=document.createElement("audio");if(e.canPlayType){if(!!e.canPlayType&&""!=e.canPlayType('audio/ogg; codecs="vorbis"')){this.html5=!0;this.useOgg=!0;this.initOk=!0}else{this.useOgg=!1;if(!!e.canPlayType&&""!=e.canPlayType("audio/mpeg")){this.html5=!0;this.initOk=!0}}}}},getSoundIdFromEvent:function(e){return soundManager.sounds[e]?soundManager.sounds[e]:e},getSoundTag:function(e){return this.useOgg?"audiosrc_o_"+e:"audiosrc_"+e},doPlay:function(e){if(!this.bMuteSound){var t=this.getSoundIdFromEvent(e.id);this.doPlayFile(t)}},loadSound:function(e){var t=this.getSoundTag(e);if(!$(t)){var i=e;this.useOgg?i+=".ogg":i+=".mp3";document.getElementById("audiosources").insertAdjacentHTML("beforeend",`\n                    <img style="display:none;" src="${globalThis.g_themeurl}sound/${i}"></img>\n                    <audio id="${t}" src="${globalThis.g_themeurl}sound/${i}"></audio>\n                `)}},doPlayFile:function(e){var t=this.getSoundTag(e);this.loadSound(e);if($(t)){$(t).volume=this.volume;$(t).currentTime=0;$(t).play()}},stop:function(e){var t=this.getSoundIdFromEvent(e.id),i=this.getSoundTag(t);$(i)&&$(i).pause()},onChangeSound:function(e){this.sounds[e.args.event]=e.args.file}})})},"dijit/form/Select":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/i18n","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","./_FormSelectWidget","../_HasDropDown","../DropDownMenu","../MenuItem","../MenuSeparator","../Tooltip","../_KeyNavMixin","../registry","dojo/text!./templates/Select.html","dojo/i18n!./nls/validate"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g,f,b){var y=t("dijit.form._SelectMenu",h,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(l(this.domNode,"selectstart",function(e){e.preventDefault();e.stopPropagation()}))},focus:function(){var t=!1,i=this.parentWidget.value;r.isArray(i)&&(i=i[i.length-1]);i&&e.forEach(this.parentWidget._getChildren(),function(e){if(e.option&&i===e.option.value){t=!0;this.focusChild(e,!1)}},this);t||this.inherited(arguments)}}),v=t("dijit.form.Select"+(d("dojo-bidi")?"_NoBidi":""),[c,u,g],{baseClass:"dijitSelect dijitValidationTextBox",templateString:b,_buttonInputDisabled:d("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var e=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[e>=0?e:0].value)}this.dropDown=new y({id:this.id+"_menu",parentWidget:this});a.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(e){if(e.value||e.label){var t=r.hitch(this,"_setValueAttr",e),i=new p({option:e,label:("text"===this.labelType?(e.label||"").toString().replace(/&/g,"&amp;").replace(/</g,"&lt;"):e.label)||this.emptyLabel,onClick:t,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:e.disabled||!1});i.focusNode.setAttribute("role","option");return i}return new _({ownerDocument:this.ownerDocument})},_addOptionItem:function(e){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(e))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(e){}},focusChild:function(e){e&&this.set("value",e.option)},_getFirst:function(){var e=this._getChildren();return e.length?e[0]:null},_getLast:function(){var e=this._getChildren();return e.length?e[e.length-1]:null},childSelector:function(e){return(e=f.byNode(e))&&e.getParent()==this.dropDown},onKeyboardSearch:function(e,t,i,a){e&&this.focusChild(e)},_loadChildren:function(t){if(!0===t){if(this.dropDown){delete this.dropDown.focusedChild;this.focusedChild=null}if(this.options.length)this.inherited(arguments);else{e.forEach(this._getChildren(),function(e){e.destroyRecursive()});var i=new p({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(i)}}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(e){this.inherited(arguments);i.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",_setDisabledAttr:function(e){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(e){this._set("required",e);this.focusNode.setAttribute("aria-required",e);this._refreshState()},_setOptionsAttr:function(e){this._isLoaded=!1;this._set("options",e)},_setDisplay:function(e){var t=("text"===this.labelType?(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;"):e)||this.emptyLabel;this.containerNode.innerHTML='<span role="option" aria-selected="true" class="dijitReset dijitInline '+this.baseClass.replace(/\s+|$/g,"Label ")+'">'+t+"</span>"},validate:function(e){var t=this.disabled||this.isValid(e);this._set("state",t?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",t?"false":"true");var i=t?"":this._missingMsg;i&&this.focused&&this._hasBeenBlurred?m.show(i,this.domNode,this.tooltipPosition,!this.isLeftToRight()):m.hide(this.domNode);this._set("message",i);return t},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||"")},reset:function(){this.inherited(arguments);m.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=o.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(l(this.domNode,"selectstart",function(e){e.preventDefault();e.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var e=this._keyNavCodes;delete e[s.LEFT_ARROW];delete e[s.RIGHT_ARROW]},_setStyleAttr:function(e){this.inherited(arguments);a.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(e){this._loadChildren(!0);this._isLoaded=!0;e()},destroy:function(e){if(this.dropDown&&!this.dropDown._destroyed){this.dropDown.destroyRecursive(e);delete this.dropDown}m.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){m.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});d("dojo-bidi")&&(v=t("dijit.form.Select",v,{_setDisplay:function(e){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));v._Menu=y;function w(e){return function(t){this._isLoaded?this.inherited(e,arguments):this.loadDropDown(r.hitch(this,e,t))}}v.prototype._onContainerKeydown=w("_onContainerKeydown");v.prototype._onContainerKeypress=w("_onContainerKeypress");return v})},"dijit/form/_FormSelectWidget":function(){define(["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],function(e,t,i,a,n,o,s,r,l,d,c,u,h){var p=n("dijit.form._FormSelectWidget",h,{multiple:!1,options:null,store:null,_setStoreAttr:function(e){this._created&&this._deprecatedSetStore(e)},query:null,_setQueryAttr:function(e){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:e})},queryOptions:null,_setQueryOptionsAttr:function(e){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:e})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,onLoadDeferred:null,getOptions:function(t){var i=this.options||[];if(null==t)return i;if(l.isArrayLike(t))return e.map(t,"return this.getOptions(item);",this);l.isString(t)&&(t={value:t});l.isObject(t)&&(e.some(i,function(e,i){for(var a in t)if(!(a in e)||e[a]!=t[a])return!1;t=i;return!0})||(t=-1));return t>=0&&t<i.length?i[t]:null},addOption:function(t){e.forEach(l.isArrayLike(t)?t:[t],function(e){e&&l.isObject(e)&&this.options.push(e)},this);this._loadChildren()},removeOption:function(t){var i=this.getOptions(l.isArrayLike(t)?t:[t]);e.forEach(i,function(t){if(t){this.options=e.filter(this.options,function(e){return e.value!==t.value||e.label!==t.label});this._removeOptionItem(t)}},this);this._loadChildren()},updateOption:function(t){e.forEach(l.isArrayLike(t)?t:[t],function(e){var t,i=this.getOptions({value:e.value});if(i)for(t in e)i[t]=e[t]},this);this._loadChildren()},setStore:function(e,t,i){r.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.","","2.0");this._deprecatedSetStore(e,t,i)},_deprecatedSetStore:function(n,o,s){var r=this.store;s=s||{};if(r!==n){for(var d;d=this._notifyConnections.pop();)d.remove();if(!n.get){l.mixin(n,{_oldAPI:!0,get:function(e){var i=new t;this.fetchItemByIdentity({identity:e,onItem:function(e){i.resolve(e)},onError:function(e){i.reject(e)}});return i.promise},query:function(e,i){var a=new t(function(){n.abort&&n.abort()});a.total=new t;var n=this.fetch(l.mixin({query:e,onBegin:function(e){a.total.resolve(e)},onComplete:function(e){a.resolve(e)},onError:function(e){a.reject(e)}},i));return new u(a)}});n.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[i.after(n,"onNew",l.hitch(this,"_onNewItem"),!0),i.after(n,"onDelete",l.hitch(this,"_onDeleteItem"),!0),i.after(n,"onSet",l.hitch(this,"_onSetItem"),!0)])}this._set("store",n)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null}s.query&&this._set("query",s.query);s.queryOptions&&this._set("queryOptions",s.queryOptions);if(n&&n.query){this._loadingStore=!0;this.onLoadDeferred=new t;this._queryRes=n.query(this.query,this.queryOptions);c(this._queryRes,l.hitch(this,function(t){if(this.sortByLabel&&!s.sort&&t.length)if(n.getValue)t.sort(a.createSortFunction([{attribute:n.getLabelAttributes(t[0])[0]}],n));else{var i=this.labelAttr;t.sort(function(e,t){return e[i]>t[i]?1:t[i]>e[i]?-1:0})}s.onFetch&&(t=s.onFetch.call(this,t,s));e.forEach(t,function(e){this._addOptionForItem(e)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(l.hitch(this,function(e,t,i){if(t==i)this._onSetItem(e);else{-1!=t&&this._onDeleteItem(e);-1!=i&&this._onNewItem(e)}}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:o);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(t):this._loadChildren();this.onLoadDeferred.resolve(!0);this.onSetStore()}),l.hitch(this,function(e){console.error("dijit.form.Select: "+e.toString());this.onLoadDeferred.reject(e)}))}return r},_setValueAttr:function(t,i){this._onChangeActive||(i=null);if(this._loadingStore)this._pendingValue=t;else if(null!=t){t=l.isArrayLike(t)?e.map(t,function(e){return l.isObject(e)?e:{value:e}}):l.isObject(t)?[t]:[{value:t}];t=e.filter(this.getOptions(t),function(e){return e&&e.value});var a=this.getOptions()||[];this.multiple||t[0]&&t[0].value||!a.length||(t[0]=a[0]);e.forEach(a,function(i){i.selected=e.some(t,function(e){return e.value===i.value})});var n=e.map(t,function(e){return e.value});if(void 0!==n&&void 0!==n[0]){var o=e.map(t,function(e){return e.label});this._setDisplay(this.multiple?o:o[0]);this.inherited(arguments,[this.multiple?n:n[0],i]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var t=e.map([].concat(this.get("selectedOptions")),function(e){return e&&"label"in e?e.label:e?e.value:null},this);return this.multiple?t:t[0]},_setDisplayedValueAttr:function(e){this.set("value",this.getOptions("string"==typeof e?{label:e}:e))},_loadChildren:function(){if(!this._loadingStore){e.forEach(this._getChildren(),function(e){e.destroyRecursive()});e.forEach(this.options,this._addOptionItem,this);this._updateSelection()}},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var t=[].concat(this.value);if(t&&t[0]){var i=this;e.forEach(this._getChildren(),function(a){var n=e.some(t,function(e){return a.option&&e===a.option.value});n&&!i.multiple&&(i.focusedChild=a);s.toggle(a.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),n);a.domNode.setAttribute("aria-selected",n?"true":"false")},this)}},_getValueFromOpts:function(){var t=this.getOptions()||[];if(!this.multiple&&t.length){var i=e.filter(t,function(e){return e.selected})[0];if(i&&i.value)return i.value;t[0].selected=!0;return t[0].value}return this.multiple?e.map(e.filter(t,function(e){return e.selected}),function(e){return e.value})||[]:""},_onNewItem:function(e,t){t&&t.parent||this._addOptionForItem(e)},_onDeleteItem:function(e){var t=this.store;this.removeOption({value:t.getIdentity(e)})},_onSetItem:function(e){this.updateOption(this._getOptionObjForItem(e))},_getOptionObjForItem:function(e){var t=this.store,i=this.labelAttr&&this.labelAttr in e?e[this.labelAttr]:t.getLabel(e);return{value:i?t.getIdentity(e):null,label:i,item:e}},_addOptionForItem:function(e){var t=this.store;if(!t.isItemLoaded||t.isItemLoaded(e)){var i=this._getOptionObjForItem(e);this.addOption(i)}else t.loadItem({item:e,onItem:function(e){this._addOptionForItem(e)},scope:this})},constructor:function(e){this._oValue=(e||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);o.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?d("> *",this.srcNodeRef).map(function(e){return"separator"===e.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:e.getAttribute("data-"+r._scopeName+"-value")||e.getAttribute("value"),label:String(e.innerHTML),selected:e.getAttribute("selected")||!1,disabled:e.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);i.after(this,"onChange",l.hitch(this,"_updateSelection"));var e=this.store;if(e&&(e.getIdentity||e.getFeatures()["dojo.data.api.Identity"])){this.store=null;this._deprecatedSetStore(e,this._oValue,{query:this.query,queryOptions:this.queryOptions})}this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var e;e=this._notifyConnections.pop();)e.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null}this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}});return p})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(e){var t={};e.setObject("dojo.data.util.sorter",t);t.basicComparator=function(e,t){var i=-1;null===e&&(e=void 0);null===t&&(t=void 0);e==t?i=0:(e>t||null==e)&&(i=1);return i};t.createSortFunction=function(e,i){var a,n=[];function o(e,t,i,a){return function(n,o){var s=a.getValue(n,e),r=a.getValue(o,e);return t*i(s,r)}}for(var s=i.comparatorMap,r=t.basicComparator,l=0;l<e.length;l++){var d=(a=e[l]).attribute;if(d){var c=a.descending?-1:1,u=r;if(s){"string"!=typeof d&&"toString"in d&&(d=d.toString());u=s[d]||r}n.push(o(d,c,u,i))}}return function(e,t){for(var i=0;i<n.length;){var a=n[i++](e,t);if(0!==a)return a}return 0}};return t})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(e,t,i,a){return e("dijit.DropDownMenu",a,{templateString:i,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(e){this._moveToPopup(e);e.stopPropagation();e.preventDefault()},_onLeftArrow:function(e){if(this.parentMenu)this.parentMenu._isMenuBar?this.parentMenu.focusPrev():this.onCancel(!1);else{e.stopPropagation();e.preventDefault()}}})})},"dijit/_MenuBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/_base/lang","dojo/mouse","dojo/on","dojo/window","./a11yclick","./registry","./_Widget","./_CssStateMixin","./_KeyNavContainer","./_TemplatedMixin"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_){return t("dijit._MenuBase",[u,_,p,h],{selected:null,_setSelectedAttr:function(e){if(this.selected!=e){if(this.selected){this.selected._setSelected(!1);this._onChildDeselect(this.selected)}e&&e._setSelected(!0);this._set("selected",e)}},activated:!1,_setActivatedAttr:function(e){n.toggle(this.domNode,"dijitMenuActive",e);n.toggle(this.domNode,"dijitMenuPassive",!e);this._set("activated",e)},parentMenu:null,popupDelay:500,passivePopupDelay:1/0,autoFocus:!1,childSelector:function(e){var t=c.byNode(e);return e.parentNode==this.containerNode&&t&&t.focus},postCreate:function(){var e=this,t="string"==typeof this.childSelector?this.childSelector:o.hitch(this,"childSelector");this.own(r(this.containerNode,r.selector(t,s.enter),function(){e.onItemHover(c.byNode(this))}),r(this.containerNode,r.selector(t,s.leave),function(){e.onItemUnhover(c.byNode(this))}),r(this.containerNode,r.selector(t,d),function(t){e.onItemClick(c.byNode(this),t);t.stopPropagation()}),r(this.containerNode,r.selector(t,"focusin"),function(){e._onItemFocus(c.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(e,t,i,a){this.inherited(arguments);e&&(-1==a||e.popup&&1==a)&&this.onItemClick(e,t)},_keyboardSearchCompare:function(e,t){return e.shortcutKey?t==e.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(e){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,e);else{var t=this._getTopMenu();t&&t._isMenuBar&&t.focusNext()}},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(e){if(this.activated){this.set("selected",e);!e.popup||e.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(e)},this.popupDelay))}else if(this.passivePopupDelay<1/0){this.passive_hover_timer&&this.passive_hover_timer.remove();this.passive_hover_timer=this.defer(function(){this.onItemClick(e,{type:"click"})},this.passivePopupDelay)}this._hoveredChild=e;e._set("hovering",!0)},_onChildDeselect:function(e){this._stopPopupTimer();if(this.currentPopupItem==e){this._stopPendingCloseTimer();this._pendingClose_timer=this.defer(function(){this._pendingClose_timer=null;this.currentPopupItem=null;e._closePopup()},this.popupDelay)}},onItemUnhover:function(e){this._hoveredChild==e&&(this._hoveredChild=null);if(this.passive_hover_timer){this.passive_hover_timer.remove();this.passive_hover_timer=null}e._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var e=this;e.parentMenu;e=e.parentMenu);return e},onItemClick:function(e,t){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(e);if(e.disabled)return!1;if(e.popup){this.set("selected",e);this.set("activated",!0);var i=/^key/.test(t._origType||t.type)||0==t.clientX&&0==t.clientY;this._openItemPopup(e,i)}else{this.onExecute();e._onClick?e._onClick(t):e.onClick(t)}},_openItemPopup:function(e,t){if(e!=this.currentPopupItem){if(this.currentPopupItem){this._stopPendingCloseTimer();this.currentPopupItem._closePopup()}this._stopPopupTimer();var i=e.popup;i.parentMenu=this;this.own(this._mouseoverHandle=r.once(i.domNode,"mouseover",o.hitch(this,"_onPopupHover")));var a=this;e._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){t&&a.focusChild(e);a._cleanUp()},onExecute:o.hitch(this,"_cleanUp",!0),onClose:function(){if(a._mouseoverHandle){a._mouseoverHandle.remove();delete a._mouseoverHandle}}},t);this.currentPopupItem=e}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();if(this.currentPopupItem){if(this.focused){a.set(this.selected.focusNode,"tabIndex",this.tabIndex);this.selected.focusNode.focus()}this.currentPopupItem._closePopup();this.currentPopupItem=null}},_onItemFocus:function(e){this._hoveredChild&&this._hoveredChild!=e&&this.onItemUnhover(this._hoveredChild);this.set("selected",e)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(e){this._closeChild();void 0===this.isShowingNow&&this.set("activated",!1);e&&this.set("selected",null)}})})},"dijit/MenuItem":function(){define(["dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/_base/kernel","dojo/sniff","dojo/_base/lang","./_Widget","./_TemplatedMixin","./_Contained","./_CssStateMixin","dojo/text!./templates/MenuItem.html"],function(e,t,i,a,n,o,s,r,l,d,c,u){var h=e("dijit.MenuItem"+(o("dojo-bidi")?"_NoBidi":""),[r,l,d,c],{templateString:u,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(e){this._set("label",e);var t,i="",a=e.search(/{\S}/);if(a>=0){i=e.charAt(a+1);var n=e.substr(0,a),o=e.substr(a+3);t=n+i+o;e=n+'<span class="dijitMenuItemShortcutKey">'+i+"</span>"+o}else t=e;this.domNode.setAttribute("aria-label",t+" "+this.accelKey);this.containerNode.innerHTML=e;this._set("shortcutKey",i)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(e){e&&!("label"in this.params)&&this._set("label",e.innerHTML)},buildRendering:function(){this.inherited(arguments);var e=this.id+"_text";i.set(this.containerNode,"id",e);this.accelKeyNode&&i.set(this.accelKeyNode,"id",this.id+"_accel");t.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==o("ie")&&this.containerNode.focus();this.focusNode.focus()}catch(e){}},_setSelected:function(e){a.toggle(this.domNode,"dijitMenuItemSelected",e)},setLabel:function(e){n.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",e)},setDisabled:function(e){n.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",e)},_setDisabledAttr:function(e){this.focusNode.setAttribute("aria-disabled",e?"true":"false");this._set("disabled",e)},_setAccelKeyAttr:function(e){if(this.accelKeyNode){this.accelKeyNode.style.display=e?"":"none";this.accelKeyNode.innerHTML=e;i.set(this.containerNode,"colSpan",e?"1":"2")}this._set("accelKey",e)}});o("dojo-bidi")&&(h=e("dijit.MenuItem",h,{_setLabelAttr:function(e){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return h})},"dijit/MenuSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_WidgetBase","./_TemplatedMixin","./_Contained","dojo/text!./templates/MenuSeparator.html"],function(e,t,i,a,n,o){return e("dijit.MenuSeparator",[i,a,n],{templateString:o,buildRendering:function(){this.inherited(arguments);t.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/TooltipDialog":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","./focus","./layout/ContentPane","./_DialogMixin","./form/_FormMixin","./_TemplatedMixin","dojo/text!./templates/TooltipDialog.html","./main"],function(e,t,i,a,n,o,s,r,l,d,c,u,h){var p=e("dijit.TooltipDialog",[r,c,d,l],{title:"",doLayout:!1,autofocus:!0,baseClass:"dijitTooltipDialog",_firstFocusItem:null,_lastFocusItem:null,templateString:u,_setTitleAttr:"containerNode",postCreate:function(){this.inherited(arguments);this.own(o(this.domNode,"keydown",n.hitch(this,"_onKey")))},orient:function(e,i,a){var n={"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove","BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft","BR-TL":"dijitTooltipBelow dijitTooltipABLeft","BL-TR":"dijitTooltipBelow dijitTooltipABRight","TL-BR":"dijitTooltipAbove dijitTooltipABRight","TR-BL":"dijitTooltipAbove dijitTooltipABLeft"}[i+"-"+a];t.replace(this.domNode,n,this._currentOrientClass||"");this._currentOrientClass=n},focus:function(){this._getFocusItems();s.focus(this._firstFocusItem)},onOpen:function(e){this.orient(this.domNode,e.aroundCorner,e.corner);var t=e.aroundNodePos;if("M"==e.corner.charAt(0)&&"M"==e.aroundCorner.charAt(0)){this.connectorNode.style.top=t.y+(t.h-this.connectorNode.offsetHeight>>1)-e.y+"px";this.connectorNode.style.left=""}else"M"==e.corner.charAt(1)&&"M"==e.aroundCorner.charAt(1)&&(this.connectorNode.style.left=t.x+(t.w-this.connectorNode.offsetWidth>>1)-e.x+"px");this._onShow()},onClose:function(){this.onHide()},_onKey:function(e){if(e.keyCode==a.ESCAPE){this.defer("onCancel");e.stopPropagation();e.preventDefault()}else if(e.keyCode==a.TAB){var t=e.target;this._getFocusItems();if(this._firstFocusItem==this._lastFocusItem){e.stopPropagation();e.preventDefault()}else if(t==this._firstFocusItem&&e.shiftKey){s.focus(this._lastFocusItem);e.stopPropagation();e.preventDefault()}else if(t!=this._lastFocusItem||e.shiftKey)e.stopPropagation();else{s.focus(this._firstFocusItem);e.stopPropagation();e.preventDefault()}}}});i("dojo-bidi")&&p.extend({_setTitleAttr:function(e){this.containerNode.title=this.textDir&&this.enforceTextDirWithUcc?this.enforceTextDirWithUcc(null,e):e;this._set("title",e)},_setTextDirAttr:function(e){if(!this._created||this.textDir!=e){this._set("textDir",e);this.textDir&&this.title&&(this.containerNode.title=this.enforceTextDirWithUcc(null,this.title))}}});return p})},"ebg/chatinput":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.chatinput",null,{constructor:function(){this.page=null;this.container_id=null;this.post_url="";this.default_content="";this.input_div=null;this.baseparams={};this.detachType=null;this.detachId=null;this.detachTypeGame=null;this.callbackBeforeChat=null;this.callbackAfterChat=null;this.callbackAfterChatError=null;this.writingNowChannel=null;this.bWritingNow=!1;this.writingNowTimeout=null;this.writingNowTimeoutDelay=8e3;this.lastTimeStartWriting=null;this.max_height=100;this.bIncreaseHeightToTop=!0},create:function(t,i,a,n){this.page=t;this.container_id=i;this.post_url=a;this.default_content=n;if(!$(this.container_id))return!1;e.empty(this.container_id);var o=this.container_id+"_input";this.detachType,this.detachId,this.detachType,this.detachId;"playtable"==this.detachType&&"onclick='window.open(\"/"+this.detachTypeGame+"?detachChatType="+this.detachType+"&table="+this.detachId+'", "notif'+this.detachType+this.detachId+'", "scrollbars=yes,width=280px,height=500px" );return false;\'';e.place("<div class='chatinputctrl'><textarea id='"+o+"' class='chatinput' value='' style='overflow:hidden;resize: none;' rows='1' maxlength='300'  style='resize:none'></textarea></div>",$(this.container_id));this.input_div=$(o);e.connect(this.input_div,"onkeyup",this,"onChatInputKeyUp");e.connect(this.input_div,"onkeypress",this,"onChatInputKeyPress");e.connect(this.input_div,"onfocus",this,"onChatInputFocus");this.input_div.placeholder=n},destroy:function(){$(this.container_id)&&e.empty(this.container_id)},sendMessage:function(){var t=e.clone(this.baseparams);t.msg=this.input_div.value;if(null===this.callbackBeforeChat||this.callbackBeforeChat(t,this.post_url)){void 0!==this.post_url_bis&&(t.no_notif=1);this.page.ajaxcall(this.post_url,t,this,function(e){this.input_div.value="";this.readaptChatHeight();null!==this.callbackAfterChat&&this.callbackAfterChat(t)},function(e){e&&null!==this.callbackAfterChatError&&this.callbackAfterChatError(t)},"post");if(void 0!==this.post_url_bis){delete t.no_notif;this.page.ajaxcall(this.post_url_bis,t,this,function(e){},function(e){},"post")}}},onChatInputKeyPress:function(t){t.keyCode==e.keys.ENTER&&e.stopEvent(t)},onChatInputKeyUp:function(t){if(t.keyCode==e.keys.ENTER){e.stopEvent(t);this.input_div.value=this.input_div.value.replace(/(\r\n|\n|\r)/gm,"");this.sendMessage();this.lastTimeStartWriting=null;return!0}var i=Math.floor(Date.now()/1e3);if(null===this.lastTimeStartWriting||i>=this.lastTimeStartWriting+5){void 0!==this.page.socket&&null!==this.writingNowChannel&&this.page.socket.rpc("startWriting",{channel:this.writingNowChannel});this.lastTimeStartWriting=i}this.readaptChatHeight();return!1},readaptChatHeight:function(){var t=e.style(this.input_div,"top"),i=e.style(this.input_div,"height");e.style(this.input_div,"height","0px");var a=Math.max(20,Math.min(this.input_div.scrollHeight+1,this.max_height));e.style(this.input_div,"height",a+"px");if(this.bIncreaseHeightToTop){var n=t-(a-i);e.style(this.input_div,"top",n+"px")}},onChatInputFocus:function(e){},onChatInputBlur:function(e){},addContentToInput:function(e){this.input_div.value+=e}})})},"ebg/thumb":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.thumb",null,{constructor:function(){this.page=null;this.div_id=null;this.div=null;this.value=0;this.target_player=null;this.staticControl=!1;this.bForceThumbDown=!1},create:function(t,i,a,n){this.page=t;this.div_id=i;this.div=$(this.div_id);this.value=toint(n);this.target_player=a;e.style(this.div,"display","inline-block");this.updateControl()},updateControl:function(){if(null!==$(this.div_id)){var t="<div>",i=!1;if(1==this.value||0==this.value&&!this.staticControl){t+='<div class="icon16 icon16_reputup givethumb" id="'+this.div_id+'_up"></div>';i=!0}if(-1==this.value||0==this.value&&!this.staticControl){i&&(t+="&nbsp;&nbsp;");t+='<div class="icon16 icon16_reputdown givethumb" id="'+this.div_id+'_down"></div>'}e.place(t,this.div_id,"only");if(1==this.value){this.page.addTooltip(this.div_id+"_up",__("lang_mainsite","I like and recommend to play with this player"),this.staticControl?"":__("lang_mainsite","Cancel"));this.staticControl||e.connect($(this.div_id+"_up"),"onclick",this,"onCancelOpinion")}else if(0!=this.value||this.staticControl){if(-1==this.value){this.page.addTooltip(this.div_id+"_down",__("lang_mainsite","I dislike to play with this player"),this.staticControl?"":__("lang_mainsite","Cancel"));this.staticControl||e.connect($(this.div_id+"_down"),"onclick",this,"onCancelOpinion")}}else{this.page.addTooltip(this.div_id+"_up","",__("lang_mainsite","I like and recommend to play with this player"));this.page.addTooltip(this.div_id+"_down","",__("lang_mainsite","I dislike to play with this player"));e.connect($(this.div_id+"_up"),"onclick",this,"onGiveThumbUp");e.connect($(this.div_id+"_down"),"onclick",this,"onGiveThumbDown")}}},onCancelOpinion:function(e){e.preventDefault();this.page.ajaxcall("/table/table/changeReputation.html",{player:this.target_player,value:0},this,function(e){this.value=0;this.updateControl()})},onGiveThumbUp:function(e){e.preventDefault();this.page.ajaxcall("/table/table/changeReputation.html",{player:this.target_player,value:1},this,function(e){this.value=1;this.updateControl()})},onGiveThumbDown:function(t){t.preventDefault();this.thumbdownDlg=new ebg.popindialog;this.thumbdownDlg.create("thumbdownDialog");this.thumbdownDlg.setTitle(__("lang_mainsite","You are about to give a thumb down."));this.thumbdownDlg.setMaxWidth(600);var i='<div id="thumbdownDialog" class="midSizeDialog">';i+=__("lang_mainsite","You are about to give a red thumb.")+"<br/><br/>";i+=__("lang_mainsite","If you confirm BGA will make sure you won't play at the same table again.")+" ";i+=__("lang_mainsite","This player won't be able to send you a message (or speak as a spectator at your table).")+" ";i+="<p>";i+="<a class='bgabutton bgabutton_blue bgabutton_big' id='thumbdown_confirm' href='#'><span>"+__("lang_mainsite","I don't want to play with this player, ever")+"</span></a> ";i+="<a class='bgabutton bgabutton_gray bgabutton_big' id='thumbdown_cancel' href='#'><span>"+__("lang_mainsite","Cancel")+"</span></a>";i+="</p>";i+="</div>";this.thumbdownDlg.setContent(i);this.thumbdownDlg.show();e.connect($("thumbdown_cancel"),"onclick",e.hitch(this.thumbdownDlg,function(e){e.preventDefault();this.destroy()}));e.connect($("thumbdown_confirm"),"onclick",e.hitch(this,function(e){e.preventDefault();this.thumbdownDlg.destroy();this.onGiveThumbDownStep2()}))},onGiveThumbDownStep2:function(t){this.thumbdownDlg=new ebg.popindialog;this.thumbdownDlg.create("thumbdownDialog2");this.thumbdownDlg.setTitle(__("lang_mainsite","You are about to give a thumb down."));this.thumbdownDlg.setMaxWidth(600);var i='<div id="thumbdownDialog2" class="midSizeDialog">';i+=__("lang_mainsite","Is this a personal opinion or should everyone avoid this player?")+"<br/><br/>";i+="<p>";i+="<a class='bgabutton bgabutton_blue bgabutton_big' id='thumbdown_personal' href='#'><span>"+__("lang_mainsite","This is my personal opinion")+"</span></a><br/>";i+="<a class='bgabutton bgabutton_blue bgabutton_big' id='thumbdown_community' href='#'><span>"+__("lang_mainsite","Everyone should avoid this person")+"</span></a><br/>";i+="<a class='bgabutton bgabutton_gray bgabutton_big' id='thumbdown_cancel2' href='#'><span>"+__("lang_mainsite","Cancel")+"</span></a>";i+="</p>";i+="</div>";this.thumbdownDlg.setContent(i);this.thumbdownDlg.show();e.connect($("thumbdown_personal"),"onclick",e.hitch(this,function(e){e.preventDefault();this.thumbdownDlg.destroy();var t={player:this.target_player,value:-1,category:"personal"};this.bForceThumbDown&&(t.f=1);this.page.ajaxcall("/table/table/changeReputation.html",t,this,function(e){this.value=-1;this.updateControl()})}));e.connect($("thumbdown_cancel2"),"onclick",e.hitch(this,function(e){e.preventDefault();this.thumbdownDlg.destroy()}));e.connect($("thumbdown_community"),"onclick",e.hitch(this,function(e){e.preventDefault();this.thumbdownDlg.destroy();this.onGiveThumbDownStep3()}))},onGiveThumbDownStep3:function(t){this.thumbdownDlg=new ebg.popindialog;this.thumbdownDlg.create("thumbdownDialog3");this.thumbdownDlg.setTitle(__("lang_mainsite","You are about to give a thumb down."));this.thumbdownDlg.setMaxWidth(600);var i='<div id="thumbdownDialog3" class="midSizeDialog">';i+=__("lang_mainsite","Please tell us why nobody should play with X?")+"<br/><br/>";i+="<p>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_chat' href='#'><span>"+__("lang_mainsite","This player is aggressive/insulting or said innapropriate things in the chat")+"</span></a>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_slow'  href='#'><span>"+__("lang_mainsite","This player plays too slowly and/or has frequent disconnections")+"</span></a>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_leave' href='#'><span>"+__("lang_mainsite","This player quits/abandoned the game on purpose")+"</span></a>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_kingmaking' href='#'><span>"+__("lang_mainsite","This player is doing some Kingmaking / team play.")+"</span></a>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_other'  href='#'><span>"+__("lang_mainsite","This player should be avoided for another reason")+"</span></a>";i+="<a class='bgabutton bgabutton_gray thumbdown_apply' id='thumbdown_personal' href='#'><span>"+__("lang_mainsite","Nevermind, this is just my opinion finally")+"</span></a>";i+="</p>";i+="</div>";this.thumbdownDlg.setContent(i);this.thumbdownDlg.show();e.query(".thumbdown_apply").connect("onclick",e.hitch(this,function(e){e.preventDefault();this.thumbdownDlg.destroy();var t=e.currentTarget.id.substr(10),i={player:this.target_player,value:-1,category:t};this.bForceThumbDown&&(i.f=1);this.page.ajaxcall("/table/table/changeReputation.html",i,this,function(e){this.value=-1;this.updateControl();"personal"!=t&&this.onGiveThumbDownFinal()})}))},onGiveThumbDownFinal:function(){this.thumbdownDlg=new ebg.popindialog;this.thumbdownDlg.create("thumbdownDialog4");this.thumbdownDlg.setTitle(__("lang_mainsite","Thank you"));this.thumbdownDlg.setMaxWidth(600);var t='<div id="thumbdownDialog4" class="midSizeDialog">';t+=e.string.substitute(__("lang_mainsite","Thanks. Eventually, if you think this player violated our Terms of Service (ex : insults / verbal aggression), you should ${action} to moderators in addition."),{action:'<a class="bga-link" href="/newreport?player='+this.target_player+'" id="thumbdown_report">'+__("lang_mainsite","Report this player")+"</a>"});t+="<p>";t+="<a class='bgabutton bgabutton_gray bgabutton_big' id='thumbdown_cancel' href='#'><span>"+__("lang_mainsite","Ok")+"</span></a>";t+="</p>";t+="</div>";this.thumbdownDlg.setContent(t);this.thumbdownDlg.show();e.connect($("thumbdown_cancel"),"onclick",e.hitch(this.thumbdownDlg,function(e){e.preventDefault();this.destroy()}));e.connect($("thumbdown_report"),"onclick",e.hitch(this.thumbdownDlg,function(t){e.destroy("thumbdownDialog4");this.destroy()}))}})})},"ebg/lazyload":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.lazyload",null,{constructor:function(){this.images_to_load={};this.evtScroll=null;this.evtResize=null;this.viewPort=null;this.uniqueId=1;this.marginForLoad=150;this.image_suffix="";this.image_position_cache={};this.scrollFromLatestCheck=null},create:function(){this.evtScroll=e.connect(window,"onscroll",this,"checkLazyImages");this.evtResize=e.connect(window,"onresize",this,"checkLazyImages")},destroy:function(){if(null!==this.evtScroll){e.disconnect(this.evtScroll);this.evtScroll=null}if(null!==this.evtResize){e.disconnect(this.evtResize);this.evtResize=null}},addImagesToLazyLoad:function(t){var i="#"+t+" .bga_lazyload";e.query(i).forEach(e.hitch(this,"addImageToLazyLoad"))},addImageToLazyLoad:function(e){if(this.isImageVisible(e))this.makeImageVisible(e);else{""!=e.id?this.images_to_load[this.uniqueId]=e.id:this.images_to_load[this.uniqueId]=e;this.uniqueId++}},onViewPortChanged:function(){this.viewPort=null;this.checkLazyImages(!1)},checkLazyImages:function(e){void 0===e&&(e=!0);if(!e){var t=document.documentElement.scrollTop||document.body.scrollTop;if(null!==this.scrollFromLatestCheck&&Math.abs(t-this.scrollFromLatestCheck)<50)return}this.scrollFromLatestCheck=t;var i=[];for(var a in this.images_to_load){var n=this.images_to_load[a];"string"==typeof n&&(n=$(n));if(this.isImageVisible(n)){this.makeImageVisible(n);i.push(a)}}for(var o in i){a=i[o];delete this.images_to_load[a]}},clearImagePositionCache:function(){this.image_position_cache={}},isImageVisible:function(t){if(null===t)return!1;if(null===t.offsetParent)return!1;null===this.viewPort&&(this.viewPort=e.window.getBox());if(t.id&&""!=t.id&&void 0!==this.image_position_cache[t.id])var i=this.image_position_cache[t.id];else{i=e.position(t,!0);t.id&&""!=t.id&&(this.image_position_cache[t.id]=i)}var a=document.documentElement.scrollTop||document.body.scrollTop,n=i.y-a;return n>0&&n<this.viewPort.h+this.marginForLoad},makeImageVisible:function(t){e.connect(t,"onload",this,"onLoadImageOk");var i=e.attr(t,"bga_lazyload");if(""!=this.image_suffix){var a=i.lastIndexOf(".");a>=0&&(i=i.substring(0,a)+this.image_suffix+"."+i.substring(a+1))}e.attr(t,"src",i)},onLoadImageOk:function(e){void 0!==e.currentTarget.id&&""!=e.currentTarget.id&&this.onImageVisible(e.currentTarget.id)},onImageVisible:function(e){}})})},"ebg/invitefriends":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.invitefriends",null,{constructor:function(){this.page=null;this.container_id=null;this.nb_friends_to_display=8;this.bPlayerGlobalSelectOnly=!0;this.bSeeMoreLink=!0;this.currentFilter="";this.bHotSeat=!1},create:function(e,t){this.page=e;this.container_id=t},destroy:function(){},refresh:function(t){void 0===t&&(t=!1);t||(this.currentFilter="");var i=this.nb_friends_to_display;this.page.ajaxcall("/community/community/friends.html",{limit:i,filter:this.currentFilter},this,function(a){var n='<div id="'+this.container_id+'_friendlist" class="list_of_players">';t&&(n="");var o=!1,s=0,r=!1,l=a.friends;for(var d in l)if(++s>i){t||r||(n+="<hr/>");r=!0}else{var c=l[d],u=getPlayerAvatar(c.id,c.avatar,32),h="";1==c.is_premium&&(h=" is_premium");o&&"offline"==c.status&&(n+="<hr/>");var p="";if("offline"==c.status)p=time_ago_format(c.last_seen);else if(void 0!==c.same_network)p=_("Online near you");else if(null==c.table_status)p=_("Online");else{var m='<a class="bga-link" href="/table?table='+c.current_table_id+'">'+_(c.game_name+"_displayed")+"</a>";p="play"==c.table_status?e.string.substitute(_("playing ${game_name}"),{game_name:m}):e.string.substitute(_("waiting for ${game_name}"),{game_name:m})}n+='<div class="player_in_list player_in_list_withbaseline">                                    <div class="emblemwrap '+h+'">                                        <img class="pl_avatar emblem" src="'+u+'"/>                                        <div class="emblempremium"></div>                                        <i class="fa fa-'+c.device+" playerstatus status_"+c.status+'"></i>                                    </div>                                    <a href="/player?id='+c.id+'" class="playername">'+c.name+'</a>                                    <div class="player_baseline">'+p+"</div>";this.bPlayerGlobalSelectOnly&&(n+='<div id="player_select_'+c.id+'" class="player_select_surface"></div>');n+="</div>";o="offline"!=c.status}0==s&&(""!=this.currentFilter?n+="<p>"+e.string.substitute(_("You have no friend with name like '${pname}'"),{pname:this.currentFilter})+"</p>":n+='<p style="margin-top:96px;padding-right:20px;">'+_("Add players to your friends to know when they are online and invite them to play.")+"</p>");if(this.bHotSeat&&""==this.currentFilter){n+='<div class="player_in_list player_in_list_withbaseline">                                <div class="emblemwrap">                                    <div class="icon32 icon32_hotseat" style="" ></div>                                    <div class="emblempremium"></div>                                    <i class="fa fa-circle playerstatus status_online"></i>                                </div>                                <a href="/player?id=-99" class="playername">'+_("Hotseat")+' <span class="beta_label">BETA</span></a>                                <div class="player_baseline">('+_("player on same device")+")</div>";this.bPlayerGlobalSelectOnly&&(n+='<div id="player_select_-99" class="player_select_surface"></div>');n+="</div>"}if(t){var g=e.position(this.container_id+"_friendlist");e.place(n,this.container_id+"_friendlist","only");e.style(this.container_id+"_friendlist","height",g.h+"px")}else{n+="</div>";if(r||""!=this.currentFilter)if(this.bSeeMoreLink)n+='<p style="text-align:center;position:relative;top:5px;"><a class="bga-link" href="/player?section=friends">'+_("See more")+"</a></p>";else{n+="<p>";n+='<input type="text" placeholder="'+_("Find a friend")+'" id="find_friend"></input>';n+="</p>"}if(a.inbound>0){n+='<div class="invite_friends_requests"><a class="bga-link" href="/player?section=friends">'+_("%s friend request(s)").replace("%s",a.inbound)+"</a></div>"}e.place(n,this.container_id,"only");if($("find_friend")){e.connect($("find_friend"),"onclick",this,function(t){e.stopEvent(t)});e.connect($("find_friend"),"onkeyup",this,"onFilterFriend")}}e.query(".player_select_surface").connect("onclick",this,"onSelectPlayerClick");this.onRefreshDone()})},onSelectPlayerClick:function(t){var i=t.currentTarget.id.substr(14);if(-99==i){this.hotseatNameDialog=new ebg.popindialog;this.hotseatNameDialog.create("hotseatNameDialog");this.hotseatNameDialog.setTitle(_("What is the player name of your hotseat friend?"));this.hotseatNameDialog.setMaxWidth(500);var a='<div id="hotseatNameDialog">';a+="<br/>";a+='<input type="text" maxlength="16" id="hotseat_player_name" value=""></input>';a+='<p><a class="bgabutton bgabutton_blue" id="select_hotseat_name_btn">'+_("OK")+"</a></p>";a+="</div>";this.hotseatNameDialog.setContent(a);this.hotseatNameDialog.show();e.connect($("select_hotseat_name_btn"),"onclick",this,"onSelectHotseatPlayer")}else this.onSelectPlayer(i)},onSelectHotseatPlayer:function(t){e.stopEvent(t);if(""!=$("hotseat_player_name").value){this.hotseatNameDialog.destroy();this.onSelectPlayer(-99,$("hotseat_player_name").value)}else this.page.showMessage(_("You must choose a name (ex: John) for your hotseat player."),"error")},onFilterFriend:function(e){this.currentFilter=$("find_friend").value;this.refresh(!0)},onSelectPlayer:function(e){},onRefreshDone:function(e){}})})},"ebg/acceptgamestart":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule"],function(e,t,i){return t("ebg.acceptgamestart",ebg.core.mainsitemodule,{constructor:function(){this.page=null;this.div_id=null;this.table_id=null;this.jstpl_gamestart='<div id="gamestart_${id}" class="gamestart_overlay"><div class="row gamestart_header"><div class="col-md-4 col-push-4"><div class="gamestart_game"><div class="gamestart_game_intro">'+_("You are going to play")+'<p style="font-size:120%">${game_name_displayed}</p></div><div class="site_logo_big"></div><div id="gamestart_game_box_wrapper"><img id="gamestart_game_box" src="${game_box_url}"></img></div></div></div><div class="col-md-4 col-pull-4"><div class="gamestart_generaloptions"><div id="tableinfos_game_speed"></div><div id="tableinfos_elo"></div></div></div><div class="col-md-4" id="gamestart_optionlist_first"><div class="gamestart_optionlist"><div class="with_options_title">'+_("With options")+':</div><div id="options_list"></div></div></div></div><div class="gamestart_warnings gamestart_warnings_first border-2 border-solid rounded-md mx-5" style="border-color: rgba(239, 68, 68);"><div class="mx-auto flex" id="gamestart_warnings_first"><div class="alphabeta_banner flex"><div class="alphabeta_icon px-2 flex items-center"></div><div class="alphabeta_text flex items-center px-3"></div></div><div class="alphabeta_triangle -mx-1"></div></div></div><div id="ags_progress_bar_wrap" style="display:none"><div id="ags_progress_bar" class="ui-progress-bar ui-container" style="display:none"><div id="ags_progress_bar_progress" class="ui-progress" style="width: 10%;"><span class="ui-label" style="display:none;"></span></div></div><p id="ags_progress_bar_label">'+_("Creating the game table...")+'</p></div><p id="ags_start_game_accept_wrap"><a class="bgabutton bgabutton_big bgabutton_gray" id="ags_start_game_refuse" href="#" ><span>'+_("Refuse")+'</span></a><a class="bgabutton bgabutton_always_big bgabutton_blue" id="ags_start_game_accept" href="#" ><i class="fa fa-check"></i> <span>'+_("Accept")+'</span></a></p><p id="ags_start_game_status_wrap" style="display:none">'+_("Waiting for")+': <span id="ags_wait_for_players"></span></p><p id="ags_start_game_cancel_wrap" style="display:none"><a class="bgabutton bgabutton_gray" id="ags_start_game_cancel" href="#" ><span>'+_("Cancel game start")+'</span></a></p><div class="row gamestart_warnings gamestart_warnings_bis"><div class="mx-2 text-center p-2 border-2 border-solid rounded" id="gamestart_warnings_bis" style="border-color: rgba(239, 68, 68);"></div></div><div id="gamestart_optionlist_bis"><div class="gamestart_optionlist"><div class="with_options_title">'+_("With options")+':</div><div id="options_list_bis"></div></div></div><div id="gamestart_playerlist" class="flex items-center justify-center flex-wrap"></div></div>';_("With options");this.jstpl_player='<div id="playerstart_${id}" class="playerstart mx-2 desktop:mx-8 my-6"><div id="playerstart_content_${id}" class="playerstart_content player_presentation"><div class="emblemwrap_xl"><img class="emblem" src="${avatarimg}"></img></div><div class="playername">${fullname}</div><i id="player_${id}_status" class="player_status   fa fa-${statusicon} status_${status}"></i><div class="playersubinfos"><div class="fa ${genderclass}" id="gender_${id}"></div> <div class="bga-flag" data-country="${flag}" id="flag_${id}"></div> <span id="current_reput_${id}" class="active_player_reput"></span></div><div class="playersubinfos_lang"><span class="playersubinfos_lang_content">${lang_html}</span><div class="playersubinfos_lang_speecharrow"></div></div><div class="playerstart_bottom"><div class="playergamedetails player_elo_details" id="elo_details_${id}"><div class="progressbar_with_info progressbar_without_info"><div class="progressbar_inner"><div id="elobar_${id}" class="progressbar progressbar_elo elo_${rank_class}"><div class="progressbar_label"><span class="symbol icon20 icon20_rankw"  style="position: relative;top:2px;"></span><span  style="position: relative;top:-2px;">${rank}</span></div><div class="progressbar_bar"><div class="grad grad100"></div><div class="grad grad200"></div><div class="grad grad300"></div><div class="grad grad500"></div><span class="progressbar_valuename">${rank_label}${rank_no}</span><div class="progressbar_content" style="width:${elobarpcent}%"><span class="progressbar_valuename">${rank_label}${rank_no}</span></div></div></div></div></div></div><div class="playergamedetails player_arena_details" id="arena_details_${id}" style="display:none"><div class="progressbar_with_info progressbar_without_info"><div class="progressbar_inner"><div id="arenabar_${id}" class="progressbar progressbar_arena arena_${league_id}"><div class="progressbar_label"><div class="progressbar_label_content">${league_name}</div></div><div class="progressbar_bar"><div class="progressbar_content"><div class="arena_container">${arena_points_html}</div></div></div></div></div></div></div><div class="tabletrophylist"><div id="trophies_${id}" class="trophies_won"><div class="prestige" style="display:none;""><div class="xp_container"><span class="prestigerank ${prestige_mask}" id="prestigerank_${id}">${prestige}</span> XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div>&nbsp;&nbsp;</div></div><a href="player?id=${id}&section=prestige" target="_blank"><i class="fa fa-lg fa-info-circle more_infos" style="color: black" id="prestige_details_${id}"></i></a></div><div class="clear"></div><div class="playerdetails" id="reputation_details_${id}"><div class="progressbar_with_info progressbar_without_info"><div class="progressbar_inner"><div id="reputationbar_${id}" class="progressbar  progressbar_reputation reputation_${karma_class}"><div class="progressbar_label"><span class="symbol"></span><span class="value">${karma}%</span></div><div class="progressbar_bar"><span class="progressbar_valuename">${karma_label}</span><div class="progressbar_content" style="width:${karma}%"><span class="progressbar_valuename">${karma_label}</span></div></div></div></div></div></div></div><i class="fa fa-2x fa-check player_confirmed_indicator" id="player_confirmed_indicator_${anonymized_id}"></i><i class="fa fa-2x fa-hourglass player_confirmed_indicator" id="player_waiting_indicator_${anonymized_id}"></i><div class="playerstart_warningblock" id="playerstart_warningblock_${id}">${warnings_nbr} &nbsp;<i class="fa fa-exclamation-triangle"></i></div></div></div>';this.jstpl_player_arena='<div id="playerstart_${id}" class="playerstart playerstart_arena mx-2 desktop:mx-8 my-6"><div id="playerstart_content_${id}" class="playerstart_content player_presentation"><div class="emblemwrap_xl"><img class="emblem" src="${avatarimg}"></img></div><div class="playername">${fullname}</div><i id="player_${id}_status" class="player_status   fa fa-${statusicon} status_${status}"></i><div class="playersubinfos"><div class="fa ${genderclass}" id="gender_${id}"></div> <div class="bga-flag" data-country="${flag}" id="flag_${id}"></div> <span id="current_reput_${id}" class="active_player_reput"></span></div><div class="playersubinfos_lang"><span class="playersubinfos_lang_content">${lang_html}</span><div class="playersubinfos_lang_speecharrow"></div></div><i class="fa fa-2x fa-check player_confirmed_indicator" id="player_confirmed_indicator_${anonymized_id}"></i><i class="fa fa-2x fa-hourglass player_confirmed_indicator" id="player_waiting_indicator_${anonymized_id}"></i><div class="playerstart_warningblock" id="playerstart_warningblock_${id}">${warnings_nbr} &nbsp;<i class="fa fa-exclamation-triangle"></i></div></div></div>';this.jstpl_player_anonymized='<div id="playerstart_${id}" class="playerstart playerstart_arena mx-2 desktop:mx-8 my-6"><div id="playerstart_content_${id}" class="playerstart_content player_presentation"><div class="emblemwrap_xl"><img class="emblem" src="${avatarimg}"></img></div><div class="playername">${fullname}</div><i class="fa fa-2x fa-check player_confirmed_indicator" id="player_confirmed_indicator_${id}"></i><i class="fa fa-2x fa-hourglass player_confirmed_indicator" id="player_waiting_indicator_${id}"></i><i id="player_${id}_status" class="player_status fa fa-${statusicon} status_${status}"></i></div></div>';this.jstpl_warning='<div class="warning ${warning_type}"><i class="fa fa-${warning_icon} fa-2x imgtext"></i>&nbsp; ${text}</div>';this.autoredirect=!1;this.previous_status="";this.bArenaMode=!1;this.debug=!1},create:function(t,a){this.page=t;this.table_id=a;0==this.debug&&this.page.showMessage(_("Your game is about to start..."),"info");this.tablechannel="/table/t"+this.table_id;this.register_subs(e.subscribe("tableInfosChanged",this,"onTableInfosChanged"));this.page.ajaxcall("/table/table/tableinfos.html",{id:this.table_id},this,"createGameStartFromTableInfos");this.register_centrifuge_subs(mainsite.subscribeCentrifugeChannel(this.tablechannel,mainsite.notifqueue,"onNotification"));i.stores.universalModals&&i.stores.universalModals.clear()},destroy:function(){this.unsubscribe_all();$("gamestart_"+this.table_id)&&e.destroy("gamestart_"+this.table_id);mainsite.bAnimatePageTitleForGameStart=!1;this.table_id=null},createGameStartFromTableInfos:function(t){if(this.debug)return;this.tableinfos=t;this.table_id=t.id;this.is_admin=t.admin_id==current_player_id;playSound("tableReady");mainsite.bAnimatePageTitleForGameStart=!0;mainsite.onUpdatePageTitleAnimation();this.bArenaMode=!1;"play"!=t.status&&"playasync"!=t.status||(this.autoredirect=!0);t.game_name_displayed=_(t.game_name+"_displayed");t.game_box_url=i.stores.games.getBoxImage(t.game_name).w280;t.game_version=mainsite.gamefilter[this.tableinfos.game_id];var a=e.string.substitute(this.jstpl_gamestart,t);e.place(a,"overall-content");e.style("gamestart_"+this.table_id,"opacity",0);e.fadeIn({node:"gamestart_"+this.table_id,duration:1e3}).play();var n=0,o=Object.keys(t.players).length;for(var s in t.players){this.addPlayerToGameStart(t.players[s]);var r=n*(2e3/(o-1))-1e3;e.style("playerstart_content_"+s,"left",r+"px");e.style("playerstart_content_"+s,"top","-1000px");this.slideToObject("playerstart_content_"+s,"playerstart_"+s,900,500).play();n++}var l="<div>";for(s in t.options_order){var d=t.options_order[s];if(void 0!==t.options[d]){var c=t.options[d];if(c.name&&"object"==typeof c.values&&"object"==typeof c.values[c.value]){var u=c.value;if(200==d){a="";var h="icon32_realtime";u>=10&&(h="icon32_turnbased");a+='<div class="icon32 '+h+'"></div><br/><br/>';20!=u?u<10?_("Realtime"):u<=12?_("Fast turn-based"):_("Turn-based"):_("No time limit");a+=" "+(c.values[c.value].name.replace("  ",'<div class="thinking_time_details">').replace(" &bull; ",'<div class="thinking_time_details">')+"</div>");var p=t.estimated_duration,m=p+" mn";if(p>1440)m=p>5760?Math.round(p/1440)+" "+_("days"):Math.round(10*p/1440)/10+" "+_("days");else if(p>120){var g=p%60;g<10&&(g="0"+g);m=Math.floor(p/60)+"h"+g}a+='<div class="thinking_time_details">'+_("Estimated duration")+" "+m+"</div>";e.place(a,"tableinfos_game_speed","only")}else if(206==d);else if(201==d){if(0==u);else if(1==u)$("tableinfos_elo").innerHTML='<span class="not_the_default">'+_("Training mode")+"</span>";else if(2==u){$("tableinfos_elo").innerHTML='<span class="not_the_default">'+_("Arena (competitive play)")+"</span>";this.bArenaMode=!0;e.query(".player_arena_details").style("display","block");e.query(".player_elo_details").style("display","none")}}else{var f=!0;if(void 0!==c.displaycondition){var b=void 0!==c.displayconditionoperand?c.displayconditionoperand:"and";f="and"==b;for(var y in c.displaycondition){var v=c.displaycondition[y];if("minplayers"==v.type)if("object"==typeof v.value){var w=!1;for(var s in v.value)t.min_player==v.value[s]&&(w=!0);w?"or"==b&&(f=!0):"and"==b&&(f=!1)}else t.min_player==v.value?"or"==b&&(f=!0):"and"==b&&(f=!1);if("maxplayers"==v.type)if("object"==typeof v.value){w=!1;for(var s in v.value)t.max_player==v.value[s]&&(w=!0);w?"or"==b&&(f=!0):"and"==b&&(f=!1)}else t.max_player==v.value?"or"==b&&(f=!0):"and"==b&&(f=!1);if("otheroption"==v.type&&void 0!==t.options[v.id])if("object"==typeof v.value){w=!1;for(var s in v.value)t.options[v.id].value==v.value[s]&&(w=!0);w?"or"==b&&(f=!0):"and"==b&&(f=!1)}else t.options[v.id].value==v.value?"or"==b&&(f=!0):"and"==b&&(f=!1);if("otheroptionisnot"==v.type)if(void 0===t.options[v.id]);else if("object"==typeof v.value){var x=!1;for(var s in v.value)t.options[v.id].value==v.value[s]&&(x=!0);x?"and"==b&&(f=!1):"or"==b&&(f=!0)}else t.options[v.id].value!=v.value?"or"==b&&(f=!0):"and"==b&&(f=!1)}}if(f){var k=c.value!=c.default;l+='<div class="gamestart_option">';l+='<div class="row-data">';l+='    <div class="row-label">'+c.name+"</div>";l+='    <div class="row-value '+(k?"not_the_default":"")+'">'+c.values[c.value].name+"</div>";l+="</div>";l+="</div>"}}}}}l+="</div>";e.place(l,"options_list");e.place(l,"options_list_bis");const C=[{text:_("This game is a BETA version. By playing it, you may encounter bugs or instability: in some cases, this could affect your Karma. If you are not willing to take this risk, you should play in Friendly  Mode. Please report any issues through the community bug management system."),button:_("Understood and agreed")},{text:_("The game you are about to play is still a work in progress and thus displayed as a BETA version. By agreeing to start, you accept that you may encounter bugs or instability which could affect your reputation. Please remember to report any issues using the community bug management system to help the development of the game."),button:_("I still want to play")}],T=[{text:_("By agreeing to start, you accept that the current game is in the early stage of development and that you may not be able to finish it. Due to the nature of the ALPHA review process, there are no guarantees that the game will be released; therefore, by playing you are expected to respect the confidentiality of this project by not discussing or showing it publicly. Further, you agree to share useful feedback with the developer. Any abuse will disqualify you as an ALPHA reviewer."),button:_("I understood and agree")},{text:_("You are about to play an ALPHA game. It means that this title is at an early stage of development and is not meant to be shared publicly. In case of misuse, your account can be removed from ALPHA reviewer status. You are strongly encouraged to share feedback and bug reports with the developers."),button:_("Understood")}],j=Math.floor(2*Math.random());let S=!1;if("beta"==t.game_status||t.beta_option_selected){e.query(".gamestart_warnings").addClass("beta-banner__gradient");e.place('<img class="w-24 h-20" src="'+g_themeurl+'img/common/svg/gameitem/betaIcon.svg">',e.query(".alphabeta_icon")[0]);e.place('<p class="text-white text-xl font-bold">'+window._("BETA version")+"</p>",e.query(".alphabeta_text")[0]);var M=e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_info",warning_icon:"exclamation-triangle",text:C[j].text}),"gamestart_warnings_first"),A=e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_info",warning_icon:"exclamation-triangle",text:C[j].text}),"gamestart_warnings_bis");e.place(' <a class="bgabutton bgabutton_gray bgabutton_small_margin" id="warning_accept" href="#" ><i class="fa fa-square-o"></i> <span>'+C[j].button+"</span></a> ",M);e.place(' <a class="bgabutton bgabutton_gray bgabutton_small_margin" id="warning_accepted" href="#" ><i style="color:darkgreen" class="fa fa-check-square-o"></i> <span>'+_("Agreed!")+"</span></a> ",M);e.place(' <a class="bgabutton bgabutton_gray bgabutton_small_margin" id="warningbis_accept" href="#" ><i class="fa fa-square-o"></i> <span>'+C[j].button+"</span></a> ",A);e.place(' <a class="bgabutton bgabutton_gray bgabutton_small_margin" id="warningbis_accepted" href="#" ><i style="color:darkgreen" class="fa fa-check-square-o"></i> <span>'+_("Agreed!")+"</span></a> ",A);e.place('<span class="emblembeta emblemstatus emblemstatus_nofold" style="position: absolute; right: -15px; bottom: 5px;"></span>',"gamestart_game_box_wrapper");S=!0}else if(["private_alpha","alpha"].includes(t.game_status)||t.alpha_option_selected){e.place('<img class="w-24 h-20" src="'+g_themeurl+'img/common/svg/gameitem/alphaIcon.svg">',e.query(".alphabeta_icon")[0]);if("private_alpha"===t.game_status){e.query(".gamestart_warnings").addClass("private-alpha-banner__gradient");e.place('<p class="text-white text-xl font-bold">'+window._("PRIVATE ALPHA version")+"</p>",e.query(".alphabeta_text")[0])}else{e.query(".gamestart_warnings").addClass("alpha-banner__gradient");e.place('<p class="text-white text-xl font-bold">'+window._("ALPHA version")+"</p>",e.query(".alphabeta_text")[0])}M=e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_info",warning_icon:"exclamation-triangle",text:T[j].text}),"gamestart_warnings_first"),A=e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_info",warning_icon:"exclamation-triangle",text:T[j].text}),"gamestart_warnings_bis");e.place(' <a class="bgabutton bgabutton_gray bgabutton_small_margin" id="warning_accept" href="#" ><i class="fa fa-square-o"></i> <span>'+T[j].button+"</span></a> ",M);e.place(' <a class="bgabutton bgabutton_gray bgabutton_small_margin" id="warning_accepted" href="#" ><i style="color:darkgreen" class="fa fa-check-square-o"></i> <span>'+_("Agreed!")+"</span></a> ",M);e.place(' <a class="bgabutton bgabutton_gray bgabutton_small_margin" id="warningbis_accept" href="#" ><i class="fa fa-square-o"></i> <span>'+T[j].button+"</span></a> ",A);e.place(' <a class="bgabutton bgabutton_gray bgabutton_small_margin" id="warningbis_accepted" href="#" ><i style="color:darkgreen" class="fa fa-check-square-o"></i> <span>'+_("Agreed!")+"</span></a> ",A);e.place('<span class="emblemalpha emblemstatus emblemstatus_nofold" style="position: absolute; right: -15px; bottom: 5px;"></span>',"gamestart_game_box_wrapper");S=!0}else e.query(".gamestart_warnings").addClass("hidden");if(S)if(t.players[current_player_id]&&0==t.players[current_player_id].played&&1!=t.players[current_player_id].decision){e.style("warning_accept","display","");e.style("warning_accepted","display","none");e.style("warningbis_accept","display","");e.style("warningbis_accepted","display","none");e.connect($("warning_accept"),"onclick",this,"onAcknowledgeWarning");e.connect($("warningbis_accept"),"onclick",this,"onAcknowledgeWarning");if(null!=$("ags_start_game_accept")){e.removeClass("ags_start_game_accept","bgabutton_blue");e.addClass("ags_start_game_accept","bgabutton_darkgray")}}else{e.style("warning_accept","display","none");e.style("warning_accepted","display","");e.style("warningbis_accept","display","none");e.style("warningbis_accepted","display","")}void 0!==t.options[201]&&1==t.options[201].value&&e.style(e.query(".thinking_time_details")[0],"display","none");$("ags_start_game_accept")&&e.connect($("ags_start_game_accept"),"onclick",this,"onStartGameAccept");$("ags_start_game_refuse")&&e.connect($("ags_start_game_refuse"),"onclick",this,"onStartGameRefuse");$("ags_start_game_cancel")&&e.connect($("ags_start_game_cancel"),"onclick",this,"onStartGameRefuse");this.updateTableInfos(t);window.scrollTo(0,0);e.query(".head_info").forEach(e.destroy);if(this.bArenaMode){0==document.hidden&&(this.autoredirect=!0);"lobby"==mainsite.currentUrl.substr(0,5)&&(this.autoredirect=!0)}},addPlayerToGameStart:function(t){var i="";t.statusicon=playerDeviceToIcon(t.device);if(t.anonymized){i=e.string.substitute(this.jstpl_player_anonymized,t);e.place(i,"gamestart_playerlist");return}t.avatarimg=getPlayerAvatar(t.id,t.avatar,92);var a=t.rank,n=this.page.getRankString(t.rank_no),o=this.page.getRankClassFromElo(a),s=this.page.getRankClassFromEloUntranslated(a),r=this.page.eloToBarPercentage(a,this.tableinfos.game_hide_ranking),l=this.page.getKarmaLabel(t.karma),d=t.arena_points;null===d&&(d=1);var c=this.arenaPointsDetails(d);i=this.arenaPointsHtml(c);t.arena_points=d;t.arena_points_html=i.bar_content;t.arena_bottom_infos=i.bottom_infos;t.league_name=c.league_name??"";t.league_id=c.league;t.genderclass=null===t.gender?"gender_not_specified":1==t.gender?"fa-mars male":"fa-venus female";t.flag=t.country.code;t.game=this.tableinfos.game_id;t.rank=this.tableinfos.game_hide_ranking?"":this.page.formatElo(a);t.rank_no=this.tableinfos.game_hide_ranking?"":" - "+n;t.rank_class=s;t.rank_label=o;t.elobarpcent=r;t.prestige_mask="";t.karma_label=l.label;t.karma_class=l.css;t.lang_html="";for(var u=1;u>=0;u--)for(var h in t.languages)if(t.languages[h].level==u){var p=h;""!=t.lang_html&&(t.lang_html+=", ");t.lang_html+='<span id="lang_'+t.id+"_"+h+'">'+this.ucFirst(p)+"</span>"}var m=[];void 0!==mainsite.red_thumbs_given&&void 0!==mainsite.red_thumbs_given[t.id]&&m.push({text:_("You dislike to play with this player")});0==t.played&&m.push({text:_("It is the first game of this player. Does he know the rules ?")});toint(t.karma)<50?m.push({text:_("This player has a very bad reputation.")}):toint(t.karma)<65&&m.push({text:_("This player does not have a good reputation.")});1==toint(t.grade)&&m.push({text:_("Due to moderatation, this player cannot chat.")});1==t.same_ip&&m.push({text:_("This player plays from the same internet address than another player.")});let g=t.anonymized_id??t.id;t.warnings_nbr=m.length;t.anonymized_id=g;var f=this.bArenaMode||this.tableinfos&&this.tableinfos.options&&2==this.tableinfos.options[201]?.value?this.jstpl_player_arena:this.jstpl_player;i=e.string.substitute(f,t);e.place(i,"gamestart_playerlist");if(t.warnings_nbr>0&&t.id!=current_player_id){e.style("playerstart_warningblock_"+g,"display","block");var b=_("Warning about ${player_name}");t.warnings_nbr>1&&(b=_("Warnings about ${player_name}"));var y="<h3>"+e.string.substitute(b,{player_name:t.fullname})+"</h3><br/><br/>";for(var v in m){y+='<p><i class="fa fa-exclamation-triangle"></i> ';y+=m[v].text;y+="</p>"}y+="<br/>";this.addTooltipHtml("playerstart_warningblock_"+t.id,y)}},onAcknowledgeWarning:function(e){e.preventDefault();this.setWarningAcknowledged()},setWarningAcknowledged:function(){if(null!=$("warning_accept")){e.style("warning_accept","display","none");e.style("warning_accepted","display","");e.style("warningbis_accept","display","none");e.style("warningbis_accepted","display","")}if(null!=$("ags_start_game_accept")){e.removeClass("ags_start_game_accept","bgabutton_darkgray");e.addClass("ags_start_game_accept","bgabutton_blue")}},onStartGameAccept:function(t){t.preventDefault();if($("ags_start_game_accept_wrap"))if(null!=$("ags_start_game_accept")&&e.hasClass("ags_start_game_accept","bgabutton_darkgray")){this.showMessage(_("You need to acknowledge the warning first"),"error");e.addClass("warning_accept","flash-red");setTimeout(()=>{e.removeClass("warning_accept","flash-red")},850)}else{this.autoredirect=!0;this.switchToAcceptedState();this.page.ajaxcall("/table/table/acceptGameStart.html",{table:this.table_id},this,function(e){})}},onStartGameRefuse:function(t){t.preventDefault();var i=$("ags_start_game_accept_wrap");i&&e.style(i,"display","none");var a=$("ags_start_game_cancel_wrap");a&&e.style(a,"display","none");this.page.ajaxcall("/table/table/refuseGameStart.html",{table:this.table_id},this,function(e){})},switchToAcceptedState:function(){this.setWarningAcknowledged();if($("ags_start_game_accept_wrap")){e.style("ags_start_game_accept_wrap","display","none");e.style("ags_start_game_status_wrap","display","block");$("ags_start_game_cancel_wrap")&&setTimeout(e.hitch(this,function(){e.style("ags_start_game_cancel_wrap","display","block")}),1e3)}},updateTableInfos:function(t){if(void 0===t.players[current_player_id])t.arePlayerAnonymized||console.error("Current player "+current_player_id+" seems not to be at this table");else{if("1"==t.players[current_player_id].decision)this.switchToAcceptedState();else if($("ags_start_game_accept_wrap")){e.style($("ags_start_game_accept_wrap"),"display","block");e.style($("ags_start_game_status_wrap"),"display","none");e.style($("ags_start_game_cancel_wrap"),"display","none")}}if($("ags_wait_for_players")){$("ags_wait_for_players").innerHTML="";var i=!1;Object.entries(t.players).forEach(([a,n])=>{let o=n.anonymized_id??a;if("play"==n.table_status)if(1!=n.decision){t.arePlayerAnonymized?$("ags_wait_for_players").innerHTML+=_("Player ${index}").replaceAll("${index}",-1*o):$("ags_wait_for_players").innerHTML+=n.fullname+" ";i=!0;if($("player_confirmed_indicator_"+o)){e.style("player_confirmed_indicator_"+o,"display","none");e.style("player_waiting_indicator_"+o,"display","block")}}else if($("player_confirmed_indicator_"+o)){e.style("player_confirmed_indicator_"+o,"display","block");e.style("player_waiting_indicator_"+o,"display","none")}});if(!i){e.style("ags_progress_bar_wrap","display","block");e.style("ags_start_game_status_wrap","display","none");e.style("ags_start_game_cancel_wrap","display","none");e.addClass("gamestart_"+this.table_id,"game_about_to_start")}}void 0!==mainsite.autoredirectedWhenTableStarts&&mainsite.autoredirectedWhenTableStarts==t.id&&(this.autoredirect=!0);var a=$("websitebaseurl").innerHTML;tableurl="//"+a;this.game_url=tableurl+"/"+t.gameserver+"/"+t.game_name+"?table="+t.id;if(this.autoredirect&&("play"==t.status||"asyncplay"==t.status)){if($("ags_progress_bar_progress")){e.style("ags_progress_bar_progress","width","40%");$("ags_progress_bar_label").innerHTML=_("Redirecting to game table ...")}this.showMessage(_("Redirecting to game table ..."),"info");window.location.href=this.game_url;return!1}this.previous_status=t.status;"cancelGameStart"==t.reload_reason&&this.showMessage(_("Game start has been cancelled because some players refused or did not click on accept button on time."),"info");return!0},tableRedirectionCountdown:function(){if(0==this.redirectionCounter){e.addClass("gamestart_"+this.table_id,"game_about_to_start");this.showMessage(_("Redirecting to game table ..."),"info");window.location.href=this.game_url}else{$("ags_progress_bar_label").innerHTML="";e.style("ags_start_game_status_wrap","display","block");$("ags_start_game_status_wrap").innerHTML=_("Game starts in %s seconds").replace("%s",this.redirectionCounter);this.redirectionCounter--;setTimeout(e.hitch(this,"tableRedirectionCountdown"),1e3)}},onTableInfosChanged:function(e){if(e.args.id==this.table_id){var t=e.args;this.updateTableInfos(t)&&"setup"!=e.args.status&&this.destroy()}}})})},"ebg/core/mainsitemodule":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/core"],function(e,t,i){return t("ebg.core.mainsitemodule",ebg.core.core,{constructor:function(){this.bModuleActive=!1;this.jstpl_news_translation_details="<h3>"+_("About news translation")+"</h3><br /><p>"+_("The news translation is done <b>first by machine translation</b> using an online service, then it can be <b>improved by the BGA community.</b>")+"</p><br /><p>  "+_('Click on <b>"Improve translation"</b> to get to the translation page and help make the translation better.')+"</p><p>  "+_('Click on <b>"Show original"</b> to see the original English text.')+"</p>"},doesNeedServerSideLoad:function(){return!0},onPostLoad:function(){this.bModuleActive=!0;null!==$("commercial_offer_flag")&&null===$("commercial_offer_block")&&(1==$("commercial_offer_flag").innerHTML?this.displayCommercialOffer():2==$("commercial_offer_flag").innerHTML&&i.stores.menuStates.setHasCommercialOffer(!0))},onPostUnLoad:function(){this.bModuleActive=!1;this.cancelAjaxCall()},displayCommercialOffer:function(){this.popindialog=new ebg.popindialog;this.popindialog.create("commercial_offer_prompt","main-content");let t=_("Try BGA Premium for 1 month for free!");var a="";null!==$("commercial_offer_campaign")&&(a=$("commercial_offer_campaign").innerHTML);var n="premium_change_offer"===a;n&&(t=_("Change your subscription to a yearly one!"));this.popindialog.setTitle(t);var o=$("commercial_offer_content").value,s='<div class="clear" style="text-align:center">';s+=n?'<a href="#" id="commercial_offer_yes" class="bgabutton bgabutton_blue bgabutton_always_big">'+_("Yes please!")+"</a>":'<a href="#" id="commercial_offer_maybelater" class="bgabutton bgabutton_gray bgabutton_always_big">'+_("Maybe later")+'</a><a href="#" id="commercial_offer_yes" class="bgabutton bgabutton_blue bgabutton_always_big">'+_("Get 1 month free")+"</a>";s+='<br /><a class="bga-link" href="#" id="commercial_offer_notagain">';s+=n?_("I'm not interested to change"):_("I'm not interested in this offer");s+="</a></div>";var r='<br>                    <img src="'+getStaticAssetUrl("img/mainsite/offer_closedgift.png")+'" class="standard_popin_right_image"></img>                    '+o+s;this.popindialog.setContent(r);this.popindialog.show();var l=$("commercial_offer_yes");null!==l&&e.connect(l,"onclick",this,function(t){e.stopEvent(t);this.popindialog.destroy();$("commercial_offer_flag").innerHTML=2;this.ajaxcall("/player/profile/commercialOfferMaybeLater.html",{},this,function(){},function(){gotourl("premium")})});null!==$("commercial_offer_more_details")&&e.connect($("commercial_offer_more_details"),"onclick",this,function(t){e.stopEvent(t);this.popindialog.destroy();$("commercial_offer_flag").innerHTML=2;this.ajaxcall("/player/profile/commercialOfferMaybeLater.html",{},this,function(){},function(){gotourl("premium?moredetails")})});null!==$("commercial_offer_maybelater")&&e.connect($("commercial_offer_maybelater"),"onclick",this,function(t){e.stopEvent(t);$("commercial_offer_flag").innerHTML=2;i.stores.menuStates.setHasCommercialOffer(!0);this.ajaxcall("/player/profile/commercialOfferMaybeLater.html",{},this,function(){this.showMessage(__("lang_mainsite","Ok, do not forget this one time offer is only valid today!")+' <span style="color: rgb(193, 0, 1);"><i class="fa fa-exclamation-circle" aria-hidden="true"></i></span>',"info")},function(){this.popindialog.destroy()})});e.connect($("commercial_offer_notagain"),"onclick",this,function(t){e.stopEvent(t);$("commercial_offer_flag").innerHTML=3;this.ajaxcall("/player/profile/commercialOfferNotAgain.html",{},this,function(){this.showMessage(__("lang_mainsite","Duly noted, thank you!"),"info")},function(){this.popindialog.destroy()})})},onClickToggleNewsTranslation:function(e){e.preventDefault();if(e.target&&e.target.closest){var t=e.target.closest(".news-full-block");if(t){var i=t.querySelector(".newstitle a"),a=t.querySelector("[data-news-en-title]"),n=i.innerHTML;i.innerHTML=a.innerHTML;a.innerHTML=n;var o=t.querySelector(".newstext"),s=t.querySelector("[data-news-en-text]");n=o.innerHTML;o.innerHTML=s.innerHTML;s.innerHTML=n;t.querySelector(".language_preference_tip").classList.toggle("hidden",!0);t.classList.toggle("news-full-block--translated")||t.querySelector(".language_preference_tip").classList.toggle("hidden",!1)}}},isModuleActive:function(){return this.bModuleActive}})})},"ebg/site/account":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule"],function(e,t,i){return t("ebg.site.account",ebg.core.mainsitemodule,{constructor:function(){this.current_page=null},onLoad:function(t){"socialregistration"==t.page&&(t.page="register");if(globalUserInfos.user_infos.is_visitor||-1!==["login","newpassword","lostpassword","confirmemail","register","registration","newuser"].indexOf(t.page))if(t.page&&-1===["login","register","newuser","newpassword","lostpassword"].indexOf(t.page)){if($("accountpage_registration"))if("registration"!=t.page){if("welcomeemail"==t.page){e.style($("accountpage_welcomeemail"),"display","block");$("welcomeemail_btn")&&e.connect($("welcomeemail_btn"),"onclick",this,"onResendWelcomeEmail")}e.style($("accountpage_registration"),"display","none")}else{e.style($("accountpage_registration"),"display","block");require(["https://www.google.com/recaptcha/api.js?hl="+e.config.locale.substr(0,2)],e.hitch(this,"loadCaptcha")).on("error",e.hitch(this,function(){if(1==$("alt_captcha").innerHTML){this.showMessage(_("Unabled to load Google anti-robot Captcha. Loading alternative Captcha..."),"error");e.style("antirobotcaptcha","display","none");e.style("alt_captcha_content","display","block");$("recaptcha_method").value=0;e.connect($("alt_captcha_confirm"),"onclick",this,"onAltCaptchaConfirm")}else this.showMessage(_("Unabled to load Google anti-robot Captcha. Please check your Internet connection."),"error")}))}}else this.accountManagerForm=new i.ms.account.BgaAccountManagerForm({target:document.querySelector("#account-module"),props:{currentStep:{mode:t.page||"login",step:t.step||1}}});else gotourl(mainsite.homepage)},onPopState:function(){if("/account"!==window.location.pathname)throw new Error("Invalid page"+window.location.pathname);this.accountManagerForm&&this.accountManagerForm.updateStateFromURL()},onAltCaptchaConfirm:function(t){e.stopEvent(t);this.ajaxcall("/account/account/confirmemail.html",{form_id:"newaccount_form"},this,function(e){if(e.success){analyticsPush({step:"3",event:"accountCreation",method:e.method});gotourl("welcome");this.showMessage(_("Email confirmed! Your account has been unlocked and we've sent an email to you with instructions to set your password :-)"),"info")}},function(e){},"post")},loadCaptcha:function(){grecaptcha;if("undefined"!=typeof grecaptcha&&void 0!==grecaptcha.render){$("antirobotcaptcha")&&e.destroy("antirobotcaptcha");$("grecaptcha_target")&&grecaptcha.render("grecaptcha_target",{sitekey:"6LcZKRMUAAAAAAG7c88C4usUg0xWab3NJOZ_9n0a",callback:e.hitch(this,function(e){this.ajaxcall("/account/account/confirmemail.html",{form_id:"newaccount_form"},this,function(e){if(e.success){analyticsPush({step:"3",event:"accountCreation",method:e.method});gotourl("welcome");this.showMessage(_("Email confirmed! Your account has been unlocked and we've sent an email to you with instructions to set your password :-)"),"info")}},function(e){},"post")})})}else setTimeout(e.hitch(this,"loadCaptcha"),300)},onResendWelcomeEmail:function(e){e.preventDefault();var t=$("welcomeemail_email").value;""!=t&&this.ajaxcall("/account/account/welcomeemail.html",{email:t},this,function(e){if("nok"==e)this.showMessage(_("Unknown email"),"error");else{this.showMessage(_("If we have an account with that email, we have sent it a message. Please check your mailbox (and SPAM folder)."),"info");gotourl("account")}})},onOnUnload:function(){if(this.accountManagerForm){this.accountManagerForm.clearFormDataCookie();this.accountManagerForm.$destroy()}}})})},"ebg/site/arenasuggestions":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","ebg/board"],function(e,t,i){return t("ebg.site.arenasuggestions",ebg.core.mainsitemodule,{gameId:null,season:null,constructor:function(){},onLoad:function(e){this.gameId=e.game;this.season=e.season;$("bga-arena-suggestions-list")&&(this.listComponent=new i.ms.arenasuggestions.BgaArenaSuggestionsList({target:$("bga-arena-suggestions-list"),props:{seeAll:!!e.see_all,seasonId:this.season}}));$("bga-arena-suggestions-list-for-game")&&(this.listGameComponent=new i.ms.arenasuggestions.BgaArenaSuggestionsListForGame({target:$("bga-arena-suggestions-list-for-game"),props:{gameId:this.gameId,seasonId:this.season}}));$("pagetitle")&&mainsite.setPageTitle($("pagetitle").innerHTML);this.connectQuery(".arenasuggestion-description__edit-btn","click",function(e){e.preventDefault();this.toggleEditDescriptionForm(!0)});this.newsfeed=new ebg.board;this.newsfeed.bStatusUpdate=!0;var t=document.querySelector(".arenasuggestion-newsfeed"),a=t?.getAttribute("data-group-id");a&&""!=a&&this.newsfeed.create(this,t,"group",a,!1)},onOnUnload:function(){this.listGameComponent&&this.listGameComponent.$destroy();this.listComponent&&this.listComponent.$destroy()},toggleEditDescriptionForm(t){var i=document.querySelector(".arenasuggestion-description__content"),a=document.querySelector(".arenasuggestion-description__edit-btn"),n=document.querySelector(".arenasuggestion-description__edit-form");if(t){i.style.display="none";a.style.display="none";if(!n){var o=$("jstpl_arenasuggestion_desc_form").innerHTML,s={content:i.textContent};e.place(this.format_string(o,s),i.parentNode);this.connectQuery(".arenasuggestion-description__edit-save","click",function(){var e=document.querySelector(".arenasuggestion-description__edit-content").value.trim();if(e!==i.textContent.trim()){var t;t="next"===this.season?"current":"current"==this.season?"previous":this.season-1;var a={content:e,game:this.gameId,season:t};this.ajaxcall("/arenasuggestions/arenasuggestions/updateDescription.html",a,this,function(e){i.textContent=e},function(e){e||this.toggleEditDescriptionForm(!1)})}else this.toggleEditDescriptionForm(!1)});this.connectQuery(".arenasuggestion-description__edit-cancel","click",function(){this.toggleEditDescriptionForm(!1)})}}else{i.style.display="";a.style.display="";n&&n.remove()}}})})},"ebg/board":function(){define(["dojo","dojo/_base/declare","dojox/html/entities"],function(e,t){return t("ebg.board",null,{constructor:function(){this.page=null;this.board_div=null;this.board_div_id=null;this.board_uid="_";this.bReadonly=!1;this.board_topic_type=null;this.board_topic_id=null;this.board_topic_arg=null;this.is_social_newsfeed=!1;this.bSocialButtons=!0;this.bStatusUpdate=!1;this.bSeeMore=!0;this.see_more_handler=null;this.per_page=10;this.restrictedBoard=!1;this.last_news_timestamp=0;this.last_news_id=0;this.postAs="";this.disabledFeed=!1;this.jstpl_boardstructure='<div id="board_fake_input_${board_uid}" class="board_fake_input">${invite_message}</div><div id="board_new_post_${board_uid}" class="board_new_post"><textarea id="board_input_${board_uid}" class="board_input"></textarea><a id="new_post_btn_${board_uid}" class="bgabutton bgabutton_blue new_post_btn" href="#"><span>'+__("lang_mainsite","Post")+'</span></a><select id="board_templates_${board_uid}" class="board_templates"><option value="" disabled selected hidden>'+__("lang_mainsite","Select template")+'</option></select></div><div id="boardposts_${board_uid}" class="bga-link-inside boardposts ${board_readonly_mode}"></div><div id="boardfooter_${board_uid}" class="boardfooter"><a class="bga-link" id="board_seemore_${board_uid}" href="#" >'+__("lang_mainsite","See more news ...")+"</a></div></div>";this.jstpl_message='<div class="post" id="post_${board_uid}_${id}"><a name="news${id}"></a><div class="postimage postimage_${postimage_class} ${postimage_addclass}" id="postimage_${board_uid}_${id}" style="background-image:url(\'${image}\');"></div><div class="postmenu"><a href="#" id="edit_board_post_${board_uid}_${id}" class="edit_board_post"><i class="fa fa-pencil"></i></a>&nbsp;&nbsp;<a href="#" id="del_board_post_${board_uid}_${id}" class="del_board_post"><i class="fa fa-times"></i></a></div><div class="postcontent"><div id="postmessage_${board_uid}_${id}" class="postmessage">${message}</div><div id="postmessage_original_${board_uid}_${id}" class="" style="display:none">${original}</div><div class="postfooter"><span class="postdate">${time}</span><span id="comment_section_${board_uid}_${id}"> &bull; <a id="comment_btn_${board_uid}_${id}" class="comment_btn" href="#" >'+__("lang_mainsite","add some comment")+'</a></span></div><div id="comments_${board_uid}_${id}" class="comments" ></div><div class="commentform" id="commentform_${board_uid}_${id}"><textarea id="comment_input_${board_uid}_${id}" class="comment_input" maxlength="400"></textarea><div class="flex justify-end mb-3 gap-2 items-center"><p class="text-sm text-bga-gray-171">'+__("lang_mainsite","Character limit: 400")+'</p><a id="cancel_new_comment_btn_${board_uid}_${id}" class="bgabutton bgabutton_red cancel_new_comment_btn" href="#"><span>'+__("lang_mainsite","Cancel")+'</span></a><a id="new_comment_btn_${board_uid}_${id}" class="bgabutton bgabutton_blue new_comment_btn" href="#"><span>'+__("lang_mainsite","Post")+"</span></a></div></div></div></div>";this.jstpl_comment='<div class="comment" id="comment_${board_uid}_${id}"><div class="postimage emblemwrap emblemwrap"><div class="emblem" style="background-image:url(${avatar_url});position:relative;top:3px;background-size:cover;"></div></div><div class="commentmenu"><a href="#" id="edi_board_comment_${board_uid}_${id}" class="edi_board_comment"><i class="fa fa-pencil"></i></a>&nbsp;&nbsp;<a href="#" id="del_board_comment_${board_uid}_${id}" class="del_board_comment"><i class="fa fa-times"></i></a></div><div class="commentcontent"><div id="postmessage_${board_uid}_${id}" class="postmessage">${message}</div><div id="postmessage_original_${board_uid}_${id}" class="" style="display:none">${original}</div><div class="postfooter"><span class="postdate">${time}</span></div></div>';this.jstpl_more_comment='<div class="comment more_comment" id="more_comment_${board_uid}_${post_id}" ><a href="#" id="more_comment_btn_${board_uid}_${post_id}">${more_comment_label}</a></div>';this.jstpl_edit_message='<div id="edit_wrapper_${board_uid}${id}">                            <textarea id="edit_message_${board_uid}${id}" class="board_input"></textarea><a id="canc_post_btn_${board_uid}${id}" class="bgabutton bgabutton_gray canc_post_btn" href="#"><span>'+__("lang_mainsite","Cancel")+'</span></a> <a id="edit_post_btn_${board_uid}${id}" class="bgabutton bgabutton_blue edit_post_btn" href="#"><span>'+__("lang_mainsite","Save")+"</span></a>                        </div>";this.jstpl_edit_comment='<div id="edit_wrapper_${board_uid}${id}">                            <textarea id="edit_comment_${board_uid}${id}" class="board_input"></textarea><a id="canc_comment_btn_${board_uid}${id}" class="bgabutton bgabutton_gray canc_post_btn" href="#"><span>'+__("lang_mainsite","Cancel")+'</span></a> <a id="edit_comment_btn_${board_uid}${id}" class="bgabutton bgabutton_blue edit_post_btn" href="#"><span>'+__("lang_mainsite","Save")+"</span></a>                        </div>"},create:function(e,t,i,a,n,o){this.page=e;this.board_div=t;this.board_div;if(null!==this.board_div){this.board_div_id=t.id;this.board_topic_type=i;this.board_topic_id=a;this.is_social_newsfeed=n;this.board_topic_arg=void 0!==o?o:null;this.init()}else console.error("Trying to create a board with a NULL div => aborting")},init:function(){e.place('<div class="loading_icon"></div>',this.board_div,"only");var t={type:this.board_topic_type,id:this.board_topic_id,arg:this.board_topic_arg,social:this.is_social_newsfeed,per_page:this.per_page};this.page.ajaxcall("/message/board",t,this,function(t){let i=t.news;this.restrictedBoard=t.restrictedBoard;e.empty(this.board_div_id);var a=__("lang_mainsite","Say something...");this.postAs&&(a=e.string.substitute(_("Say something as ${someone}..."),{someone:this.postAs}));e.place(this.page.format_string(this.jstpl_boardstructure,{board_uid:this.board_uid,board_readonly_mode:this.bReadonly?"board_readonly":"",invite_message:a}),this.board_div_id);if(!this.bStatusUpdate||this.restrictedBoard){e.style($("board_fake_input_"+this.board_uid),"display","none");e.style($("board_new_post_"+this.board_uid),"display","none")}e.connect($("board_fake_input_"+this.board_uid),"onclick",this,"onFakeInputClick");e.connect($("new_post_btn_"+this.board_uid),"onclick",this,"onPostNewMessage");e.connect($("board_seemore_"+this.board_uid),"onclick",this,"onSeemore");this.bSeeMore||e.style($("board_seemore_"+this.board_uid),"display","none");this.insert_posts(i);this.is_social_newsfeed&&i.length<this.per_page&&!this.disabledFeed&&e.place("<div class='whiteblock smalltext'>"+_("This newsfeed displays news from you, your friends and your groups. Add players to your friendlist and join interesting groups to enjoy it best!")+"</div>",$("boardposts_"+this.board_uid),"last");void 0!==this.per_page_after_init&&(this.per_page=this.per_page_after_init);if(!this.restrictedBoard&&this.boardTemplates&&Object.values(this.boardTemplates).length>0){e.style($("board_templates_"+this.board_uid),"display","block");for(const t in this.boardTemplates)if(Object.hasOwnProperty.call(this.boardTemplates,t)){const i=this.boardTemplates[t].name;e.place('<option value="'+t+'">'+i+"</option>",$("board_templates_"+this.board_uid),"last")}e.connect($("board_templates_"+this.board_uid),"onchange",this,"onTemplateChange")}},void 0,void 0,function(t,i){e.empty(this.board_div_id);e.place("<div class='text-center'><p>"+_("There was a problem getting the news feed.")+"</p><button id='bga-news-retry' class='inline bga-button-clean bga-link'>"+_("Retry")+"</button></div>",this.board_div_id);let a=e.connect($("bga-news-retry"),"onclick",this,()=>{this.init();e.disconnect(a)})})},onNewPosts:function(){},insert_posts:function(t,i){i||(i="last");this.disabledFeed=!1;let a={};for(var n in t){var o=t[n];if($("post_"+this.board_uid+"_"+o.id));else{var s="",r="";void 0!==o.imgclass&&(s=o.imgclass);"avatar"==s&&(-1!=o.img.indexOf("/icon/")?r+="game_icon":r+="emblem");var l=o.img;"http:"!=o.img.substr(0,5)&&"https:"!=o.img.substr(0,6)&&(l=g_themeurl+o.img);o.html=this.page.makeClickableLinks(o.html,!1);o.html=replaceAll(o.html,"<br"," <br");o.html=this.page.addSmileyToText(o.html);a[o.id]=e.place(this.page.format_string(this.jstpl_message,{id:o.id,board_uid:this.board_uid,message:o.html,original:o.original,time:time_ago_format(o.date_ago),image:l,postimage_class:s,postimage_addclass:r}),$("boardposts_"+this.board_uid),i);if(null!==o.imgadd){l=o.imgadd;"http:"!=o.imgadd.substr(0,5)&&"https:"!=o.imgadd.substr(0,6)&&(l=g_themeurl+o.imgadd);if(45==o.news_type){e.place('<div class="postimage postimage_avatar emblem" style="background-image: url('+l+'); margin-left: -5px;"></div>',"postimage_"+this.board_uid+"_"+o.id,"before");e.style("postimage_"+this.board_uid+"_"+o.id,{marginLeft:"5px"})}else 17==o.news_type&&e.place('<div class="postimage trophyimg">'+e.string.substitute('<img src="${src}"/>',{src:l})+"</div>","postimage_"+this.board_uid+"_"+o.id,"before")}e.connect($("comment_btn_"+this.board_uid+"_"+o.id),"onclick",this,"onCommentBtnClicked");e.connect($("new_comment_btn_"+this.board_uid+"_"+o.id),"onclick",this,"onPostNewComment");e.connect($("cancel_new_comment_btn_"+this.board_uid+"_"+o.id),"onclick",this,"cancelNewComment");(0==this.bSocialButtons||this.restrictedBoard)&&e.style($("comment_section_"+this.board_uid+"_"+o.id),"display","none");e.connect($("del_board_post_"+this.board_uid+"_"+o.id),"onclick",this,"onDeletePost");e.connect($("edit_board_post_"+this.board_uid+"_"+o.id),"onclick",this,"onEditPost");o.canRemove&&e.addClass("post_"+this.board_uid+"_"+o.id,"post_canRemove");0==o.canModify&&e.style("edit_board_post_"+this.board_uid+"_"+o.id,"visibility","hidden");if(o.comment_nbr>0){if(o.comment_nbr>1){if(o.comment_nbr-1==1)var d=this.page.format_string(__("lang_mainsite","Display 1 comment..."),{nbr:o.comment_nbr-1});else d=this.page.format_string(__("lang_mainsite","Display ${nbr} comments..."),{nbr:o.comment_nbr-1});e.place(this.page.format_string(this.jstpl_more_comment,{post_id:o.id,board_uid:this.board_uid,more_comment_label:d}),"comments_"+this.board_uid+"_"+o.id);e.connect($("more_comment_btn_"+this.board_uid+"_"+o.id),"onclick",this,"onMoreComment")}this.insert_comment(o.id,o)}void 0!==o.bRead&&0==toint(o.bRead)&&e.addClass("post_"+this.board_uid+"_"+o.id,"playernotification_not_read");if("uniquenews"==this.board_topic_type)e.addClass("postmessage_"+this.board_uid+"_"+o.id,"extended_message");else if(e.style("postmessage_"+this.board_uid+"_"+o.id,"height")>=150){e.addClass("postmessage_"+this.board_uid+"_"+o.id,"extended_message_hidden");e.place('<p class="readmore_post"><a href="#" id="readmore_post_'+this.board_uid+"_"+o.id+'">'+_("Read more")+"</a></p>","postmessage_"+this.board_uid+"_"+o.id,"after");e.connect($("readmore_post_"+this.board_uid+"_"+o.id),"onclick",this,"postReadMore")}o.disabledFeed&&(this.disabledFeed=!0)}if("last"==i){this.last_news_id=o.refid;this.last_news_timestamp=o.timestamp}}if(window.location.hash){let t=window.location.hash.substr(5);if(a[t]){e.style(a[t],{backgroundColor:"#edbab7"});a[t].scrollIntoView()}}this.onNewPosts()},postReadMore:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(14);this.doReadMore(i)},doReadMore:function(t){if($("readmore_post_"+t)){e.addClass("postmessage_"+t,"extended_message");e.destroy("readmore_post_"+t)}},format_comment_text:function(e){e=this.page.makeClickableLinks(e,!1);e=this.page.addSmileyToText(e);return e=this.page.nl2br(e,!1)},insert_comment:function(t,i){var a='<a href="player?id='+i.comment_author+'" class="playername">'+i.comment_author_name+"</a>&nbsp;";a+='<span id="postmessage_commentcontent_'+this.board_uid+"_"+i.comment_id+'"></span>';e.place(this.page.format_string(this.jstpl_comment,{id:i.comment_id,board_uid:this.board_uid,message:a,original:i.comment_text,time:time_ago_format(i.comment_date_ago),avatar_url:getPlayerAvatar(i.comment_author,i.comment_avatar||"",32),player:i.comment_author}),"comments_"+this.board_uid+"_"+t);$("postmessage_commentcontent_"+this.board_uid+"_"+i.comment_id).innerHTML=this.format_comment_text(i.comment_text);e.connect($("del_board_comment_"+this.board_uid+"_"+i.comment_id),"onclick",this,"onDeleteComment");e.connect($("edi_board_comment_"+this.board_uid+"_"+i.comment_id),"onclick",this,"onEditComment");i.comment_canRemove&&e.addClass($("comment_"+this.board_uid+"_"+i.comment_id),"comment_canRemove");!1===i.comment_canModify&&e.style("edi_board_comment_"+this.board_uid+"_"+i.comment_id,"visibility","hidden");if(e.style("comment_"+this.board_uid+"_"+i.comment_id,"height")>=150){e.addClass("postmessage_"+this.board_uid+"_"+i.comment_id,"extended_message_hidden");e.place('<p><a href="#" id="readmore_post_'+this.board_uid+"_"+i.comment_id+'">'+_("Read more")+"</a></p>","postmessage_"+this.board_uid+"_"+i.comment_id,"after");e.connect($("readmore_post_"+this.board_uid+"_"+i.comment_id),"onclick",this,"postReadMore")}},onFakeInputClick:function(t){t.preventDefault();e.style($("board_fake_input_"+this.board_uid),"display","none");e.style($("board_new_post_"+this.board_uid),"display","block");e.style($("new_post_btn_"+this.board_uid),"display","block");$("board_input_"+this.board_uid).focus()},onTemplateChange:function(t){t.preventDefault();const i=e.attr(e.byId("board_templates_"+this.board_uid),"value");let a="";this.boardTemplates[i]&&(a=this.boardTemplates[i].text);e.attr($("board_input_"+this.board_uid),"value",a);$("board_input_"+this.board_uid).focus()},onPostNewMessage:function(t){t.preventDefault();e.style($("new_post_btn_"+this.board_uid),"display","none");var i=$("board_input_"+this.board_uid).value;$("board_input_"+this.board_uid).value="";var a={type:this.board_topic_type,id:this.board_topic_id,message:i};this.page.ajaxcall("/message/board/add.html",a,this,function(e){this.insert_posts([e],"first")},function(t){e.style($("board_fake_input_"+this.board_uid),"display","block");e.style($("board_new_post_"+this.board_uid),"display","none")},"post")},onSeemore:function(e){e.preventDefault();if("function"!=typeof this.see_more_handler){var t={type:this.board_topic_type,id:this.board_topic_id,arg:this.board_topic_arg,social:this.is_social_newsfeed,page:0,per_page:this.per_page,from_time:this.last_news_timestamp,from_id:this.last_news_id};this.page.ajaxcall("/message/board",t,this,function(e){let t=e.news;0==t.length&&this.page.showMessage(__("lang_mainsite","No more publication"),"info");this.insert_posts(t)})}else this.see_more_handler()},onCommentBtnClicked:function(t){t.preventDefault();var i=t.currentTarget.id.substr(14);e.style($("commentform_"+this.board_uid+"_"+i),"display","block");$("comment_input_"+this.board_uid+"_"+i).focus()},cancelNewComment:function(t){t.preventDefault();var i=t.currentTarget.id.substr(25);e.style($("commentform_"+this.board_uid+"_"+i),"display","none");$("comment_input_"+this.board_uid+"_"+i).value=""},onPostNewComment:function(t){t.preventDefault();var i=t.currentTarget.id.substr(18);e.style($("commentform_"+this.board_uid+"_"+i),"display","none");var a=$("comment_input_"+this.board_uid+"_"+i).value;$("comment_input_"+this.board_uid+"_"+i).value="";var n={id:i,message:a};this.page.ajaxcall("/message/board/addcomment.html",n,this,function(e){this.insert_comment(i,{comment_id:e.comment_id,comment_author:current_player_id,comment_avatar:e.comment_avatar||"000000",comment_author_name:e.comment_author_name||"",comment_text:this.page.htmlentities(a,"ENT_NOQUOTES"),original:a,comment_date_ago:0,comment_canRemove:!0})},function(e){},"post");analyticsPush({event:"post_comment"})},onMoreComment:function(t){t.preventDefault();var i=t.currentTarget.id.substr(19);e.style($("more_comment_btn_"+this.board_uid+"_"+i),"display","none");this.page.ajaxcall("/message/board/comments.html",{id:i},this,function(t){e.empty("comments_"+this.board_uid+"_"+i);for(var a in t){var n=t[a];n.original=n.comment_text;this.insert_comment(i,n)}})},onDeletePost:function(t){t.preventDefault();var i=t.currentTarget.id.substr(17);this.page.confirmationDialog(__("lang_mainsite","Would you really want to remove this post and all associated comments ? This operation can't be cancelled."),e.hitch(this,function(){this.page.ajaxcall("/message/board/deletePost.html",{post:i},this,function(t){e.destroy("post_"+this.board_uid+"_"+i)})}))},onDeleteComment:function(t){t.preventDefault();var i=t.currentTarget.id.substr(20);this.page.confirmationDialog(__("lang_mainsite","Would you really want to remove this comment ? This operation can't be cancelled."),e.hitch(this,function(){this.page.ajaxcall("/message/board/deleteComment.html",{comment:i},this,function(t){e.destroy("comment_"+this.board_uid+"_"+i)})}))},onEditComment:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(19);e.place(e.string.substitute(this.jstpl_edit_comment,{board_uid:this.board_uid,id:i}),"postmessage_"+this.board_uid+i,"after");e.style("postmessage_"+this.board_uid+i,"display","none");e.query("#post_"+this.board_uid+i+" .postmenu").style("visibility","hidden");e.connect($("canc_comment_btn_"+this.board_uid+i),"onclick",this,"onCancelEditComment");e.connect($("edit_comment_btn_"+this.board_uid+i),"onclick",this,"onSaveEditComment");$("edit_comment_"+this.board_uid+i).innerHTML=$("postmessage_original_"+this.board_uid+i).innerHTML},onCancelEditComment:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(18);e.style("postmessage_"+this.board_uid+i,"display","block");e.query("#post_"+this.board_uid+i+" .postmenu").style("visibility","visible");e.destroy("edit_wrapper_"+this.board_uid+i)},onSaveEditComment:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(18),a=$("edit_comment_"+this.board_uid+i).value,n={id:i.substr(1),message:a};this.page.ajaxcall("/message/board/modifycomment.html",n,this,function(e){$("postmessage_commentcontent_"+this.board_uid+i).innerHTML=this.format_comment_text(a);$("postmessage_original_"+this.board_uid+i).innerHTML=a},function(t){e.style("postmessage_"+this.board_uid+i,"display","block");e.query("#post_"+this.board_uid+i+" .postmenu").style("visibility","visible");e.destroy("edit_wrapper_"+this.board_uid+i)},"post")},onSignalPost:function(e){e.preventDefault();e.currentTarget.id.substr(17)},onEditPost:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(17);this.doReadMore(this.board_uid+i);e.place(e.string.substitute(this.jstpl_edit_message,{board_uid:this.board_uid,id:i}),"postmessage_"+this.board_uid+i,"after");e.style("postmessage_"+this.board_uid+i,"display","none");e.query("#post_"+this.board_uid+i+" .postmenu").style("visibility","hidden");e.connect($("canc_post_btn_"+this.board_uid+i),"onclick",this,"onCancelEditPost");e.connect($("edit_post_btn_"+this.board_uid+i),"onclick",this,"onSaveEditPost");$("edit_message_"+this.board_uid+i).innerHTML=$("postmessage_original_"+this.board_uid+i).innerHTML},onCancelEditPost:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(15);e.style("postmessage_"+this.board_uid+i,"display","block");e.query("#post_"+this.board_uid+i+" .postmenu").style("visibility","visible");e.destroy("edit_wrapper_"+this.board_uid+i)},onSaveEditPost:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(15),a=$("edit_message_"+this.board_uid+i).value,n={id:i.substr(1),message:a};this.page.ajaxcall("/message/board/modify.html",n,this,function(e){var t=e.html;t=this.page.makeClickableLinks(t,!1);t=replaceAll(t,"<br"," <br");t=this.page.addSmileyToText(t);$("postmessage_"+this.board_uid+i).innerHTML=t;$("postmessage_original_"+this.board_uid+i).innerHTML=e.original},function(t){e.style("postmessage_"+this.board_uid+i,"display","block");e.query("#post_"+this.board_uid+i+" .postmenu").style("visibility","visible");e.destroy("edit_wrapper_"+this.board_uid+i)},"post")}})})},"ebg/site/award":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.award",ebg.core.mainsitemodule,{constructor:function(){this.award_id=null;this.game_id=null},onLoad:function(e){},onOnUnload:function(){}})})},"ebg/site/bugs":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule"],function(e,t,i){return t("ebg.site.bugs",ebg.core.mainsitemodule,{constructor:function(){this.bugsPage=null},onLoad:function(e){mainsite.setPageTitle(_("Bugs & suggestions"));var t=document.querySelector("#main-content");if(t){document.documentElement.classList.add("bga-white-background");this.bugsPage=new i.ms.bugs.BgaBugsPage({target:t,props:{initialArgs:e}})}},onOnUnload:function(){if(this.bugsPage){document.documentElement.classList.remove("bga-white-background");this.bugsPage.$destroy();this.bugsPage=null}}})})},"ebg/site/community":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule","ebg/comboajax"],function(e,t){return t("ebg.site.community",ebg.core.mainsitemodule,{constructor:function(){this.filteringSelect=null;this.filteringSelectAddToFriend=null;this.filteringSelectGroup=null},onLoad:function(t){mainsite.setPageTitle(_("Community"));if($("findplayer")){this.filteringSelect=new ebg.comboajax;this.filteringSelect.create("findplayer","/player/player/findplayer.html",__("lang_mainsite","Type a player name..."));e.connect(this.filteringSelect,"onChange",this,function(e){if(0!=toint(e)){this.filteringSelect;gotourl("player?id="+e)}})}if($("findfriend")){this.filteringSelectAddToFriend=new ebg.comboajax;this.filteringSelectAddToFriend.create("findfriend","/player/player/findplayer.html?nofriends",__("lang_mainsite","Type a player name..."));e.connect(this.filteringSelectAddToFriend,"onChange",this,function(e){if(0!=toint(e)){this.filteringSelectAddToFriend;this.ajaxcall("/community/community/addToFriend.html",{id:e},this,function(){mainsite.gotourl_forcereload("community")},function(e){})}})}if($("findgroup")){this.filteringSelectGroup=new ebg.comboajax;this.filteringSelectGroup.create("findgroup","/group/group/findgroup.html",__("lang_mainsite","Type a group name..."));e.connect(this.filteringSelectGroup,"onChange",this,function(e){0!=toint(e)&&gotourl("group?id="+e)})}e.query(".date_to_format").forEach(e.hitch(this,function(t){t.innerHTML=date_format(toint(t.innerHTML),!1,!1);e.style(t,"display","inline")}))},onOnUnload:function(){$("findplayer")&&dijit.byId("findplayer").destroy();$("findfriend")&&dijit.byId("findfriend").destroy();$("findgroup")&&dijit.byId("findgroup").destroy()}})})},"ebg/comboajax":function(){define(["dojo","dojo/_base/declare","dijit/form/FilteringSelect","dojox/data/QueryReadStore"],function(e,t){return t("ebg.comboajax",null,{constructor:function(){this.div_id=null;this.div=null;this.query_url="";this.stateStore=null;this.filteringSelect=null;this.currentSelection=null;this.disableNextOnChange=!1},create:function(t,i,a,n){this.div_id=t;this.div=$(t);null===this.div&&console.error("comboajax::create: "+this.div_id+" associated div is null");this.query_url=i;this.stateStore=new dojox.data.QueryReadStore({url:this.query_url});void 0===a&&(a=__("lang_mainsite","Start typing..."));void 0===n&&(n="");this.filteringSelect=new dijit.form.FilteringSelect({id:t,name:t,store:this.stateStore,searchAttr:"q",value:n,queryExpr:"${0}",hasDownArrow:!1,invalidMessage:a},t);this.div=$(t);this.div.value=a;e.connect(this.div,"onfocus",this,function(e){this.div.value="";this.filteringSelect.loadAndOpenDropDown()});e.connect(dijit.byId(this.div_id),"onChange",this,function(e){var i=dijit.byId(t);if(null!==i&&null!==i.item&&i.item){var a=i.item.i.id;this.currentSelection=a;this.disableNextOnChange||this.onChange(a)}this.disableNextOnChange=!1});e.connect(this.div,"onkeyup",this,"onKeyUp")},onKeyUp:function(e){var t=dijit.byId(this.div_id);if(13==e.keyCode&&null!==t.item){var i=t.item.i.id;this.currentSelection=i;this.onChange(i)}},setValue:function(e){this.filteringSelect.attr("displayedValue",e)},onChange:function(e){},destroy:function(e){dijit.byId(this.div_id).destroy()},getSelection:function(){return this.filteringSelect.item&&this.filteringSelect.item.i&&this.filteringSelect.item.i.id?this.filteringSelect.item.i.id:null},setSelection:function(e,t){this.disableNextOnChange=t;this.stateStore.url=this.query_url+"?q="+e;this.stateStore.close();this.filteringSelect.set("displayedValue",e)}})})},"dojox/data/QueryReadStore":function(){define(["dojo","dojox","dojo/data/util/sorter","dojo/string"],function(e,t){return e.declare("dojox.data.QueryReadStore",null,{url:"",requestMethod:"get",_className:"dojox.data.QueryReadStore",_items:[],_lastServerQuery:null,_numRows:-1,lastRequestHash:null,doClientPaging:!1,doClientSorting:!1,_itemsByIdentity:null,_identifier:null,_features:{"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0},_labelAttr:"label",constructor:function(t){e.mixin(this,t)},getValue:function(t,i,a){this._assertIsItem(t);if(!e.isString(i))throw new Error(this._className+".getValue(): Invalid attribute, string expected!");return!this.hasAttribute(t,i)&&a?a:t.i[i]},getValues:function(e,t){this._assertIsItem(e);var i=[];this.hasAttribute(e,t)&&i.push(e.i[t]);return i},getAttributes:function(e){this._assertIsItem(e);var t=[];for(var i in e.i)t.push(i);return t},hasAttribute:function(e,t){return this.isItem(e)&&void 0!==e.i[t]},containsValue:function(e,t,i){for(var a=this.getValues(e,t),n=a.length,o=0;o<n;o++)if(a[o]==i)return!0;return!1},isItem:function(e){return!!e&&(void 0!==e.r&&e.r==this)},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){this.isItemLoaded(e.item)},fetch:function(t){(t=t||{}).store||(t.store=this);var i=this;this._fetchItems(t,function(t,a,n){var o=a.abort||null,s=!1,r=a.start?a.start:0;0==i.doClientPaging&&(r=0);var l=a.count?r+a.count:t.length;a.abort=function(){s=!0;o&&o.call(a)};var d=a.scope||e.global;a.store||(a.store=i);a.onBegin&&a.onBegin.call(d,n,a);a.sort&&i.doClientSorting&&t.sort(e.data.util.sorter.createSortFunction(a.sort,i));if(a.onItem)for(var c=r;c<t.length&&c<l;++c){var u=t[c];s||a.onItem.call(d,u,a)}if(a.onComplete&&!s){var h=null;a.onItem||(h=t.slice(r,l));a.onComplete.call(d,h,a)}},function(t,i){if(i.onError){var a=i.scope||e.global;i.onError.call(a,t,i)}});return t},getFeatures:function(){return this._features},close:function(e){},getLabel:function(e){if(this._labelAttr&&this.isItem(e))return this.getValue(e,this._labelAttr)},getLabelAttributes:function(e){return this._labelAttr?[this._labelAttr]:null},_xhrFetchHandler:function(t,i,a,n){(t=this._filterResponse(t)).label&&(this._labelAttr=t.label);var o=t.numRows||-1;this._items=[];e.forEach(t.items,function(e){this._items.push({i:e,r:this})},this);var s=t.identifier;this._itemsByIdentity={};if(s){this._identifier=s;var r;for(r=0;r<this._items.length;++r){var l=this._items[r].i,d=l[s];if(this._itemsByIdentity[d])throw new Error(this._className+":  The json data as specified by: ["+this.url+"] is malformed.  Items within the list have identifier: ["+s+"].  Value collided: ["+d+"]");this._itemsByIdentity[d]=l}}else{this._identifier=Number;for(r=0;r<this._items.length;++r)this._items[r].n=r}o=this._numRows=-1===o?this._items.length:o;a(this._items,i,o);this._numRows=o},_fetchItems:function(t,i,a){var n=t.serverQuery||t.query||{};if(!this.doClientPaging){n.start=t.start||0;t.count&&(n.count=t.count)}if(!this.doClientSorting&&t.sort){var o=[];e.forEach(t.sort,function(e){e&&e.attribute&&o.push((e.descending?"-":"")+e.attribute)});n.sort=o.join(",")}if(this.doClientPaging&&null!==this._lastServerQuery&&e.toJson(n)==e.toJson(this._lastServerQuery)){this._numRows=-1===this._numRows?this._items.length:this._numRows;i(this._items,t,this._numRows)}else{var s=("post"==this.requestMethod.toLowerCase()?e.xhrPost:e.xhrGet)({url:this.url,handleAs:"json-comment-optional",content:n,failOk:!0});t.abort=function(){s.cancel()};s.addCallback(e.hitch(this,function(e){this._xhrFetchHandler(e,t,i,a)}));s.addErrback(function(e){a(e,t)});this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);this._lastServerQuery=e.mixin({},n)}},_filterResponse:function(e){return e},_assertIsItem:function(e){if(!this.isItem(e))throw new Error(this._className+": Invalid item argument.")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error(this._className+": Invalid attribute argument ('"+e+"').")},fetchItemByIdentity:function(t){if(this._itemsByIdentity){var i=this._itemsByIdentity[t.identity];if(void 0!==i){if(t.onItem){var a=t.scope?t.scope:e.global;t.onItem.call(a,{i:i,r:this})}return}}var n={serverQuery:{id:t.identity}};this._fetchItems(n,function(i,a){var n=t.scope?t.scope:e.global;try{var o=null;i&&1==i.length&&(o=i[0]);t.onItem&&t.onItem.call(n,o)}catch(s){t.onError&&t.onError.call(n,s)}},function(i,a){var n=t.scope?t.scope:e.global;t.onError&&t.onError.call(n,i)})},getIdentity:function(e){return this._identifier===Number?e.n:e.i[this._identifier]},getIdentityAttributes:function(e){return[this._identifier]}})})},"dojox/main":function(){define(["dojo/_base/kernel"],function(e){return e.dojox})},"ebg/site/controlpanel":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.controlpanel",ebg.core.mainsitemodule,{constructor:function(){},onLoad:function(t){mainsite.setPageTitle("Control panel");$("jumpto").innerHTML;$("cp_go_to_table_id")&&e.connect($("cp_go_to_table_id"),"onkeyup",this,"onGoToTableCP");$("cp_go_to_table_id")&&e.connect($("cp_go_to_table_id"),"onclick",this,function(t){e.stopEvent(t)});$("cp_go_to_player_id")&&e.connect($("cp_go_to_player_id"),"onkeyup",this,"onGoToPlayerCP");$("cp_go_to_player_id")&&e.connect($("cp_go_to_player_id"),"onclick",this,function(t){e.stopEvent(t)});$("cp_studio_ssh_key_upload")&&e.connect($("cp_studio_ssh_key_upload"),"onclick",this,"onUploadKey")},onOnUnload:function(){},onUploadKey:function(){var e=$("cp_studio_ssh_key").value;""!=e?this.ajaxcall("/admin/studio/uploadKey.html",{key:btoa(e)},this,()=>this.showMessage("Done! Your key has been uploaded.","info")):this.showMessage("Please paste your key in the text input field","info")},onGoToTableCP:function(e){if("Enter"==e.key){e.preventDefault();gotourl("table?table="+$("cp_go_to_table_id").value+"&nr=true");$("cp_go_to_table_id")&&($("cp_go_to_table_id").value="")}},onGoToPlayerCP:function(e){if("Enter"==e.key){e.preventDefault();gotourl("player?id="+$("cp_go_to_player_id").value);$("cp_go_to_player_id")&&($("cp_go_to_player_id").value="")}}})})},"ebg/site/doc":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.doc",ebg.core.mainsitemodule,{constructor:function(){this.currentPage=null},onLoad:function(e){mainsite.setPageTitle($("pagetitle").innerHTML);this.addTooltipToClass("wikimenu","",_("Go to the corresponding BGA wiki page, and edit it if you like."));if("contact"==e.pageid)gotourl("contact");else if("About_Board_Game_Arena"==e.pageid)gotourl("join?aboutmode");else if("Parrainage"==e.pageid)gotourl("sponsorship");else if("privacy"==e.pageid)gotourl("legal");else if(""==e.pageid||"About_Board_Game_Arena"==e.pageid||"About_us"==e.pageid||"Club_Board_Game_Arena"==e.pageid||"Contact_us"==e.pageid||"Getting_started"==e.pageid||"Browser_support"==e.pageid||"Moderation_and_grades"==e.pageid||"Game_clock"==e.pageid||"Rating"==e.pageid||"Reputation"==e.pageid||"Translation_guidelines"==e.pageid||"Faq"==e.pageid||"Help"==e.pageid){alert(e.pageid);gotourl("faq")}},onOnUnload:function(){}})})},"ebg/site/gamegurus":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule","ebg/board"],function(e,t){return t("ebg.site.gamegurus",ebg.core.mainsitemodule,{gameId:null,constructor:function(){},onLoad:function(e){$("pagetitle")&&mainsite.setPageTitle($("pagetitle").innerHTML);this.newsfeed=new ebg.board;this.newsfeed.bStatusUpdate=!0;var t=document.querySelector(".gamegurus-newsfeed"),i=t?.getAttribute("data-group-id");i&&""!=i&&this.newsfeed.create(this,t,"group",i,!1)},onOnUnload:function(){}})})},"ebg/site/gameinprogress":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","ebg/lobby"],function(e,t,i){return t("ebg.site.gameinprogress",ebg.core.mainsitemodule,{constructor:function(){},doesNeedServerSideLoad:function(){return!1},onLoad:function(e){document.documentElement.classList.add("bga-white-background");mainsite.setPageTitle(_("Games in progress"));this.gamesInProgress=new i.ms.games.BgaPlayerProgressList({target:document.querySelector("#main-content")})},onOnUnload:function(){document.documentElement.classList.remove("bga-white-background");this.gamesInProgress&&this.gamesInProgress.$destroy()}})})},"ebg/lobby":function(){define(["dojo","dojo/_base/declare","ebg/pageheader","ebg/popindialog"],function(e,t){return t("ebg.lobby",null,{constructor:function(){this.page=null;this.div_id=null;this.div=null;this.carousel_position=0;this.tables=null;this.gamefilter=null;this.playerfilter=null;this.popindialog=null;this.jstpl_table_wrap='<div id="gametable_${id}" class="gametable_game_${game_id} relative z-0"></div>';this.jstpl_table='<div id="gametableblock_${id}" class="gametable gametable_status_${status}"><div class="gametable_colored_indicator"></div><a href="${game_url}" class="gametablelink"></a><div class="gametable_content"><div class="gametable_upper_part"><div class="gameinfo"><img src="${game_icon_url}" class="game_icon" alt=""/></div><div class="gametable_upper_part_right"><div class="gametable_infos"><div class="gameinfoname"><span class="gamename">${game_name_displayed}</span></div></div><div class="table_top_status smalltext"><div class="cannotJoinTableText" id="cannotJoinTable_${id}">'+_("You cannot join this table")+'</div><div class="suggestion_wrap"><div class="icon20 icon20_suggestion"></div> '+_("You've been suggested to join this table")+'<div class="suggestion_refuse"><a class="bga-link" href="#" id="suggest_wannaplay_remove_${id}_${game_id}">['+_("I don't want to play ${game_name_displayed} now")+']</a></div></div><b class="table_status_detailled">${status_detailled}</b><span class="table_status_separator"> &bull; </span>${table_date_info}<div class="table_top_status_detailed"><div>${filters}</div><div class="game_presentation">${presentation}</div><div class="smalltext">${optionstxt}</div></div></div></div></div><span id="gametable_game_url_${id}" style="display:none;">${game_url}</span><div class="clear gametable_separator"></div><div class="players" id="players_table_${id}"></div><div class="clear"/></div></div>';this.jstpl_player_table='<div id="tableplace_${table_id}_${player_id}" class="tableplace smalltext ${tableplaceclass}"><a href="player?id=${player_id}" title="${player_name}"  ><div class="emblemwrap ${emblem_class}"><img src="${player_avatar}" alt="" class="emblem" /><div class="emblempremium"></div></div></a><div class="player_name_wrap"><a href="player?id=${player_id}" class="playername">${player_name}</a><br/><span class="playersummary">${player_summary}</span></div></div>';this.jstpl_player_table_free='<div class="tableplace smalltext tableplace_${freeplacetype}"><div class="emblemwrap"><div class="emblem ${freeplacetype}"></div></div><div class="player_name_wrap"><span class="player_name">${text}</span><br/></div></div>';this.jstpl_wannaplay_item='<div id="wannaplay_${id}" class="wannaplay_item ${howtoplay}"><div class="game_box_image_wrap"></div><div id="button_play_${id}" class="icon20 icon20_play wannaplay_play"></div> <div class="wannaplay_gamename gamename"><div class="gamenameinner">${name}</div></div><div id="wannaplay_remove_${id}" class="icon20 icon20_remove wannaplay_remove"></div><div class="quick_howtoplay"><a href="/gamepanel?id=${id}#how-to-play">'+_("How to play?")+"</a></div></div>";this.notifqueue=new ebg.gamenotif;this.table_to_status={};this.games_to_category={};this.table_to_location={};this.mode="normal";this.displayAllTables=!1;this.bDoNotSaveConfig=!1;this.evtScroll=null;this.evtResize=null},create:function(t,i){this.page=t;e.query(".wannaplay_item").forEach(e.hitch(this,function(e){var t=e.id.substr(10);this.setupGameWannaplayItem(t)}));this.gamefilter=void 0!==i?i:mainsite.gamefilter;var a={status:"open"};if("inprogress"==this.mode){a.status="play";if(this.displayAllTables){a.status="playall";var n=0;for(var o in this.gamefilter)n++;1==n&&(a.game=o)}}if(null!==this.playerfilter){delete a.status;a.playerfilter=this.playerfilter;e.style("gamelist_gameselect","display","none")}this.page.ajaxcall("/tablemanager/tablemanager/tableinfos.html",a,this,function(e){this.reloadGameTables(e.tables,e.tableorder,e.suggestions)});this.page.register_subs(e.subscribe("tablemanagerInfosChanged",this,"onTableInfosChanged"));this.page.register_subs(e.subscribe("tablesuggest",this,"onTableSuggest"));this.page.register_subs(e.subscribe("updateWannaPlay",this,"onUpdateWannaPlay"));this.updateHelpMessageVisibility();e.query(".carousel_control").connect("onclick",this,"onCarouselControl");var s=$("wannaplay_in_order").innerHTML;s=s.split(",");for(var r in s){o=s[r];"wannaplay"!=this.games_to_category[o]&&this.moveGameSummary(o,!0)}e.connect($("game_wannaplay_add"),"onclick",this,"onDisplayDrowdown");e.connect($("close_wannaplay_mask"),"onclick",this,"onHideDropdown");e.subscribe("updateActivePlayers",this,"updateActivePlayers");this.updateGameMode();e.query(".display_cannot_join").connect("onclick",function(t){e.stopEvent(t);e.query(".display_cannot_join").style("display","none");e.query(".cannot_join_group").style("display","block")});if("inprogress"==this.mode){e.parser.parse();this.div=$("gamelist_gameselect");this.div.value=_("Start typing a game name");e.connect(this.div,"onfocus",this,function(e){this.div.value=""});e.connect(dijit.byId("gamelist_gameselect"),"onChange",this,"onGoToGame")}e.query(".sectiontitle_dropdown_command").connect("onclick",this,function(t){e.stopEvent(t);var i=t.currentTarget.parentNode.id;e.query("#"+i+" .sectiontitle_dropdown_menu").toggleClass("sectiontitle_dropdown_menu_visible")});this.closeLobbyMenu=e.connect($("overall-content"),"onclick",this,function(t){e.query(".sectiontitle_dropdown_menu_visible").removeClass("sectiontitle_dropdown_menu_visible")});mainsite.updateAsyncCounters()},unload:function(){e.disconnect(this.closeLobbyMenu);dijit.byId("gamelist_gameselect")&&dijit.byId("gamelist_gameselect").destroy();if(null!==this.evtScroll){e.disconnect(this.evtScroll);this.evtScroll=null}if(null!==this.evtResize){e.disconnect(this.evtResize);this.evtResize=null}},onStartNewGame:function(t){e.stopEvent(t);localStorage.setItem("bga-lobby-type","old");var i=t.currentTarget.id.substr(12),a=$("playing_mode").innerHTML;this.page.ajaxcall("/table/table/createnew.html",{game:i,gamemode:a,is_meeting:!1},this,function(t){if(t.table){t.table;var a=t.table;e.publish("gotourl",[{module:"table",args:{table:a,tb:t.forceTB,nr:!0}}])}else t.mmstarted&&gotourl("lobby?game="+i)})},promptToActivateNotifications:function(){if("Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window){this.popindialog=new ebg.popindialog;this.popindialog.create("notifications_prompt","main-content");this.popindialog.setTitle(_("Would you like to enable web notifications?"));var t='<br>                    <img src="'+getStaticAssetUrl("img/mainsite/prompt_webpush.png")+'" class="standard_popin_right_image"></img>                    {NOTIFICATIONS_PRESENTATION}<br/><br />                    {NOTIFICATIONS_ACTIVATION_INFO}<br/><br/>                    <div class="clear" style="text-align:center">                        <a href="#" id="notifications_prompt_notnow" class="bgabutton bgabutton_gray bgabutton_always_big">'+_("Maybe later")+'</a>                        <a href="#" id="notifications_prompt_enable" class="bgabutton bgabutton_blue bgabutton_always_big">'+_("Yes, please!")+'</a>                        <br /><a href="#" id="notifications_prompt_notagain">'+_("I'm not interested, please do not ask me again")+"</a>                    </div>";t=(t=t.replace("{NOTIFICATIONS_PRESENTATION}",_("Web notifications allow to display notifications on your device through your browser. This is especially useful if you like to multitask or play turn-based games."))).replace("{NOTIFICATIONS_ACTIVATION_INFO}",_("You can test notifications and finetune events you want to be notified about in <a href='${url}' target='_blank'>your account preferences</a>.").replace("${url}","/preferences?section=notifications"));this.popindialog.setContent(t);this.popindialog.show();e.connect($("notifications_prompt_enable"),"onclick",this,function(t){e.stopEvent(t);this.popindialog.destroy();this.page.setupWebPush().then(e.hitch(this,function(){this.page.ajaxcall("/player/profile/setNotificationPreference.html",{type:"webNotifications",value:1},this,function(){this.page.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})})).then(null,e.hitch(this,function(e){console.error(e);this.page.showMessage(__("lang_mainsite","We haven't been able to setup notifications! Did you confirm authorization when prompted by the browser?"),"error")}))});e.connect($("notifications_prompt_notnow"),"onclick",this,function(t){e.stopEvent(t);this.popindialog.destroy()});e.connect($("notifications_prompt_notagain"),"onclick",this,function(t){e.stopEvent(t);this.page.ajaxcall("/player/profile/setNotificationPreference.html",{type:"webNotifications",value:2},this,function(){this.page.showMessage(__("lang_mainsite","Profile informations updated !"),"info");this.popindialog.destroy()})})}},onRemoveFromMyGames:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[4];this.page.ajaxcall("/lobby/lobby/wannaplay.html",{game:i,wanna:0},this,function(e){this.moveGameSummary(i,!1)})},onRemoveFromMyGamesButton:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(17);this.page.ajaxcall("/lobby/lobby/wannaplay.html",{game:i,wanna:0},this,function(e){this.moveGameSummary(i,!1)})},onUpdateWannaPlay:function(e){this.moveGameSummary(e.args.game,e.args.wanna)},updateGameTextFilterInvite:function(){"none"==e.style("game_wannaplay_add_dropdown_wrap","display")?e.style("game_wannaplay_add_invite_filter","display","none"):""==$("wannaplay_textfilter").value?e.style("game_wannaplay_add_invite_filter","display","block"):e.style("game_wannaplay_add_invite_filter","display","none")},onDisplayDrowdown:function(t){e.style("game_wannaplay_add_dropdown_wrap","display","block");e.style("wannaplay_textfilter","display","block");e.style("close_wannaplay_mask","display","block");$("wannaplay_textfilter").focus();$("wannaplay_textfilter").value="";e.query(".filtered").removeClass("filtered");this.updateGameTextFilterInvite()},onHideDropdown:function(t){if("block"==e.style("game_wannaplay_add_dropdown_wrap","display")){e.style("game_wannaplay_add_dropdown_wrap","display","none");e.style("wannaplay_textfilter","display","none");e.style("close_wannaplay_mask","display","none");this.updateGameTextFilterInvite()}},onCarouselControl:function(t){e.stopEvent(t);var i=520,a=e.query(".game_suggestion").length*i;if("carousel_left"==t.currentTarget.id){this.carousel_position+=i;this.carousel_position>0&&(this.carousel_position=-a+i)}else{this.carousel_position-=i;this.carousel_position<=-a&&(this.carousel_position=0)}e.fx.slideTo({node:"suggestion_carousel_slider",top:0,left:this.carousel_position,delay:0,duration:200,unit:"px"}).play()},onClickWannaLearn:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(12);gotourl("gamepanel?game="+$("game_name_"+i).innerHTML)},setupGameWannaplayItem:function(t){e.connect($("button_play_"+t),"onclick",this,"onStartNewGame");e.connect($("wannaplay_remove_"+t),"onclick",this,"onRemoveFromMyGamesButton");this.page.addTooltip("button_play_"+t,"",_("Start a new table of this game"));this.page.addTooltip("wannaplay_remove_"+t,"",_("Remove from My Games"))},reloadGameTables:function(t,i,a){$("gametables_wannaplay")&&e.empty("gametables_wannaplay");$("gametables_wannaplay_cantjoin")&&e.empty("gametables_wannaplay_cantjoin");$("gametables_wannaplay_turnbased")&&e.empty("gametables_wannaplay_turnbased");$("gametables_other")&&e.empty("gametables_other");$("gametables_other_turnbased")&&e.empty("gametables_other_turnbased");$("gametables_other_cantjoin")&&e.empty("gametables_other_cantjoin");$("gametables_other_turnbased_cantjoin")&&e.empty("gametables_other_turnbased_cantjoin");$("gametables_yours")&&e.empty("gametables_yours");$("gametables_yours_realtime")&&e.empty("gametables_yours_realtime");this.table_to_status={};this.tables_not_displayed={};this.tables_not_displayed_order=[];var n=0;for(var o in i){var s=i[o];if(void 0!==t[s]){var r=t[s],l=this.getTableLocation(r),d="last";if("inprogress"==this.mode)var c="gametables_yours_realtime"==l||"gametables_yours"==l;else c="gametables_wannaplay"==l||"gametables_wannaplay_cantjoin"==l||"gametables_wannaplay_turnbased"==l||"gametables_wannaplay_turnbased_cantjoin"==l;if(c||n<1){void 0!==r.players[current_player_id]&&"inprogress"!=this.mode&&(d="first");e.place(this.page.format_string(this.jstpl_table_wrap,{id:r.id,game_id:r.game_id}),l,d);this.table_to_location[r.id]=l;this.display_table(r)&&!c&&n++}else{this.tables_not_displayed[r.id]=r;this.tables_not_displayed_order.push(r.id)}}}for(o in a)this.suggestTable(a[o]);this.updateGameCounters();this.updateActivePlayers();this.checkNeedMoreTables();this.evtScroll=e.connect(window,"onscroll",this,"checkNeedMoreTables");this.evtResize=e.connect(window,"onresize",this,"checkNeedMoreTables")},getTargetForOtherTablesInThisDisplay:function(){return"inprogress"==this.mode?"gametables_inprogress_all":"realtime"==$("playing_mode").innerHTML?"gametables_other":"async"==$("playing_mode").innerHTML?"gametables_other_turnbased":void 0},checkNeedMoreTables:function(){var t=e.window.getBox(),i=e.position("lobby_tag_display_more_tables"),a=0,n=this.getTargetForOtherTablesInThisDisplay();if(i.y>0&&i.y<t.h){for(var o=[],s=[];this.tables_not_displayed_order.length>0;){var r=this.tables_not_displayed_order.shift();if(void 0!==this.tables_not_displayed[r]){var l=!1,d=this.tables_not_displayed[r],c=this.getTableLocation(d);if(""==n||c==n||c==n+"_cantjoin"){e.place(this.page.format_string(this.jstpl_table_wrap,{id:d.id,game_id:d.game_id}),c,"last");this.table_to_location[d.id]=c;if(l=this.display_table(d)){o.push(r);if(++a>20)break}}l||s.push(r)}}for(var u in o)delete this.tables_not_displayed[o[u]];for(var u in s)this.tables_not_displayed_order.unshift(s[u]);if("inprogress"===this.mode&&Object.keys(this.tables_not_displayed).length+Object.keys(this.table_to_location).length>=1e3&&!$("gametables_inprogress_all").querySelector("p[tableslimitreached]")){var h=document.createElement("p"),p=document.createTextNode("All tables are not listed here.");h.setAttribute("tableslimitreached",!0);h.appendChild(p);$("gametables_inprogress_all").appendChild(h)}}},ensureTableIsDisplayed:function(t){if(void 0!==this.tables_not_displayed&&this.tables_not_displayed[t]){var i=this.tables_not_displayed[t],a=this.getTableLocation(i);e.place(this.page.format_string(this.jstpl_table_wrap,{id:i.id,game_id:i.game_id}),a,"last");this.table_to_location[i.id]=a;this.display_table(i);delete this.tables_not_displayed[t]}},display_table:function(t){t.id;$("gametable_"+t.id)&&e.empty("gametable_"+t.id);if(1==t.destroyed)return!1;if(!this.gamefilter[t.game_id])return!1;if(null!==this.playerfilter&&void 0===t.players[this.playerfilter])return!1;if("inprogress"!=this.mode){t.join_visibility="block";t.see_visibility="none"}else{t.join_visibility="none";t.see_visibility="block"}if("play"==t.status||"asyncplay"==t.status){var i=$("gameserver_url").innerHTML;t.game_url=i+"/"+t.gameserver+"/"+t.game_name+"?table="+t.id;this.getTableLocation(t);if("gametables_yours"==this.getTableLocation(t)||"gametables_yours_realtime"==this.getTableLocation(t)){e.style("no_game_in_progress","display","none");e.style("some_game_in_progress","display","block")}}else t.game_url="/table?table="+t.id+"&nr=true";var a=new Date;"play"==t.status||"asyncplay"==t.status?t.table_date_info=e.string.substitute(_("Game started ${time}"),{time:date_format(t.gamestart,!1)}):t.scheduled<=a.getTime()/1e3?t.table_date_info=e.string.substitute(_("Created ${time}"),{time:date_format(t.scheduled,!1)}):t.table_date_info=e.string.substitute(_("Game starts ${time}"),{time:date_format(t.scheduled,!0)});var n="";n=20!=t.options[200]?t.options[200]<=12?" ("+_("Fast turn-based")+")":" ("+_("turn-based")+")":" ("+_("No time limit")+")";t.status_detailled="";if("open"==t.status)$("opt_t_t_"+t.options[200])?1==t.options[201]?t.status_detailled=_("Open for joining")+" ("+_("Training mode")+")":t.status_detailled=_("Open for joining")+" ("+$("opt_t_t_"+t.options[200]).innerHTML+")":t.status_detailled=_("Open for joining")+" ("+_("realtime")+")";else if("setup"==t.status)t.status_detailled=_("Game is about to start");else if("play"==t.status)t.status_detailled=_("Game in progress")+" ("+_("realtime")+")";else if("asyncplay"==t.status)t.status_detailled=_("Game in progress")+n;else if("finished"==t.status)t.status_detailled=_("Game has ended");else if("meeting"==t.status)t.status_detailled=_("Meeting");else if("asyncopen"==t.status)if($("opt_t_t_"+t.options[200]))if(1==t.options[201])t.status_detailled=_("Open for joining")+" ("+_("Training mode")+")";else if(void 0!==t.options[206]&&0!=t.options[206]){var o=toint(t.options[206])-1+":00",s=mainsite.playingHoursToLocal(o,!0);t.status_detailled=_("Open for joining")+" ("+$("opt_t_t_"+t.options[200]).innerHTML+" "+e.string.substitute(_("between ${start_hour} and ${end_hour}"),s)+")"}else t.status_detailled=_("Open for joining")+" ("+$("opt_t_t_"+t.options[200]).innerHTML+")";else t.status_detailled=_("Open for joining")+" ("+_("turn-based")+")";else"init"==t.status||"asyncinit"==t.status?t.status_detailled=_("You did not open this table for joining yet"):"tournamentopen"==t.status?t.status_detailled=_("Tournament game is ready to start"):"tournamentmeeting"==t.status&&(t.status_detailled=_("Planned tournament game"));if("First game on BGA"==t.presentation&&e.query("#game_know_wrapper #game_beacon_"+t.game_id+"_0").length>0){t.presentation=e.string.substitute(_("First game on BGA: help this player to discover BGA and get ${points}!"),{points:'3<div class="icon20 icon20_gift2"></div>'})}else t.presentation=this.page.nl2br(t.presentation,!1);2==t.options[201]&&(t.presentation+="<div  style='margin-bottom: 8px;'><div class='icon20 icon_arena imgtext'></div> "+_("Arena mode")+"</div>");void 0!==t.reputation_filter.label&&(t.reputation_filter=t.reputation_filter.label);void 0!==t.level_filter.label&&(t.level_filter=t.level_filter.label);t.filters=this.page.format_string_recursive(t.level_filter.log,t.level_filter.args);if(""!=t.reputation_filter){""!=t.filters&&(t.filters+=", ");t.filters+=t.reputation_filter}if(null!==t.filter_group){""!=t.filters&&(t.filters+=", ");var r=!1;"public"!=t.filter_group_visibility&&"member"==t.filter_group_visibility&&1!==mainsite.groupList[t.filter_group]&&(r=!0);t.filter_group_label="";r?t.filter_group_label="("+_("private group")+")":"normal"==t.filter_group_type?t.filter_group_label=t.filter_group_name:"friend"==t.filter_group_type&&(t.filter_group_label=e.string.substitute(_("${player}'s friends"),{player:t.filter_group_name}));t.filters+=t.filter_group_label}if(null!==t.filter_lang){""!=t.filters&&(t.filters+=", ");t.filters+=t.filter_lang_label}t.optionstxt="";for(var l in t.options){var d=t.options[l];"object"==typeof d&&(d=d.value);var c="opt_"+t.game_id+"_"+l+"_"+d;if($(c)){""!=t.optionstxt&&(t.optionstxt+=", ");var u=_("gameoptions_"+t.game_id+"_"+$(c).value);u=u.replace("gameoptions_"+t.game_id+"_","");t.optionstxt+=u}}t.game_name_displayed=this.page.getGameNameDisplayed(t.game_name);t.game_icon_url=getMediaUrl(t.game_name,"icon");t.game_version=mainsite.gamefilter[t.game_id];null===t.game_version&&(t.game_version="current");var h=this.page.format_string(this.jstpl_table,t);e.place(h,"gametable_"+t.id);t.id,t.id;var p=0;e.removeClass("gametable_"+t.id,"player_is_at_table");for(player_display_index in t.player_display){var m=t.player_display[player_display_index],g=t.players[m];if(void 0===g){var f="ERROR (please report to contact@boardgamearena.com) : Found player "+m+" in player_display for table "+t.id+" that is not present in table.player";console.error(f);console.error(g);this.page.showMessage(f,"only_to_log")}else{var b="";0==g.ranksummary?b=_("Beginner"):1300==g.ranksummary?b=_("Apprentice"):1400==g.ranksummary?b="":1500==g.ranksummary?b=_("Good player"):1600==g.ranksummary?b=_("Strong player"):1800==g.ranksummary?b=_("Expert"):2e3==g.ranksummary&&(b=_("Master"));var y="";"expected"==g.table_status&&(y="tableplace_expected");var v="";1==g.is_premium&&(v="is_premium");var w=this.page.format_string(this.jstpl_player_table,{player_id:g.id,table_id:t.id,player_name:g.fullname,player_avatar:getPlayerAvatar(g.id,g.avatar,32),player_summary:b,tableplaceclass:y,emblem_class:v});e.place(w,"players_table_"+t.id);if($("availableplayertable_"+g.id)){$("availableplayertable_"+g.id).innerHTML=t.game_name_displayed+" n"+t.id;e.style("availableplayertable_"+g.id,"display","block")}g.id==current_player_id&&"expected"!=g.table_status&&e.addClass("gametable_"+t.id,"player_is_at_table");p++}}this.reconnect_table(t.id,t.game_id);if("open"==t.status||"meeting"==t.status||"asyncopen"==t.status)for(;p<t.max_player;){p++;var x="freeplace",k="("+_("Free")+")";if(p>t.min_player){x="freeplaceopt";k="("+_("Free")+")"}e.place(this.page.format_string(this.jstpl_player_table_free,{freeplacetype:x,text:k}),"players_table_"+t.id)}1!=toint(t.max_player)||"open"!=t.status&&"meeting"!=t.status&&"asyncopen"!=t.status||e.addClass("gametable_"+t.id,"soloGameTable");var C=this.table_to_status[t.id];void 0!==C?"normal"==this.mode?"open"!=C&&"setup"!=C&&"asyncopen"!=C||"open"==t.status||"setup"==t.status||"asyncopen"==t.status||e.fx.wipeOut({node:"gametable_"+t.id,duration:500,onEnd:e.hitch(this,function(){e.destroy("gametable_"+t.id)})}).play():"inprogress"==this.mode&&("play"!=C&&"asyncplay"!=C||"play"==t.status||"asyncplay"==C||e.fx.wipeOut({node:"gametable_"+t.id,duration:500,onEnd:e.hitch(this,function(){e.destroy("gametable_"+t.id)})}).play()):"normal"!=this.mode||"play"!=t.status&&"asyncplay"!=t.status&&"finished"!=t.status||e.destroy("gametable_"+t.id);this.table_to_status[t.id]=t.status;this.updateTableCanJoinStatus(t);return!0},reconnect_table:function(t,i){$("suggest_wannaplay_remove_"+t+"_"+i)&&e.connect($("suggest_wannaplay_remove_"+t+"_"+i),"onclick",this,"onRemoveFromMyGames")},suggestTable:function(t){this.ensureTableIsDisplayed(t);$("gametable_"+t)&&e.addClass("gametable_"+t,"suggestedtable")},onTableInfosChanged:function(t){var i=t.args;void 0===i.filter_group&&(i.filter_group=null);void 0===i.filter_group_name&&(i.filter_group_name=null);void 0===i.filter_group_visibility&&(i.filter_group_visibility=null);void 0===i.filter_group_type&&(i.filter_group_type=null);void 0===i.filter_lang&&(i.filter_lang=null);void 0===i.presentation&&(i.presentation="");void 0===i.level_filter&&(i.level_filter={label:{log:"",args:[]}});void 0===i.level_filter_r&&(i.level_filter_r=127);void 0===i.reputation_filter&&(i.reputation_filter={label:"",details:{opinion:0,leave:0,clock:0,karma:0}});void 0===i.reputation_filter_r&&(i.reputation_filter_r=0);void 0===i.gameserver&&(i.gameserver=0);void 0===i.progression&&(i.progression=0);this.ensureTableIsDisplayed(i.id);if($("gametable_"+i.id))this.display_table(i);else if("finished"!=i.status&&("normal"==this.mode||"inprogress"==this.mode&&("play"==i.status||"asyncplay"==i.status))){var a=this.getTableLocation(i);e.place(this.page.format_string(this.jstpl_table_wrap,{id:i.id,game_id:i.game_id}),a,"first");this.table_to_location[i.id]=a;this.display_table(i);if($("gametable_"+i.id)){e.style("gametable_"+i.id,"display","none");e.fx.wipeIn({node:"gametable_"+i.id,duration:500}).play()}}this.updateGameCounters()},onTableSuggest:function(e){e.args.suggested_id==current_player_id&&this.suggestTable(e.args.table_id)},getTableLocation:function(e){if("inprogress"==this.mode)return this.displayAllTables?"gametables_inprogress_all":e.players[current_player_id]?"play"==e.status||"open"==e.status||"init"==e.status?"gametables_yours_realtime":"playasync"==e.players[current_player_id].table_status?"gametables_yours":"gametables_other_turnbased":"play"==e.status?"gametables_other":"gametables_other_turnbased";var t="";""!=this.canIJoinTable(e)&&(t="_cantjoin");return void 0!==this.games_to_category[e.game_id]?"asyncopen"!=e.status&&"asyncinit"!=e.status?"gametables_"+this.games_to_category[e.game_id]+t:"gametables_"+this.games_to_category[e.game_id]+"_turnbased"+t:"asyncopen"!=e.status&&"asyncinit"!=e.status?"gametables_other"+t:"gametables_other_turnbased"+t},updateGameCounters:function(){},updateHelpMessageVisibility:function(){e.query("#wannaplay_gamelist_content .wannaplay_item").length>0?e.style("sectionhelp_wannaplay","display","none"):e.style("sectionhelp_wannaplay","display","block")},moveGameSummary:function(t,i,a){void 0===a&&(a=!1);if(i&&"wannaplay"==this.games_to_category[t]){e.fx.chain([e.fadeOut({node:$("wannaplay_"+t)}),e.fadeIn({node:$("wannaplay_"+t)}),e.fadeOut({node:$("wannaplay_"+t)}),e.fadeIn({node:$("wannaplay_"+t)})]).play()}else{i&&"1";if(i){var n=e.query(".add_wannaplay_"+t),o="";if($("add_wannaplay_k_"+t));else o="howtoplay";if($("gamename_"+t)){var s=$("gamename_"+t).innerHTML;e.place(this.page.format_string(this.jstpl_wannaplay_item,{id:t,name:n[0].innerHTML,gamename:s,players:$("initial_wannaplay_"+t).innerHTML,howtoplay:o,boxsize:$("wannaplay_icon_size").innerHTML}),"wannaplay_gamelist_content");n.addClass("wannaplay");$("game_suggestion_"+t)&&this.page.fadeOutAndDestroy("game_suggestion_"+t);if(a){e.fx.chain([e.fadeOut({node:$("wannaplay_"+t)}),e.fadeIn({node:$("wannaplay_"+t)}),e.fadeOut({node:$("wannaplay_"+t)}),e.fadeIn({node:$("wannaplay_"+t)})]).play()}this.setupGameWannaplayItem(t)}else console.error("cannot found game "+t)}else{e.destroy("wannaplay_"+t);e.query(".add_wannaplay_"+t).removeClass("wannaplay")}if(i){this.games_to_category[t]="wannaplay";var r=[];for(var l in this.tables_not_displayed){var d=this.tables_not_displayed[l];if(d.game_id==t){var c=this.getTableLocation(d);e.place(this.page.format_string(this.jstpl_table_wrap,{id:d.id,game_id:d.game_id}),c,"last");this.table_to_location[d.id]=c;this.display_table(d);r.push(l)}}for(var u in r)delete this.tables_not_displayed[r[u]];e.query(".gametable_game_"+t).forEach(e.hitch(this,function(i){var a="gametables_wannaplay";(e.query("#"+i.id+" .gametable_status_asyncopen").length>0||e.query("#"+i.id+" .gametable_status_asyncplay").length>0)&&(a="gametables_wannaplay_turnbased");e.hasClass(i,"cannotJoinTable")&&(a+="_cantjoin");var n=i.id.substr(10);this.table_to_location[n]=a;e.fx.wipeOut({node:i,duration:500,onEnd:e.hitch(this,function(i){var n=e.clone(i);e.destroy(i);e.place(n,a,"first");this.reconnect_table(i.id.substr(10),t);var o=e.fx.wipeIn({node:n.id,duration:500});e.connect(o,"onEnd",function(t){e.style(t.id,"overflow","visible")});o.play()})}).play()}))}else{this.games_to_category[t]="other";e.query(".gametable_game_"+t).forEach(e.hitch(this,function(i){var a="gametables_other";(e.query("#"+i.id+" .gametable_status_asyncopen").length>0||e.query("#"+i.id+" .gametable_status_asyncplay").length>0)&&(a="gametables_other_turnbased");e.hasClass(i,"cannotJoinTable")&&(a+="_cantjoin");var n=i.id.substr(10);this.table_to_location[n]=a;e.fx.wipeOut({node:i,duration:500,onEnd:e.hitch(this,function(i){var n=e.clone(i);e.destroy(i);e.place(n,a,"first");this.reconnect_table(i.id.substr(10),t);var o=e.fx.wipeIn({node:n.id,duration:500});e.connect(o,"onEnd",function(t){e.style(t.id,"overflow","visible")});o.play()})}).play()}))}this.updateHelpMessageVisibility();this.updateSuggestionPlace()}},updateSuggestionPlace:function(){var t=e.query("#wannaplay_gamelist_content .wannaplay_item").length;if(t>3){if(e.query("#suggestion_carousel_topright_wrap #suggestion_carousel").length>0){var i=e.clone($("suggestion_carousel"));e.destroy("suggestion_carousel");e.place(i,"suggestion_carousel_bottom_wrap");e.style("suggestion_carousel_topright_wrap","display","none");e.query(".carousel_control").connect("onclick",this,"onCarouselControl")}e.style("game_wannaplay_add","marginTop","2px")}else{if(e.query("#suggestion_carousel_bottom_wrap #suggestion_carousel").length>0){i=e.clone($("suggestion_carousel"));e.destroy("suggestion_carousel");e.place(i,"suggestion_carousel_topright_wrap");e.style("suggestion_carousel_topright_wrap","display","block");e.query(".carousel_control").connect("onclick",this,"onCarouselControl")}var a=10;t>0&&(a=30+141*t);e.style("suggestion_carousel_topright_wrap","marginLeft",a+"px");e.style("game_wannaplay_add","marginTop","20px")}0==e.query("#suggestion_carousel .game_suggestion").length?e.style("suggestion_carousel","display","none"):e.style("suggestion_carousel","display","block")},onGameModeChangeMobileSwitcher:function(t){"none"==e.style("pageheader_lobbymenunav","display")?e.style("pageheader_lobbymenunav","display","block"):"none"!=e.style("pageheader_mobile_switcher","display")&&e.style("pageheader_lobbymenunav","display","")},onGameModeChange:function(t){if("normal"==this.mode){if("pageheader_async"==t.currentTarget.id){var i=1,a=0;$("playing_mode").innerHTML="async"}else{i=0,a=1;$("playing_mode").innerHTML="realtime"}this.bDoNotSaveConfig||this.page.ajaxcall("/player/profile/setGameMode.html",{async:i,realtime:a},this,function(e){});this.updateGameMode()}else if("inprogress"==this.mode){var n="/lobby";"pageheader_async"==t.currentTarget.id?gotourl(n+"?mode=async"):gotourl(n+"?mode=realtime")}$("pageheader_lobbymenunav")&&e.style("pageheader_lobbymenunav","display","")},updateGameMode:function(){var t=$("playing_mode").innerHTML;e.removeClass("gamelobby_inner",["mask_async","mask_realtime"]);e.removeClass("gamelobby-module","gamemode_async gamemode_realtime");if("realtime"==t){e.addClass("gamelobby_inner","mask_async");e.addClass("gamelobby-module","gamemode_realtime");"inprogress"!=this.mode&&e.addClass("pageheader_realtime","pageheader_menuitemselected");"inprogress"!=this.mode&&($("pageheader_lobbymenunav_wrap").scrollLeft=0)}if("async"==t){e.addClass("gamelobby_inner","mask_realtime");e.addClass("gamelobby-module","gamemode_async");"inprogress"!=this.mode&&e.addClass("pageheader_async","pageheader_menuitemselected");"inprogress"!=this.mode&&($("pageheader_lobbymenunav_wrap").scrollLeft=220)}},updateActivePlayers:function(){if("inprogress"==this.mode){e.query(".tableplace_activeplayer").removeClass("tableplace_activeplayer");e.query(".tableplace_activeplayer_current").removeClass("tableplace_activeplayer_current");e.query(".tableplace_activeplayer_clockalert").removeClass("tableplace_activeplayer_clockalert");e.query(".tableplace_activeplayer_clockalert_current").removeClass("tableplace_activeplayer_clockalert_current");for(var t in mainsite.asyncTableInfos)for(var i in mainsite.asyncTableInfos[t].actives)if("asyncplay"==mainsite.asyncTableInfos[t].status){var a=mainsite.asyncTableInfos[t].actives[i],n=0;mainsite.asyncTableInfos[t].over_times&&mainsite.asyncTableInfos[t].over_times[i]&&1==mainsite.asyncTableInfos[t].over_times[i]&&(n=1);toint(a)==toint(current_player_id)?$("tableplace_"+t+"_"+a)&&(0==n?e.addClass("tableplace_"+t+"_"+a,"tableplace_activeplayer_current"):e.addClass("tableplace_"+t+"_"+a,"tableplace_activeplayer_clockalert_current")):$("tableplace_"+t+"_"+a)&&(0==n?e.addClass("tableplace_"+t+"_"+a,"tableplace_activeplayer"):e.addClass("tableplace_"+t+"_"+a,"tableplace_activeplayer_clockalert"))}}},onGoToGame:function(e){var t=dijit.byId("gamelist_gameselect").get("value").substr(11);gotourl("gametables?game="+t)},canIJoinTable:function(t){if("open"==t.status||"asyncopen"==t.status||"setup"==t.status){if(current_player_id<0)return"";if(void 0!==t.players[current_player_id])return"";if(t.current_player_nbr>=t.max_player)return _("There is no place left at this table");var i=Math.floor(t.reputation_filter_r/64);if(i>0&&toint($("opt_k_k_k").innerHTML)<{0:0,1:50,2:65,3:75,4:85}[i])return _("Your reputation is not high enough for this table");if(127!=t.level_filter_r){if($("opt_"+t.game_id+"_r_r")){var a=$("opt_"+t.game_id+"_r_r").innerHTML;n=a>=2e3?64:a>=1800?32:a>=1600?16:a>=1500?8:a>=1400?4:a>1300?2:1}else var n=1;if(!(t.level_filter_r&n))return _("Your cannot join this table due to your level")}if(t.filter_group&&void 0===mainsite.allGroupList[t.filter_group]){void 0===t.filter_group_label&&(t.filter_group_label="");return e.string.substitute(_("Only members of `${group}` can join this table"),{group:t.filter_group_label})}if(t.filter_lang&&void 0===mainsite.allLanguagesList[t.filter_lang]){void 0===t.filter_lang_label&&(t.filter_lang_label="");return e.string.substitute(_("Only players speaking `${lang}` can join this table"),{lang:t.filter_lang_label})}for(var o in t.players){if(void 0!==mainsite.red_thumbs_given[o])return _("You added one participant to your blacklist (red thumb)");if(void 0!==mainsite.red_thumbs_taken[o])return _("One participant added you to his/her blacklist (red thumb)")}}return""},updateTableCanJoinStatus:function(t){var i=this.canIJoinTable(t);if(""!=i){if($("gametable_"+t.id)){$("cannotJoinTable_"+t.id).innerHTML='<i class="fa fa-ban" aria-hidden="true"></i> '+i;e.addClass("gametable_"+t.id,"cannotJoinTable");if(void 0!==this.table_to_location[t.id]&&"_cantjoin"!=this.table_to_location[t.id].slice(-9)){target=this.table_to_location[t.id]+"_cantjoin";var a=t.id;this.table_to_location[a]=target;e.fx.wipeOut({node:"gametable_"+a,duration:500,onEnd:e.hitch(this,function(i){var n=e.clone(i);e.destroy(i);e.place(n,target,"first");this.reconnect_table(a,t.game_id);var o=e.fx.wipeIn({node:n.id,duration:500});e.connect(o,"onEnd",function(t){e.style(t.id,"overflow","visible")});o.play()})}).play()}}}else if($("gametable_"+t.id)){e.removeClass("gametable_"+t.id,"cannotJoinTable");if(void 0!==this.table_to_location[t.id]&&"_cantjoin"==this.table_to_location[t.id].slice(-9)){target=this.table_to_location[t.id].slice(0,-9);a=t.id;this.table_to_location[a]=target;e.fx.wipeOut({node:"gametable_"+a,duration:500,onEnd:e.hitch(this,function(i){var n=e.clone(i);e.destroy(i);e.place(n,target,"first");this.reconnect_table(a,t.game_id);var o=e.fx.wipeIn({node:n.id,duration:500});e.connect(o,"onEnd",function(t){e.style(t.id,"overflow","visible")});o.play()})}).play()}}}})})},"ebg/pageheader":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.pageheader",null,{constructor:function(){this.page=null;this.div_id=null;this.adaptsubtrigger=null;this.bDisableAdaptMenu=!1;this.bUpdateQueryString=!1},create:function(t,i,a,n,o){this.page=t;this.div_id=i;this.buttons=a;this.bAllByDefault=n;this.bUpdateQueryString=void 0===o||o;n||this.hideAllSections();for(var s in a){var r=a[s];e.connect($(r.btn),"onclick",this,"onClickButton");void 0!==r.defaults&&r.defaults&&this.showSection(r.section,r.btn)}e.query("#"+i+" h2").connect("onclick",this,"onClickHeader");this.adaptsubtrigger=e.connect(window,"onresize",this,e.hitch(this,"adaptSubmenu"));this.adaptSubmenu()},destroy:function(){if(null!==this.adaptsubtrigger){e.disconnect(this.adaptsubtrigger);this.adaptsubtrigger=null}},adaptSubmenu:function(){if(!this.bDisableAdaptMenu&&$(this.div_id)){e.removeClass(this.div_id,"pageheader_menu_smallwidth");var t=null,i=!1;e.query("#"+this.div_id+" .pageheader_menuitem").forEach(function(a){if("none"!=e.style(a,"display")){var n=e.position(a);null===t?t=n.y:Math.abs(t-n.y)>10&&(i=!0)}});i&&e.addClass(this.div_id,"pageheader_menu_smallwidth")}},getSelected:function(){var t=e.query("#"+this.div_id+" .pageheader_menuitemselected");return 1!=t.length?null:t[0].id},getNumberSelected:function(){return e.query("#"+this.div_id+" .pageheader_menuitemselected").length},hideAllSections:function(){for(var t in this.buttons){e.query("#"+this.div_id+" .pageheader_menuitemselected").removeClass("pageheader_menuitemselected");if("object"==typeof this.buttons[t].section)for(var i in this.buttons[t].section)$(this.buttons[t].section[i])?e.style(this.buttons[t].section[i],"display","none"):console.error("pageheader coulnd find : "+this.buttons[t].section[i]);else $(this.buttons[t].section)?e.style(this.buttons[t].section,"display","none"):console.error("pageheader: "+this.buttons[t].section+" does not exists")}e.query("#"+this.div_id+" .pageheader_hide_if_not_active").style("display","none")},showDefault:function(){if(this.bAllByDefault){for(var t in this.buttons){if("object"==typeof(i=this.buttons[t]).section)for(var t in i.section)$(i.section[t])?e.style(i.section[t],"display","block"):console.error("pageheader coulnd find : "+i.section[t]);else e.style(i.section,"display","block")}e.query("#"+this.div_id+" .pageheader_menuitemselected").removeClass("pageheader_menuitemselected");e.query("#"+this.div_id+" .pageheader_hide_if_not_active").style("display","block");this.updateQueryString("")}else{this.hideAllSections();for(var t in this.buttons){var i;void 0!==(i=this.buttons[t]).defaults&&this.showSection(i.section,i.btn)}}},showSection:function(t,i){if(null!=t&&$(t))if("object"==typeof t)for(var a in t)e.style(t[a],"display","block");else e.style(t,"display","block");e.addClass(i,"pageheader_menuitemselected");this.updateQueryString(i);this.onSectionChanged()},onSectionChanged:function(){},onClickButton:function(t){e.stopEvent(t);this.showSectionFromButton(t.currentTarget.id)},showSectionFromButton:function(e){for(var t in this.buttons){var i=this.buttons[t];if(i.btn==e){this.hideAllSections();this.showSection(i.section,i.btn);void 0!==i.onShow&&i.onShow();void 0!==i.onHide&&i.onHide()}}},onClickHeader:function(e){this.showDefault()},updateQueryString:function(t){if(this.bUpdateQueryString){var i="",a=window.location.search,n=a.split("?");if(n.length>=2&&n[1].length>0){for(var o=1;o<n.length;o++){o>1&&(i+="%3F");i+=n[o]}module=n[0]}else module=a;var s=e.queryToObject(i);if(""===t||1!==this.getNumberSelected()){s.section=null;delete s.section}else s.section=t.substr(11);i=e.objectToQuery(s);var r=module;""!=i&&(r+="?"+i);if(window.location.search!=r&&"undefined"!=typeof mainsite){mainsite.disableNextHashChange=!0;history.pushState(null,"",window.location.pathname+r)}}}})})},"ebg/site/gamelist":function(){define(["dojo","dojo/_base/declare","svelte/index"],function(e,t,i){return t("ebg.site.gamelist",ebg.core.mainsitemodule,{constructor:function(){},doesNeedServerSideLoad:function(){return!1},onLoad:function(e){mainsite.setPageTitle(_("Games"));document.documentElement.classList.add("bga-white-background");this.gameBrowser=new i.ms.games.BgaGameBrowser({target:document.querySelector("#main-content")})},onOnUnload:function(){document.documentElement.classList.remove("bga-white-background");this.gameBrowser&&this.gameBrowser.$destroy()},onPopState:function(){if("/gamelist"!==window.location.pathname)throw new Error("Invalid page");this.gameBrowser&&this.gameBrowser.readFiltersFromUrl()}})})},"ebg/site/gamepanel":function(){define(["dojo","dojo/_base/declare","svelte/index"],function(e,t,i){return t("ebg.site.gamepanel",ebg.core.mainsitemodule,{constructor:function(){},doesNeedServerSideLoad:function(){return!1},onLoad:function(e){document.documentElement.classList.add("bga-white-background");this.gamePanel=new i.ms.games.BgaGamePanel({target:document.querySelector("#main-content"),props:{gameNameOrId:e.game||e.id,tableId:e.table}})},onOnUnload:function(){if(this.gamePanel&&!this.gamePanel.checkQuit())return!1;document.documentElement.classList.remove("bga-white-background");this.gamePanel&&this.gamePanel.$destroy()},onPopState:function(){window.location.pathname,window.location.hash;if("/gamepanel"!==window.location.pathname)throw new Error("Invalid page");if(this.gamePanel){const e=new URLSearchParams(window.location.search);this.gamePanel.gameNameOrId=e.get("game")||e.get("id");this.gamePanel.tableId=e.get("table");this.gamePanel.checkHash()}}})})},"ebg/site/gamereview":function(){define(["dojo","dojo/_base/declare","dojox/charting/Chart2D","dojox/charting/themes/Wetland","dojox/charting/widget/Legend","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.gamereview",ebg.core.mainsitemodule,{constructor:function(){this.game_name=null;this.chart=null;this.checkTimeout=null;this.checksNumber=0;this.checksMessages=null},onLoad:function(t){this.table_id=t.table;this.identity_id=t.player;const i=new URLSearchParams(window.location.search).get("reporterId");if(i){const e=document.getElementById(`choosePlayerLink_${i}`);e&&e.insertAdjacentText("beforeend",` (${_("Bug reporter")})`)}mainsite.setPageTitle($("reviewtitle").innerHTML);if(null!==$("not_allowed_beacon"))setTimeout("gotourl( 'club' )",2e3);else if(null!==$("temporarily_disabled_beacon"));else if(null!==$("loading_table_id")){this.ajaxcall("/gamereview/gamereview/requestTableArchive.html",{table:$("loading_table_id").value},this,function(e){if(1==e){null!==this.checkTimeout&&clearTimeout(this.checkTimeout);mainsite.gotourl_forcereload("gamereview?table="+$("loading_table_id").value)}});this.checksMessages=[];this.checksMessages.push(_("Igniting the time machine..."));this.checksMessages.push(_("Exploring the near and distant past..."));this.checksMessages.push(_("Enjoying a drink with King Arthur and the knights..."));this.checksMessages.push(_("Running with the dinosaurs..."));this.checksMessages.push(_("Checking on the big bang to be sure..."));e.connect($("waiting_tryagain"),"onclick",this,function(){mainsite.gotourl_forcereload("gamereview?table="+$("loading_table_id").value)});this.checkTimeout=setTimeout(e.hitch(this,function(){this.checkTableArchiveReady()}),5e3)}else{this.game_name=$("game_name").innerHTML;var a="dojo/i18n!ebg/nls/lang_"+this.game_name;""!=mainsite.jsbundlesversion&&(a+="-"+mainsite.jsbundlesversion);require([a],e.hitch(this,function(e){this.ajaxcall("/archive/archive/logs.html",{table:this.table_id,translated:!0},this,function(e){globalThis.g_i18n.loadBundle("lang_"+this.game_name).finally(()=>this.displayGameLog(e.logs,e.players))})}));e.query(".toggleArchiveComment").connect("onclick",this,"toggleArchiveComment");e.query(".choosePlayerLink").connect("onclick",this,"onChoosePlayer");e.connect($("display_time_on_logs"),"onchange",this,"onDisplayTimeOnLogs")}globalUserInfos.user_rights.includes("display_technical")&&e.query("#scroll_to_graph").connect("onclick",this,()=>{let e=document.getElementById("reflexion_time_section");e&&e.scrollIntoView&&e.scrollIntoView({behavior:"smooth",inline:"start"})})},checkTableArchiveReady:function(){this.ajaxcall("/gamereview/gamereview/checkTableArchiveReady.html",{table:$("loading_table_id").value},this,function(t){if(!0===t){null!==this.checkTimeout&&clearTimeout(this.checkTimeout);mainsite.gotourl_forcereload("gamereview?table="+$("loading_table_id").value)}else if(this.checksNumber<4){this.checksNumber++;null!==$("waiting_message")&&($("waiting_message").innerHTML=this.checksMessages[this.checksNumber]);this.checkTimeout=setTimeout(e.hitch(this,function(){this.checkTableArchiveReady()}),6e3)}else if(null!==$("waiting_message")){e.style("waiting_image","display","none");e.style("waiting_error_image","display","");$("waiting_message").innerHTML=_("Sorry, this archive has not been found.")+" "+_("Unfortunately, it may have been lost: it doesn't happen often, but it happens.");e.style("waiting_tryagain","display","")}})},onOnUnload:function(){this.unsubscribe_all();void 0!==this.legend&&this.legend.destroy();null!==this.checkTimeout&&clearTimeout(this.checkTimeout)},onDisplayTimeOnLogs:function(t){if($("display_time_on_logs").checked){e.query(".reflexiontimes_block").style("display","block");window.scroll(0,0)}else{e.query(".reflexiontimes_block").style("display","none");window.scroll(0,0)}},displayGameLog:function(t,i){let a=globalUserInfos.user_rights.includes("display_technical");globalThis.g_i18n.setActiveBundle("lang_"+this.game_name);var n="",o="",s=null,r=!1;this.chart=new dojox.charting.Chart2D("chart");var l={},d={},c={};i.forEach(e=>{c[e.id]=e.name});e.empty("gamelogs");var u={},h=null,p=null;for(var m in t){var g=t[m],f='<div class="smalltext">'+_("Move")+" "+g.move_id+" :",b=!1;if(s!=g.move_id){b=!0;s=g.move_id;r=!1}if(void 0!==g.time){var y=new Date(1e3*g.time);o=y.toLocaleDateString();f+=o!=n?'<span style="float: right"> '+o+" "+y.toLocaleTimeString()+" </span></div>":'<span style="float: right"> '+y.toLocaleTimeString()+" </span></div>"}else f+='<span style="float: right"> '+g.data[0].time+" GMT+1 </span></div>";for(var v in g.data){var w=g.data[v];if("gameStateChange"==w.type){var x="";for(var k in w.args.reflexion.total)if(null!==w.args.reflexion.total[k]){0;void 0===l[k]&&(l[k]=[]);var C=+w.args.reflexion.total[k];if(u[k]!==C){u[k]&&l[k].push({x:g.time,y:u[k]});l[k].push({x:g.time,y:C});u[k]=C}h=g.time;null===p&&(p=g.time);if(void 0===d[k]||d[k]!=w.args.reflexion.total[k]){var T=!0;void 0===d[k]?c[k]||(c[k]=$("playername_"+k).innerHTML):w.args.reflexion.total[k]<0&&(T=!1);d[k]=w.args.reflexion.total[k];value_color=T?"green":"red";var j=w.args.reflexion.total[k];let e=!a||T?"color:"+value_color+";":"background-color: "+value_color+"; color:white;font-weight:bold;";x+='<div class="reflexiontimes">'+c[k]+': <span style="'+e+'">'+this.formatReflexionTime(j).string+"</span></div>"}}if(""!=x){let t=a?"block":"none";e.place('<div class="reflexiontimes_block" style="display:'+t+'">'+x+"</div>","gamelogs")}}if(""!=w.log){if(!r){r=!0;e.place(f,"gamelogs")}var S='<div class="gamelogreview whiteblock">'+this.format_string_recursive(w.log,w.args)+"</div>";e.place(S,"gamelogs")}}r&&(n=o);b&&e.query(".archiveCommentPreview_move"+g.move_id).forEach(function(t){if(!r){r=!0;e.place(f,"gamelogs")}var i=e.clone(t);e.destroy(t);e.place(i,"gamelogs")})}for(var k in l)h&&u[k]&&l[k].push({x:h,y:u[k]});e.query(".archiveCommentPreview").style("display","none");globalThis.g_i18n.setActiveBundle("lang_mainsite");var M=null;this.chart.addPlot("default",{type:"Lines"}).addPlot("Grid",{type:"Grid",hAxis:"x",vAxis:"y",hMajorLines:!0,hMinorLines:!1,vMajorLines:!0,vMinorLines:!1}).addAxis("x",{fixLower:"major",fixUpper:"major",labelFunc:(e,t,i)=>t<p?" ":time_format(Math.round((t-p)/60))}).addAxis("y",{vertical:!0,fixLower:"major",fixUpper:"major",labelFunc:(e,t,i)=>{var a=mainsite.formatReflexionTime(t).string;if(a===M)return" ";M=a;return a}}).setTheme(dojox.charting.themes.Wetland);var A=0,E={};for(var k in l){var N=i.find(e=>e.id==k);if(!N){N={name:$("playername_"+k)?$("playername_"+k).innerHTML:"",id:k,color:"#000",avatar:null}}var L=N.color;E[L]&&(L=dojox.charting.themes.Wetland.colors[A]);"#ffffff"===L&&(L="#aaaaaa");this.chart.addSeries("&nbsp;"+N.name+"&nbsp;&nbsp;",l[k],{stroke:{color:L,width:3}}).render();A++;E[L]=!0}this.legend=new dojox.charting.widget.Legend({chart:this.chart},"legend1")},toggleArchiveComment:function(t){var i=t.currentTarget.id.substr(21);t.currentTarget.checked?e.query(".archiveCommentPreview_author_"+i).style("display","block"):e.query(".archiveCommentPreview_author_"+i).style("display","none")},onChoosePlayer:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(17),a=t.currentTarget.href;a+=current_player_id+";";e.query(".commentFrom_"+i+" .toggleArchiveComment").forEach(function(e){if(e.checked){var t=e.id.split("_")[1];a+=t+";"}});document.location.href=a}})})},"dojox/charting/Chart2D":function(){define(["dojo/_base/kernel","dojo/_base/lang","..","./Chart","./axis2d/Default","./axis2d/Invisible","./plot2d/Default","./plot2d/Lines","./plot2d/Areas","./plot2d/Markers","./plot2d/MarkersOnly","./plot2d/Scatter","./plot2d/Stacked","./plot2d/StackedLines","./plot2d/StackedAreas","./plot2d/Columns","./plot2d/StackedColumns","./plot2d/ClusteredColumns","./plot2d/Bars","./plot2d/StackedBars","./plot2d/ClusteredBars","./plot2d/Grid","./plot2d/Pie","./plot2d/Bubble","./plot2d/Candlesticks","./plot2d/OHLC","./plot2d/Spider"],function(e,t,i,a){e.deprecated("dojox.charting.Chart2D","Use dojox.charting.Chart instead and require all other components explicitly","2.0");return t.setObject("dojox.charting.Chart2D",a)})},"dojox/charting/Chart":function(){define(["../main","dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/dom-style","dojo/dom","dojo/dom-geometry","dojo/dom-construct","dojo/_base/Color","dojo/sniff","./Element","./SimpleTheme","./Series","./axis2d/common","dojox/gfx/shape","dojox/gfx","dojo/has!dojo-bidi?./bidi/Chart","dojox/lang/functional","dojox/lang/functional/fold","dojox/lang/functional/reversed"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g,f){var b=t.getObject("charting",!0,e),y=f.lambda("item.clear()"),v=f.lambda("item.purgeGroup()"),w=f.lambda("item.destroy()"),x=f.lambda("item.dirty = false"),k=f.lambda("item.dirty = true"),C=f.lambda("item.name"),T={l:10,t:10,r:10,b:10},j=a(d("dojo-bidi")?"dojox.charting.NonBidiChart":"dojox.charting.Chart",null,{constructor:function(e,t){t||(t={});this.margins=t.margins||T;this._customMargins=!!t.margins;this.stroke=t.stroke;this.fill=t.fill;this.delayInMs=t.delayInMs||200;this.title=t.title;this.titleGap=t.titleGap;this.titlePos=t.titlePos;this.titleFont=t.titleFont;this.titleFontColor=t.titleFontColor;this.titleAlign=t.titleAlign;this.chartTitle=null;this.htmlLabels=!0;"htmlLabels"in t&&(this.htmlLabels=t.htmlLabels);this.theme=null;this.axes={};this.stack=[];this.plots={};this.series=[];this.runs={};this.dirty=!0;this.node=o.byId(e);var i=s.getMarginBox(e);this.surface=m.createSurface(this.node,i.w||400,i.h||300);-1==this.surface.declaredClass.indexOf("vml")&&(this._nativeClip=!0)},destroy:function(){i.forEach(this.series,w);i.forEach(this.stack,w);f.forIn(this.axes,w);this.surface.destroy();this.chartTitle&&this.chartTitle.tagName&&r.destroy(this.chartTitle)},getCoords:function(){var e=this.node,t=n.getComputedStyle(e),i=s.getMarginBox(e,t),a=s.position(e,!0);i.x=a.x;i.y=a.y;return i},setTheme:function(e){this.theme=e.clone();this._customMargins||(this.margins=this.theme.chart.margins||T);this.dirty=!0;return this},addAxis:function(e,t){var i,a=t&&t.type||"Default";if("string"==typeof a){if(!b.axis2d||!b.axis2d[a])throw Error("Can't find axis: "+a+" - Check require() dependencies.");i=new b.axis2d[a](this,t)}else i=new a(this,t);i.name=e;i.dirty=!0;e in this.axes&&this.axes[e].destroy();this.axes[e]=i;this.dirty=!0;return this},getAxis:function(e){return this.axes[e]},removeAxis:function(e){if(e in this.axes){this.axes[e].destroy();delete this.axes[e];this.dirty=!0}return this},addPlot:function(e,t){var i,a=t&&t.type||"Default";if("string"==typeof a){if(!b.plot2d||!b.plot2d[a])throw Error("Can't find plot: "+a+" - didn't you forget to dojo.require() it?");i=new b.plot2d[a](this,t)}else i=new a(this,t);i.name=e;i.dirty=!0;if(e in this.plots){this.stack[this.plots[e]].destroy();this.stack[this.plots[e]]=i}else{this.plots[e]=this.stack.length;this.stack.push(i)}this.dirty=!0;return this},getPlot:function(e){return this.stack[this.plots[e]]},removePlot:function(e){if(e in this.plots){var t=this.plots[e];delete this.plots[e];this.stack[t].destroy();this.stack.splice(t,1);f.forIn(this.plots,function(e,i,a){e>t&&(a[i]=e-1)});var a=i.filter(this.series,function(t){return t.plot!=e});if(a.length<this.series.length){i.forEach(this.series,function(t){t.plot==e&&t.destroy()});this.runs={};i.forEach(a,function(e,t){this.runs[e.plot]=t},this);this.series=a}this.dirty=!0}return this},getPlotOrder:function(){return f.map(this.stack,C)},setPlotOrder:function(e){var t={},i=f.filter(e,function(e){if(!(e in this.plots)||e in t)return!1;t[e]=1;return!0},this);i.length<this.stack.length&&f.forEach(this.stack,function(e){var a=e.name;a in t||i.push(a)});var a=f.map(i,function(e){return this.stack[this.plots[e]]},this);f.forEach(a,function(e,t){this.plots[e.name]=t},this);this.stack=a;this.dirty=!0;return this},movePlotToFront:function(e){if(e in this.plots){var t=this.plots[e];if(t){var i=this.getPlotOrder();i.splice(t,1);i.unshift(e);return this.setPlotOrder(i)}}return this},movePlotToBack:function(e){if(e in this.plots){var t=this.plots[e];if(t<this.stack.length-1){var i=this.getPlotOrder();i.splice(t,1);i.push(e);return this.setPlotOrder(i)}}return this},addSeries:function(e,t,i){var a=new h(this,t,i);a.name=e;if(e in this.runs){this.series[this.runs[e]].destroy();this.series[this.runs[e]]=a}else{this.runs[e]=this.series.length;this.series.push(a)}this.dirty=!0;!("ymin"in a)&&"min"in a&&(a.ymin=a.min);!("ymax"in a)&&"max"in a&&(a.ymax=a.max);return this},getSeries:function(e){return this.series[this.runs[e]]},removeSeries:function(e){if(e in this.runs){var t=this.runs[e];delete this.runs[e];this.series[t].destroy();this.series.splice(t,1);f.forIn(this.runs,function(e,i,a){e>t&&(a[i]=e-1)});this.dirty=!0}return this},updateSeries:function(e,t,i){if(e in this.runs){var a=this.series[this.runs[e]];a.update(t);if(i)this.dirty=!0;else{this._invalidateDependentPlots(a.plot,!1);this._invalidateDependentPlots(a.plot,!0)}}return this},getSeriesOrder:function(e){return f.map(f.filter(this.series,function(t){return t.plot==e}),C)},setSeriesOrder:function(e){var t,i={},a=f.filter(e,function(e){if(!(e in this.runs)||e in i)return!1;var a=this.series[this.runs[e]];if(t){if(a.plot!=t)return!1}else t=a.plot;i[e]=1;return!0},this);f.forEach(this.series,function(e){var n=e.name;n in i||e.plot!=t||a.push(n)});var n=f.map(a,function(e){return this.series[this.runs[e]]},this);this.series=n.concat(f.filter(this.series,function(e){return e.plot!=t}));f.forEach(this.series,function(e,t){this.runs[e.name]=t},this);this.dirty=!0;return this},moveSeriesToFront:function(e){if(e in this.runs){var t=this.runs[e],i=this.getSeriesOrder(this.series[t].plot);if(e!=i[0]){i.splice(t,1);i.unshift(e);return this.setSeriesOrder(i)}}return this},moveSeriesToBack:function(e){if(e in this.runs){var t=this.runs[e],i=this.getSeriesOrder(this.series[t].plot);if(e!=i[i.length-1]){i.splice(t,1);i.push(e);return this.setSeriesOrder(i)}}return this},resize:function(e,t){switch(arguments.length){case 1:s.setMarginBox(this.node,e);break;case 2:s.setMarginBox(this.node,{w:e,h:t})}var i=s.getMarginBox(this.node),a=this.surface.getDimensions();if(a.width!=i.w||a.height!=i.h){this.surface.setDimensions(i.w,i.h);this.dirty=!0;return this.render()}return this},getGeometry:function(){var e={};f.forIn(this.axes,function(t){t.initialized()&&(e[t.name]={name:t.name,vertical:t.vertical,scaler:t.scaler,ticks:t.ticks})});return e},setAxisWindow:function(e,t,a,n){var o=this.axes[e];if(o){o.setWindow(t,a);i.forEach(this.stack,function(t){t.hAxis!=e&&t.vAxis!=e||(t.zoom=n)})}return this},setWindow:function(e,t,a,n,o){"plotArea"in this||this.calculateGeometry();f.forIn(this.axes,function(i){var o,s,r=i.getScaler().bounds,l=r.span/(r.upper-r.lower);s=i.vertical?n/l/(o=t):a/l/(o=e);i.setWindow(o,s)});i.forEach(this.stack,function(e){e.zoom=o});return this},zoomIn:function(e,t,i){var a=this.axes[e];if(a){var n,o,s=a.getScaler().bounds,r=Math.min(t[0],t[1]),l=Math.max(t[0],t[1]);r=t[0]<s.lower?s.lower:r;l=t[1]>s.upper?s.upper:l;n=(s.upper-s.lower)/(l-r);o=r-s.lower;this.setAxisWindow(e,n,o);i?this.delayedRender():this.render()}},calculateGeometry:function(){if(this.dirty)return this.fullGeometry();$(i.filter(this.stack,function(e){return e.dirty||e.hAxis&&this.axes[e.hAxis].dirty||e.vAxis&&this.axes[e.vAxis].dirty},this),this.plotArea);return this},fullGeometry:function(){this._makeDirty();i.forEach(this.stack,y);this.theme||this.setTheme(new u);i.forEach(this.series,function(e){if(!(e.plot in this.plots)){if(!b.plot2d||!b.plot2d.Default)throw Error("Can't find plot: Default - didn't you forget to dojo.require() it?");var t=new b.plot2d.Default(this,{});t.name=e.plot;this.plots[e.plot]=this.stack.length;this.stack.push(t)}this.stack[this.plots[e.plot]].addSeries(e)},this);i.forEach(this.stack,function(e){e.assignAxes&&e.assignAxes(this.axes)},this);var e=this.dim=this.surface.getDimensions();e.width=m.normalizedLength(e.width);e.height=m.normalizedLength(e.height);f.forIn(this.axes,y);$(this.stack,e);var t=this.offsets={l:0,r:0,t:0,b:0},a=this;f.forIn(this.axes,function(e){d("dojo-bidi")&&a._resetLeftBottom(e);f.forIn(e.getOffsets(),function(e,i){t[i]=Math.max(e,t[i])})});if(this.title){this.titleGap=0==this.titleGap?0:this.titleGap||this.theme.chart.titleGap||20;this.titlePos=this.titlePos||this.theme.chart.titlePos||"top";this.titleFont=this.titleFont||this.theme.chart.titleFont;this.titleFontColor=this.titleFontColor||this.theme.chart.titleFontColor||"black";this.titleAlign=this.titleAlign||this.theme&&this.theme.chart&&this.theme.chart.titleAlign||"middle";var n=m.normalizedLength(m.splitFontString(this.titleFont).size);t["top"==this.titlePos?"t":"b"]+=n+this.titleGap}f.forIn(this.margins,function(e,i){t[i]+=e});this.plotArea={width:e.width-t.l-t.r,height:e.height-t.t-t.b};f.forIn(this.axes,y);$(this.stack,this.plotArea);return this},render:function(){if(this._delayedRenderHandle){clearTimeout(this._delayedRenderHandle);this._delayedRenderHandle=null}this.theme&&this.theme.clear();if(this.dirty)return this.fullRender();this.calculateGeometry();f.forEachRev(this.stack,function(e){e.render(this.dim,this.offsets)},this);f.forIn(this.axes,function(e){e.render(this.dim,this.offsets)},this);this._makeClean();return this},fullRender:function(){this.fullGeometry();var e=this.offsets,t=this.dim,a=Math.max(0,t.width-e.l-e.r),n=Math.max(0,t.height-e.t-e.b);i.forEach(this.series,v);f.forIn(this.axes,v);i.forEach(this.stack,v);var o=this.surface.children;if(_.dispose)for(var s=0;s<o.length;++s)_.dispose(o[s]);this.chartTitle&&this.chartTitle.tagName&&r.destroy(this.chartTitle);this.surface.clear();this.chartTitle=null;this._renderChartBackground(t,e);this._nativeClip,this._renderPlotBackground(t,e,a,n);f.foldr(this.stack,function(i,a){return a.render(t,e),0},0);this._nativeClip||this._renderChartBackground(t,e);this.title&&this._renderTitle(t,e);f.forIn(this.axes,function(i){i.render(t,e)});this._makeClean();return this},_renderTitle:function(e,t){var i="canvas"==m.renderer&&this.htmlLabels||!d("ie")&&!d("opera")&&this.htmlLabels?"html":"gfx",a=m.normalizedLength(m.splitFontString(this.titleFont).size),n=m._base._getTextBox(this.title,{font:this.titleFont}),o=this.titleAlign,s=d("dojo-bidi")&&this.isRightToLeft(),r=e.width/2;if("edge"===o){o="left";r=s?e.width-(t.r+n.w):t.l}else if("middle"!=o){s&&(o="left"===o?"right":"left");if("left"===o)r=this.margins.l;else if("right"===o){o="left";r=e.width-(this.margins.l+n.w)}}this.chartTitle=p.createText[i](this,this.surface,r,"top"==this.titlePos?a+this.margins.t:e.height-this.margins.b,o,this.title,this.titleFont,this.titleFontColor)},_renderChartBackground:function(e,t){var i,a=this.theme,o=void 0!==this.fill?this.fill:a.chart&&a.chart.fill,s=void 0!==this.stroke?this.stroke:a.chart&&a.chart.stroke;if("inherit"==o){var r=this.node;o=new l(n.get(r,"backgroundColor"));for(;0==o.a&&r!=document.documentElement;){o=new l(n.get(r,"backgroundColor"));r=r.parentNode}}if(o)if(this._nativeClip){o=c.prototype._shapeFill(c.prototype._plotFill(o,e),{x:0,y:0,width:e.width+1,height:e.height+1});this.surface.createRect({width:e.width+1,height:e.height+1}).setFill(o)}else{o=c.prototype._plotFill(o,e,t);if(t.l){i={x:0,y:0,width:t.l,height:e.height+1};this.surface.createRect(i).setFill(c.prototype._shapeFill(o,i))}if(t.r){i={x:e.width-t.r,y:0,width:t.r+1,height:e.height+2};this.surface.createRect(i).setFill(c.prototype._shapeFill(o,i))}if(t.t){i={x:0,y:0,width:e.width+1,height:t.t};this.surface.createRect(i).setFill(c.prototype._shapeFill(o,i))}if(t.b){i={x:0,y:e.height-t.b,width:e.width+1,height:t.b+2};this.surface.createRect(i).setFill(c.prototype._shapeFill(o,i))}}s&&this.surface.createRect({width:e.width-1,height:e.height-1}).setStroke(s)},_renderPlotBackground:function(e,t,i,a){var n=this.theme,o=n.plotarea&&n.plotarea.fill,s=n.plotarea&&n.plotarea.stroke,r={x:t.l-1,y:t.t-1,width:i+2,height:a+2};if(o){o=c.prototype._shapeFill(c.prototype._plotFill(o,e,t),r);this.surface.createRect(r).setFill(o)}s&&this.surface.createRect({x:t.l,y:t.t,width:i+1,height:a+1}).setStroke(s)},delayedRender:function(){this._delayedRenderHandle||(this._delayedRenderHandle=setTimeout(t.hitch(this,function(){this.render()}),this.delayInMs));return this},connectToPlot:function(e,t,i){return e in this.plots?this.stack[this.plots[e]].connect(t,i):null},fireEvent:function(e,t,i){if(e in this.runs){var a=this.series[this.runs[e]].plot;if(a in this.plots){var n=this.stack[this.plots[a]];n&&n.fireEvent(e,t,i)}}return this},_makeClean:function(){i.forEach(this.axes,x);i.forEach(this.stack,x);i.forEach(this.series,x);this.dirty=!1},_makeDirty:function(){i.forEach(this.axes,k);i.forEach(this.stack,k);i.forEach(this.series,k);this.dirty=!0},_invalidateDependentPlots:function(e,t){if(e in this.plots){var a,n=this.stack[this.plots[e]],o=t?"vAxis":"hAxis";if(n[o]){if((a=this.axes[n[o]])&&a.dependOnData()){a.dirty=!0;i.forEach(this.stack,function(e){e[o]&&e[o]==n[o]&&(e.dirty=!0)})}}else n.dirty=!0}},setDir:function(e){return this},_resetLeftBottom:function(e){},formatTruncatedLabel:function(e,t,i){}});function S(e,t){if(e&&t){e.min=Math.min(e.min,t.min);e.max=Math.max(e.max,t.max)}return e||t}function $(e,t){var a={},n={};i.forEach(e,function(e){var t=a[e.name]=e.getSeriesStats();e.hAxis&&(n[e.hAxis]=S(n[e.hAxis],function(e){return{min:e.hmin,max:e.hmax}}(t)));e.vAxis&&(n[e.vAxis]=S(n[e.vAxis],function(e){return{min:e.vmin,max:e.vmax}}(t)))});i.forEach(e,function(e){var i=a[e.name];e.hAxis&&function(e,t){e.hmin=t.min;e.hmax=t.max}(i,n[e.hAxis]);e.vAxis&&function(e,t){e.vmin=t.min;e.vmax=t.max}(i,n[e.vAxis]);e.initializeScalers(t,i)})}return d("dojo-bidi")?a("dojox.charting.Chart",[j,g]):j})},"dojox/charting/Element":function(){define(["dojo/_base/array","dojo/dom-construct","dojo/_base/declare","dojox/gfx","dojox/gfx/shape"],function(e,t,i,a,n){return i("dojox.charting.Element",null,{chart:null,group:null,htmlElements:null,dirty:!0,renderingOptions:null,constructor:function(e,t){this.chart=e;this.group=null;this.htmlElements=[];this.dirty=!0;this.trailingSymbol="...";this._events=[];t&&t.renderingOptions&&(this.renderingOptions=t.renderingOptions)},purgeGroup:function(){this.destroyHtmlElements();if(this.group){this.getGroup().removeShape();var i=this.getGroup().children;if(n.dispose)for(var a=0;a<i.length;++a)n.dispose(i[a],!0);this.getGroup().rawNode&&t.empty(this.getGroup().rawNode);this.getGroup().clear();n.dispose&&n.dispose(this.getGroup(),!0);if(this.getGroup()!=this.group){this.group.rawNode&&t.empty(this.group.rawNode);this.group.clear();n.dispose&&n.dispose(this.group,!0)}this.group=null}this.dirty=!0;if(this._events.length){e.forEach(this._events,function(e){e.shape.disconnect(e.handle)});this._events=[]}return this},cleanGroup:function(e){this.destroyHtmlElements();e||(e=this.chart.surface);if(this.group){var i,a=this.getGroup().children;if(n.dispose)for(var o=0;o<a.length;++o)n.dispose(a[o],!0);if(this.getGroup().rawNode){i=this.getGroup().bgNode;t.empty(this.getGroup().rawNode)}this.getGroup().clear();i&&this.getGroup().rawNode.appendChild(i)}else{this.group=e.createGroup();if(this.renderingOptions&&this.group.rawNode&&"http://www.w3.org/2000/svg"==this.group.rawNode.namespaceURI)for(var s in this.renderingOptions)this.group.rawNode.setAttribute(s,this.renderingOptions[s])}this.dirty=!0;return this},getGroup:function(){return this.group},destroyHtmlElements:function(){if(this.htmlElements.length){e.forEach(this.htmlElements,t.destroy);this.htmlElements=[]}},destroy:function(){this.purgeGroup()},overrideShape:function(e,t){},getTextWidth:function(e,t){return a._base._getTextBox(e,{font:t}).w||0},getTextWithLimitLength:function(e,t,i,a){if(!e||e.length<=0)return{text:"",truncated:a||!1};if(!i||i<=0)return{text:e,truncated:a||!1};var n=e.substring(0,1)+this.trailingSymbol;if(i<=this.getTextWidth(n,t))return{text:n,truncated:!0};if(this.getTextWidth(e,t)<=i)return{text:e,truncated:a||!1};for(var o=0,s=e.length;o<s;){if(s-o<=2){for(;this.getTextWidth(e.substring(0,o)+this.trailingSymbol,t)>i;)o-=1;return{text:e.substring(0,o)+this.trailingSymbol,truncated:!0}}var r=o+Math.round(.618*(s-o));this.getTextWidth(e.substring(0,r),t)<i?o=r:s=r}},getTextWithLimitCharCount:function(e,t,i,a){return!e||e.length<=0?{text:"",truncated:a||!1}:!i||i<=0||e.length<=i?{text:e,truncated:a||!1}:{text:e.substring(0,i)+this.trailingSymbol,truncated:!0}},_plotFill:function(e,t,i){if(!e||!e.type||!e.space)return e;var n,o=e.space;switch(e.type){case"linear":if("plot"===o||"shapeX"===o||"shapeY"===o){(e=a.makeParameters(a.defaultLinearGradient,e)).space=o;if("plot"===o||"shapeX"===o){n=t.height-i.t-i.b;e.y1=i.t+n*e.y1/100;e.y2=i.t+n*e.y2/100}if("plot"===o||"shapeY"===o){n=t.width-i.l-i.r;e.x1=i.l+n*e.x1/100;e.x2=i.l+n*e.x2/100}}break;case"radial":if("plot"===o){(e=a.makeParameters(a.defaultRadialGradient,e)).space=o;var s=t.width-i.l-i.r,r=t.height-i.t-i.b;e.cx=i.l+s*e.cx/100;e.cy=i.t+r*e.cy/100;e.r=e.r*Math.sqrt(s*s+r*r)/200}break;case"pattern":if("plot"===o||"shapeX"===o||"shapeY"===o){(e=a.makeParameters(a.defaultPattern,e)).space=o;if("plot"===o||"shapeX"===o){n=t.height-i.t-i.b;e.y=i.t+n*e.y/100;e.height=n*e.height/100}if("plot"===o||"shapeY"===o){n=t.width-i.l-i.r;e.x=i.l+n*e.x/100;e.width=n*e.width/100}}}return e},_shapeFill:function(e,t){if(!e||!e.space)return e;var i,n=e.space;switch(e.type){case"linear":if("shape"===n||"shapeX"===n||"shapeY"===n){(e=a.makeParameters(a.defaultLinearGradient,e)).space=n;if("shape"===n||"shapeX"===n){i=t.width;e.x1=t.x+i*e.x1/100;e.x2=t.x+i*e.x2/100}if("shape"===n||"shapeY"===n){i=t.height;e.y1=t.y+i*e.y1/100;e.y2=t.y+i*e.y2/100}}break;case"radial":if("shape"===n){(e=a.makeParameters(a.defaultRadialGradient,e)).space=n;e.cx=t.x+t.width/2;e.cy=t.y+t.height/2;e.r=e.r*t.width/200}break;case"pattern":if("shape"===n||"shapeX"===n||"shapeY"===n){(e=a.makeParameters(a.defaultPattern,e)).space=n;if("shape"===n||"shapeX"===n){i=t.width;e.x=t.x+i*e.x/100;e.width=i*e.width/100}if("shape"===n||"shapeY"===n){i=t.height;e.y=t.y+i*e.y/100;e.height=i*e.height/100}}}return e},_pseudoRadialFill:function(e,t,i,n,o){if(!e||"radial"!==e.type||"shape"!==e.space)return e;var s=e.space;(e=a.makeParameters(a.defaultRadialGradient,e)).space=s;if(arguments.length<4){e.cx=t.x;e.cy=t.y;e.r=e.r*i/100;return e}var r=arguments.length<5?n:(o+n)/2;return{type:"linear",x1:t.x,y1:t.y,x2:t.x+e.r*i*Math.cos(r)/100,y2:t.y+e.r*i*Math.sin(r)/100,colors:e.colors}}})})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(e,t,i){t.switchTo(i);return t})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(e,t,i,a,n){var o=null;i.add("vml",function(e,t,i){i.innerHTML='<v:shape adj="1"/>';var a="adj"in i.firstChild;i.innerHTML="";return a});return{load:function(s,r,l){if(o&&"force"!=s)l(o);else{for(var d,c,u=n.forceGfxRenderer,h=!u&&(t.isString(n.gfxRenderer)?n.gfxRenderer:"svg,vml,canvas,silverlight").split(",");!u&&h.length;)switch(h.shift()){case"svg":"SVGAngle"in a.global&&(u="svg");break;case"vml":i("vml")&&(u="vml");break;case"silverlight":try{i("ie")?(d=new ActiveXObject("AgControl.AgControl"))&&d.IsVersionSupported("1.0")&&(c=!0):navigator.plugins["Silverlight Plug-In"]&&(c=!0)}catch(_){c=!1}finally{d=null}c&&(u="silverlight");break;case"canvas":a.global.CanvasRenderingContext2D&&(u="canvas")}"canvas"===u&&!1!==n.canvasEvents&&(u="canvasWithEvents");n.isDebug;"svg"==u&&void 0!==window.svgweb?window.svgweb.addOnLoad(p):p()}function p(){r(["dojox/gfx/"+u],function(t){e.renderer=u;o=t;l(t)})}}}})},"dojox/charting/SimpleTheme":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/_base/Color","dojox/lang/utils","dojox/gfx/gradutils"],function(e,t,i,a,n,o){var s=i("dojox.charting.SimpleTheme",null,{shapeSpaces:{shape:1,shapeX:1,shapeY:1},constructor:function(i){i=i||{};var a=s.defaultTheme;t.forEach(["chart","plotarea","axis","grid","series","marker","indicator"],function(t){this[t]=e.delegate(a[t],i[t])},this);if(i.seriesThemes&&i.seriesThemes.length){this.colors=null;this.seriesThemes=i.seriesThemes.slice(0)}else{this.seriesThemes=null;this.colors=(i.colors||s.defaultColors).slice(0)}this.markerThemes=null;i.markerThemes&&i.markerThemes.length&&(this.markerThemes=i.markerThemes.slice(0));this.markers=i.markers?e.clone(i.markers):e.delegate(s.defaultMarkers);this.noGradConv=i.noGradConv;this.noRadialConv=i.noRadialConv;i.reverseFills&&this.reverseFills();this._current=0;this._buildMarkerArray()},clone:function(){var e=new this.constructor({chart:this.chart,plotarea:this.plotarea,axis:this.axis,grid:this.grid,series:this.series,marker:this.marker,colors:this.colors,markers:this.markers,indicator:this.indicator,seriesThemes:this.seriesThemes,markerThemes:this.markerThemes,noGradConv:this.noGradConv,noRadialConv:this.noRadialConv,pieInnerRadius:this.pieInnerRadius});t.forEach(["clone","clear","next","skip","addMixin","post","getTick"],function(t){this.hasOwnProperty(t)&&(e[t]=this[t])},this);return e},clear:function(){this._current=0},next:function(t,i,o){var s,r,l=n.merge;if(this.colors){s=e.delegate(this.series);r=e.delegate(this.marker);var d,c=new a(this.colors[this._current%this.colors.length]);if(s.stroke&&s.stroke.color){s.stroke=e.delegate(s.stroke);d=new a(s.stroke.color);s.stroke.color=new a(c);s.stroke.color.a=d.a}else s.stroke={color:c};if(r.stroke&&r.stroke.color){r.stroke=e.delegate(r.stroke);d=new a(r.stroke.color);r.stroke.color=new a(c);r.stroke.color.a=d.a}else r.stroke={color:c};if(!s.fill||s.fill.type)s.fill=c;else{d=new a(s.fill);s.fill=new a(c);s.fill.a=d.a}if(!r.fill||r.fill.type)r.fill=c;else{d=new a(r.fill);r.fill=new a(c);r.fill.a=d.a}}else{s=this.seriesThemes?l(this.series,this.seriesThemes[this._current%this.seriesThemes.length]):this.series;r=this.markerThemes?l(this.marker,this.markerThemes[this._current%this.markerThemes.length]):s}var u={series:s,marker:r,symbol:r&&r.symbol||this._markers[this._current%this._markers.length]};++this._current;i&&(u=this.addMixin(u,t,i));o&&(u=this.post(u,t));return u},skip:function(){++this._current},addMixin:function(i,a,o,s){if(e.isArray(o))t.forEach(o,function(e){i=this.addMixin(i,a,e)},this);else{var r={};if("color"in o)if("line"==a||"area"==a){e.setObject("series.stroke.color",o.color,r);e.setObject("marker.stroke.color",o.color,r)}else e.setObject("series.fill",o.color,r);t.forEach(["stroke","outline","shadow","fill","filter","font","fontColor","labelWiring"],function(t){var i="marker"+t.charAt(0).toUpperCase()+t.substr(1),a=i in o;if(t in o){e.setObject("series."+t,o[t],r);a||e.setObject("marker."+t,o[t],r)}a&&e.setObject("marker."+t,o[i],r)});if("marker"in o){r.symbol=o.marker;r.symbol=o.marker}i=n.merge(i,r)}s&&(i=this.post(i,a));return i},post:function(e,t){var i,a=e.series.fill;if(!this.noGradConv&&this.shapeSpaces[a.space]&&"linear"==a.type){"bar"==t?i={x1:a.y1,y1:a.x1,x2:a.y2,y2:a.x2}:this.noRadialConv||"shape"!=a.space||"slice"!=t&&"circle"!=t||(i={type:"radial",cx:0,cy:0,r:100});if(i)return n.merge(e,{series:{fill:i}})}return e},getTick:function(e,t){var i=this.axis.tick,a=e+"Tick",o=n.merge;i?this.axis[a]&&(i=o(i,this.axis[a])):i=this.axis[a];t&&(i?t[a]&&(i=o(i,t[a])):i=t[a]);return i},inspectObjects:function(e){t.forEach(["chart","plotarea","axis","grid","series","marker","indicator"],function(t){e(this[t])},this);this.seriesThemes&&t.forEach(this.seriesThemes,e);this.markerThemes&&t.forEach(this.markerThemes,e)},reverseFills:function(){this.inspectObjects(function(e){e&&e.fill&&(e.fill=o.reverse(e.fill))})},addMarker:function(e,t){this.markers[e]=t;this._buildMarkerArray()},setMarkers:function(e){this.markers=e;this._buildMarkerArray()},_buildMarkerArray:function(){this._markers=[];for(var e in this.markers)this._markers.push(this.markers[e])}});e.mixin(s,{defaultMarkers:{CIRCLE:"m-3,0 c0,-4 6,-4 6,0 m-6,0 c0,4 6,4 6,0",SQUARE:"m-3,-3 l0,6 6,0 0,-6 z",DIAMOND:"m0,-3 l3,3 -3,3 -3,-3 z",CROSS:"m0,-3 l0,6 m-3,-3 l6,0",X:"m-3,-3 l6,6 m0,-6 l-6,6",TRIANGLE:"m-3,3 l3,-6 3,6 z",TRIANGLE_INVERTED:"m-3,-3 l3,6 3,-6 z"},defaultColors:["#54544c","#858e94","#6e767a","#948585","#474747"],defaultTheme:{chart:{stroke:null,fill:"white",pageStyle:null,titleGap:20,titlePos:"top",titleFont:"normal normal bold 14pt Tahoma",titleFontColor:"#333",titleAlign:"middle"},plotarea:{stroke:null,fill:"white"},axis:{stroke:{color:"#333",width:1},tick:{color:"#666",position:"center",font:"normal normal normal 7pt Tahoma",fontColor:"#333",labelGap:4},majorTick:{width:1,length:6},minorTick:{width:.8,length:3},microTick:{width:.5,length:1},title:{gap:15,font:"normal normal normal 11pt Tahoma",fontColor:"#333",orientation:"axis"}},series:{stroke:{width:1.5,color:"#333"},outline:{width:.1,color:"#ccc"},shadow:null,fill:"#ccc",font:"normal normal normal 8pt Tahoma",fontColor:"#000",labelWiring:{width:1,color:"#ccc"}},marker:{stroke:{width:1.5,color:"#333"},outline:{width:.1,color:"#ccc"},shadow:null,fill:"#ccc",font:"normal normal normal 8pt Tahoma",fontColor:"#000"},indicator:{lineStroke:{width:1.5,color:"#333"},lineOutline:{width:.1,color:"#ccc"},lineShadow:null,lineFill:null,stroke:{width:1.5,color:"#333"},outline:{width:.1,color:"#ccc"},shadow:null,fill:"#ccc",radius:3,font:"normal normal normal 10pt Tahoma",fontColor:"#000",markerFill:"#ccc",markerSymbol:"m-3,0 c0,-4 6,-4 6,0 m-6,0 c0,4 6,4 6,0",markerStroke:{width:1.5,color:"#333"},markerOutline:{width:.1,color:"#ccc"},markerShadow:null}}});return s})},"dojox/lang/utils":function(){define(["..","dojo/_base/lang"],function(dojox,lang){var du=lang.getObject("lang.utils",!0,dojox),empty={},opts=Object.prototype.toString,clone=function(e){if(e)switch(opts.call(e)){case"[object Array]":return e.slice(0);case"[object Object]":return lang.delegate(e)}return e};lang.mixin(du,{coerceType:function(target,source){switch(typeof target){case"number":return Number(eval("("+source+")"));case"string":return String(source);case"boolean":return Boolean(eval("("+source+")"))}return eval("("+source+")")},updateWithObject:function(e,t,i){if(!t)return e;for(var a in e)if(a in t&&!(a in empty)){var n=e[a];n&&"object"==typeof n?du.updateWithObject(n,t[a],i):e[a]=i?du.coerceType(n,t[a]):clone(t[a])}return e},updateWithPattern:function(e,t,i,a){if(!t||!i)return e;for(var n in i)n in t&&!(n in empty)&&(e[n]=a?du.coerceType(i[n],t[n]):clone(t[n]));return e},merge:function(e,t){if(t){var i,a,n,o,s=opts.call(e),r=opts.call(t);switch(r){case"[object Array]":if(r==s){for(a=0,n=(i=new Array(Math.max(e.length,t.length))).length;a<n;++a)i[a]=du.merge(e[a],t[a]);return i}return t.slice(0);case"[object Object]":if(r==s&&e){i=lang.delegate(e);for(a in t)if(a in e){n=e[a];(o=t[a])!==n&&(i[a]=du.merge(n,o))}else i[a]=lang.clone(t[a]);return i}return lang.clone(t)}}return t}});return du})},"dojox/gfx/gradutils":function(){define(["./_base","dojo/_base/lang","./matrix","dojo/_base/Color"],function(e,t,i,a){var n=e.gradutils={};n.getColor=function(e,t){var n;if(e){switch(e.type){case"linear":var o=Math.atan2(e.y2-e.y1,e.x2-e.x1),s=i.rotate(-o),r=i.project(e.x2-e.x1,e.y2-e.y1),l=i.multiplyPoint(r,t),d=i.multiplyPoint(r,e.x1,e.y1),c=i.multiplyPoint(r,e.x2,e.y2),u=i.multiplyPoint(s,c.x-d.x,c.y-d.y).x;n=i.multiplyPoint(s,l.x-d.x,l.y-d.y).x/u;break;case"radial":var h=t.x-e.cx,p=t.y-e.cy;n=Math.sqrt(h*h+p*p)/e.r}return function(e,t){if(e<=0)return t[0].color;var i=t.length;if(e>=1)return t[i-1].color;for(var n=0;n<i;++n){var o=t[n];if(o.offset>=e){if(n){var s=t[n-1];return a.blendColors(new a(s.color),new a(o.color),(e-s.offset)/(o.offset-s.offset))}return o.color}}return t[i-1].color}(n,e.colors)}return new a(e||[0,0,0,0])};n.reverse=function(e){if(e)switch(e.type){case"linear":case"radial":if((e=t.delegate(e)).colors){for(var i,a=e.colors,n=a.length,o=0,s=e.colors=new Array(a.length);o<n;++o){i=a[o];s[o]={offset:1-i.offset,color:i.color}}s.sort(function(e,t){return e.offset-t.offset})}}return e};return n})},"dojox/charting/Series":function(){define(["dojo/_base/lang","dojo/_base/declare","./Element"],function(e,t,i){return t("dojox.charting.Series",i,{constructor:function(t,i,a){e.mixin(this,a);"string"!=typeof this.plot&&(this.plot="default");this.update(i)},clear:function(){this.dyn={}},update:function(t){if(e.isArray(t))this.data=t;else{this.source=t;this.data=this.source.data;this.source.setSeriesObject&&this.source.setSeriesObject(this)}this.dirty=!0;this.clear()}})})},"dojox/charting/axis2d/common":function(){define(["dojo/_base/lang","dojo/_base/window","dojo/dom-geometry","dojox/gfx","dojo/has"],function(e,t,i,a,n){var o=e.getObject("dojox.charting.axis2d.common",!0),s=function(e){e.marginLeft="0px";e.marginTop="0px";e.marginRight="0px";e.marginBottom="0px";e.paddingLeft="0px";e.paddingTop="0px";e.paddingRight="0px";e.paddingBottom="0px";e.borderLeftWidth="0px";e.borderTopWidth="0px";e.borderRightWidth="0px";e.borderBottomWidth="0px"};return e.mixin(o,{createText:{gfx:function(e,t,i,a,n,o,s,r){return t.createText({x:i,y:a,text:o,align:n}).setFont(s).setFill(r)},html:function(e,o,r,l,d,c,u,h,p){var _,m=t.doc.createElement("div"),g=m.style;e.getTextDir&&(m.dir=e.getTextDir(c));s(g);g.font=u;m.innerHTML=String(c).replace(/\s/g,"&nbsp;");g.color=h;g.position="absolute";g.left="-10000px";t.body().appendChild(m);var f=a.normalizedLength(a.splitFontString(u).size);p||(_=function(e){if(e.getBoundingClientRect){var t=e.getBoundingClientRect();return t.width||t.right-t.left}return i.getMarginBox(e).w}(m));"rtl"==m.dir&&(r+=p||_);t.body().removeChild(m);g.position="relative";if(p){g.width=p+"px";switch(d){case"middle":g.textAlign="center";g.left=r-p/2+"px";break;case"end":g.textAlign="right";g.left=r-p+"px";break;default:g.left=r+"px";g.textAlign="left"}}else switch(d){case"middle":g.left=Math.floor(r-_/2)+"px";break;case"end":g.left=Math.floor(r-_)+"px";break;default:g.left=Math.floor(r)+"px"}g.top=Math.floor(l-f)+"px";g.whiteSpace="nowrap";var b=t.doc.createElement("div"),y=b.style;s(y);y.width="0px";y.height="0px";b.appendChild(m);e.node.insertBefore(b,e.node.firstChild);n("dojo-bidi")&&e.htmlElementsRegistry.push([b,r,l,d,c,u,h]);return b}}})})},"dojox/lang/functional":function(){define(["./functional/lambda","./functional/array","./functional/object"],function(e){return e})},"dojox/lang/functional/lambda":function(){define(["../..","dojo/_base/lang","dojo/_base/array"],function(e,t,i){var a=t.getObject("lang.functional",!0,e),n={},o="ab".split(/a*/).length>1?String.prototype.split:function(e){var t=this.split.call(this,e),i=e.exec(this);i&&0==i.index&&t.unshift("");return t},s=function(e){var t=[],a=o.call(e,/\s*->\s*/m);if(a.length>1)for(;a.length;){e=a.pop();t=a.pop().split(/\s*,\s*|\s+/m);a.length&&a.push("(function("+t.join(", ")+"){ return ("+e+"); })")}else if(e.match(/\b_\b/))t=["_"];else{var n=e.match(/^\s*(?:[+*\/%&|\^\.=<>]|!=)/m),s=e.match(/[+\-*\/%&|\^\.=<>!]\s*$/m);if(n||s){if(n){t.push("$1");e="$1"+e}if(s){t.push("$2");e+="$2"}}else{var r=e.replace(/(?:\b[A-Z]|\.[a-zA-Z_$])[a-zA-Z_$\d]*|[a-zA-Z_$][a-zA-Z_$\d]*:|this|true|false|null|undefined|typeof|instanceof|in|delete|new|void|arguments|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|escape|eval|isFinite|isNaN|parseFloat|parseInt|unescape|dojo|dijit|dojox|window|document|'(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"/g,"").match(/([a-z_$][a-z_$\d]*)/gi)||[],l={};i.forEach(r,function(e){if(!l.hasOwnProperty(e)){t.push(e);l[e]=1}})}}return{args:t,body:e}};t.mixin(a,{rawLambda:function(e){return s(e)},buildLambda:function(e){var t=s(e);return"function("+t.args.join(",")+"){return ("+t.body+");}"},lambda:function(e){if("function"==typeof e)return e;if(e instanceof Array)return(t=e).length?function(){var e=t.length-1,i=a.lambda(t[e]).apply(this,arguments);for(--e;e>=0;--e)i=a.lambda(t[e]).call(this,i);return i}:function(e){return e};var t;if(n.hasOwnProperty(e))return n[e];var i=s(e);return n[e]=new Function(i.args,"return ("+i.body+");")},clearLambdaCache:function(){n={}}});return a})},"dojox/lang/functional/array":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","./lambda"],function(e,t,i,a){var n={};t.mixin(a,{filter:function(i,o,s){"string"==typeof i&&(i=i.split(""));s=s||e.global;o=a.lambda(o);var r,l,d,c=[];if(t.isArray(i))for(l=0,d=i.length;l<d;++l){r=i[l];o.call(s,r,l,i)&&c.push(r)}else if("function"==typeof i.hasNext&&"function"==typeof i.next)for(l=0;i.hasNext();){r=i.next();o.call(s,r,l++,i)&&c.push(r)}else for(l in i)if(!(l in n)){r=i[l];o.call(s,r,l,i)&&c.push(r)}return c},forEach:function(i,o,s){"string"==typeof i&&(i=i.split(""));s=s||e.global;o=a.lambda(o);var r,l;if(t.isArray(i))for(r=0,l=i.length;r<l;o.call(s,i[r],r,i),++r);else if("function"==typeof i.hasNext&&"function"==typeof i.next)for(r=0;i.hasNext();o.call(s,i.next(),r++,i));else for(r in i)r in n||o.call(s,i[r],r,i);return s},map:function(i,o,s){"string"==typeof i&&(i=i.split(""));s=s||e.global;o=a.lambda(o);var r,l,d;if(t.isArray(i)){r=new Array(l=i.length);for(d=0;d<l;r[d]=o.call(s,i[d],d,i),++d);}else if("function"==typeof i.hasNext&&"function"==typeof i.next){r=[];for(d=0;i.hasNext();r.push(o.call(s,i.next(),d++,i)));}else{r=[];for(d in i)d in n||r.push(o.call(s,i[d],d,i))}return r},every:function(i,o,s){"string"==typeof i&&(i=i.split(""));s=s||e.global;o=a.lambda(o);var r,l;if(t.isArray(i)){for(r=0,l=i.length;r<l;++r)if(!o.call(s,i[r],r,i))return!1}else if("function"==typeof i.hasNext&&"function"==typeof i.next){for(r=0;i.hasNext();)if(!o.call(s,i.next(),r++,i))return!1}else for(r in i)if(!(r in n)&&!o.call(s,i[r],r,i))return!1;return!0},some:function(i,o,s){"string"==typeof i&&(i=i.split(""));s=s||e.global;o=a.lambda(o);var r,l;if(t.isArray(i)){for(r=0,l=i.length;r<l;++r)if(o.call(s,i[r],r,i))return!0}else if("function"==typeof i.hasNext&&"function"==typeof i.next){for(r=0;i.hasNext();)if(o.call(s,i.next(),r++,i))return!0}else for(r in i)if(!(r in n)&&o.call(s,i[r],r,i))return!0;return!1}});return a})},"dojox/lang/functional/object":function(){define(["dojo/_base/kernel","dojo/_base/lang","./lambda"],function(e,t,i){var a={};t.mixin(i,{keys:function(e){var t=[];for(var i in e)i in a||t.push(i);return t},values:function(e){var t=[];for(var i in e)i in a||t.push(e[i]);return t},filterIn:function(t,n,o){o=o||e.global;n=i.lambda(n);var s,r,l={};for(r in t)if(!(r in a)){s=t[r];n.call(o,s,r,t)&&(l[r]=s)}return l},forIn:function(t,n,o){o=o||e.global;n=i.lambda(n);for(var s in t)s in a||n.call(o,t[s],s,t);return o},mapIn:function(t,n,o){o=o||e.global;n=i.lambda(n);var s,r={};for(s in t)s in a||(r[s]=n.call(o,t[s],s,t));return r}});return i})},"dojox/lang/functional/fold":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/kernel","./lambda"],function(e,t,i,a){var n={};e.mixin(a,{foldl:function(t,o,s,r){"string"==typeof t&&(t=t.split(""));r=r||i.global;o=a.lambda(o);var l,d;if(e.isArray(t))for(l=0,d=t.length;l<d;s=o.call(r,s,t[l],l,t),++l);else if("function"==typeof t.hasNext&&"function"==typeof t.next)for(l=0;t.hasNext();s=o.call(r,s,t.next(),l++,t));else for(l in t)l in n||(s=o.call(r,s,t[l],l,t));return s},foldl1:function(t,o,s){"string"==typeof t&&(t=t.split(""));s=s||i.global;o=a.lambda(o);var r,l,d;if(e.isArray(t)){r=t[0];for(l=1,d=t.length;l<d;r=o.call(s,r,t[l],l,t),++l);}else if("function"==typeof t.hasNext&&"function"==typeof t.next){if(t.hasNext()){r=t.next();for(l=1;t.hasNext();r=o.call(s,r,t.next(),l++,t));}}else{var c=!0;for(l in t)if(!(l in n))if(c){r=t[l];c=!1}else r=o.call(s,r,t[l],l,t)}return r},foldr:function(e,t,n,o){"string"==typeof e&&(e=e.split(""));o=o||i.global;t=a.lambda(t);for(var s=e.length;s>0;--s,n=t.call(o,n,e[s],s,e));return n},foldr1:function(e,t,n){"string"==typeof e&&(e=e.split(""));n=n||i.global;t=a.lambda(t);for(var o=e.length,s=e[o-1],r=o-1;r>0;--r,s=t.call(n,s,e[r],r,e));return s},reduce:function(e,t,i){return arguments.length<3?a.foldl1(e,t):a.foldl(e,t,i)},reduceRight:function(e,t,i){return arguments.length<3?a.foldr1(e,t):a.foldr(e,t,i)},unfold:function(e,t,n,o,s){s=s||i.global;t=a.lambda(t);n=a.lambda(n);e=a.lambda(e);for(var r=[];!e.call(s,o);r.push(t.call(s,o)),o=n.call(s,o));return r}})})},"dojox/lang/functional/reversed":function(){define(["dojo/_base/lang","dojo/_base/kernel","./lambda"],function(e,t,i){e.mixin(i,{filterRev:function(e,a,n){"string"==typeof e&&(e=e.split(""));n=n||t.global;a=i.lambda(a);for(var o,s=[],r=e.length-1;r>=0;--r){o=e[r];a.call(n,o,r,e)&&s.push(o)}return s},forEachRev:function(e,a,n){"string"==typeof e&&(e=e.split(""));n=n||t.global;a=i.lambda(a);for(var o=e.length-1;o>=0;a.call(n,e[o],o,e),--o);},mapRev:function(e,a,n){"string"==typeof e&&(e=e.split(""));n=n||t.global;a=i.lambda(a);for(var o=e.length,s=new Array(o),r=o-1,l=0;r>=0;s[l++]=a.call(n,e[r],r,e),--r);return s},everyRev:function(e,a,n){"string"==typeof e&&(e=e.split(""));n=n||t.global;a=i.lambda(a);for(var o=e.length-1;o>=0;--o)if(!a.call(n,e[o],o,e))return!1;return!0},someRev:function(e,a,n){"string"==typeof e&&(e=e.split(""));n=n||t.global;a=i.lambda(a);for(var o=e.length-1;o>=0;--o)if(a.call(n,e[o],o,e))return!0;return!1}});return i})},"dojox/charting/axis2d/Default":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/sniff","dojo/_base/declare","dojo/_base/connect","dojo/dom-geometry","./Invisible","../scaler/linear","./common","dojox/gfx","dojox/lang/utils","dojox/lang/functional","dojo/has!dojo-bidi?../bidi/axis2d/Default"],function(e,t,i,a,n,o,s,r,l,d,c,u,h){var p=45,_=a(i("dojo-bidi")?"dojox.charting.axis2d.NonBidiDefault":"dojox.charting.axis2d.Default",s,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,leftBottom:!0,includeZero:!1,fixed:!0,majorLabels:!0,minorTicks:!0,minorLabels:!0,microTicks:!1,rotation:0,htmlLabels:!0,enableCache:!1,dropLabels:!0,labelSizeChange:!1,position:"leftOrBottom"},optionalParams:{min:0,max:1,from:0,to:1,majorTickStep:4,minorTickStep:2,microTickStep:1,labels:[],labelFunc:null,maxLabelSize:0,maxLabelCharCount:0,trailingSymbol:null,stroke:{},majorTick:{},minorTick:{},microTick:{},tick:{},font:"",fontColor:"",title:"",titleGap:0,titleFont:"",titleFontColor:"",titleOrientation:""},constructor:function(t,i){this.opt=e.clone(this.defaultParams);c.updateWithObject(this.opt,i);c.updateWithPattern(this.opt,i,this.optionalParams);if(this.opt.enableCache){this._textFreePool=[];this._lineFreePool=[];this._textUsePool=[];this._lineUsePool=[]}this._invalidMaxLabelSize=!0;i&&"position"in i||(this.opt.position=this.opt.leftBottom?"leftOrBottom":"rightOrTop");this.renderingOptions={"shape-rendering":"crispEdges"}},setWindow:function(e,t){e!=this.scale&&(this._invalidMaxLabelSize=!0);return this.inherited(arguments)},_groupLabelWidth:function(t,i,a){if(!t.length)return 0;t.length>50&&(t.length=50);e.isObject(t[0])&&(t=u.map(t,function(e){return e.text}));a&&(t=u.map(t,function(t){return 0==e.trim(t).length?"":t.substring(0,a)+this.trailingSymbol},this));var n=t.join("<br>");return d._base._getTextBox(n,{font:i}).w||0},_getMaxLabelSize:function(i,a,n,o,s,l){if(null==this._maxLabelSize&&6==arguments.length){var d=this.opt;this.scaler.minMinorStep=this._prevMinMinorStep=0;var c=e.clone(d);delete c.to;delete c.from;var u=r.buildScaler(i,a,n,c,d.to-d.from);u.minMinorStep=0;this._majorStart=u.major.start;var h=r.buildTicks(u,d);if(l&&h){var p=0,_=0,m=function(e){e.label&&this.push(e.label)},g=[];if(this.opt.majorLabels){t.forEach(h.major,m,g);p=this._groupLabelWidth(g,s,c.maxLabelCharCount);c.maxLabelSize&&(p=Math.min(c.maxLabelSize,p))}g=[];if(this.opt.dropLabels&&this.opt.minorLabels){t.forEach(h.minor,m,g);_=this._groupLabelWidth(g,s,c.maxLabelCharCount);c.maxLabelSize&&(_=Math.min(c.maxLabelSize,_))}this._maxLabelSize={majLabelW:p,minLabelW:_,majLabelH:l,minLabelH:l}}else this._maxLabelSize=null}return this._maxLabelSize},calculate:function(e,t,i){this.inherited(arguments);this.scaler.minMinorStep=this._prevMinMinorStep;if((this._invalidMaxLabelSize||i!=this._oldSpan)&&e!=1/0&&t!=-1/0){this._invalidMaxLabelSize=!1;this.opt.labelSizeChange&&(this._maxLabelSize=null);this._oldSpan=i;var a=this.opt,n=this.chart.theme.axis,o=a.rotation%360,s=this.chart.theme.axis.tick.labelGap,l=a.font||n.majorTick&&n.majorTick.font||n.tick&&n.tick.font,c=l?d.normalizedLength(d.splitFontString(l).size):0,u=this._getMaxLabelSize(e,t,i,o,l,c);"number"!=typeof s&&(s=4);if(u&&a.dropLabels){var h,p,_=Math.abs(Math.cos(o*Math.PI/180)),m=Math.abs(Math.sin(o*Math.PI/180));o<0&&(o+=360);switch(o){case 0:case 180:if(this.vertical)h=p=c;else{h=u.majLabelW;p=u.minLabelW}break;case 90:case 270:if(this.vertical){h=u.majLabelW;p=u.minLabelW}else h=p=c;break;default:h=this.vertical?Math.min(u.majLabelW,c/_):Math.min(u.majLabelW,c/m);var g=Math.sqrt(u.minLabelW*u.minLabelW+c*c),f=this.vertical?c*_+u.minLabelW*m:u.minLabelW*_+c*m;p=Math.min(g,f)}this.scaler.minMinorStep=this._prevMinMinorStep=Math.max(h,p)+s;var b=this.scaler.minMinorStep<=this.scaler.minor.tick*this.scaler.bounds.scale;this._skipInterval=b?0:Math.floor((h+s)/(this.scaler.major.tick*this.scaler.bounds.scale))}else this._skipInterval=0}this.ticks=r.buildTicks(this.scaler,this.opt);return this},getOffsets:function(){var e={l:0,r:0,t:0,b:0};if(!this.scaler)return e;var t=this.opt,i=this.chart.theme.axis,a=this.chart.theme.axis.tick.labelGap,n=t.titleFont||i.title&&i.title.font,o=0==t.titleGap?0:t.titleGap||i.title&&i.title.gap,s=this.chart.theme.getTick("major",t),r=this.chart.theme.getTick("minor",t),l=n?d.normalizedLength(d.splitFontString(n).size):0,c=t.rotation%360,u=t.position,h="rightOrTop"!==u,_=Math.abs(Math.cos(c*Math.PI/180)),m=Math.abs(Math.sin(c*Math.PI/180));this.trailingSymbol=void 0===t.trailingSymbol||null===t.trailingSymbol?this.trailingSymbol:t.trailingSymbol;"number"!=typeof a&&(a=4);c<0&&(c+=360);var g=this._getMaxLabelSize();if(g){var f,b=Math.ceil(Math.max(g.majLabelW,g.minLabelW))+1,y=Math.ceil(Math.max(g.majLabelH,g.minLabelH))+1;if(this.vertical){f=h?"l":"r";switch(c){case 0:case 180:e[f]="center"===u?0:b;e.t=e.b=y/2;break;case 90:case 270:e[f]=y;e.t=e.b=b/2;break;default:if(c<=p||180<c&&c<=225){e[f]=y*m/2+b*_;e[h?"t":"b"]=y*_/2+b*m;e[h?"b":"t"]=y*_/2}else if(c>315||180>c&&c>135){e[f]=y*m/2+b*_;e[h?"b":"t"]=y*_/2+b*m;e[h?"t":"b"]=y*_/2}else if(c<90||180<c&&c<270){e[f]=y*m+b*_;e[h?"t":"b"]=y*_+b*m}else{e[f]=y*m+b*_;e[h?"b":"t"]=y*_+b*m}}"center"===u?e[f]=0:e[f]+=a+Math.max(s.length>0?s.length:0,r.length>0?r.length:0)+(t.title?l+o:0)}else{f=h?"b":"t";switch(c){case 0:case 180:e[f]="center"===u?0:y;e.l=e.r=b/2;break;case 90:case 270:e[f]=b;e.l=e.r=y/2;break;default:if(45<=c&&c<=90||225<=c&&c<=270){e[f]=y*_/2+b*m;e[h?"r":"l"]=y*m/2+b*_;e[h?"l":"r"]=y*m/2}else if(90<=c&&c<=135||270<=c&&c<=315){e[f]=y*_/2+b*m;e[h?"l":"r"]=y*m/2+b*_;e[h?"r":"l"]=y*m/2}else if(c<p||180<c&&c<225){e[f]=y*_+b*m;e[h?"r":"l"]=y*m+b*_}else{e[f]=y*_+b*m;e[h?"l":"r"]=y*m+b*_}}"center"===u?e[f]=0:e[f]+=a+Math.max(s.length>0?s.length:0,r.length>0?r.length:0)+(t.title?l+o:0)}}return e},cleanGroup:function(e){if(this.opt.enableCache&&this.group){this._lineFreePool=this._lineFreePool.concat(this._lineUsePool);this._lineUsePool=[];this._textFreePool=this._textFreePool.concat(this._textUsePool);this._textUsePool=[]}this.inherited(arguments)},createText:function(e,t,i,a,n,o,s,r,d){if(!this.opt.enableCache||"html"==e)return l.createText[e](this.chart,t,i,a,n,o,s,r,d);var c;if(this._textFreePool.length>0){(c=this._textFreePool.pop()).setShape({x:i,y:a,text:o,align:n});t.add(c)}else c=l.createText[e](this.chart,t,i,a,n,o,s,r);this._textUsePool.push(c);return c},createLine:function(e,t){var i;if(this.opt.enableCache&&this._lineFreePool.length>0){(i=this._lineFreePool.pop()).setShape(t);e.add(i)}else i=e.createLine(t);this.opt.enableCache&&this._lineUsePool.push(i);return i},render:function(e,a){var n=this._isRtl();if(!this.dirty||!this.scaler)return this;var o,s,c,u,h,_,m,g,f,b=this.opt,y=this.chart.theme.axis,v=b.position,w="rightOrTop"!==v,x=b.rotation%360,k=0,C=this.chart.theme.axis.tick.labelGap,T=b.font||y.majorTick&&y.majorTick.font||y.tick&&y.tick.font,j=b.titleFont||y.title&&y.title.font,S=b.fontColor||y.majorTick&&y.majorTick.fontColor||y.tick&&y.tick.fontColor||"black",$=b.titleFontColor||y.title&&y.title.fontColor||"black",M=0==b.titleGap?0:b.titleGap||y.title&&y.title.gap||15,A=b.titleOrientation||y.title&&y.title.orientation||"axis",E=this.chart.theme.getTick("major",b),N=this.chart.theme.getTick("minor",b),L=this.chart.theme.getTick("micro",b),D="stroke"in b?b.stroke:y.stroke,P=T?d.normalizedLength(d.splitFontString(T).size):0,I=Math.abs(Math.cos(x*Math.PI/180)),R=Math.abs(Math.sin(x*Math.PI/180)),F=j?d.normalizedLength(d.splitFontString(j).size):0;"number"!=typeof C&&(C=4);x<0&&(x+=360);var O=this._getMaxLabelSize();O=O&&O.majLabelW;if(this.vertical){o={y:e.height-a.b};s={y:a.t};c={y:(e.height-a.b+a.t)/2};u=P*R+(O||0)*I+C+Math.max(E.length>0?E.length:0,N.length>0?N.length:0)+F+M;h={x:0,y:-1};g={x:0,y:0};_={x:1,y:0};m={x:C,y:0};switch(x){case 0:f="end";g.y=.4*P;break;case 90:f="middle";g.x=-P;break;case 180:f="start";g.y=.4*-P;break;case 270:f="middle";break;default:if(x<p){f="end";g.y=.4*P}else if(x<90){f="end";g.y=.4*P}else if(x<135)f="start";else if(x<225){f="start";g.y=.4*-P}else if(x<270){f="start";g.x=w?0:.4*P}else if(x<315){f="end";g.x=w?0:.4*P}else{f="end";g.y=.4*P}}if(w){o.x=s.x="center"===v?e.width/2:a.l;k=A&&"away"==A?90:270;c.x=a.l-u+(270==k?F:0);_.x=-1;m.x=-m.x}else{o.x=s.x=e.width-a.r;k=A&&"axis"==A?90:270;c.x=e.width-a.r+u-(270==k?0:F);switch(f){case"start":f="end";break;case"end":f="start";break;case"middle":g.x+=P}}}else{o={x:a.l};s={x:e.width-a.r};c={x:(e.width-a.r+a.l)/2};u=P*I+(O||0)*R+C+Math.max(E.length>0?E.length:0,N.length>0?N.length:0)+F+M;h={x:n?-1:1,y:0};g={x:0,y:0};_={x:0,y:1};m={x:0,y:C};switch(x){case 0:f="middle";g.y=P;break;case 90:f="start";g.x=.4*-P;break;case 180:f="middle";break;case 270:f="end";g.x=.4*P;break;default:if(x<45){f="start";g.y=w?P:0}else if(x<135){f="start";g.x=.4*-P}else if(x<180){f="start";g.y=w?0:-P}else if(x<225){f="end";g.y=w?0:-P}else if(x<315){f="end";g.y=w?.4*P:0}else{f="end";g.y=w?P:0}}if(w){o.y=s.y="center"===v?e.height/2:e.height-a.b;k=A&&"axis"==A?180:0;c.y=e.height-a.b+u-(k?F:0)}else{o.y=s.y=a.t;k=A&&"away"==A?180:0;c.y=a.t-u+(k?0:F);_.y=-1;m.y=-m.y;switch(f){case"start":f="end";break;case"end":f="start";break;case"middle":g.y-=P}}}this.cleanGroup();var B=this.group,H=this.scaler,z=this.ticks,q=r.getTransformerFromModel(this.scaler),G=b.title&&k||x||!this.opt.htmlLabels||i("ie")||i("opera")?"gfx":"html",W=_.x*E.length,U=_.y*E.length,V=this._skipInterval;B.createLine({x1:o.x,y1:o.y,x2:s.x,y2:s.y}).setStroke(D);if(b.title){var Y=l.createText[G](this.chart,B,c.x,c.y,"middle",b.title,j,$);"html"==G?this.htmlElements.push(Y):Y.setTransform(d.matrix.rotategAt(k,c.x,c.y))}if(null==z){this.dirty=!1;return this}var X=z.major.length>0?(z.major[0].value-this._majorStart)/H.major.tick:0,K=this.opt.majorLabels;t.forEach(z.major,function(e,t){var i,a=q(e.value),r=(n?s.x:o.x)+h.x*a,l=o.y+h.y*a;t+=X;this.createLine(B,{x1:r,y1:l,x2:r+W,y2:l+U}).setStroke(E);if(e.label&&(!V||(t-(1+V))%(1+V)==0)){var c=b.maxLabelCharCount?this.getTextWithLimitCharCount(e.label,T,b.maxLabelCharCount):{text:e.label,truncated:!1};c=b.maxLabelSize?this.getTextWithLimitLength(c.text,T,b.maxLabelSize,c.truncated):c;i=this.createText(G,B,r+(E.length>0?W:0)+m.x+(x?0:g.x),l+(E.length>0?U:0)+m.y+(x?0:g.y),f,c.text,T,S);c.truncated&&this.chart.formatTruncatedLabel(i,e.label,G);c.truncated&&this.labelTooltip(i,this.chart,e.label,c.text,T,G);"html"==G?this.htmlElements.push(i):x&&i.setTransform([{dx:g.x,dy:g.y},d.matrix.rotategAt(x,r+(E.length>0?W:0)+m.x,l+(E.length>0?U:0)+m.y)])}},this);W=_.x*N.length;U=_.y*N.length;K=this.opt.minorLabels&&H.minMinorStep<=H.minor.tick*H.bounds.scale;t.forEach(z.minor,function(e){var t,i=q(e.value),a=(n?s.x:o.x)+h.x*i,r=o.y+h.y*i;this.createLine(B,{x1:a,y1:r,x2:a+W,y2:r+U}).setStroke(N);if(K&&e.label){var l=b.maxLabelCharCount?this.getTextWithLimitCharCount(e.label,T,b.maxLabelCharCount):{text:e.label,truncated:!1};l=b.maxLabelSize?this.getTextWithLimitLength(l.text,T,b.maxLabelSize,l.truncated):l;t=this.createText(G,B,a+(N.length>0?W:0)+m.x+(x?0:g.x),r+(N.length>0?U:0)+m.y+(x?0:g.y),f,l.text,T,S);l.truncated&&this.chart.formatTruncatedLabel(t,e.label,G);l.truncated&&this.labelTooltip(t,this.chart,e.label,l.text,T,G);"html"==G?this.htmlElements.push(t):x&&t.setTransform([{dx:g.x,dy:g.y},d.matrix.rotategAt(x,a+(N.length>0?W:0)+m.x,r+(N.length>0?U:0)+m.y)])}},this);W=_.x*L.length;U=_.y*L.length;t.forEach(z.micro,function(e){var t=q(e.value),i=o.x+h.x*t,a=o.y+h.y*t;this.createLine(B,{x1:i,y1:a,x2:i+W,y2:a+U}).setStroke(L)},this);this.dirty=!1;return this},labelTooltip:function(t,i,a,s,r,l){var c=["dijit/Tooltip"],u={type:"rect"},h=["above","below"],p=d._base._getTextBox(s,{font:r}).w||0,_=r?d.normalizedLength(d.splitFontString(r).size):0;if("html"==l){e.mixin(u,o.position(t.firstChild,!0));u.width=Math.ceil(p);u.height=Math.ceil(_);this._events.push({shape:dojo,handle:n.connect(t.firstChild,"onmouseover",this,function(e){require(c,function(e){e.show(a,u,h)})})});this._events.push({shape:dojo,handle:n.connect(t.firstChild,"onmouseout",this,function(e){require(c,function(e){e.hide(u)})})})}else{var m=t.getShape(),g=i.getCoords();(u=e.mixin(u,{x:m.x-p/2,y:m.y})).x+=g.x;u.y+=g.y;u.x=Math.round(u.x);u.y=Math.round(u.y);u.width=Math.ceil(p);u.height=Math.ceil(_);this._events.push({shape:t,handle:t.connect("onmouseenter",this,function(e){require(c,function(e){e.show(a,u,h)})})});this._events.push({shape:t,handle:t.connect("onmouseleave",this,function(e){require(c,function(e){e.hide(u)})})})}},_isRtl:function(){return!1}});return i("dojo-bidi")?a("dojox.charting.axis2d.Default",[_,h]):_})},"dojox/charting/axis2d/Invisible":function(){define(["dojo/_base/lang","dojo/_base/declare","./Base","../scaler/linear","dojox/lang/utils"],function(e,t,i,a,n){return t("dojox.charting.axis2d.Invisible",i,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,leftBottom:!0,includeZero:!1,fixed:!0},optionalParams:{min:0,max:1,from:0,to:1,majorTickStep:4,minorTickStep:2,microTickStep:1},constructor:function(t,i){this.opt=e.clone(this.defaultParams);n.updateWithObject(this.opt,i);n.updateWithPattern(this.opt,i,this.optionalParams)},dependOnData:function(){return!("min"in this.opt)||!("max"in this.opt)},clear:function(){delete this.scaler;delete this.ticks;this.dirty=!0;return this},initialized:function(){return"scaler"in this&&!(this.dirty&&this.dependOnData())},setWindow:function(e,t){this.scale=e;this.offset=t;return this.clear()},getWindowScale:function(){return"scale"in this?this.scale:1},getWindowOffset:function(){return"offset"in this?this.offset:0},calculate:function(e,t,i,n){if(this.initialized())return this;var o=this.opt;this.labels=o.labels;this.scaler=(n||a).buildScaler(e,t,i,o);var s=this.scaler.bounds;if("scale"in this){o.from=s.lower+this.offset;o.to=(s.upper-s.lower)/this.scale+o.from;if(!isFinite(o.from)||isNaN(o.from)||!isFinite(o.to)||isNaN(o.to)||o.to-o.from>=s.upper-s.lower){delete o.from;delete o.to;delete this.scale;delete this.offset}else{if(o.from<s.lower){o.to+=s.lower-o.from;o.from=s.lower}else if(o.to>s.upper){o.from+=s.upper-o.to;o.to=s.upper}this.offset=o.from-s.lower}this.scaler=(n||a).buildScaler(e,t,i,o);s=this.scaler.bounds;if(1==this.scale&&0==this.offset){delete this.scale;delete this.offset}}return this},getScaler:function(){return this.scaler},getTicks:function(){return this.ticks}})})},"dojox/charting/axis2d/Base":function(){define(["dojo/_base/declare","../Element"],function(e,t){return e("dojox.charting.axis2d.Base",t,{constructor:function(e,t){this.vertical=t&&t.vertical;this.opt={};this.opt.min=t&&t.min;this.opt.max=t&&t.max},clear:function(){return this},initialized:function(){return!1},calculate:function(e,t,i){return this},getScaler:function(){return null},getTicks:function(){return null},getOffsets:function(){return{l:0,r:0,t:0,b:0}},render:function(e,t){this.dirty=!1;return this},isNullValue:function(e){return!1},naturalBaseline:0})})},"dojox/charting/scaler/linear":function(){define(["dojo/_base/lang","./common"],function(e,t){var i=e.getObject("dojox.charting.scaler.linear",!0),a=t.getNumericLabel;function n(e,t){e=e.toLowerCase();for(var i=t.length-1;i>=0;--i)if(e===t[i])return!0;return!1}var o=function(t,a,o,s,r,l,d){o=e.delegate(o);if(!s){"major"==o.fixUpper&&(o.fixUpper="minor");"major"==o.fixLower&&(o.fixLower="minor")}if(!r){"minor"==o.fixUpper&&(o.fixUpper="micro");"minor"==o.fixLower&&(o.fixLower="micro")}if(!l){"micro"==o.fixUpper&&(o.fixUpper="none");"micro"==o.fixLower&&(o.fixLower="none")}var c=n(o.fixLower,["major"])?Math.floor(o.min/s)*s:n(o.fixLower,["minor"])?Math.floor(o.min/r)*r:n(o.fixLower,["micro"])?Math.floor(o.min/l)*l:o.min,u=n(o.fixUpper,["major"])?Math.ceil(o.max/s)*s:n(o.fixUpper,["minor"])?Math.ceil(o.max/r)*r:n(o.fixUpper,["micro"])?Math.ceil(o.max/l)*l:o.max;o.useMin&&(t=c);o.useMax&&(a=u);var h=!s||o.useMin&&n(o.fixLower,["major"])?t:Math.ceil(t/s)*s,p=!r||o.useMin&&n(o.fixLower,["major","minor"])?t:Math.ceil(t/r)*r,_=!l||o.useMin&&n(o.fixLower,["major","minor","micro"])?t:Math.ceil(t/l)*l,m=s?(o.useMax&&n(o.fixUpper,["major"])?Math.round((a-h)/s):Math.floor((a-h)/s))+1:0,g=r?(o.useMax&&n(o.fixUpper,["major","minor"])?Math.round((a-p)/r):Math.floor((a-p)/r))+1:0,f=l?(o.useMax&&n(o.fixUpper,["major","minor","micro"])?Math.round((a-_)/l):Math.floor((a-_)/l))+1:0,b=r?Math.round(s/r):0,y=l?Math.round(r/l):0,v=s?Math.floor(Math.log(s)/Math.LN10):0,w=r?Math.floor(Math.log(r)/Math.LN10):0,x=d/(a-t);isFinite(x)||(x=1);return{bounds:{lower:c,upper:u,from:t,to:a,scale:x,span:d},major:{tick:s,start:h,count:m,prec:v},minor:{tick:r,start:p,count:g,prec:w},micro:{tick:l,start:_,count:f,prec:0},minorPerMajor:b,microPerMinor:y,scaler:i}};return e.mixin(i,{buildScaler:function(e,t,i,a,n,s){var r={fixUpper:"none",fixLower:"none",natural:!1};if(a){"fixUpper"in a&&(r.fixUpper=String(a.fixUpper));"fixLower"in a&&(r.fixLower=String(a.fixLower));"natural"in a&&(r.natural=Boolean(a.natural))}s=!s||s<3?3:s;"min"in a&&(e=a.min);"max"in a&&(t=a.max);if(a.includeZero){e>0&&(e=0);t<0&&(t=0)}r.min=e;r.useMin=!0;r.max=t;r.useMax=!0;if("from"in a){e=a.from;r.useMin=!1}if("to"in a){t=a.to;r.useMax=!1}if(t<=e)return o(e,t,r,0,0,0,i);n||(n=t-e);var l,d=Math.floor(Math.log(n)/Math.LN10),c=a&&"majorTickStep"in a?a.majorTickStep:Math.pow(10,d),u=0,h=0;if(a&&"minorTickStep"in a)u=a.minorTickStep;else do{u=c/10;if((!r.natural||u>.9)&&(l=o(e,t,r,c,u,0,i)).bounds.scale*l.minor.tick>s)break;u=c/5;if((!r.natural||u>.9)&&(l=o(e,t,r,c,u,0,i)).bounds.scale*l.minor.tick>s)break;u=c/2;if((!r.natural||u>.9)&&(l=o(e,t,r,c,u,0,i)).bounds.scale*l.minor.tick>s)break;return o(e,t,r,c,0,0,i)}while(0);if(a&&"microTickStep"in a){h=a.microTickStep;l=o(e,t,r,c,u,h,i)}else do{h=u/10;if((!r.natural||h>.9)&&(l=o(e,t,r,c,u,h,i)).bounds.scale*l.micro.tick>3)break;h=u/5;if((!r.natural||h>.9)&&(l=o(e,t,r,c,u,h,i)).bounds.scale*l.micro.tick>3)break;h=u/2;if((!r.natural||h>.9)&&(l=o(e,t,r,c,u,h,i)).bounds.scale*l.micro.tick>3)break;h=0}while(0);return h?l:o(e,t,r,c,u,0,i)},buildTicks:function(e,t){var i,n,o,s=e.major.start,r=e.minor.start,l=e.micro.start;if(t.microTicks&&e.micro.tick)i=e.micro.tick,n=l;else if(t.minorTicks&&e.minor.tick)i=e.minor.tick,n=r;else{if(!e.major.tick)return null;i=e.major.tick,n=s}var d=1/e.bounds.scale;if(e.bounds.to<=e.bounds.from||isNaN(d)||!isFinite(d)||i<=0||isNaN(i)||!isFinite(i))return null;for(var c=[],u=[],h=[];n<=e.bounds.to+d;){if(Math.abs(s-n)<i/2){o={value:s};t.majorLabels&&(o.label=a(s,e.major.prec,t));c.push(o);s+=e.major.tick;r+=e.minor.tick;l+=e.micro.tick}else if(Math.abs(r-n)<i/2){if(t.minorTicks){o={value:r};t.minorLabels&&e.minMinorStep<=e.minor.tick*e.bounds.scale&&(o.label=a(r,e.minor.prec,t));u.push(o)}r+=e.minor.tick;l+=e.micro.tick}else{t.microTicks&&h.push({value:l});l+=e.micro.tick}n+=i}return{major:c,minor:u,micro:h}},getTransformerFromModel:function(e){var t=e.bounds.from,i=e.bounds.scale;return function(e){return(e-t)*i}},getTransformerFromPlot:function(e){var t=e.bounds.from,i=e.bounds.scale;return function(e){return e/i+t}}})})},"dojox/charting/scaler/common":function(){define(["dojo/_base/lang"],function(e){var t=function(e,t){return Math.abs(e-t)<=1e-6*(Math.abs(e)+Math.abs(t))},i=e.getObject("dojox.charting.scaler.common",!0),a={};return e.mixin(i,{doIfLoaded:function(e,t,i){if(void 0===a[e])try{a[e]=require(e)}catch(n){a[e]=null}return a[e]?t(a[e]):i()},getNumericLabel:function(e,a,n){var o="";i.doIfLoaded("dojo/number",function(t){o=(n.fixed?t.format(e,{places:a<0?-a:0}):t.format(e))||""},function(){o=n.fixed?e.toFixed(a<0?-a:0):e.toString()});if(n.labelFunc){var s=n.labelFunc(o,e,a);if(s)return s}if(n.labels){for(var r=n.labels,l=0,d=r.length;l<d;){var c=Math.floor((l+d)/2);r[c].value<e?l=c+1:d=c}if(l<r.length&&t(r[l].value,e))return r[l].text;if(--l>=0&&l<r.length&&t(r[l].value,e))return r[l].text;if((l+=2)<r.length&&t(r[l].value,e))return r[l].text}return o}})})},"dojox/charting/plot2d/Default":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(e,t,i,a,n,o,s,r,l,d,c){var u=l.lambda("item.purgeGroup()");return t("dojox.charting.plot2d.Default",[n,o],{defaultParams:{lines:!0,areas:!1,markers:!1,tension:"",animate:!1,enableCache:!1,interpolate:!1},optionalParams:{stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",marker:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:"",zeroLine:0},constructor:function(t,i){this.opt=e.clone(e.mixin(this.opt,this.defaultParams));d.updateWithObject(this.opt,i);d.updateWithPattern(this.opt,i,this.optionalParams);this.animate=this.opt.animate},createPath:function(e,t,i){var a;if(this.opt.enableCache&&e._pathFreePool.length>0){(a=e._pathFreePool.pop()).setShape(i);t.add(a)}else a=t.createPath(i);this.opt.enableCache&&e._pathUsePool.push(a);return a},buildSegments:function(e,t){for(var i=this.series[e],a=t?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0,n=t?Math.min(i.data.length,Math.ceil(this._hScaler.bounds.to)):i.data.length,o=null,s=[],r=a;r<n;r++)if(this.isNullValue(i.data[r]))this.opt.interpolate&&!t||(o=null);else{if(!o){o=[];s.push({index:r,rseg:o})}o.push(t&&i.data[r].hasOwnProperty("y")?i.data[r].y:i.data[r])}return s},render:function(t,n){if(this.zoom&&!this.isDataDirty())return this.performZoom(t,n);this.resetEvents();this.dirty=this.isDirty();var o;if(this.dirty){i.forEach(this.series,u);this._eventSeries={};this.cleanGroup();this.getGroup().setTransform(null);o=this.getGroup();r.forEachRev(this.series,function(e){e.cleanGroup(o)})}for(var l,d,h=this.chart.theme,p=this.events(),_=0;_<this.series.length;_++){var m=this.series[_];if(this.dirty||m.dirty){m.cleanGroup();if(this.opt.enableCache){m._pathFreePool=(m._pathFreePool?m._pathFreePool:[]).concat(m._pathUsePool?m._pathUsePool:[]);m._pathUsePool=[]}if(m.data.length){var g,f=h.next(this.opt.areas?"area":"line",[this.opt,m],!0),b=this._hScaler.scaler.getTransformerFromModel(this._hScaler),y=this._vScaler.scaler.getTransformerFromModel(this._vScaler),v=this._eventSeries[m.name]=new Array(m.data.length);o=m.group;if(m.hidden){this.opt.lines&&(m.dyn.stroke=f.series.stroke);if(m.markers||void 0===m.markers&&this.opt.markers){m.dyn.markerFill=f.marker.fill;m.dyn.markerStroke=f.marker.stroke;m.dyn.marker=f.symbol}this.opt.areas&&(m.dyn.fill=f.series.fill)}else{for(var w=i.some(m.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),x=this.buildSegments(_,w),k=0;k<x.length;k++){var C=x[k];g=w?i.map(C.rseg,function(e,i){return{x:b(i+C.index+1)+n.l,y:t.height-n.b-y(e),data:e}},this):i.map(C.rseg,function(e){return{x:b(e.x)+n.l,y:t.height-n.b-y(e.y),data:e}},this);if(w&&this.opt.interpolate)for(;k<x.length;){k++;(C=x[k])&&(g=g.concat(i.map(C.rseg,function(e,i){return{x:b(i+C.index+1)+n.l,y:t.height-n.b-y(e),data:e}},this)))}var T=this.opt.tension?s.curve(g,this.opt.tension):"";if(this.opt.areas&&g.length>1){var j=this._plotFill(f.series.fill,t,n),S=e.clone(g),$=t.height-n.b;isNaN(this.opt.zeroLine)||($=Math.max(n.t,Math.min(t.height-n.b-y(this.opt.zeroLine),$)));if(this.opt.tension){var M="L"+S[S.length-1].x+","+$+" L"+S[0].x+","+$+" L"+S[0].x+","+S[0].y;m.dyn.fill=o.createPath(T+" "+M).setFill(j).getFill()}else{S.push({x:g[g.length-1].x,y:$});S.push({x:g[0].x,y:$});S.push(g[0]);m.dyn.fill=o.createPolyline(S).setFill(j).getFill()}}if(this.opt.lines||this.opt.markers){l=f.series.stroke;f.series.outline&&((d=m.dyn.outline=s.makeStroke(f.series.outline)).width=2*d.width+(l&&l.width||0))}this.opt.markers&&(m.dyn.marker=f.symbol);var A=null,E=null,N=null;if(l&&f.series.shadow&&g.length>1){var L=f.series.shadow,D=i.map(g,function(e){return{x:e.x+L.dx,y:e.y+L.dy}});this.opt.lines&&(this.opt.tension?m.dyn.shadow=o.createPath(s.curve(D,this.opt.tension)).setStroke(L).getStroke():m.dyn.shadow=o.createPolyline(D).setStroke(L).getStroke());if(this.opt.markers&&f.marker.shadow){L=f.marker.shadow;N=i.map(D,function(e){return this.createPath(m,o,"M"+e.x+" "+e.y+" "+f.symbol).setStroke(L).setFill(L.color)},this)}}if(this.opt.lines&&g.length>1){var P;d&&(this.opt.tension?m.dyn.outline=o.createPath(T).setStroke(d).getStroke():m.dyn.outline=o.createPolyline(g).setStroke(d).getStroke());this.opt.tension?m.dyn.stroke=(P=o.createPath(T)).setStroke(l).getStroke():m.dyn.stroke=(P=o.createPolyline(g)).setStroke(l).getStroke();P.setFilter&&f.series.filter&&P.setFilter(f.series.filter)}var I=null;if(this.opt.markers){var R=f;A=new Array(g.length);E=new Array(g.length);d=null;R.marker.outline&&((d=s.makeStroke(R.marker.outline)).width=2*d.width+(R.marker.stroke?R.marker.stroke.width:0));i.forEach(g,function(e,t){if(this.opt.styleFunc||"number"!=typeof e.data){var i="number"!=typeof e.data?[e.data]:[];this.opt.styleFunc&&i.push(this.opt.styleFunc(e.data));R=h.addMixin(f,"marker",i,!0)}else R=h.post(f,"marker");var a="M"+e.x+" "+e.y+" "+R.symbol;d&&(E[t]=this.createPath(m,o,a).setStroke(d));A[t]=this.createPath(m,o,a).setStroke(R.marker.stroke).setFill(R.marker.fill)},this);m.dyn.markerFill=R.marker.fill;m.dyn.markerStroke=R.marker.stroke;!I&&this.opt.labels&&(I=A[0].getBoundingBox());p?i.forEach(A,function(e,t){var i={element:"marker",index:t+C.index,run:m,shape:e,outline:E[t]||null,shadow:N&&N[t]||null,cx:g[t].x,cy:g[t].y};if(w){i.x=t+C.index+1;i.y=m.data[t+C.index]}else{i.x=C.rseg[t].x;i.y=m.data[t+C.index].y}this._connectEvents(i);v[t+C.index]=i},this):delete this._eventSeries[m.name]}if(this.opt.labels){var F=I?I.width:2,O=I?I.height:2;i.forEach(g,function(e,t){if(this.opt.styleFunc||"number"!=typeof e.data){var i="number"!=typeof e.data?[e.data]:[];this.opt.styleFunc&&i.push(this.opt.styleFunc(e.data));R=h.addMixin(f,"marker",i,!0)}else R=h.post(f,"marker");this.createLabel(o,C.rseg[t],{x:e.x-F/2,y:e.y-O/2,width:F,height:O},R)},this)}}m.dirty=!1}}else{m.dirty=!1;h.skip()}}else{h.skip();this._reconnectEvents(m.name)}}a("dojo-bidi")&&this._checkOrientation(this.group,t,n);if(this.animate){var B=this.getGroup();c.animateTransform(e.delegate({shape:B,duration:1200,transform:[{name:"translate",start:[0,t.height-n.b],end:[0,0]},{name:"scale",start:[1,0],end:[1,1]},{name:"original"}]},this.animate)).play()}this.dirty=!1;return this}})})},"dojox/charting/plot2d/CartesianBase":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/has","./Base","../scaler/primitive","dojox/gfx","dojox/gfx/fx","dojox/lang/utils"],function(e,t,i,a,n,o,s,r,l){var d=function(){return!1};return t("dojox.charting.plot2d.CartesianBase",n,{baseParams:{hAxis:"x",vAxis:"y",labels:!1,labelOffset:10,fixed:!0,precision:1,labelStyle:"inside",htmlLabels:!0,omitLabels:!0,labelFunc:null},constructor:function(t,i){this.axes=["hAxis","vAxis"];this.zoom=null;this.zoomQueue=[];this.lastWindow={vscale:1,hscale:1,xoffset:0,yoffset:0};this.hAxis=i&&i.hAxis||"x";this.vAxis=i&&i.vAxis||"y";this.series=[];this.opt=e.clone(this.baseParams);l.updateWithObject(this.opt,i)},clear:function(){this.inherited(arguments);this._hAxis=null;this._vAxis=null;return this},cleanGroup:function(e,t){this.inherited(arguments);if(!t&&this.chart._nativeClip){var i=this.chart.offsets,a=this.chart.dim,n=Math.max(0,a.width-i.l-i.r),o=Math.max(0,a.height-i.t-i.b);this.group.setClip({x:i.l,y:i.t,width:n,height:o});this._clippedGroup||(this._clippedGroup=this.group.createGroup())}},purgeGroup:function(){this.inherited(arguments);this._clippedGroup=null},getGroup:function(){return this._clippedGroup||this.group},setAxis:function(e){e&&(this[e.vertical?"_vAxis":"_hAxis"]=e);return this},toPage:function(e){var t=this._hAxis,i=this._vAxis,a=t.getScaler(),n=i.getScaler(),o=a.scaler.getTransformerFromModel(a),s=n.scaler.getTransformerFromModel(n),r=this.chart.getCoords(),l=this.chart.offsets,d=this.chart.dim,c=function(e){var a={};a.x=o(e[t.name])+r.x+l.l;a.y=r.y+d.height-l.b-s(e[i.name]);return a};return e?c(e):c},toData:function(e){var t=this._hAxis,i=this._vAxis,a=t.getScaler(),n=i.getScaler(),o=a.scaler.getTransformerFromPlot(a),s=n.scaler.getTransformerFromPlot(n),r=this.chart.getCoords(),l=this.chart.offsets,d=this.chart.dim,c=function(e){var a={};a[t.name]=o(e.x-r.x-l.l);a[i.name]=s(r.y+d.height-e.y-l.b);return a};return e?c(e):c},isDirty:function(){return this.dirty||this._hAxis&&this._hAxis.dirty||this._vAxis&&this._vAxis.dirty},createLabel:function(e,t,i,a){if(this.opt.labels){var n,o,r=this.opt.labelFunc?this.opt.labelFunc.apply(this,[t,this.opt.fixed,this.opt.precision]):this._getLabel(isNaN(t.y)?t:t.y);if("inside"==this.opt.labelStyle){var l=s._base._getTextBox(r,{font:a.series.font});n=i.x+i.width/2;o=i.y+i.height/2+l.h/4;if(l.w>i.width||l.h>i.height)return}else{n=i.x+i.width/2;o=i.y-this.opt.labelOffset}this.renderLabel(e,n,o,r,a,"inside"==this.opt.labelStyle)}},performZoom:function(t,a){var n=this._vAxis.scale||1,o=this._hAxis.scale||1,s=t.height-a.b,l=this._hScaler.bounds,d=(l.from-l.lower)*l.scale,c=this._vScaler.bounds,u=(c.from-c.lower)*c.scale,h=n/this.lastWindow.vscale,p=o/this.lastWindow.hscale,_=(this.lastWindow.xoffset-d)/(1==this.lastWindow.hscale?o:this.lastWindow.hscale),m=(u-this.lastWindow.yoffset)/(1==this.lastWindow.vscale?n:this.lastWindow.vscale),g=this.getGroup(),f=r.animateTransform(e.delegate({shape:g,duration:1200,transform:[{name:"translate",start:[0,0],end:[a.l*(1-p),s*(1-h)]},{name:"scale",start:[1,1],end:[p,h]},{name:"original"},{name:"translate",start:[0,0],end:[_,m]}]},this.zoom));e.mixin(this.lastWindow,{vscale:n,hscale:o,xoffset:d,yoffset:u});this.zoomQueue.push(f);i.connect(f,"onEnd",this,function(){this.zoom=null;this.zoomQueue.shift();this.zoomQueue.length>0&&this.zoomQueue[0].play()});1==this.zoomQueue.length&&this.zoomQueue[0].play();return this},initializeScalers:function(e,t){if(this._hAxis){this._hAxis.initialized()||this._hAxis.calculate(t.hmin,t.hmax,e.width);this._hScaler=this._hAxis.getScaler()}else this._hScaler=o.buildScaler(t.hmin,t.hmax,e.width);if(this._vAxis){this._vAxis.initialized()||this._vAxis.calculate(t.vmin,t.vmax,e.height);this._vScaler=this._vAxis.getScaler()}else this._vScaler=o.buildScaler(t.vmin,t.vmax,e.height);return this},isNullValue:function(e){if(null==e)return!0;var t=this._hAxis?this._hAxis.isNullValue:d,i=this._vAxis?this._vAxis.isNullValue:d;return"number"==typeof e?t(1)||i(e):t(isNaN(e.x)?1:e.x)||null===e.y||i(e.y)}})})},"dojox/charting/plot2d/Base":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojox/gfx","../Element","./common","../axis2d/common","dojo/has"],function(e,t,i,a,n,o,s,r){var l=e("dojox.charting.plot2d.Base",n,{constructor:function(e,t){t&&t.tooltipFunc&&(this.tooltipFunc=t.tooltipFunc)},clear:function(){this.series=[];this.dirty=!0;return this},setAxis:function(e){return this},assignAxes:function(e){t.forEach(this.axes,function(t){this[t]&&this.setAxis(e[this[t]])},this)},addSeries:function(e){this.series.push(e);return this},getSeriesStats:function(){return o.collectSimpleStats(this.series,i.hitch(this,"isNullValue"))},calculateAxes:function(e){this.initializeScalers(e,this.getSeriesStats());return this},initializeScalers:function(){return this},isDataDirty:function(){return t.some(this.series,function(e){return e.dirty})},render:function(e,t){return this},renderLabel:function(e,t,i,n,o,r,l){var d=s.createText[this.opt.htmlLabels&&"vml"!=a.renderer?"html":"gfx"](this.chart,e,t,i,l||"middle",n,o.series.font,o.series.fontColor);r&&(this.opt.htmlLabels&&"vml"!=a.renderer?d.style.pointerEvents="none":d.rawNode&&(d.rawNode.style.pointerEvents="none"));this.opt.htmlLabels&&"vml"!=a.renderer&&this.htmlElements.push(d);return d},getRequiredColors:function(){return this.series.length},_getLabel:function(e){return o.getLabel(e,this.opt.fixed,this.opt.precision)}});r("dojo-bidi")&&l.extend({_checkOrientation:function(e,t,i){this.chart.applyMirroring(this.group,t,i)}});return l})},"dojox/charting/plot2d/common":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojox/gfx","dojox/lang/functional","../scaler/common"],function(e,t,i,a,n,o){var s=e.getObject("dojox.charting.plot2d.common",!0);return e.mixin(s,{doIfLoaded:o.doIfLoaded,makeStroke:function(e){if(!e)return e;("string"==typeof e||e instanceof i)&&(e={color:e});return a.makeParameters(a.defaultStroke,e)},augmentColor:function(e,t){var a=new i(e),n=new i(t);n.a=a.a;return n},augmentStroke:function(e,t){var i=s.makeStroke(e);i&&(i.color=s.augmentColor(i.color,t));return i},augmentFill:function(e,t){new i(t);return"string"==typeof e||e instanceof i?s.augmentColor(e,t):e},defaultStats:{vmin:Number.POSITIVE_INFINITY,vmax:Number.NEGATIVE_INFINITY,hmin:Number.POSITIVE_INFINITY,hmax:Number.NEGATIVE_INFINITY},collectSimpleStats:function(i,a){for(var n=e.delegate(s.defaultStats),o=0;o<i.length;++o)for(var r=i[o],l=0;l<r.data.length;l++)if(!a(r.data[l])){if("number"==typeof r.data[l]){var d=n.vmin,c=n.vmax;t.forEach(r.data,function(e,t){if(!a(e)){var i=t+1,o=e;isNaN(o)&&(o=0);n.hmin=Math.min(n.hmin,i);n.hmax=Math.max(n.hmax,i);n.vmin=Math.min(n.vmin,o);n.vmax=Math.max(n.vmax,o)}});"ymin"in r&&(n.vmin=Math.min(d,r.ymin));"ymax"in r&&(n.vmax=Math.max(c,r.ymax))}else{var u=n.hmin,h=n.hmax;d=n.vmin,c=n.vmax;"xmin"in r&&"xmax"in r&&"ymin"in r&&"ymax"in r||t.forEach(r.data,function(e,t){if(!a(e)){var i="x"in e?e.x:t+1,o=e.y;isNaN(i)&&(i=0);isNaN(o)&&(o=0);n.hmin=Math.min(n.hmin,i);n.hmax=Math.max(n.hmax,i);n.vmin=Math.min(n.vmin,o);n.vmax=Math.max(n.vmax,o)}});"xmin"in r&&(n.hmin=Math.min(u,r.xmin));"xmax"in r&&(n.hmax=Math.max(h,r.xmax));"ymin"in r&&(n.vmin=Math.min(d,r.ymin));"ymax"in r&&(n.vmax=Math.max(c,r.ymax))}break}return n},calculateBarSize:function(e,t,i){i||(i=1);var a=t.gap,n=(e-2*a)/i;"minBarSize"in t&&(n=Math.max(n,t.minBarSize));"maxBarSize"in t&&(n=Math.min(n,t.maxBarSize));return{size:n=Math.max(n,1),gap:a=(e-n*i)/2}},collectStackedStats:function(t){var i=e.clone(s.defaultStats);if(t.length){i.hmin=Math.min(i.hmin,1);i.hmax=n.foldl(t,"seed, run -> Math.max(seed, run.data.length)",i.hmax);for(var a=0;a<i.hmax;++a){var o=t[0].data[a];o=o&&("number"==typeof o?o:o.y);isNaN(o)&&(o=0);i.vmin=Math.min(i.vmin,o);for(var r=1;r<t.length;++r){var l=t[r].data[a];l=l&&("number"==typeof l?l:l.y);isNaN(l)&&(l=0);o+=l}i.vmax=Math.max(i.vmax,o)}}return i},curve:function(e,i){var a=e.slice(0);"x"==i&&(a[a.length]=a[0]);return t.map(a,function(e,t){if(0==t)return"M"+e.x+","+e.y;if(!isNaN(i)){var n=e.x-a[t-1].x,o=a[t-1].y;return"C"+(e.x-n/i*(i-1))+","+o+" "+(e.x-n/i)+","+e.y+" "+e.x+","+e.y}if("X"==i||"x"==i||"S"==i){var s,r,l,d,c,u,h=a[t-1],p=a[t],_=1/6;if(1==t){s="x"==i?a[a.length-2]:h;_=1/3}else s=a[t-2];if(t==a.length-1){r="x"==i?a[1]:p;_=1/3}else r=a[t+1];var m=Math.sqrt((p.x-h.x)*(p.x-h.x)+(p.y-h.y)*(p.y-h.y)),g=Math.sqrt((p.x-s.x)*(p.x-s.x)+(p.y-s.y)*(p.y-s.y)),f=Math.sqrt((r.x-h.x)*(r.x-h.x)+(r.y-h.y)*(r.y-h.y)),b=g*_,y=f*_;if(b>m/2&&y>m/2){b=m/2;y=m/2}else if(b>m/2){b=m/2;y=m/2*f/g}else if(y>m/2){y=m/2;b=m/2*g/f}if("S"==i){s==h&&(b=0);p==r&&(y=0)}l=h.x+b*(p.x-s.x)/g;d=h.y+b*(p.y-s.y)/g;c=p.x-y*(r.x-h.x)/f;u=p.y-y*(r.y-h.y)/f}return"C"+l+","+d+" "+c+","+u+" "+p.x+","+p.y}).join(" ")},getLabel:function(e,t,i){return o.doIfLoaded("dojo/number",function(a){return(t?a.format(e,{places:i}):a.format(e))||""},function(){return t?e.toFixed(i):e.toString()})}})})},"dojox/charting/scaler/primitive":function(){define(["dojo/_base/lang"],function(e){var t=e.getObject("dojox.charting.scaler.primitive",!0);return e.mixin(t,{buildScaler:function(e,i,a,n){if(e==i){e-=.5;i+=.5}return{bounds:{lower:e,upper:i,from:e,to:i,scale:a/(i-e),span:a},scaler:t}},buildTicks:function(e,t){return{major:[],minor:[],micro:[]}},getTransformerFromModel:function(e){var t=e.bounds.from,i=e.bounds.scale;return function(e){return(e-t)*i}},getTransformerFromPlot:function(e){var t=e.bounds.from,i=e.bounds.scale;return function(e){return e/i+t}}})})},"dojox/gfx/fx":function(){define(["dojo/_base/lang","./_base","./matrix","dojo/_base/Color","dojo/_base/array","dojo/_base/fx","dojo/_base/connect","dojo/sniff"],function(e,t,i,a,n,o,s,r){var l=t.fx={};function d(e,t){this.start=e,this.end=t}d.prototype.getValue=function(e){return(this.end-this.start)*e+this.start};function c(e,t,i){this.start=e,this.end=t;this.units=i}c.prototype.getValue=function(e){return(this.end-this.start)*e+this.start+this.units};function u(e,t){this.start=e,this.end=t;this.temp=new a}u.prototype.getValue=function(e){return a.blendColors(this.start,this.end,e,this.temp)};function h(e){this.values=e;this.length=e.length}h.prototype.getValue=function(e){return this.values[Math.min(Math.floor(e*this.length),this.length-1)]};function p(e,t){this.values=e;this.def=t||{}}p.prototype.getValue=function(t){var i=e.clone(this.def);for(var a in this.values)i[a]=this.values[a].getValue(t);return i};function _(e,t){this.stack=e;this.original=t}_.prototype.getValue=function(e){var t=[];n.forEach(this.stack,function(a){if(a instanceof i.Matrix2D)t.push(a);else if("original"==a.name&&this.original)t.push(this.original);else if("matrix"!=a.name){if(a.name in i){var o=i[a.name];if("function"==typeof o){var s=n.map(a.start,function(t,i){return(a.end[i]-t)*e+t}),r=o.apply(i,s);r instanceof i.Matrix2D&&t.push(r)}else t.push(o)}}else if(a.start instanceof i.Matrix2D&&a.end instanceof i.Matrix2D){var l=new i.Matrix2D;for(var d in a.start)l[d]=(a.end[d]-a.start[d])*e+a.start[d];t.push(l)}},this);return t};var m=new a(0,0,0,0);function g(e,i,a,n){if(e.values)return new h(e.values);var o,s,r;s=e.start?t.normalizeColor(e.start):o=i?a?i[a]:i:n;if(e.end)r=t.normalizeColor(e.end);else{o||(o=i?a?i[a]:i:n);r=o}return new u(s,r)}l.animateStroke=function(e){e.easing||(e.easing=o._defaultEasing);var t,i=new o.Animation(e),a=e.shape;s.connect(i,"beforeBegin",i,function(){t=a.getStroke();var i,n,o=e.color,s={};o&&(s.color=g(o,t,"color",m));(o=e.style)&&o.values&&(s.style=new h(o.values));(o=e.width)&&(s.width=function(e,t,i,a){if(e.values)return new h(e.values);var n,o,s;o=e.start?e.start:n=t?t[i]:a;if(e.end)s=e.end;else{"number"!=typeof n&&(n=t?t[i]:a);s=n}return new d(o,s)}(o,t,"width",1));(o=e.cap)&&o.values&&(s.cap=new h(o.values));if(o=e.join)if(o.values)s.join=new h(o.values);else{i=o.start?o.start:t&&t.join||0;n=o.end?o.end:t&&t.join||0;"number"==typeof i&&"number"==typeof n&&(s.join=new d(i,n))}this.curve=new p(s,t)});s.connect(i,"onAnimate",a,"setStroke");return i};l.animateFill=function(e){e.easing||(e.easing=o._defaultEasing);var t,i=new o.Animation(e),a=e.shape;s.connect(i,"beforeBegin",i,function(){t=a.getFill();var i=e.color;i&&(this.curve=g(i,t,"",m))});s.connect(i,"onAnimate",a,"setFill");return i};l.animateFont=function(e){e.easing||(e.easing=o._defaultEasing);var t,i=new o.Animation(e),a=e.shape;s.connect(i,"beforeBegin",i,function(){t=a.getFont();var i,n,o=e.style,s={};o&&o.values&&(s.style=new h(o.values));(o=e.variant)&&o.values&&(s.variant=new h(o.values));(o=e.weight)&&o.values&&(s.weight=new h(o.values));(o=e.family)&&o.values&&(s.family=new h(o.values));if((o=e.size)&&o.units){i=parseFloat(o.start?o.start:a.font&&a.font.size||"0");n=parseFloat(o.end?o.end:a.font&&a.font.size||"0");s.size=new c(i,n,o.units)}this.curve=new p(s,t)});s.connect(i,"onAnimate",a,"setFont");return i};l.animateTransform=function(e){e.easing||(e.easing=o._defaultEasing);var i,a=new o.Animation(e),l=e.shape;s.connect(a,"beforeBegin",a,function(){i=l.getTransform();this.curve=new _(e.transform,i)});s.connect(a,"onAnimate",l,"setTransform");if("svg"===t.renderer&&(r("ie")>=9||r("ff")))var d=[s.connect(a,"onBegin",a,function(){for(var e=l.getParent();e&&e.getParent;)e=e.getParent();if(e){l.__svgContainer=e.rawNode.parentNode;l.__svgRoot=e.rawNode;if(l.__svgRoot&&l.__svgRoot.getAttribute){l.__svgWidth=parseInt(l.__svgRoot.getAttribute("width"),10);isNaN(l.__svgWidth)&&delete l.__svgWidth}}}),s.connect(a,"onAnimate",a,function(){try{if(l.__svgContainer){var e=l.__svgContainer.style.visibility;l.__svgContainer.style.visibility="visible";l.__svgContainer.offsetHeight;l.__svgContainer.style.visibility=e;var t=l.__svgWidth;if(!isNaN(t))try{l.__svgRoot.setAttribute("width",t-5e-6);l.__svgRoot.setAttribute("width",t)}catch(i){}}}catch(a){}}),s.connect(a,"onEnd",a,function(){n.forEach(d,s.disconnect);if(l.__svgContainer){var e=l.__svgContainer;if(null==e.getAttribute("__gotVis")){e.setAttribute("__gotVis",!0);var t=l.__svgContainer.style.visibility,i=l.__svgRoot,a=l.__svgWidth;e.style.visibility="visible";setTimeout(function(){try{e.style.visibility=t;e.removeAttribute("__gotVis");e=null;try{if(!isNaN(a)){i.setAttribute("width",a-5e-6);i.setAttribute("width",a)}}catch(n){}}catch(o){}},100)}}delete l.__svgContainer;delete l.__svgRoot;delete l.__svgWidth})];return a};return l})},"dojox/charting/plot2d/_PlotEvents":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/_base/connect"],function(e,t,i,a){return i("dojox.charting.plot2d._PlotEvents",null,{constructor:function(){this._shapeEvents=[];this._eventSeries={}},destroy:function(){this.resetEvents();this.inherited(arguments)},plotEvent:function(e){},raiseEvent:function(i){this.plotEvent(i);var a=e.delegate(i);a.originalEvent=i.type;a.originalPlot=i.plot;a.type="onindirect";t.forEach(this.chart.stack,function(e){if(e!==this&&e.plotEvent){a.plot=e;e.plotEvent(a)}},this)},connect:function(e,t){this.dirty=!0;return a.connect(this,"plotEvent",e,t)},events:function(){return!!this.plotEvent.after},resetEvents:function(){if(this._shapeEvents.length){t.forEach(this._shapeEvents,function(e){e.shape.disconnect(e.handle)});this._shapeEvents=[]}this.raiseEvent({type:"onplotreset",plot:this})},_connectSingleEvent:function(e,t){this._shapeEvents.push({shape:e.eventMask,handle:e.eventMask.connect(t,this,function(i){e.type=t;e.event=i;this.raiseEvent(e);e.event=null})})},_connectEvents:function(e){if(e){e.chart=this.chart;e.plot=this;e.hAxis=this.hAxis||null;e.vAxis=this.vAxis||null;e.eventMask=e.eventMask||e.shape;this._connectSingleEvent(e,"onmouseover");this._connectSingleEvent(e,"onmouseout");this._connectSingleEvent(e,"onclick")}},_reconnectEvents:function(e){var i=this._eventSeries[e];i&&t.forEach(i,this._connectEvents,this)},fireEvent:function(e,t,i,a){var n=this._eventSeries[e];if(n&&n.length&&i<n.length){var o=n[i];o.type=t;o.event=a||null;this.raiseEvent(o);o.event=null}}})})},"dojox/charting/plot2d/Lines":function(){define(["dojo/_base/declare","./Default"],function(e,t){return e("dojox.charting.plot2d.Lines",t,{constructor:function(){this.opt.lines=!0}})})},"dojox/charting/plot2d/Areas":function(){define(["dojo/_base/declare","./Default"],function(e,t){return e("dojox.charting.plot2d.Areas",t,{constructor:function(){this.opt.lines=!0;this.opt.areas=!0}})})},"dojox/charting/plot2d/Markers":function(){define(["dojo/_base/declare","./Default"],function(e,t){return e("dojox.charting.plot2d.Markers",t,{constructor:function(){this.opt.markers=!0}})})},"dojox/charting/plot2d/MarkersOnly":function(){define(["dojo/_base/declare","./Default"],function(e,t){return e("dojox.charting.plot2d.MarkersOnly",t,{constructor:function(){this.opt.lines=!1;this.opt.markers=!0}})})},"dojox/charting/plot2d/Scatter":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx","dojox/gfx/gradutils"],function(e,t,i,a,n,o,s,r,l,d,c,u){var h=l.lambda("item.purgeGroup()");return i("dojox.charting.plot2d.Scatter",[n,o],{defaultParams:{shadows:null,animate:null},optionalParams:{markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:"",styleFunc:null},constructor:function(t,i){this.opt=e.clone(e.mixin(this.opt,this.defaultParams));d.updateWithObject(this.opt,i);d.updateWithPattern(this.opt,i,this.optionalParams);this.animate=this.opt.animate},render:function(e,i){if(this.zoom&&!this.isDataDirty())return this.performZoom(e,i);this.resetEvents();this.dirty=this.isDirty();var n;if(this.dirty){t.forEach(this.series,h);this._eventSeries={};this.cleanGroup();n=this.getGroup();r.forEachRev(this.series,function(e){e.cleanGroup(n)})}for(var o=this.chart.theme,l=this.events(),d=0;d<this.series.length;d++){var c=this.series[d];if(this.dirty||c.dirty){c.cleanGroup();if(c.data.length){var p,_=o.next("marker",[this.opt,c]),m=this._hScaler.scaler.getTransformerFromModel(this._hScaler),g=this._vScaler.scaler.getTransformerFromModel(this._vScaler);if(c.hidden){c.dyn.marker=_.symbol;c.dyn.markerFill=_.marker.fill;c.dyn.markerStroke=_.marker.stroke}else{n=c.group;p="number"==typeof c.data[0]?t.map(c.data,function(t,a){return{x:m(a+1)+i.l,y:e.height-i.b-g(t)}},this):t.map(c.data,function(t,a){return{x:m(t.x)+i.l,y:e.height-i.b-g(t.y)}},this);var f=new Array(p.length),b=new Array(p.length),y=new Array(p.length);t.forEach(p,function(t,a){var r,l=c.data[a];if(this.opt.styleFunc||"number"!=typeof l){var d="number"!=typeof l?[l]:[];this.opt.styleFunc&&d.push(this.opt.styleFunc(l));r=o.addMixin(_,"marker",d,!0)}else r=o.post(_,"marker");var h="M"+t.x+" "+t.y+" "+r.symbol;if(r.marker.shadow){f[a]=n.createPath("M"+(t.x+r.marker.shadow.dx)+" "+(t.y+r.marker.shadow.dy)+" "+r.symbol).setStroke(r.marker.shadow).setFill(r.marker.shadow.color);this.animate&&this._animateScatter(f[a],e.height-i.b)}if(r.marker.outline){var p=s.makeStroke(r.marker.outline);p.width=2*p.width+(r.marker.stroke&&r.marker.stroke.width||0);y[a]=n.createPath(h).setStroke(p);this.animate&&this._animateScatter(y[a],e.height-i.b)}var m=s.makeStroke(r.marker.stroke),g=this._plotFill(r.marker.fill,e,i);if(!g||"linear"!==g.type&&"radial"!=g.type)b[a]=n.createPath(h).setStroke(m).setFill(g);else{var v=u.getColor(g,{x:t.x,y:t.y});m&&(m.color=v);b[a]=n.createPath(h).setStroke(m).setFill(v)}if(this.opt.labels){var w=b[a].getBoundingBox();this.createLabel(n,l,w,r)}this.animate&&this._animateScatter(b[a],e.height-i.b)},this);if(b.length){c.dyn.marker=_.symbol;c.dyn.markerStroke=b[b.length-1].getStroke();c.dyn.markerFill=b[b.length-1].getFill()}if(l){var v=new Array(b.length);t.forEach(b,function(e,t){var i={element:"marker",index:t,run:c,shape:e,outline:y&&y[t]||null,shadow:f&&f[t]||null,cx:p[t].x,cy:p[t].y};if("number"==typeof c.data[0]){i.x=t+1;i.y=c.data[t]}else{i.x=c.data[t].x;i.y=c.data[t].y}this._connectEvents(i);v[t]=i},this);this._eventSeries[c.name]=v}else delete this._eventSeries[c.name];c.dirty=!1}}else{c.dirty=!1;o.skip()}}else{o.skip();this._reconnectEvents(c.name)}}this.dirty=!1;a("dojo-bidi")&&this._checkOrientation(this.group,e,i);return this},_animateScatter:function(t,i){c.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[0,i],end:[0,0]},{name:"scale",start:[0,0],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/Stacked":function(){define(["dojo/_base/declare","dojo/_base/lang","./Default","./commonStacked"],function(e,t,i,a){return e("dojox.charting.plot2d.Stacked",i,{getSeriesStats:function(){return a.collectStats(this.series,t.hitch(this,"isNullValue"))},buildSegments:function(e,i){for(var n=this.series[e],o=i?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0,s=i?Math.min(n.data.length-1,Math.ceil(this._hScaler.bounds.to)):n.data.length-1,r=null,l=[],d=t.hitch(this,"isNullValue"),c=o;c<=s;c++){var u=i?a.getIndexValue(this.series,e,c,d):a.getValue(this.series,e,n.data[c]?n.data[c].x:null,d);if(d(u[0])||!i&&null==u[0].y)this.opt.interpolate&&!i||(r=null);else{if(!r){r=[];l.push({index:c,rseg:r})}r.push(u[0])}}return l}})})},"dojox/charting/plot2d/commonStacked":function(){define(["dojo/_base/lang","dojox/lang/functional","./common"],function(e,t,i){var a=e.getObject("dojox.charting.plot2d.commonStacked",!0);return e.mixin(a,{collectStats:function(t,n){for(var o=e.delegate(i.defaultStats),s=0;s<t.length;++s)for(var r=t[s],l=0;l<r.data.length;l++){var d,c;if(null!==r.data[l]){if("number"!=typeof r.data[l]&&r.data[l].hasOwnProperty("x"))null!==(d=r.data[l].x)&&(c=null!=(c=a.getValue(t,s,d,n)[0])&&c.y?c.y:null);else{c=a.getIndexValue(t,s,l,n)[0];d=l+1}o.hmin=Math.min(o.hmin,d);o.hmax=Math.max(o.hmax,d);o.vmin=Math.min(o.vmin,c);o.vmax=Math.max(o.vmax,c)}}return o},rearrangeValues:function(e,i,a){var n=t.filter(e,"x"),o=n.length;if(!o)return e;for(var s={},r=0;r<o;++r){for(var l=n[r],d=l.min,c=l.max;d<c;++d)l[d]=(l[d]||0)+(s[d]||0);s=l}for(r=0;r<o;++r)for(d=(l=n[r]).min,c=l.max;d<c;++d)l[d]=this.isNullValue(l[d])?0:i(l[d])-a;if(this.opt.minWidth){var u=this.opt.minWidth;for(r=o-1;r;--r){l=n[r];s=n[r-1];for(d=l.min,c=l.max;d<c;++d)l[d]=l[d]-s[d]}var h=l.min,p=l.max;for(d=h;d<p;++d){var _=0,m=0;for(r=0;r<o;++r){var g=n[r][d];if(g>0){_+=g;++m}}if(_<=m*u)for(r=0;r<o;++r)(g=n[r][d])>0&&(n[r][d]=u);else{var f=0;for(r=0;r<o;++r)if((g=(l=n[r])[d])>0)if(g<u){f+=u-g;l[d]=u}else if(f>0){var b=l[d]-u;if(b>=f){l[d]-=f;f=0}else if(b>0){l[d]=u;f-=b}}if(f>0)for(r=o-1;r>=0;--r)if((g=(l=n[r])[d])>0){if((b=l[d]-u)>=f){l[d]-=f;break}if(b>0){l[d]=u;f-=b}}}}for(r=1;r<o;++r){l=n[r];s=n[r-1];for(d=l.min,c=l.max;d<c;++d)l[d]=l[d]+s[d]}}return e},getIndexValue:function(e,t,i,a){var n,o,s,r=0;for(o=0;o<=t;++o)if(!e[o].hidden){s=r;if(!a(n=e[o].data[i])){isNaN(n)&&(n=n.y||0);r+=n}}return[r,s]},getValue:function(e,t,i,a){var n,o,s,r,l=null;for(n=0;n<=t;++n)if(!e[n].hidden)for(o=0;o<e[n].data.length;o++){r=l;if(!a(s=e[n].data[o])){if(s.x==i){l||(l={x:i});if(null!=s.y){null==l.y&&(l.y=0);l.y+=s.y}break}if(s.x>i)break}}return[l,r]}})})},"dojox/charting/plot2d/StackedLines":function(){define(["dojo/_base/declare","./Stacked"],function(e,t){return e("dojox.charting.plot2d.StackedLines",t,{constructor:function(){this.opt.lines=!0}})})},"dojox/charting/plot2d/StackedAreas":function(){define(["dojo/_base/declare","./Stacked"],function(e,t){return e("dojox.charting.plot2d.StackedAreas",t,{constructor:function(){this.opt.lines=!0;this.opt.areas=!0}})})},"dojox/charting/plot2d/Columns":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(e,t,i,a,n,o,s,r,l,d,c){var u=l.lambda("item.purgeGroup()"),h=function(){return!1};return i("dojox.charting.plot2d.Columns",[n,o],{defaultParams:{gap:0,animate:null,enableCache:!1},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(e.mixin(this.opt,this.defaultParams));d.updateWithObject(this.opt,i);d.updateWithPattern(this.opt,i,this.optionalParams);this.animate=this.opt.animate;this.renderingOptions={"shape-rendering":"crispEdges"}},getSeriesStats:function(){var t=s.collectSimpleStats(this.series,e.hitch(this,"isNullValue"));t.hmin-=.5;t.hmax+=.5;return t},createRect:function(e,t,i){var a;if(this.opt.enableCache&&e._rectFreePool.length>0){(a=e._rectFreePool.pop()).setShape(i);t.add(a)}else a=t.createRect(i);this.opt.enableCache&&e._rectUsePool.push(a);return a},render:function(i,n){if(this.zoom&&!this.isDataDirty())return this.performZoom(i,n);this.resetEvents();this.dirty=this.isDirty();var o;if(this.dirty){t.forEach(this.series,u);this._eventSeries={};this.cleanGroup();o=this.getGroup();r.forEachRev(this.series,function(e){e.cleanGroup(o)})}var s=this.chart.theme,l=this._hScaler.scaler.getTransformerFromModel(this._hScaler),d=this._vScaler.scaler.getTransformerFromModel(this._vScaler),c=Math.max(this._vScaler.bounds.lower,this._vAxis?this._vAxis.naturalBaseline:0),h=d(c),p=this.events(),_=this.getBarProperties(),m=0,g=this.extractValues(this._hScaler);g=this.rearrangeValues(g,d,h);for(var f=0;f<this.series.length;f++){var b=this.series[f];if(this.dirty||b.dirty){b.cleanGroup();if(this.opt.enableCache){b._rectFreePool=(b._rectFreePool?b._rectFreePool:[]).concat(b._rectUsePool?b._rectUsePool:[]);b._rectUsePool=[]}var y=s.next("column",[this.opt,b]),v=new Array(b.data.length);if(b.hidden)b.dyn.fill=y.series.fill;else{o=b.group;for(var w=t.some(b.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),x=w?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0,k=w?Math.min(b.data.length,Math.ceil(this._hScaler.bounds.to)):b.data.length,C=x;C<k;++C){var T=b.data[C];if(!this.isNullValue(T)){var j,S,$=this.getValue(T,C,f,w),M=(d($.y),g[f][C]);if(this.opt.styleFunc||"number"!=typeof T){var A="number"!=typeof T?[T]:[];this.opt.styleFunc&&A.push(this.opt.styleFunc(T));j=s.addMixin(y,"column",A,!0)}else j=s.post(y,"column");if(_.width>=1){var E={x:n.l+l($.x+.5)+_.gap+_.thickness*m,y:i.height-n.b-h-Math.max(M,0),width:_.width,height:Math.abs(M)};if(j.series.shadow){var N=e.clone(E);N.x+=j.series.shadow.dx;N.y+=j.series.shadow.dy;S=this.createRect(b,o,N).setFill(j.series.shadow.color).setStroke(j.series.shadow);this.animate&&this._animateColumn(S,i.height-n.b+h,M)}var L=this._plotFill(j.series.fill,i,n);L=this._shapeFill(L,E);var D=this.createRect(b,o,E).setFill(L).setStroke(j.series.stroke);this.overrideShape(D,{index:C,value:$});D.setFilter&&j.series.filter&&D.setFilter(j.series.filter);b.dyn.fill=D.getFill();b.dyn.stroke=D.getStroke();if(p){var P={element:"column",index:C,run:b,shape:D,shadow:S,cx:$.x+.5,cy:$.y,x:w?C:b.data[C].x,y:w?b.data[C]:b.data[C].y};this._connectEvents(P);v[C]=P}!isNaN($.py)&&$.py>c&&(E.height=M-d($.py));this.createLabel(o,T,E,j);this.animate&&this._animateColumn(D,i.height-n.b-h,M)}}}this._eventSeries[b.name]=v;b.dirty=!1;m++}}else{s.skip();this._reconnectEvents(b.name)}}this.dirty=!1;a("dojo-bidi")&&this._checkOrientation(this.group,i,n);return this},getValue:function(e,t,i,a){var n,o;if(a){n="number"==typeof e?e:e.y;o=t}else{n=e.y;o=e.x-1}return{x:o,y:n}},extractValues:function(e){for(var i=[],a=this.series.length-1;a>=0;--a){var n=this.series[a];if(this.dirty||n.dirty){var o=t.some(n.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),s=o?Math.max(0,Math.floor(e.bounds.from-1)):0,r=o?Math.min(n.data.length,Math.ceil(e.bounds.to)):n.data.length,l=i[a]=[];l.min=s;l.max=r;for(var d=s;d<r;++d){var c=n.data[d];l[d]=this.isNullValue(c)?0:"number"==typeof c?c:c.y}}}return i},rearrangeValues:function(e,t,i){for(var a=0,n=e.length;a<n;++a){var o=e[a];if(o)for(var s=o.min,r=o.max;s<r;++s){var l=o[s];o[s]=this.isNullValue(l)?0:t(l)-i}}return e},isNullValue:function(e){if(null==e)return!0;var t=this._hAxis?this._hAxis.isNullValue:h,i=this._vAxis?this._vAxis.isNullValue:h;return"number"==typeof e?i(.5)||t(e):i(isNaN(e.x)?.5:e.x+.5)||null===e.y||t(e.y)},getBarProperties:function(){var e=s.calculateBarSize(this._hScaler.bounds.scale,this.opt);return{gap:e.gap,width:e.size,thickness:0}},_animateColumn:function(t,i,a){0===a&&(a=1);c.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[0,i-i/a],end:[0,0]},{name:"scale",start:[1,1/a],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/StackedColumns":function(){define(["dojo/_base/declare","dojo/_base/lang","./Columns","./commonStacked"],function(e,t,i,a){return e("dojox.charting.plot2d.StackedColumns",i,{getSeriesStats:function(){var e=a.collectStats(this.series,t.hitch(this,"isNullValue"));e.hmin-=.5;e.hmax+=.5;return e},rearrangeValues:function(e,t,i){return a.rearrangeValues.call(this,e,t,i)}})})},"dojox/charting/plot2d/ClusteredColumns":function(){define(["dojo/_base/declare","dojo/_base/array","./Columns","./common"],function(e,t,i,a){return e("dojox.charting.plot2d.ClusteredColumns",i,{getBarProperties:function(){var e=this.series.length;t.forEach(this.series,function(t){t.hidden&&e--});var i=a.calculateBarSize(this._hScaler.bounds.scale,this.opt,e);return{gap:i.gap,width:i.size,thickness:i.size,clusterSize:e}}})})},"dojox/charting/plot2d/Bars":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/gfx/fx","dojox/lang/utils","dojox/lang/functional","dojox/lang/functional/reversed"],function(e,t,i,a,n,o,s,r,l,d,c){var u=c.lambda("item.purgeGroup()"),h=function(){return!1};return i("dojox.charting.plot2d.Bars",[n,o],{defaultParams:{gap:0,animate:null,enableCache:!1},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(e.mixin(this.opt,this.defaultParams));l.updateWithObject(this.opt,i);l.updateWithPattern(this.opt,i,this.optionalParams);this.animate=this.opt.animate;this.renderingOptions={"shape-rendering":"crispEdges"}},getSeriesStats:function(){var t,i=s.collectSimpleStats(this.series,e.hitch(this,"isNullValue"));i.hmin-=.5;i.hmax+=.5;t=i.hmin,i.hmin=i.vmin,i.vmin=t;t=i.hmax,i.hmax=i.vmax,i.vmax=t;return i},createRect:function(e,t,i){var a;if(this.opt.enableCache&&e._rectFreePool.length>0){(a=e._rectFreePool.pop()).setShape(i);t.add(a)}else a=t.createRect(i);this.opt.enableCache&&e._rectUsePool.push(a);return a},createLabel:function(e,t,i,a){if(this.opt.labels&&"outside"==this.opt.labelStyle){var n=i.y+i.height/2,o=i.x+i.width+this.opt.labelOffset;this.renderLabel(e,o,n,this._getLabel(isNaN(t.y)?t:t.y),a,"start")}else this.inherited(arguments)},render:function(i,n){if(this.zoom&&!this.isDataDirty())return this.performZoom(i,n);this.dirty=this.isDirty();this.resetEvents();var o;if(this.dirty){t.forEach(this.series,u);this._eventSeries={};this.cleanGroup();o=this.getGroup();d.forEachRev(this.series,function(e){e.cleanGroup(o)})}var s=this.chart.theme,r=this._hScaler.scaler.getTransformerFromModel(this._hScaler),l=this._vScaler.scaler.getTransformerFromModel(this._vScaler),c=Math.max(this._hScaler.bounds.lower,this._hAxis?this._hAxis.naturalBaseline:0),h=r(c),p=this.events(),_=this.getBarProperties(),m=this.series.length;t.forEach(this.series,function(e){e.hidden&&m--});var g=m,f=this.extractValues(this._vScaler);f=this.rearrangeValues(f,r,h);for(var b=0;b<this.series.length;b++){var y=this.series[b];if(this.dirty||y.dirty){y.cleanGroup();if(this.opt.enableCache){y._rectFreePool=(y._rectFreePool?y._rectFreePool:[]).concat(y._rectUsePool?y._rectUsePool:[]);y._rectUsePool=[]}var v=s.next("bar",[this.opt,y]);if(y.hidden){y.dyn.fill=v.series.fill;y.dyn.stroke=v.series.stroke}else{g--;var w=new Array(y.data.length);o=y.group;for(var x=t.some(y.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),k=x?Math.max(0,Math.floor(this._vScaler.bounds.from-1)):0,C=x?Math.min(y.data.length,Math.ceil(this._vScaler.bounds.to)):y.data.length,T=k;T<C;++T){var j=y.data[T];if(!this.isNullValue(j)){var S,$,M=this.getValue(j,T,b,x),A=f[b][T];if(this.opt.styleFunc||"number"!=typeof j){var E="number"!=typeof j?[j]:[];this.opt.styleFunc&&E.push(this.opt.styleFunc(j));S=s.addMixin(v,"bar",E,!0)}else S=s.post(v,"bar");if(A&&_.height>=1){var N={x:n.l+h+Math.min(A,0),y:i.height-n.b-l(M.x+1.5)+_.gap+_.thickness*(m-g-1),width:Math.abs(A),height:_.height};if(S.series.shadow){var L=e.clone(N);L.x+=S.series.shadow.dx;L.y+=S.series.shadow.dy;$=this.createRect(y,o,L).setFill(S.series.shadow.color).setStroke(S.series.shadow);this.animate&&this._animateBar($,n.l+h,-A)}var D=this._plotFill(S.series.fill,i,n);D=this._shapeFill(D,N);var P=this.createRect(y,o,N).setFill(D).setStroke(S.series.stroke);P.setFilter&&S.series.filter&&P.setFilter(S.series.filter);y.dyn.fill=P.getFill();y.dyn.stroke=P.getStroke();if(p){var I={element:"bar",index:T,run:y,shape:P,shadow:$,cx:M.y,cy:M.x+1.5,x:x?T:y.data[T].x,y:x?y.data[T]:y.data[T].y};this._connectEvents(I);w[T]=I}if(!isNaN(M.py)&&M.py>c){N.x+=r(M.py);N.width-=r(M.py)}this.createLabel(o,j,N,S);this.animate&&this._animateBar(P,n.l+h,-Math.abs(A))}}}this._eventSeries[y.name]=w;y.dirty=!1}}else{s.skip();this._reconnectEvents(y.name)}}this.dirty=!1;a("dojo-bidi")&&this._checkOrientation(this.group,i,n);return this},getValue:function(e,t,i,a){var n,o;if(a){n="number"==typeof e?e:e.y;o=t}else{n=e.y;o=e.x-1}return{y:n,x:o}},extractValues:function(e){for(var i=[],a=this.series.length-1;a>=0;--a){var n=this.series[a];if(this.dirty||n.dirty){var o=t.some(n.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),s=o?Math.max(0,Math.floor(e.bounds.from-1)):0,r=o?Math.min(n.data.length,Math.ceil(e.bounds.to)):n.data.length,l=i[a]=[];l.min=s;l.max=r;for(var d=s;d<r;++d){var c=n.data[d];l[d]=this.isNullValue(c)?0:"number"==typeof c?c:c.y}}}return i},rearrangeValues:function(e,t,i){for(var a=0,n=e.length;a<n;++a){var o=e[a];if(o)for(var s=o.min,r=o.max;s<r;++s){var l=o[s];o[s]=this.isNullValue(l)?0:t(l)-i}}return e},isNullValue:function(e){if(null==e)return!0;var t=this._hAxis?this._hAxis.isNullValue:h,i=this._vAxis?this._vAxis.isNullValue:h;return"number"==typeof e?i(.5)||t(e):i(isNaN(e.x)?.5:e.x+.5)||null===e.y||t(e.y)},getBarProperties:function(){var e=s.calculateBarSize(this._vScaler.bounds.scale,this.opt);return{gap:e.gap,height:e.size,thickness:0}},_animateBar:function(t,i,a){0==a&&(a=1);r.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[i-i/a,0],end:[0,0]},{name:"scale",start:[1/a,1],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/StackedBars":function(){define(["dojo/_base/declare","dojo/_base/lang","./Bars","./commonStacked"],function(e,t,i,a){return e("dojox.charting.plot2d.StackedBars",i,{getSeriesStats:function(){var e,i=a.collectStats(this.series,t.hitch(this,"isNullValue"));i.hmin-=.5;i.hmax+=.5;e=i.hmin,i.hmin=i.vmin,i.vmin=e;e=i.hmax,i.hmax=i.vmax,i.vmax=e;return i},rearrangeValues:function(e,t,i){return a.rearrangeValues.call(this,e,t,i)}})})},"dojox/charting/plot2d/ClusteredBars":function(){define(["dojo/_base/declare","dojo/_base/array","./Bars","./common"],function(e,t,i,a){return e("dojox.charting.plot2d.ClusteredBars",i,{getBarProperties:function(){var e=this.series.length;t.forEach(this.series,function(t){t.hidden&&e--});var i=a.calculateBarSize(this._vScaler.bounds.scale,this.opt,e);return{gap:i.gap,height:i.size,thickness:i.size}}})})},"dojox/charting/plot2d/Grid":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/sniff","./CartesianBase","./common","dojox/lang/utils","dojox/gfx/fx"],function(e,t,i,a,n,o,s,r){var l=function(e,t){return e.value-t.value};return t("dojox.charting.plot2d.Grid",n,{defaultParams:{hMajorLines:!0,hMinorLines:!1,vMajorLines:!0,vMinorLines:!1,hStripes:!1,vStripes:!1,animate:null,enableCache:!1,renderOnAxis:!0},optionalParams:{majorHLine:{},minorHLine:{},majorVLine:{},minorVLine:{},hFill:{},vFill:{},hAlternateFill:{},vAlternateFill:{}},constructor:function(t,i){this.opt=e.clone(this.defaultParams);s.updateWithObject(this.opt,i);s.updateWithPattern(this.opt,i,this.optionalParams);this.animate=this.opt.animate;if(this.opt.enableCache){this._lineFreePool=[];this._lineUsePool=[];this._rectFreePool=[];this._rectUsePool=[]}},addSeries:function(e){return this},getSeriesStats:function(){return e.delegate(o.defaultStats)},cleanGroup:function(){this.inherited(arguments);if(this.opt.enableCache){this._lineFreePool=this._lineFreePool.concat(this._lineUsePool);this._lineUsePool=[];this._rectFreePool=this._rectFreePool.concat(this._rectUsePool);this._rectUsePool=[]}},createLine:function(e,t){var i;if(this.opt.enableCache&&this._lineFreePool.length>0){(i=this._lineFreePool.pop()).setShape(t);e.add(i)}else i=e.createLine(t);this.opt.enableCache&&this._lineUsePool.push(i);return i},createRect:function(e,t){var i;if(this.opt.enableCache&&this._rectFreePool.length>0){(i=this._rectFreePool.pop()).setShape(t);e.add(i)}else i=e.createRect(t);this.opt.enableCache&&this._rectUsePool.push(i);return i},render:function(e,t){if(this.zoom)return this.performZoom(e,t);this.dirty=this.isDirty();if(!this.dirty)return this;this.cleanGroup();var i,n,o=this.getGroup(),s=this.chart.theme;if(a("ios")&&a("ios")<6||a("android")||a("safari")&&!a("ios")){var r=Math.max(0,e.width-t.l-t.r),l=Math.max(0,e.height-t.t-t.b);o.createRect({x:t.l,y:t.t,width:r,height:l})}if(this._vAxis){n=this._vAxis.getTicks();var d=this._vAxis.getScaler();if(null!=n&&null!=d){var c=d.scaler.getTransformerFromModel(d);this.opt.hStripes&&this._renderHRect(n,s.grid,e,t,d,c);if(this.opt.hMinorLines){i=this.opt.minorHLine||s.grid&&s.grid.minorLine||s.axis.minorTick;this._renderHLines(n.minor,i,e,t,d,c)}if(this.opt.hMajorLines){i=this.opt.majorHLine||s.grid&&s.grid.majorLine||s.axis.majorTick;this._renderHLines(n.major,i,e,t,d,c)}}}if(this._hAxis){n=this._hAxis.getTicks();var u=this._hAxis.getScaler();if(null!=n&&null!=u){var h=u.scaler.getTransformerFromModel(u);this.opt.vStripes&&this._renderVRect(n,s.grid,e,t,u,h);if(n&&this.opt.vMinorLines){i=this.opt.minorVLine||s.grid&&s.grid.minorLine||s.axis.minorTick;this._renderVLines(n.minor,i,e,t,u,h)}if(n&&this.opt.vMajorLines){i=this.opt.majorVLine||s.grid&&s.grid.majorLine||s.axis.majorTick;this._renderVLines(n.major,i,e,t,u,h)}}}this.dirty=!1;return this},_renderHLines:function(e,t,a,n,o,s){var r=this.getGroup();i.forEach(e,function(e){if(this.opt.renderOnAxis||e.value!=(this._vAxis.opt.leftBottom?o.bounds.from:o.bounds.to)){var i=a.height-n.b-s(e.value),l=this.createLine(r,{x1:n.l,y1:i,x2:a.width-n.r,y2:i}).setStroke(t);this.animate&&this._animateGrid(l,"h",n.l,n.r+n.l-a.width)}},this)},_renderVLines:function(e,t,a,n,o,s){var r=this.getGroup();i.forEach(e,function(e){if(this.opt.renderOnAxis||e.value!=(this._hAxis.opt.leftBottom?o.bounds.from:o.bounds.to)){var i=n.l+s(e.value),l=this.createLine(r,{x1:i,y1:n.t,x2:i,y2:a.height-n.b}).setStroke(t);this.animate&&this._animateGrid(l,"v",a.height-n.b,a.height-n.b-n.t)}},this)},_renderHRect:function(e,t,i,a,n,o){var s,r,d,c,u,h=e.major.concat(e.minor);h.sort(l);h[0].value>n.bounds.from&&h.splice(0,0,{value:n.bounds.from});h[h.length-1].value<n.bounds.to&&h.push({value:n.bounds.to});for(var p=this.getGroup(),_=0;_<h.length-1;_++){r=h[_];d=i.height-a.b-o(r.value);c=i.height-a.b-o(h[_+1].value);if(s=_%2==0?this.opt.hAlternateFill||t&&t.alternateFill:this.opt.hFill||t&&t.fill){u=this.createRect(p,{x:a.l,y:d,width:i.width-a.r,height:d-c}).setFill(s);this.animate&&this._animateGrid(u,"h",a.l,a.r+a.l-i.width)}}},_renderVRect:function(e,t,i,a,n,o){var s,r,d,c,u,h=e.major.concat(e.minor);h.sort(l);h[0].value>n.bounds.from&&h.splice(0,0,{value:n.bounds.from});h[h.length-1].value<n.bounds.to&&h.push({value:n.bounds.to});for(var p=this.getGroup(),_=0;_<h.length-1;_++){r=h[_];d=a.l+o(r.value);c=a.l+o(h[_+1].value);if(s=_%2==0?this.opt.vAlternateFill||t&&t.alternateFill:this.opt.vFill||t&&t.fill){u=this.createRect(p,{x:d,y:a.t,width:c-d,height:i.width-a.r}).setFill(s);this.animate&&this._animateGrid(u,"v",i.height-a.b,i.height-a.b-a.t)}}},_animateGrid:function(t,i,a,n){var o="h"==i?[a,0]:[0,a],s="h"==i?[1/n,1]:[1,1/n];r.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:o,end:[0,0]},{name:"scale",start:s,end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/Pie":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/dom-geometry","dojo/_base/Color","./Base","./_PlotEvents","./common","dojox/gfx","dojox/gfx/matrix","dojox/lang/functional","dojox/lang/utils","dojo/has"],function(e,t,i,a,n,o,s,r,l,d,c,u,h){return i("dojox.charting.plot2d.Pie",[o,s],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0,radGrad:"native",fanSize:5,startAngle:0,innerRadius:0,minWidth:0,zeroDataMessage:""},optionalParams:{radius:0,omitLabels:!1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",labelWiring:{}},constructor:function(t,i){this.opt=e.clone(this.defaultParams);u.updateWithObject(this.opt,i);u.updateWithPattern(this.opt,i,this.optionalParams);this.axes=[];this.run=null;this.dyn=[];this.runFilter=[];i&&i.hasOwnProperty("innerRadius")&&(this._plotSetInnerRadius=!0)},clear:function(){this.inherited(arguments);this.dyn=[];this.run=null;return this},setAxis:function(e){return this},addSeries:function(e){this.run=e;return this},getSeriesStats:function(){return e.delegate(r.defaultStats)},getRequiredColors:function(){return this.run?this.run.data.length:0},render:function(i,o){if(!this.dirty)return this;this.resetEvents();this.dirty=!1;this._eventSeries={};this.cleanGroup();var s=this.group,r=this.chart.theme;!this._plotSetInnerRadius&&r&&r.pieInnerRadius&&(this.opt.innerRadius=r.pieInnerRadius);var u,p,_,m,g,f=(i.width-o.l-o.r)/2,b=(i.height-o.t-o.b)/2,y=Math.min(f,b),v="font"in this.opt?this.opt.font:r.axis.tick.titleFont||"",w=v?l.normalizedLength(l.splitFontString(v).size):0,x=this.opt.hasOwnProperty("fontColor")?this.opt.fontColor:r.axis.tick.fontColor,k=d._degToRad(this.opt.startAngle),C=k,T=this.run.data,j=this.events(),S=e.hitch(this,function(){var e=r.clone(),a=c.map(T,function(t){var i=[this.opt,this.run];null!==t&&"number"!=typeof t&&i.push(t);this.opt.styleFunc&&i.push(this.opt.styleFunc(t));return e.next("slice",i,!0)},this);"radius"in this.opt&&(y=this.opt.radius<y?this.opt.radius:y);var l={cx:o.l+f,cy:o.t+b,r:y},d=new n(x);this.opt.innerRadius&&(d.a=.1);var u=this._createRing(s,l).setStroke(d);this.opt.innerRadius&&u.setFill(d);this.opt.zeroDataMessage&&this.renderLabel(s,l.cx,l.cy+w/3,this.opt.zeroDataMessage,{series:{font:v,fontColor:x}},null,"middle");this.dyn=[];t.forEach(T,function(e,t){this.dyn.push({fill:this._plotFill(a[t].series.fill,i,o),stroke:a[t].series.stroke})},this)});if(!this.run&&!this.run.data.ength){S();return this}if("number"==typeof T[0]){u=c.map(T,"x ? Math.max(x, 0) : 0");if(c.every(u,"<= 0")){S();return this}p=c.map(u,"/this",c.foldl(u,"+",0));this.opt.labels&&(_=t.map(p,function(e){return e>0?this._getLabel(100*e)+"%":""},this))}else{if(!(u=c.map(T,"x ? Math.max(x.y, 0) : 0")).length||c.every(u,"<= 0")){S();return this}p=c.map(u,"/this",c.foldl(u,"+",0));this.opt.labels&&(_=t.map(p,function(e,t){if(e<0)return"";var i=T[t];return i.hasOwnProperty("text")?i.text:this._getLabel(100*e)+"%"},this))}var $=c.map(T,function(e){var t=[this.opt,this.run];null!==e&&"number"!=typeof e&&t.push(e);this.opt.styleFunc&&t.push(this.opt.styleFunc(e));return r.next("slice",t,!0)},this);if(this.opt.labels){m=c.foldl1(c.map(_,function(e,t){var i=$[t].series.font;return l._base._getTextBox(e,{font:i}).w},this),"Math.max(a, b)")/2;this.opt.labelOffset<0&&(y=Math.min(f-2*m,b-w)+this.opt.labelOffset)}this.opt.hasOwnProperty("radius")&&(y=this.opt.radius<.9*y?this.opt.radius:.9*y);if(!this.opt.radius&&this.opt.labels&&"columns"==this.opt.labelStyle){y/=2;f>b&&f>2*y&&(y*=f/(2*y));y>=.8*b&&(y=.8*b)}else y>=.9*b&&(y=.9*b);g=y-this.opt.labelOffset;var M={cx:o.l+f,cy:o.t+b,r:y};this.dyn=[];var A,E,N=new Array(p.length),L=[],D=C,P=this.opt.minWidth;t.forEach(p,function(e,t){if(0!==e){var i=D+2*e*Math.PI;t===p.length-1&&(i=k+2*Math.PI);var a=i-D,n=a*y;L[t]={step:a,start:D,end:i,weak:n<P};D=i}else L[t]={step:0,end:D,start:D,weak:!1}});if(P>0){var I,R=0,F=P/y,O=0;for(I=L.length-1;I>=0;I--)if(L[I].weak){++R;O+=L[I].step;L[I].step=F}var B=R*F;if(B>Math.PI){F=Math.PI/R;for(I=0;I<L.length;++I)L[I].weak&&(L[I].step=F);B=Math.PI}if(R>0){F=1-(B-O)/2/Math.PI;for(I=0;I<L.length;++I)L[I].weak||(L[I].step=F*L[I].step)}for(I=0;I<L.length;++I){L[I].start=I?L[I].end:D;L[I].end=L[I].start+L[I].step}for(I=L.length-1;I>=0;--I)if(0!==L[I].step){L[I].end=D+2*Math.PI;break}}D=C;t.some(p,function(t,n){var r,c=T[n],u=$[n];if(t>=1){E=this._plotFill(u.series.fill,i,o);E=this._shapeFill(E,{x:M.cx-M.r,y:M.cy-M.r,width:2*M.r,height:2*M.r});E=this._pseudoRadialFill(E,{x:M.cx,y:M.cy},M.r);r=this._createRing(s,M).setFill(E).setStroke(u.series.stroke);this.dyn.push({fill:E,stroke:u.series.stroke});if(j){A={element:"slice",index:n,run:this.run,shape:r,x:n,y:"number"==typeof c?c:c.y,cx:M.cx,cy:M.cy,cr:y};this._connectEvents(A);N[n]=A}var h;for(h=n+1;h<p.length;h++){u=$[h];this.dyn.push({fill:u.series.fill,stroke:u.series.stroke})}return!0}if(0===L[n].step){this.dyn.push({fill:u.series.fill,stroke:u.series.stroke});return!1}var _,m=L[n].step,g=M.cx+y*Math.cos(D),f=M.cy+y*Math.sin(D),b=M.cx+y*Math.cos(D+m),v=M.cy+y*Math.sin(D+m),w=d._degToRad(this.opt.fanSize);if(u.series.fill&&"radial"===u.series.fill.type&&"fan"===this.opt.radGrad&&m>w){var x,k,C,S,P,I,R,F=s.createGroup(),O=Math.ceil(m/w),B=m/O;E=this._shapeFill(u.series.fill,{x:M.cx-M.r,y:M.cy-M.r,width:2*M.r,height:2*M.r});for(x=0;x<O;++x){k=D+(x-.2)*B;C=D+(x+1+.2)*B;S=0==x?g:M.cx+y*Math.cos(k);P=0==x?f:M.cy+y*Math.sin(k);I=x==O-1?b:M.cx+y*Math.cos(C);R=x==O-1?v:M.cy+y*Math.sin(C);this._createSlice(F,M,y,S,P,I,R,k,B).setFill(this._pseudoRadialFill(E,{x:M.cx,y:M.cy},y,D+(x+.5)*B,D+(x+.5)*B))}_=u.series.stroke;this._createSlice(F,M,y,g,f,b,v,D,m).setStroke(_);r=F}else{_=u.series.stroke;r=this._createSlice(s,M,y,g,f,b,v,D,m).setStroke(_);if((E=u.series.fill)&&"radial"===E.type){E=this._shapeFill(E,{x:M.cx-M.r,y:M.cy-M.r,width:2*M.r,height:2*M.r});"linear"===this.opt.radGrad&&(E=this._pseudoRadialFill(E,{x:M.cx,y:M.cy},y,D,D+m))}else if(E&&"linear"===E.type){var H=e.clone(r.getBoundingBox());if("svg"===l.renderer){var z={w:0,h:0};try{z=a.position(r.rawNode)}catch(q){}z.h>H.height&&(H.height=z.h);z.w>H.width&&(H.width=z.w)}E=this._plotFill(E,i,o);E=this._shapeFill(E,H)}r.setFill(E)}this.dyn.push({fill:E,stroke:u.series.stroke});if(j){A={element:"slice",index:n,run:this.run,shape:r,x:n,y:"number"==typeof c?c:c.y,cx:M.cx,cy:M.cy,cr:y};this._connectEvents(A);N[n]=A}D+=m;return!1},this);if(this.opt.labels){var H=h("dojo-bidi")&&this.chart.isRightToLeft();if("default"==this.opt.labelStyle){D=C=k;t.some(p,function(e,t){if(e<=0&&!this.opt.minWidth)return!1;var a=$[t];if(e>=1){this.renderLabel(s,M.cx,M.cy+w/2,_[t],a,this.opt.labelOffset>0);return!0}var n=C+2*e*Math.PI;t+1==p.length&&(n=k+2*Math.PI);if(this.opt.omitLabels&&n-C<.001)return!1;var o=D+L[t].step/2,r=M.cx+g*Math.cos(o),l=M.cy+g*Math.sin(o)+w/2;this.renderLabel(s,H?i.width-r:r,l,_[t],a,this.opt.labelOffset>0);D+=L[t].step;C=n;return!1},this)}else if("columns"==this.opt.labelStyle){var z=this.opt.omitLabels;D=C=k;var q,G=[],W=0;for(q=p.length-1;q>=0;--q)p[q]&&++W;t.forEach(p,function(e,t){var i=C+2*e*Math.PI;t+1==p.length&&(i=k+2*Math.PI);if(0!==this.minWidth||i-C>=.001){var a=D+L[t].step/2;1!==W||this.opt.minWidth||(a=(C+i)/2);G.push({angle:a,left:Math.cos(a)<0,theme:$[t],index:t,omit:!!z&&i-C<.001})}C=i;D+=L[t].step},this);var U=l._base._getTextBox("a",{font:v,whiteSpace:"nowrap"}).h;this._getProperLabelRadius(G,U,1.1*M.r);var V=M.cx-2*M.r,Y=M.cx+2*M.r;t.forEach(G,function(t){if(!t.omit){var i=$[t.index],n=0;i&&i.axis&&i.axis.tick&&i.axis.tick.labelGap&&(n=i.axis.tick.labelGap);var o=l._base._getTextBox(_[t.index],{font:i.series.font,whiteSpace:"nowrap",paddingLeft:n+"px"}).w,r=M.cx+t.labelR*Math.cos(t.angle),d=M.cy+t.labelR*Math.sin(t.angle),c=t.left?V+o:Y-o,u=t.left?V:c+n,h=M.r,m=s.createPath().moveTo(M.cx+h*Math.cos(t.angle),M.cy+h*Math.sin(t.angle));Math.abs(t.labelR*Math.cos(t.angle))<2*M.r-o&&m.lineTo(r,d);m.lineTo(c,d).setStroke(t.theme.series.labelWiring);m.moveToBack();var g=U/3+d,f=this.renderLabel(s,u,g||0,_[t.index],i,!1,"left");if(j&&!this.opt.htmlLabels){var b=l._base._getTextBox(_[t.index],{font:t.theme.series.font}).w||0,y=l.normalizedLength(l.splitFontString(t.theme.series.font).size);A={element:"labels",index:t.index,run:this.run,shape:f,x:u,y:d,label:_[t.index]};var v=f.getShape(),w=a.position(this.chart.node,!0),x=e.mixin({type:"rect"},{x:v.x,y:v.y-2*y});x.x+=w.x;x.y+=w.y;x.x=Math.round(x.x);x.y=Math.round(x.y);x.width=Math.ceil(b);x.height=Math.ceil(y);A.aroundRect=x;this._connectEvents(A);N[p.length+t.index]=A}}},this)}}var X=0;this._eventSeries[this.run.name]=c.map(T,function(e){return e<=0?null:N[X++]});h("dojo-bidi")&&this._checkOrientation(this.group,i,o);return this},_getProperLabelRadius:function(e,t,i){if(1!=e.length){var a,n,o={},s={},r=2,l=2;for(a=0;a<e.length;++a){n=Math.abs(Math.sin(e[a].angle));if(e[a].left){if(r>n){r=n;o=e[a]}}else if(l>n){l=n;s=e[a]}}o.labelR=s.labelR=i;this._caculateLabelR(o,e,t);this._caculateLabelR(s,e,t)}else e[0].labelR=i},_caculateLabelR:function(e,t,i){var a,n,o,s,r=t.length,l=e.labelR,d=t[e.index].left?-i:i;for(o=0,n=((a=e.index)+1)%r;o<r&&t[a].left===t[n].left;++o){s=(Math.sin(t[a].angle)*l+d)/Math.sin(t[n].angle);l=Math.max(e.labelR,s);t[n].labelR=l;a=(a+1)%r;n=(n+1)%r}o>=r&&(t[0].labelR=e.labelR);for(o=0,n=((a=e.index)||r)-1;o<r&&t[a].left===t[n].left;++o){s=(Math.sin(t[a].angle)*l-d)/Math.sin(t[n].angle);l=Math.max(e.labelR,s);t[n].labelR=l;a=(a||r)-1;n=(n||r)-1}},_createRing:function(e,t){var i=this.opt.innerRadius;i>0?i=t.r*(i/100):i<0&&(i=-i);return i?e.createPath({}).setAbsoluteMode(!0).moveTo(t.cx,t.cy-t.r).arcTo(t.r,t.r,0,!1,!0,t.cx+t.r,t.cy).arcTo(t.r,t.r,0,!0,!0,t.cx,t.cy-t.r).closePath().moveTo(t.cx,t.cy-i).arcTo(i,i,0,!1,!0,t.cx+i,t.cy).arcTo(i,i,0,!0,!0,t.cx,t.cy-i).closePath():e.createCircle(t)},_createSlice:function(e,t,i,a,n,o,s,r,l){var d=this.opt.innerRadius;d>0?d=t.r*(d/100):d<0&&(d=-d);if(d){var c=t.cx+d*Math.cos(r),u=t.cy+d*Math.sin(r),h=t.cx+d*Math.cos(r+l),p=t.cy+d*Math.sin(r+l);return e.createPath({}).setAbsoluteMode(!0).moveTo(c,u).lineTo(a,n).arcTo(i,i,0,l>Math.PI,!0,o,s).lineTo(h,p).arcTo(d,d,0,l>Math.PI,!1,c,u).closePath()}return e.createPath({}).setAbsoluteMode(!0).moveTo(t.cx,t.cy).lineTo(a,n).arcTo(i,i,0,l>Math.PI,!0,o,s).lineTo(t.cx,t.cy).closePath()}})})},"dojox/charting/plot2d/Bubble":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(e,t,i,a,n,o,s,r,l,d,c){var u=l.lambda("item.purgeGroup()");return t("dojox.charting.plot2d.Bubble",[n,o],{defaultParams:{animate:null},optionalParams:{stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",labelFunc:null},constructor:function(t,i){this.opt=e.clone(e.mixin(this.opt,this.defaultParams));d.updateWithObject(this.opt,i);d.updateWithPattern(this.opt,i,this.optionalParams);this.opt.labelFunc||(this.opt.labelFunc=function(e,t,i){return this._getLabel(e.size,t,i)});this.animate=this.opt.animate},render:function(e,t){var n;if(this.zoom&&!this.isDataDirty())return this.performZoom(e,t);this.resetEvents();this.dirty=this.isDirty();if(this.dirty){i.forEach(this.series,u);this._eventSeries={};this.cleanGroup();n=this.getGroup();r.forEachRev(this.series,function(e){e.cleanGroup(n)})}for(var o=this.chart.theme,l=this._hScaler.scaler.getTransformerFromModel(this._hScaler),d=this._vScaler.scaler.getTransformerFromModel(this._vScaler),c=this.events(),h=0;h<this.series.length;h++){var p=this.series[h];if(this.dirty||p.dirty){p.cleanGroup();if(p.data.length){if("number"!=typeof p.data[0]){var _=o.next("circle",[this.opt,p]),m=i.map(p.data,function(i){return i?{x:l(i.x)+t.l,y:e.height-t.b-d(i.y),radius:this._vScaler.bounds.scale*(i.size/2)}:null},this);if(p.hidden){p.dyn.fill=_.series.fill;p.dyn.stroke=_.series.stroke}else{n=p.group;var g=null,f=null,b=null,y=this.opt.styleFunc,v=function(e){return y?o.addMixin(_,"circle",[e,y(e)],!0):o.addMixin(_,"circle",e,!0)};if(_.series.shadow){b=i.map(m,function(i,a){if(!this.isNullValue(i)){var o=v(p.data[a]).series.shadow,s=n.createCircle({cx:i.x+o.dx,cy:i.y+o.dy,r:i.radius}).setStroke(o).setFill(o.color);this.animate&&this._animateBubble(s,e.height-t.b,i.radius);return s}return null},this);b.length&&(p.dyn.shadow=b[b.length-1].getStroke())}if(_.series.outline){f=i.map(m,function(i,a){if(!this.isNullValue(i)){var o=v(p.data[a]),r=s.makeStroke(o.series.outline);r.width=2*r.width+(_.series.stroke&&_.series.stroke.width||0);var l=n.createCircle({cx:i.x,cy:i.y,r:i.radius}).setStroke(r);this.animate&&this._animateBubble(l,e.height-t.b,i.radius);return l}return null},this);f.length&&(p.dyn.outline=f[f.length-1].getStroke())}g=i.map(m,function(i,a){if(!this.isNullValue(i)){var o=v(p.data[a]),s={x:i.x-i.radius,y:i.y-i.radius,width:2*i.radius,height:2*i.radius},r=this._plotFill(o.series.fill,e,t);r=this._shapeFill(r,s);var l=n.createCircle({cx:i.x,cy:i.y,r:i.radius}).setFill(r).setStroke(o.series.stroke);l.setFilter&&o.series.filter&&l.setFilter(o.series.filter);this.animate&&this._animateBubble(l,e.height-t.b,i.radius);this.createLabel(n,p.data[a],s,o);return l}return null},this);if(g.length){p.dyn.fill=g[g.length-1].getFill();p.dyn.stroke=g[g.length-1].getStroke()}if(c){var w=new Array(g.length);i.forEach(g,function(e,t){if(null!==e){var i={element:"circle",index:t,run:p,shape:e,outline:f&&f[t]||null,shadow:b&&b[t]||null,x:p.data[t].x,y:p.data[t].y,r:p.data[t].size/2,cx:m[t].x,cy:m[t].y,cr:m[t].radius};this._connectEvents(i);w[t]=i}},this);this._eventSeries[p.name]=w}else delete this._eventSeries[p.name];p.dirty=!1}}}else{p.dirty=!1;o.skip()}}else{o.skip();this._reconnectEvents(p.name)}}this.dirty=!1;a("dojo-bidi")&&this._checkOrientation(this.group,e,t);return this},_animateBubble:function(t,i,a){c.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[0,i],end:[0,0]},{name:"scale",start:[0,1/a],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/Candlesticks":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(e,t,i,a,n,o,s,r,l,d,c){var u=l.lambda("item.purgeGroup()");return t("dojox.charting.plot2d.Candlesticks",[n,o],{defaultParams:{gap:2,animate:null},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(this.defaultParams);d.updateWithObject(this.opt,i);d.updateWithPattern(this.opt,i,this.optionalParams);this.animate=this.opt.animate},collectStats:function(t){for(var a=e.delegate(s.defaultStats),n=0;n<t.length;n++){var o=t[n];if(o.data.length){var r=a.vmin,l=a.vmax;"ymin"in o&&"ymax"in o||i.forEach(o.data,function(e,t){if(!this.isNullValue(e)){var i=e.x||t+1;a.hmin=Math.min(a.hmin,i);a.hmax=Math.max(a.hmax,i);a.vmin=Math.min(a.vmin,e.open,e.close,e.high,e.low);a.vmax=Math.max(a.vmax,e.open,e.close,e.high,e.low)}},this);"ymin"in o&&(a.vmin=Math.min(r,o.ymin));"ymax"in o&&(a.vmax=Math.max(l,o.ymax))}}return a},getSeriesStats:function(){var e=this.collectStats(this.series);e.hmin-=.5;e.hmax+=.5;return e},render:function(e,t){if(this.zoom&&!this.isDataDirty())return this.performZoom(e,t);this.resetEvents();this.dirty=this.isDirty();var n;if(this.dirty){i.forEach(this.series,u);this._eventSeries={};this.cleanGroup();n=this.getGroup();r.forEachRev(this.series,function(e){e.cleanGroup(n)})}var o,l,d,c=this.chart.theme,h=this._hScaler.scaler.getTransformerFromModel(this._hScaler),p=this._vScaler.scaler.getTransformerFromModel(this._vScaler),_=this.events();l=(o=s.calculateBarSize(this._hScaler.bounds.scale,this.opt)).gap;d=o.size;for(var m=this.series.length-1;m>=0;--m){var g=this.series[m];if(this.dirty||g.dirty){g.cleanGroup();var f=c.next("candlestick",[this.opt,g]),b=new Array(g.data.length);if(g.hidden){g.dyn.fill=f.series.fill;g.dyn.stroke=f.series.stroke}else{n=g.group;for(var y=0;y<g.data.length;++y){var v=g.data[y];if(!this.isNullValue(v)){var w=c.addMixin(f,"candlestick",v,!0),x=h(v.x||y+.5)+t.l+l,k=e.height-t.b,C=p(v.open),T=p(v.close),j=p(v.high),S=p(v.low);if("mid"in v)var $=p(v.mid);if(S>j){var M=j;j=S;S=M}if(d>=1){var A=C>T,E={x1:d/2,x2:d/2,y1:k-j,y2:k-S},N={x:0,y:k-Math.max(C,T),width:d,height:Math.max(A?C-T:T-C,1)},L=n.createGroup();L.setTransform({dx:x,dy:0});var D=L.createGroup();D.createLine(E).setStroke(w.series.stroke);D.createRect(N).setStroke(w.series.stroke).setFill(A?w.series.fill:"white");"mid"in v&&D.createLine({x1:w.series.stroke&&w.series.stroke.width||1,x2:d-(w.series.stroke&&w.series.stroke.width||1),y1:k-$,y2:k-$}).setStroke(A?"white":w.series.stroke);g.dyn.fill=w.series.fill;g.dyn.stroke=w.series.stroke;if(_){var P={element:"candlestick",index:y,run:g,shape:D,x:x,y:k-Math.max(C,T),cx:d/2,cy:k-Math.max(C,T)+Math.max(A?C-T:T-C,1)/2,width:d,height:Math.max(A?C-T:T-C,1),data:v};this._connectEvents(P);b[y]=P}}this.animate&&this._animateCandlesticks(L,k-S,j-S)}}this._eventSeries[g.name]=b;g.dirty=!1}}else{c.skip();this._reconnectEvents(g.name)}}this.dirty=!1;a("dojo-bidi")&&this._checkOrientation(this.group,e,t);return this},tooltipFunc:function(e){return'<table cellpadding="1" cellspacing="0" border="0" style="font-size:0.9em;"><tr><td>Open:</td><td align="right"><strong>'+e.data.open+'</strong></td></tr><tr><td>High:</td><td align="right"><strong>'+e.data.high+'</strong></td></tr><tr><td>Low:</td><td align="right"><strong>'+e.data.low+'</strong></td></tr><tr><td>Close:</td><td align="right"><strong>'+e.data.close+"</strong></td></tr>"+(void 0!==e.data.mid?'<tr><td>Mid:</td><td align="right"><strong>'+e.data.mid+"</strong></td></tr>":"")+"</table>"},_animateCandlesticks:function(t,i,a){c.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[0,i-i/a],end:[0,0]},{name:"scale",start:[1,1/a],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/OHLC":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(e,t,i,a,n,o,s,r,l,d,c){var u=l.lambda("item.purgeGroup()");return i("dojox.charting.plot2d.OHLC",[n,o],{defaultParams:{gap:2,animate:null},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(this.defaultParams);d.updateWithObject(this.opt,i);d.updateWithPattern(this.opt,i,this.optionalParams);this.animate=this.opt.animate},collectStats:function(i){for(var a=e.delegate(s.defaultStats),n=0;n<i.length;n++){var o=i[n];if(o.data.length){var r=a.vmin,l=a.vmax;"ymin"in o&&"ymax"in o||t.forEach(o.data,function(e,t){if(!this.isNullValue(e)){var i=e.x||t+1;a.hmin=Math.min(a.hmin,i);a.hmax=Math.max(a.hmax,i);a.vmin=Math.min(a.vmin,e.open,e.close,e.high,e.low);a.vmax=Math.max(a.vmax,e.open,e.close,e.high,e.low)}},this);"ymin"in o&&(a.vmin=Math.min(r,o.ymin));"ymax"in o&&(a.vmax=Math.max(l,o.ymax))}}return a},getSeriesStats:function(){var e=this.collectStats(this.series);e.hmin-=.5;e.hmax+=.5;return e},render:function(e,i){if(this.zoom&&!this.isDataDirty())return this.performZoom(e,i);this.resetEvents();this.dirty=this.isDirty();if(this.dirty){t.forEach(this.series,u);this._eventSeries={};this.cleanGroup();var n=this.getGroup();r.forEachRev(this.series,function(e){e.cleanGroup(n)})}var o,l,d,c=this.chart.theme,h=this._hScaler.scaler.getTransformerFromModel(this._hScaler),p=this._vScaler.scaler.getTransformerFromModel(this._vScaler),_=this.events();l=(o=s.calculateBarSize(this._hScaler.bounds.scale,this.opt)).gap;d=o.size;for(var m=0;m<this.series.length;m++){var g=this.series[m];if(this.dirty||g.dirty){g.cleanGroup();for(var f=c.next("candlestick",[this.opt,g]),b=(n=g.group,new Array(g.data.length)),y=0;y<g.data.length;++y){var v=g.data[y];if(!this.isNullValue(v)){var w=c.addMixin(f,"candlestick",v,!0),x=h(v.x||y+.5)+i.l+l,k=e.height-i.b,C=p(v.open),T=p(v.close),j=p(v.high),S=p(v.low);if(S>j){var $=j;j=S;S=$}if(d>=1){var M={x1:d/2,x2:d/2,y1:k-j,y2:k-S},A={x1:0,x2:d/2+(w.series.stroke&&w.series.stroke.width||1)/2,y1:k-C,y2:k-C},E={x1:d/2-(w.series.stroke&&w.series.stroke.width||1)/2,x2:d,y1:k-T,y2:k-T},N=n.createGroup();N.setTransform({dx:x,dy:0});var L=N.createGroup();L.createLine(M).setStroke(w.series.stroke);L.createLine(A).setStroke(w.series.stroke);L.createLine(E).setStroke(w.series.stroke);g.dyn.stroke=w.series.stroke;if(_){var D={element:"candlestick",index:y,run:g,shape:L,x:x,y:k-Math.max(C,T),cx:d/2,cy:k-Math.max(C,T)+Math.max(C>T?C-T:T-C,1)/2,width:d,height:Math.max(C>T?C-T:T-C,1),data:v};this._connectEvents(D);b[y]=D}}this.animate&&this._animateOHLC(N,k-S,j-S)}}this._eventSeries[g.name]=b;g.dirty=!1}else{c.skip();this._reconnectEvents(g.name)}}this.dirty=!1;a("dojo-bidi")&&this._checkOrientation(this.group,e,i);return this},_animateOHLC:function(t,i,a){c.animateTransform(e.delegate({shape:t,duration:1200,transform:[{name:"translate",start:[0,i-i/a],end:[0,0]},{name:"scale",start:[1,1/a],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/Spider":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/dom-geometry","dojo/_base/fx","dojo/fx","dojo/sniff","./Base","./_PlotEvents","./common","../axis2d/common","dojox/gfx","dojox/gfx/matrix","dojox/gfx/fx","dojox/lang/functional","dojox/lang/utils","dojo/fx/easing"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g,f){var b=t("dojox.charting.plot2d.Spider",[l,d],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:.2,spiderOrigin:.16,markerSize:3,spiderType:"polygon",animationType:f.backOut,animate:null,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",fontColor:""},constructor:function(t,i){this.opt=e.clone(this.defaultParams);g.updateWithObject(this.opt,i);g.updateWithPattern(this.opt,i,this.optionalParams);this.dyn=[];this.datas={};this.labelKey=[];this.oldSeriePoints={};this.animate=null===this.opt.animate?{}:this.opt.animate;this.animations={}},clear:function(){this.inherited(arguments);this.dyn=[];this.axes=[];this.datas={};this.labelKey=[];this.oldSeriePoints={};this.animations={};return this},setAxis:function(e){if(e){null!=e.opt.min&&(this.datas[e.name].min=e.opt.min);null!=e.opt.max&&(this.datas[e.name].max=e.opt.max)}return this},addSeries:function(e){this.series.push(e);var t;for(t in e.data){var i=e.data[t],a=this.datas[t];if(a){a.vlist.push(i);a.min=Math.min(a.min,i);a.max=Math.max(a.max,i)}else{var n="__"+t;this.axes.push(n);this[n]=t;this.datas[t]={min:i,max:i,vlist:[i]}}}if(this.labelKey.length<=0)for(t in e.data)this.labelKey.push(t);return this},getSeriesStats:function(){return c.collectSimpleStats(this.series,function(e){return null===e})},render:function(e,t){if(!this.dirty)return this;this.dirty=!1;this.cleanGroup();var i=this.group,o=this.chart.theme;this.resetEvents();if(!this.series||!this.series.length)return this;var s,r,l,d,c,_,g,f,b,y,v,w,x,k,C,T,j,S,$=this.opt,M=o.axis,A=(e.width-t.l-t.r)/2,E=(e.height-t.t-t.b)/2,N=Math.min(A,E),L=$.font||M.majorTick&&M.majorTick.font||M.tick&&M.tick.font||"normal normal normal 7pt Tahoma",D=$.axisFont||M.tick&&M.tick.titleFont||"normal normal normal 11pt Tahoma",P=$.axisTickFontColor||M.majorTick&&M.majorTick.fontColor||M.tick&&M.tick.fontColor||"silver",I=$.axisFontColor||M.tick&&M.tick.titleFontColor||"black",R=$.axisColor||M.tick&&M.tick.axisColor||"silver",F=$.spiderColor||M.tick&&M.tick.spiderColor||"silver",O=$.axisWidth||M.stroke&&M.stroke.width||2,B=$.spiderWidth||M.stroke&&M.stroke.width||2,H=$.seriesWidth||M.stroke&&M.stroke.width||2,z=h.normalizedLength(h.splitFontString(D).size),q=p._degToRad($.startAngle),G=$.spiderOrigin,W=$.divisions>=3?$.divisions:3,U=$.markerSize,V=$.spiderType,Y=$.animationType,X=$.labelOffset<-10?$.labelOffset:-10,K=.2;if($.labels){s=a.map(this.series,function(e){return e.name},this);r=m.foldl1(m.map(s,function(e){var t=o.series.font;return h._base._getTextBox(e,{font:t}).w},this),"Math.max(a, b)")/2;l=(N=Math.min(A-2*r,E-z)+X)-X}"radius"in $&&(l=(N=$.radius)-X);N/=1.2;for(var Z={cx:t.l+A,cy:t.t+E,r:N},J=0;J<this.series.length;J++){k=this.series[J];if(this.dirty||k.dirty){k.cleanGroup();if(null!==(C=k.data)){v=this._getObjectLength(C);if(!d||d.length<=0){d=[],c=[],f=[];this._buildPoints(d,v,Z,N,q,!0,e);this._buildPoints(c,v,Z,N*G,q,!0,e);this._buildPoints(f,v,Z,l,q,!1,e);if(W>2){_=[],g=[];for(b=0;b<W-2;b++){_[b]=[];this._buildPoints(_[b],v,Z,N*(G+(1-G)*(b+1)/(W-1)),q,!0,e);g[b]=N*(G+(1-G)*(b+1)/(W-1))}}}}}else o.skip()}var Q=i.createGroup(),ee={color:R,width:O},te={color:F,width:B};for(b=d.length-1;b>=0;--b){var ie={x:(y=d[b]).x+(y.x-Z.cx)*K,y:y.y+(y.y-Z.cy)*K},ae={x:y.x+(y.x-Z.cx)*K/2,y:y.y+(y.y-Z.cy)*K/2};Q.createLine({x1:Z.cx,y1:Z.cy,x2:ie.x,y2:ie.y}).setStroke(ee);this._drawArrow(Q,ie,ae,ee)}var ne=i.createGroup();for(b=f.length-1;b>=0;--b){y=f[b];w=h._base._getTextBox(this.labelKey[b],{font:D}).w||0;x=this.opt.htmlLabels&&"vml"!=h.renderer?"html":"gfx";var oe=u.createText[x](this.chart,ne,n.isBodyLtr()||"html"!=x?y.x:y.x+w-e.width,y.y,"middle",this.labelKey[b],D,I);this.opt.htmlLabels&&this.htmlElements.push(oe)}var se=i.createGroup();if("polygon"==V){se.createPolyline(d).setStroke(te);se.createPolyline(c).setStroke(te);if(_.length>0)for(b=_.length-1;b>=0;--b)se.createPolyline(_[b]).setStroke(te)}else{se.createCircle({cx:Z.cx,cy:Z.cy,r:N}).setStroke(te);se.createCircle({cx:Z.cx,cy:Z.cy,r:N*G}).setStroke(te);if(g.length>0)for(b=g.length-1;b>=0;--b)se.createCircle({cx:Z.cx,cy:Z.cy,r:g[b]}).setStroke(te)}v=this._getObjectLength(this.datas);var re=i.createGroup(),le=0;for(var de in this.datas){j=(T=this.datas[de]).min;S=T.max-j;fe=q+2*Math.PI*le/v;for(J=0;J<W;J++){var ce=j+S*J/(W-1);y=this._getCoordinate(Z,N*(G+(1-G)*J/(W-1)),fe,e);ce=this._getLabel(ce);w=h._base._getTextBox(ce,{font:L}).w||0;x=this.opt.htmlLabels&&"vml"!=h.renderer?"html":"gfx";this.opt.htmlLabels&&this.htmlElements.push(u.createText[x](this.chart,re,n.isBodyLtr()||"html"!=x?y.x:y.x+w-e.width,y.y,"start",ce,L,P))}le++}this.chart.seriesShapes={};for(J=this.series.length-1;J>=0;J--)if(null!==(C=(k=this.series[J]).data)){var ue=o.next("spider",[$,k]),he=h.normalizeColor(ue.series.fill),pe={color:ue.series.fill,width:H};he.a=$.seriesFillAlpha;k.dyn={fill:he,stroke:pe};if(k.hidden)continue;var _e=[],me=[];le=0;for(de in C){j=(T=this.datas[de]).min;S=T.max-j;var ge=C[de],fe=q+2*Math.PI*le/v;y=this._getCoordinate(Z,N*(G+(1-G)*(ge-j)/S),fe,e);_e.push(y);me.push({sname:k.name,key:de,data:ge});le++}_e[_e.length]=_e[0];me[me.length]=me[0];var be=this._getBoundary(_e),ye=k.group,ve=this.oldSeriePoints[k.name],we=this._createSeriesEntry(ye,ve||c,_e,he,pe,N,G,U,Y);this.chart.seriesShapes[k.name]=we;this.oldSeriePoints[k.name]=_e;var xe={element:"spider_poly",index:J,id:"spider_poly_"+k.name,run:k,plot:this,shape:we.poly,parent:ye,brect:be,cx:Z.cx,cy:Z.cy,cr:N,f:he,s:i};this._connectEvents(xe);var ke={element:"spider_plot",index:J,id:"spider_plot_"+k.name,run:k,plot:this,shape:k.group};this._connectEvents(ke);a.forEach(we.circles,function(e,t){var a={element:"spider_circle",index:t,id:"spider_circle_"+k.name+t,run:k,plot:this,shape:e,parent:ye,tdata:me[t],cx:_e[t].x,cy:_e[t].y,f:he,s:i};this._connectEvents(a)},this)}return this},_createSeriesEntry:function(t,n,r,l,d,c,u,h,p){for(var _=this.animate?n:r,m=t.createPolyline(_).setFill(l).setStroke(d),g=[],f=0;f<_.length;f++){var b=_[f],y=h,v=t.createCircle({cx:b.x,cy:b.y,r:y}).setFill(l).setStroke(d);g.push(v)}if(this.animate){var w=a.map(r,function(t,a){var s=n[a],r=new o.Animation(e.delegate({duration:1e3,easing:p,curve:[s.y,t.y]},this.animate)),l=m,d=g[a];i.connect(r,"onAnimate",function(e){var t=l.getShape();t.points[a].y=e;l.setShape(t);var i=d.getShape();i.cy=e;d.setShape(i)});return r},this),x=a.map(r,function(t,a){var s=n[a],r=new o.Animation(e.delegate({duration:1e3,easing:p,curve:[s.x,t.x]},this.animate)),l=m,d=g[a];i.connect(r,"onAnimate",function(e){var t=l.getShape();t.points[a].x=e;l.setShape(t);var i=d.getShape();i.cx=e;d.setShape(i)});return r},this);s.combine(w.concat(x)).play()}return{group:t,poly:m,circles:g}},plotEvent:function(e){"spider_plot"==e.element&&("onmouseover"!=e.type||r("ie")||e.shape.moveToFront())},tooltipFunc:function(e){return"spider_circle"==e.element?e.tdata.sname+"<br/>"+e.tdata.key+"<br/>"+e.tdata.data:null},_getBoundary:function(e){for(var t=e[0].x,i=e[0].x,a=e[0].y,n=e[0].y,o=0;o<e.length;o++){var s=e[o];t=Math.max(s.x,t);a=Math.max(s.y,a);i=Math.min(s.x,i);n=Math.min(s.y,n)}return{x:i,y:n,width:t-i,height:a-n}},_drawArrow:function(e,t,i,a){var n=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),o=(i.y-t.y)/n,s=(i.x-t.x)/n,r={x:i.x+n/3*-o,y:i.y+n/3*s},l={x:i.x+n/3*o,y:i.y+n/3*-s};e.createPolyline([t,r,l]).setFill(a.color).setStroke(a)},_buildPoints:function(e,t,i,a,n,o,s){for(var r=0;r<t;r++){var l=n+2*Math.PI*r/t;e.push(this._getCoordinate(i,a,l,s))}o&&e.push(this._getCoordinate(i,a,n+2*Math.PI,s))},_getCoordinate:function(e,t,i,a){var n=e.cx+t*Math.cos(i);r("dojo-bidi")&&this.chart.isRightToLeft()&&a&&(n=a.width-n);return{x:n,y:e.cy+t*Math.sin(i)}},_getObjectLength:function(t){var i=0;if(e.isObject(t))for(var a in t)i++;return i},_getLabel:function(e){return c.getLabel(e,this.opt.fixed,this.opt.precision)}});return b})},"dojox/charting/themes/Wetland":function(){define(["../SimpleTheme","./common"],function(e,t){t.Wetland=new e({colors:["#bfbc64","#737130","#73373b","#7dafca","#8d3c42"]});return t.Wetland})},"dojox/charting/themes/common":function(){define(["dojo/_base/lang"],function(e){return e.getObject("dojox.charting.themes",!0)})},"dojox/charting/widget/Legend":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojox/gfx","dojo/_base/array","dojo/has","dojo/has!dojo-bidi?../bidi/widget/Legend","dojox/lang/functional","dojo/dom","dojo/dom-construct","dojo/dom-class","dijit/registry"],function(e,t,i,a,n,o,s,r,l,d,c){var u=e(n("dojo-bidi")?"dojox.charting.widget.NonBidiLegend":"dojox.charting.widget.Legend",t,{chartRef:"",horizontal:!0,swatchSize:18,legendBody:null,postCreate:function(){if(!this.chart&&this.chartRef){this.chart=c.byId(this.chartRef)||c.byNode(r.byId(this.chartRef));this.chart||this.chartRef}this.chart=this.chart.chart||this.chart;this.refresh()},buildRendering:function(){this.domNode=l.create("table",{role:"group","aria-label":"chart legend",class:"dojoxLegendNode"});this.legendBody=l.create("tbody",null,this.domNode);this.inherited(arguments)},destroy:function(){this._surfaces&&a.forEach(this._surfaces,function(e){e.destroy()});this.inherited(arguments)},refresh:function(){this._surfaces&&a.forEach(this._surfaces,function(e){e.destroy()});this._surfaces=[];for(;this.legendBody.lastChild;)l.destroy(this.legendBody.lastChild);if(this.horizontal){d.add(this.domNode,"dojoxLegendHorizontal");this._tr=l.create("tr",null,this.legendBody);this._inrow=0}var e=this.series||this.chart.series;if(0!=e.length)if("dojox.charting.plot2d.Pie"==e[0].chart.stack[0].declaredClass){var t=e[0].chart.stack[0];if("number"==typeof t.run.data[0]){var i=s.map(t.run.data,"Math.max(x, 0)"),n=s.map(i,"/this",s.foldl(i,"+",0));a.forEach(n,function(e,i){this._addLabel(t.dyn[i],t._getLabel(100*e)+"%")},this)}else a.forEach(t.run.data,function(e,i){this._addLabel(t.dyn[i],e.legend||e.text||e.y)},this)}else a.forEach(e,function(e){this._addLabel(e.dyn,e.legend||e.name)},this)},_addLabel:function(e,t){var i=l.create("td"),a=l.create("div",null,i),o=l.create("label",null,i),s=l.create("div",{style:{width:this.swatchSize+"px",height:this.swatchSize+"px",float:"left"}},a);d.add(a,"dojoxLegendIcon dijitInline");d.add(o,"dojoxLegendText");if(this._tr){this._tr.appendChild(i);if(++this._inrow===this.horizontal){this._tr=l.create("tr",null,this.legendBody);this._inrow=0}}else{l.create("tr",null,this.legendBody).appendChild(i)}this._makeIcon(s,e);o.innerHTML=String(t);n("dojo-bidi")&&(o.dir=this.getTextDir(t,o.dir))},_makeIcon:function(e,t){var a={h:this.swatchSize,w:this.swatchSize},n=i.createSurface(e,a.w,a.h);this._surfaces.push(n);if(t.fill)n.createRect({x:2,y:2,width:a.w-4,height:a.h-4}).setFill(t.fill).setStroke(t.stroke);else if(t.stroke||t.marker){var o={x1:0,y1:a.h/2,x2:a.w,y2:a.h/2};t.stroke&&n.createLine(o).setStroke(t.stroke);if(t.marker){var s={x:a.w/2,y:a.h/2};n.createPath({path:"M"+s.x+" "+s.y+" "+t.marker}).setFill(t.markerFill).setStroke(t.markerStroke)}}else{n.createRect({x:2,y:2,width:a.w-4,height:a.h-4}).setStroke("black");n.createLine({x1:2,y1:2,x2:a.w-2,y2:a.h-2}).setStroke("black");n.createLine({x1:2,y1:a.h-2,x2:a.w-2,y2:2}).setStroke("black")}}});return n("dojo-bidi")?e("dojox.charting.widget.Legend",[u,o]):u})},"ebg/site/group":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","ebg/comboajax","ebg/board","ebg/chatinput","ebg/textdescription","ebg/pageheader"],function(e,t,i){return t("ebg.site.group",ebg.core.mainsitemodule,{constructor:function(){this.group_id=null;this.avatar_src=null;this.invitePlayer=null;this.newsfeed=null;this.bGroupAdmin=!1;this.textdescription=null},onLoad:function(t){this.group_id=t.id;$("group_redirect")&&""!=$("group_redirect").innerHTML&&gotourl($("group_redirect").innerHTML+window.location.hash);let a=document.querySelector(".group-members-list");a&&(this.groupMembersListComponent=new i.ms.group.BgaGroupMembersList({target:a,props:{groupId:this.group_id}}));let n=document.getElementsByClassName("group-avatar-holder");this.groupAvatarComponents=[];for(let e=0;e<n.length;e++){let t=n[e];this.groupAvatarComponents.push(new i.ms.group.BgaGroupAvatar({target:t,props:{size:100,group:{avatar:t.getAttribute("data-group-avatar"),type:t.getAttribute("data-group-type"),game_id:t.getAttribute("data-game-id"),id:t.getAttribute("data-group-id")}}}))}$("group_avatar")&&(this.avatar_src=$("group_avatar").src);if($("group_name")){mainsite.setPageTitle($("group_name").innerHTML);this.pageheader=new ebg.pageheader;this.pageheader.create(this,"pageheader",[{btn:"pageheader_publicinfos",section:"pagesection_publicinfos"},{btn:"pageheader_members",section:"pagesection_members"},{btn:"pageheader_recent",section:"pagesection_recent"},{btn:"pageheader_configuration",section:"pagesection_configuration"}],!0);void 0!==t.section&&this.pageheader.showSectionFromButton("pageheader_"+t.section);e.connect($("joingroup"),"onclick",this,"onJoinGroup");e.connect($("quitgroup"),"onclick",this,"onQuitGroup");"block"==e.style("group_config_wrap","display")&&(this.bGroupAdmin=!0);this.newsfeed=new ebg.board;1==toint($("canPostOnNewsFeed").innerHTML)?this.newsfeed.bStatusUpdate=!0:this.newsfeed.bStatusUpdate=!1;this.bGroupAdmin&&(this.newsfeed.postAs=$("group_name").innerHTML);this.newsfeed.create(this,$("newsfeed"),"group",this.group_id,!1);this.bGroupAdmin&&(this.newsfeed.boardTemplates={beta_release:{name:"Beta release",text:'The game is now open in BETA for the whole BGA community (see the "Beta games" category on https://boardgamearena.com/gamelist). Thanks a lot for playtesting the ALPHA version!'},beta_release_unpopular:{name:"Beta release - less popular",text:'The game is now open in BETA for the whole BGA community (see the "Beta games" category on https://boardgamearena.com/gamelist). Thanks a lot for playtesting the ALPHA version!\n\nNote: Some less popular games can be moved forward before receiving the minimum of 10 approvals if they don\'t have any major bugs reported and implementation rating is sufficiently high and the publisher approved the implementation (when applicable).'},premium_switch:{name:"Switch to premium",text:"Dear players,\n\n<PUBLISHER> and BGA decided to offer <GAME> as a free game during the promotional period, which has now come to an end. <GAME> becomes a premium game today. Any player can still join the game table, but only premium members can create a table.\n\nThank you all for making the game successful on BGA, and we hope you will continue to enjoy the game.\n\nWe are very grateful to <PUBLISHER> for investing their resources and energy in bringing this great game to BGA."},release_date:{name:"Official release annoucement",text:"Dear players\nThe game is now fully released.\nTournaments and Arena are available once you reach 100 ELO points! Have fun!"},new_release:{name:"New release",text:"Dear players\nWe just released a new version of the game with following changes:\n - ...\n\nEnjoy!"},lock_for_update:{name:"Lock for update",text:"Dear players\nWe are preparing a big update so we needed to stop table creation in the meantime.\n\nThanks for your patience!"}});e.connect($("save_group_config"),"onclick",this,"onSaveGroupConfig");e.connect($("change_emblem_submit"),"onclick",this,"onSubmitNewEmblem");e.connect($("delete_group"),"onclick",this,"onDeleteGroup");e.connect($("delete_players_from_group"),"onclick",this,"onDeletePlayersFromGroup");null!==$("canChat")&&1==toint($("canChat").innerHTML)?e.style("startchat_wrapper","display","inline"):e.style("startchat_wrapper","display","none");e.connect($("startchat"),"onclick",this,"onStartChat");if(this.bGroupAdmin){this.textdescription=new ebg.textdescription;this.textdescription.create(this,"textdescription","group",this.group_id)}}},onOnUnload:function(){null!==this.textdescription&&this.textdescription.destroy();this.textdescription=null;null!==this.groupMembersList&&this.groupMembersListComponent.$destroy();null!==this.pageheader&&this.pageheader.destroy();if(this.groupAvatarComponents)for(let e=0;e<this.groupAvatarComponents.length;e++)this.groupAvatarComponents[e].$destroy()},onJoinGroup:function(e){e.preventDefault();this.ajaxcall("/community/community/joinGroup.html",{id:this.group_id},this,function(){mainsite.gotourl_forcereload("group?id="+this.group_id)},function(e){})},onQuitGroup:function(t){t.preventDefault();this.confirmationDialog(_("Are you sure you want to leave this group?"),e.hitch(this,function(){this.ajaxcall("/community/community/quitGroup.html",{id:this.group_id},this,function(){mainsite.gotourl_forcereload("group?id="+this.group_id)},function(e){})}))},onSaveGroupConfig:function(e){e.preventDefault();this.ajaxcall("/group/group/saveGroupConfig.html",{form_id:"editgroupconfig"},this,function(e){this.showMessage(_("Group configuration saved"),"info")},function(e){},"post")},onSubmitNewEmblem:function(e){e.preventDefault();this.ajaxcall("/group/group/newEmblem.html",{form_id:"change_groupemblem_form"},this,function(e){if(0===e.valid)this.showMessage(e.invalidity_reason,"error");else{this.showMessage(_("New emblem loaded !"),"info");mainsite.gotourl_forcereload("group?id="+this.group_id)}},function(){},"iframe")},onDeletePlayersFromGroup:function(e){e.preventDefault();i.bgaConfirm({title:"Delete all players from group",description:'Do you really want to <b class="red">delete</b> all players from this group? Please make sure no tables are still running. (The BGA admins will be kept.)',isDescriptionHtml:!0,yesButton:"Yes, delete all players."}).then(e=>{this.ajaxcall("/group/group/deletePlayersFromGroup.html",{id:this.group_id},this,function(){mainsite.gotourl_forcereload("group?id="+this.group_id)},function(e){})})},onDeleteGroup:function(e){e.preventDefault();i.bgaReadText({title:"Delete group",description:'Do you really want to <b class="red">delete</b> this group ? If you write a message below, it will be published in the chat. Otherwise, an automatic message will be sent.',isDescriptionHtml:!0,yesButton:"DELETE GROUP",value:"This group has been removed as it violates our terms of services."}).then(e=>{!1!==e&&(""!=e?this.ajaxcall("/group/group/deleteGroup.html",{id:this.group_id,text:e??""},this,function(){mainsite.gotourl_forcereload("group?id="+this.group_id)},function(e){}):this.showMessage("Please enter some text to explain why the group has been deleted.","error"))})},onStartChat:function(e){e.preventDefault();mainsite.createChatBarWindow({type:"group",id:this.group_id,avatar_src:this.avatar_src,label:$("group_name").innerHTML,url:"/group?id="+this.group_id,channel:"/group/g"+this.group_id,window_id:"group_"+this.group_id,start:"expanded"},!0);mainsite.expandChatWindow("group_"+this.group_id);mainsite.loadPreviousMessage("group",this.group_id)}})})},"ebg/textdescription":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.textdescription",null,{constructor:function(){this.page=null;this.div=null;this.description_type=null;this.description_id=null;this.display_mode="block";this.jstpl_template='<div id="textdisplayed_${id}">${text}</div><div id="edittextform_${id}" style="display:none;"><textarea id="textdescriptioninput_${id}" class="textdescriptioninput">${textarea}</textarea><a id="savetext_${id}" class="bgabutton bgabutton_blue" href="#"><span>'+__("lang_mainsite","Save")+'</span></a></div><div><a href="#" class="bga-link" id="edittext_${id}">['+_("Edit")+"]</a></div>";this.jstpl_template_inline='<span id="textdisplayed_${id}">${text}</span><span id="edittextform_${id}" style="display:none;"><textarea id="textdescriptioninput_${id}" class="textdescriptioninput">${textarea}</textarea><a id="savetext_${id}" class="bgabutton bgabutton_blue" href="#"><span>'+__("lang_mainsite","Save")+'</span></a></span>&nbsp;&nbsp;<span><a class="bga-link" href="#" id="edittext_${id}">['+_("Edit")+"]</a></span>"},create:function(t,i,a,n){this.page=t;this.div=i;this.description_type=a;this.description_id=n;var o=$(this.div).innerHTML,s=o=o.replace(/<br\s*\/?>/gm,"");e.empty(this.div);o=this.page.makeClickableLinks(o,!0);o=this.page.addSmileyToText(o);o=this.page.nl2br(o,!1);"block"==this.display_mode?e.place(e.string.substitute(this.jstpl_template,{id:this.div,text:o,textarea:s}),this.div):e.place(e.string.substitute(this.jstpl_template_inline,{id:this.div,text:o,textarea:s}),this.div);e.connect($("edittext_"+this.div),"onclick",this,"onEditText");e.connect($("savetext_"+this.div),"onclick",this,"onSaveText")},destroy:function(){},onEditText:function(t){t.preventDefault();e.style("edittext_"+this.div,"display","none");e.style("textdisplayed_"+this.div,"display","none");e.style("edittextform_"+this.div,"display",this.display_mode)},onSaveText:function(t){t.preventDefault();var i=$("textdescriptioninput_"+this.div).value,a={type:this.description_type,id:this.description_id,text:i};this.page.ajaxcall("/message/text/updateText.html",a,this,function(t){var a=this.page.htmlentities(i,"ENT_NOQUOTES");a=this.page.makeClickableLinks(a,!0);a=this.page.addSmileyToText(a);a=this.page.nl2br(a,!1);$("textdisplayed_"+this.div).innerHTML=a;e.style("edittext_"+this.div,"display",this.display_mode);e.style("textdisplayed_"+this.div,"display",this.display_mode);e.style("edittextform_"+this.div,"display","none")})}})})},"ebg/site/headlines":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule","ebg/headlines_unread","ebg/lazyload"],function(e,t){return t("ebg.site.headlines",ebg.core.mainsitemodule,{constructor:function(){this.headlines_unread=null;this.lazyload=null},onLoad:function(t){mainsite.setPageTitle(_("News"));e.query(".news_show_translated").connect("onclick",this,"onClickToggleNewsTranslation");e.query(".news_show_untranslated").connect("onclick",this,"onClickToggleNewsTranslation");$("newsletter_optin")&&e.connect($("newsletter_optin"),"onclick",this,"onClickNewsLetterOptin");for(var i=e.query(".translation_details_news"),a=0;a<i.length;a++)this.addTooltipHtml(i[a].id,this.format_string(this.jstpl_news_translation_details,{}));this.headlines_unread=new ebg.headlines_unread;this.headlines_unread.create(this);mainsite.bVisitedHeadlinesPage=!0;mainsite.updateHeadlinesNbrNotification();this.lazyload=new ebg.lazyload;this.lazyload.create();this.lazyload.addImagesToLazyLoad("latest_news")},onClickNewsLetterOptin:function(e){if(!(current_player_id<=0)){e.preventDefault();e.stopPropagation();this.ajaxcall("/player/profile/newsletter.html",{value:1},this,function(){this.showMessage(__("lang_mainsite",'You successfully subcribed to our newsletter. You can change this anytime by going to <a href="%s">your email preferences</a>.').replace("%s","/preferences?section=email"),"info")})}},onOnUnload:function(){if(this.headlines_unread){this.headlines_unread.destroy();this.headlines_unread=null}if(this.lazyload){this.lazyload.destroy();this.lazyload=null}}})})},"ebg/headlines_unread":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.headlines_unread",null,{constructor:function(){this.page=null;this.bActiveReadEvent=!0;this.evtScroll=null;this.evtResize=null},create:function(t){this.page=t;this.markUnread();if(this.bActiveReadEvent){this.detectRead();this.evtScroll=e.connect(window,"onscroll",this,"detectRead");this.evtResize=e.connect(window,"onresize",this,"detectRead")}},destroy:function(){if(null!==this.evtScroll){e.disconnect(this.evtScroll);this.evtScroll=null}if(null!==this.evtResize){e.disconnect(this.evtResize);this.evtResize=null}},markUnread:function(){for(var t in mainsite.unreadNews)$("welcomenews_"+t)&&e.addClass("welcomenews_"+t,"unread_news")},detectRead:function(){var t=e.window.getBox();e.query(".newsfooter").forEach(e.hitch(this,function(i){var a=e.position(i),n=i.id.substr(11);if(a.y>0&&a.y<t.h&&void 0!==mainsite.unreadNews[n]){delete mainsite.unreadNews[n];e.removeClass("welcomenews_"+n,"unread_news");mainsite.updateHeadlinesNbrNotification();this.page.ajaxcall("/headlines/headlines/readnews.html",{news_id:n},this,function(){},function(e){})}}))}})})},"ebg/site/lobby":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","ebg/lobbyauto"],function(dojo,declare,svelte){return declare("ebg.site.lobby",ebg.core.mainsitemodule,{constructor:function(){this.lobby=null},onLoad:function(args){this.initial_time=(new Date).getTime();mainsite.setPageTitle(_("Play"));svelte.stores.subMenu.setCurrentItem("lobby");this.simplified=void 0!==args.simplified;if(null!==$("inside_script"))try{eval($("inside_script").innerHTML)}catch(e){$("inside_script").innerHTML;mainsite.onInvisibleScriptError(e.name+": "+e.message.replaceAll("${","{")+"\n"+e.stack,"","")}"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")&&null!==$("web_notifications_expired_flag")&&1==$("web_notifications_expired_flag").innerHTML&&this.setupWebPush();if(void 0!==args.game){var toexpand=JSON.parse(localStorage.getItem("explobby"));if(toexpand&&toexpand[args.game]){delete toexpand[args.game];localStorage.setItem("explobby",JSON.stringify(toexpand))}}this.lobby=new ebg.lobbyauto;this.lobby.create(this);void 0!==args.addgame&&this.lobby.doAddFavorite(args.addgame);null!==$("prompt_web_notifications_flag")&&1==$("prompt_web_notifications_flag").innerHTML&&this.lobby.promptToActivateNotifications();if(this.simplified){this.lobby.opponentMode="manual";this.lobby.updateOpponentMode();this.lobby.switchGameMode("realtime");this.lobby.switchRankingMode("simple");null!==$("pageheaderlobby")&&($("pageheaderlobby").style.display="none")}else{void 0!==args.arena?this.lobby.switchRankingMode("arena"):void 0!==args.simple&&this.lobby.switchRankingMode("simple");void 0!==args.mode&&this.lobby.switchGameMode(args.mode)}var wantToPlayGameId=null;if(wantToPlayGameId){localStorage.removeItem("bga-want-to-play-game-id");this.lobby.doAddFavorite(wantToPlayGameId,dojo.hitch(this,function(){"manual"==this.lobby.opponentMode&&this.lobby.expandGame(args.game)}),!0)}if(void 0!==args.game){if(current_player_id<0){var redirect_url=encodeURIComponent(mainsite.currentUrl);mainsite.showMessage(_("To go further, you must log in or create an account (in 10 seconds)!"),"info");mainsite.gotourl("account?warn&redirect="+redirect_url);localStorage.setItem("bga-want-to-play-game-id",args.game);return}this.lobby.displayGameInCategory(args.game,"spotlight");this.lobby.reorderGamesIn("spotlight","current",null,!0);this.lobby.toggleNonSpotlightVisibility(!1);"manual"==this.lobby.opponentMode&&this.lobby.expandGame(args.game,!1)}},profile:function(e){var t=(new Date).getTime();$("mydebug_output").innerHTML+="<br/>"+e+": "+(t-this.initial_time)+"ms"},onOnUnload:function(){if(!this.lobby.checkUnload())return!1;this.unsubscribe_all();if(null!==this.lobby){this.lobby.unload();this.lobby=null}}})})},"ebg/lobbyauto":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/pageheader","ebg/lazyload","ebg/popindialog","ebg/comboajax"],function(e,t,i){return t("ebg.lobbyauto",null,{constructor:function(){this.page=null;this.div_id=null;this.div=null;this.lazyload=null;this.game_to_table_to_access={};this.gamefilter=null;this.playerfilter=null;this.popindialog=null;this.jstpl_wannaplay_game='<div id="game_box_wrap_other_${GAME_ID}" class="game_box_wrap game_box_wrap_game_${GAME_ID}">  <div id="wannaplay_${ID}" class="wannaplay_item ${HOW_TO_PLAY} ${DISABLED_RANKING} ${ALPHABETA} ${FAVORITE} wannaplayauto_item ${WANNAPLAY} initial_wannaplay add_wannaplay_${ID}">      <div class="game_box_image_wrap">          <img id="wannaplay_img_${ID}" bga_game_id="${ID}" class="game_box bga_lazyload" src="${THEMEURL}img/common/blank.gif" />      </div>      <div class="game_box_mask">        <div class="game_box_mask_content">              <a href="playerstat?id=${CURRENT_PLAYER_ID}&game=${ID}">                  <div class="wannaplay_mask_button myelo gamerank_${PLAYER_GAMERANK}" id="wannaplay_myelo_${ID}"><div class="icon20 icon20_rankw"></div><div class="myelo_value">${PLAYER_ELO}</div></div>                                  </a>              <a href="halloffame?game=${ID}&season=${CURRENT_ARENA_SEASON_NUMBER}">                  <div class="wannaplay_mask_button myarena" id="wannaplay_myarena_${ID}">                      <div class="myarena_league league_${PLAYER_ARENALEAGUE}">                          <div class="arena_label">${PLAYER_ARENAPOINTS}</div>                      </div>                  </div>                                  </a>              <a href="/gamepanel?id=${ID}&showtoplay_seemore">                  <div class="wannaplay_mask_button how_to_play_button" id="wannaplay_howtoplay_${ID}"><i class="fa fa-graduation-cap" aria-hidden="true"></i></div>                                  </a>              <div class="wannaplay_mask_button wannaplayauto_pref" id="wannaplay_pref_${ID}"><i class="fa fa-cog" aria-hidden="true"></i></div>                                  <div class="wannaplay_mask_button add_favorite" id="add_favorite_${ID}"><i class="fa fa-heart" aria-hidden="true"></i><i class="fa fa-circle backplus" aria-hidden="true"></i><i class="fa fa-plus frontplus" aria-hidden="true"></i></div>              <div class="wannaplay_mask_button del_favorite" id="del_favorite_${ID}"><i class="fa fa-heart" aria-hidden="true" ></i></div>        </div>      </div>      <div class="wannaplay_gamename gamename"><div class="gamenameinner" ><a id="gamename_${ID}" href="/gamepanel?game=${GAMENAME}" class="gamename gamenamedisplayed">${NAME}</a></div></div>      <div class="wannaplayauto_play_zone">          <div class="wannaplayauto_play_zone_content">              <div id="button_play_${ID}" class="bgabutton bgabutton_blue wannaplayauto_button">                  ${PLAY_NOW}              </div>          </div>      </div>      ${PREMIUM_FLAG}      ${ALPHA_FLAG}      ${BETA_FLAG}      <div id="wannaplayauto_time_${ID}" class="wannaplayauto_time"><div class="fa fa-clock-o fa-spin wannaplayauto_time_icon"></div><span id="wannaplayauto_timevalue_${ID}">?</span><span id="wannaplayauto_timeunit_${ID}"></span></div>      <div id="wannaplayauto_loading_${ID}" class="wannaplayauto_loading"><div id="wannaplayauto_loadingbar_${ID}" class="wannaplayauto_loadingbar"></div><div class="wannaplayauto_loadingbartxt">${LOOKING_FOR_PLAYERS}</div></div>      <span style="display:none" class="game_popularity">${POPULARITY}</span>      <span style="display:none" class="game_lastplay">${LAST_PLAY}</span>      <span style="display:none" class="game_maxplayers">${MAX_PLAYERS}</span>      <span style="display:none" class="game_minplayers">${MIN_PLAYERS}</span>  </div>  <div id="wannaplay_premium_banner_${ID}" class="bubblebanner" style="display:none"></div></div>';this.jstpl_xannaplay_game='<div id="Xannaplay_${ID}" class="wannaplay_item ${HOW_TO_PLAY} ${DISABLED_RANKING} ${ALPHABETA} ${FAVORITE} wannaplayauto_item ${WANNAPLAY} Xannaplay  add_wannaplay_${ID}" style="display:none;">  <div class="game_box_image_wrap">      <img id="Xannaplay_img_${ID}" bga_game_id="${ID}" class="game_box bga_lazyload" src="${THEMEURL}img/common/blank.gif" />  </div>  <div class="game_box_mask">    <div class="game_box_mask_content">      <a href="playerstat?id=${CURRENT_PLAYER_ID}&game=${ID}">          <div class="wannaplay_mask_button myelo gamerank_${PLAYER_GAMERANK}" id="Xannaplay_myelo_${ID}"><div class="icon20 icon20_rankw"></div><div class="myelo_value">${PLAYER_ELO}</div></div>                          </a>      <a href="halloffame?game=${ID}&season=${CURRENT_ARENA_SEASON_NUMBER}">          <div class="wannaplay_mask_button myarena" id="Xannaplay_myarena_${ID}">              <div class="myarena_league league_${PLAYER_ARENALEAGUE}">                  <div class="arena_label">${PLAYER_ARENAPOINTS}</div>              </div>          </div>                          </a>      <a href="/gamepanel?id=${ID}#how-to-play">          <div class="wannaplay_mask_button how_to_play_button" id="Xannaplay_howtoplay_${ID}"><i class="fa fa-graduation-cap" aria-hidden="true"></i></div>                          </a>      <div class="wannaplay_mask_button wannaplayauto_pref" id="Xannaplay_pref_${ID}"><i class="fa fa-cog" aria-hidden="true"></i></div>                          <div class="wannaplay_mask_button add_favorite" id="Xdd_favorite_${ID}"><i class="fa fa-heart" aria-hidden="true"></i><i class="fa fa-circle backplus" aria-hidden="true"></i><i class="fa fa-plus frontplus" aria-hidden="true"></i></div>      <div class="wannaplay_mask_button del_favorite" id="Xel_favorite_${ID}"><i class="fa fa-heart" aria-hidden="true" ></i></div>    </div>  </div>  <div class="wannaplay_gamename gamename"><div class="gamenameinner"><a href="/gamepanel?game=${GAMENAME}" class="gamename gamenamedisplayed">${NAME}</a></div></div>  <div class="wannaplayauto_play_zone">      <div class="wannaplayauto_play_zone_content">          <div id="Xutton_play_${ID}" class="bgabutton bgabutton_blue wannaplayauto_button">              ${PLAY_NOW}          </div>      </div>  </div>  ${PREMIUM_FLAG}  ${ALPHA_FLAG}  ${BETA_FLAG}  <div id="Xannaplayauto_time_${ID}" class="wannaplayauto_time"><div class="fa fa-clock-o fa-spin wannaplayauto_time_icon"></div><span id="Xannaplayauto_timevalue_${ID}">?</span><span id="Xannaplayauto_timeunit_${ID}"></span></div>  <div id="Xannaplayauto_loading_${ID}" class="wannaplayauto_loading"><div id="Xannaplayauto_loadingbar_${ID}" class="wannaplayauto_loadingbar"></div><div class="wannaplayauto_loadingbartxt">${LOOKING_FOR_PLAYERS}</div></div>  <span style="display:none" class="game_popularity">${POPULARITY}</span>  <span style="display:none" class="game_lastplay">${LAST_PLAY}</span>  <span style="display:none" class="game_minplayers">${MIN_PLAYERS}</span>  <span id="gamenameraw_${GAME_ID}" style="display:none;">${GAMENAME}</span>  <span id="arenaraw_${GAME_ID}" style="display:none;">${PLAYER_ARENAPOINTS_RAW}</span>  <span id="nbleagues_${GAME_ID}" style="display:none;">${GAME_NB_LEAGUES}</span>  <span id="wait_time_async_${GAME_ID}" style="display:none;">${WAIT_TIME_ASYNC}</span>  <span id="wait_time_realtime_${GAME_ID}" style="display:none;">${WAIT_TIME_REALTIME}</span>  <span id="progress_async_${GAME_ID}" style="display:none;">${PROGRESS_ASYNC}</span>  <span id="progress_realtime_${GAME_ID}" style="display:none;">${PROGRESS_REALTIME}</span>  <span id="remaining_async_${GAME_ID}" style="display:none;">${REMAINING_ASYNC}</span>  <span id="remaining_realtime_${GAME_ID}" style="display:none;">${REMAINING_REALTIME}</span>  <span id="timeprofile_async_${GAME_ID}" style="display:none;">${TIMEPROFILE_ASYNC}</span>  <span id="timeprofile_realtime_${GAME_ID}" style="display:none;">${TIMEPROFILE_REALTIME}</span>  <span id="rankinginfos_${GAME_ID}" style="display:none;">${RANKINGINFOS}</span>  <span id="waiting_time_${GAME_ID}" style="display:none;">${WAITINGTIME}</span>  <div id="Xannaplay_premium_banner_${ID}" class="bubblebanner bga-link-inside" style="display:none"></div></div>';this.jstpl_elo_details='<div class="elodetails_tooltips"><h3>'+_("ELO rank at ${game_name}")+" : ${elo_label}</h3><hr/><p>"+_("This ELO score is an evaluation of your skill for this game.")+'</p><div class="row-data"><div class="row-label">'+_("World BGA rank")+'</div><div class="row-value"><b><span id="gamerankno_${player_id}" class="gamerankno_${game_id}">${rank_no}</span></b></div></div><div class="row-data"><div class="row-label">'+_("Games played")+'</div><div class="row-value"><b>${played}</b></div></div><div class="row-data"><div class="row-label">'+_("Victories")+'</div><div class="row-value"><b>${victory}</b></div></div><div class="icon20 icon20_stat"></div> '+_("Click to see detailled stats")+"</div>";this.jstpl_table_wrap='<div id="gametable_${id}" class="gametable_game_${game_id} relative z-0"></div>';this.jstpl_table='<div id="gametableblock_${id}" class="gametable gametable_status_${status} ${realtable}"><div class="gametable_colored_indicator"></div><a href="${game_url}" class="gametablelink"></a><div class="gametable_content"><div class="gameinfo"><img src="${game_icon_url}" class="game_icon" alt=""/></div><div class="gametable_upper_part"><div class="gametable_button_zone"><a class="bgabutton bgabutton_blue" id="startgame_${id}">'+_("Start")+'</a> <a class="bgabutton bgabutton_blue" id="opengame_${id}">'+_("Open")+'</a> <a class="bgabutton bgabutton_blue" id="configgame_${id}" href="/table?table=${id}&nr=true">'+_("Configure")+'</a> <a class="bgabutton bgabutton_blue" id="joingame_${id}">'+_("Join")+'</a> <a class="bgabutton bgabutton_gray" id="viewgame_${id}" href="/table?table=${id}&nr=true">'+_("View")+'</a> <a class="bgabutton bgabutton_gray" id="quitgame_${id}">'+_("Quit")+'</a> </div><div class="gametable_upper_part_right"><div class="gametable_infos"><div class="gameinfoname"><span class="gamename">${game_name_displayed}</span></div></div><div class="table_top_status smalltext"><div class="cannotJoinTableText" id="cannotJoinTable_${id}">'+_("You cannot join this table")+'</div><div class="suggestion_wrap"><div class="icon20 icon20_suggestion"></div> '+_("You've been suggested to join this table")+'<div class="suggestion_refuse"><a class="bga-link" href="#" id="suggest_wannaplay_remove_${id}_${game_id}">['+_("I don't want to play ${game_name_displayed} now")+']</a></div></div><b class="table_status_detailled">${status_detailled}</b><span class="table_status_separator"> &bull; </span>${table_date_info}<div class="table_top_status_detailed"><div>${filters}</div><div class="game_presentation">${presentation}</div><div class="smalltext">${optionstxt}</div></div></div></div></div><span id="gametable_game_url_${id}" style="display:none;">${game_url}</span><div class="clear gametable_separator"></div><div class="players" id="players_table_${id}"></div><div class="clear"/></div></div>';this.jstpl_player_table='<div id="tableplace_${table_id}_${player_id}" class="tableplace smalltext ${tableplaceclass}"><a href="player?id=${player_id}" title="${player_name}"  ><div class="emblemwrap ${emblem_class}"><img src="${player_avatar}" alt="" class="emblem" /><div class="emblempremium"></div></div></a><div class="player_name_wrap"><a href="player?id=${player_id}" class="playername">${player_name}</a><br/><span class="playersummary">${player_summary}</span></div></div>';this.jstpl_player_table_free='<div class="tableplace smalltext tableplace_${freeplacetype}"><div class="emblemwrap"><div class="emblem ${freeplacetype}"></div></div><div class="player_name_wrap"><span class="player_name">${text}</span><br/></div></div>';this.jstpl_arena_bar_tooltip='<div class="progressbar_with_info"><div class="progressbar_inner"><div  class="progressbar progressbar_arena arena_${league_id}"><div class="progressbar_label"><div class="progressbar_label_content">${league_name}</div></div><div class="progressbar_bar"><div class="progressbar_content"  style="${arenabarpcent}"><div class="arena_container">${arena_points_html}</div></div></div></div></div><div class="progressbar_bottom_infos">${arena_bottom_infos}</div></div>';this.priority_to_sentence={1:_("I'm okay to play with"),2:_("I prefer not playing with"),3:_("I'm reluctant to play with"),9:_("I never want to play with")};this.table_to_status={};this.notifqueue=new ebg.gamenotif;this.table_to_location={};this.games_to_section={};this.mode="normal";this.rankingMode="simple";this.clockmode="realtime";this.opponentMode="manual";this.displayAllTables=!1;this.evtScroll=null;this.evtResize=null;this.tablePreferencesDialog=null;this.tablePreferences=[];this.tablePreferencesCurrentGame=null;this.game_to_table_nbr={};this.game_to_target={};this.globalPreferencesDialog=null;this.globalPreferences=[];this.redirect_url=null;this.redirect_timer=null;this.interval_id=null;this.redirect_game_id=null;this.current_game_sorting={favorite:"recent",known:"recent",other:"popularity"};this.tablemanagerGlobalSub={};this.changeDisplaySizeSpecific("suggested_games_list","compact",!1)},create:function(t,i){this.page=t;if("s"==(l=$("playing_mode").innerHTML)[0])this.rankingMode="simple";else if("a"==l[0]){this.rankingMode="arena";this.loadArenaProgress()}else this.rankingMode="choice";"r"==l[1]?this.clockmode="realtime":"a"==l[1]?this.clockmode="async":this.clockmode="choice";"m"==l[2]?this.opponentMode="manual":"a"==l[2]?this.opponentMode="automatic":"f"==l[2]?this.opponentMode="friends":this.opponentMode="choice";e.query(".initial_wannaplay").forEach(e.hitch(this,function(e){var t=e.id.substr(10);this.setupGameWannaplayItem(t)}));this.gamefilter=void 0!==i?i:mainsite.gamefilter;var a={status:"open"};if("inprogress"==this.mode){a.status="play";if(this.displayAllTables){a.status="playall";var n=0;for(var o in this.gamefilter)n++;1==n&&(a.game=o)}}if(null!==this.playerfilter){delete a.status;a.playerfilter=this.playerfilter;e.style("gamelist_gameselect","display","none")}this.page.register_subs(e.subscribe("tablemanagerInfosChanged",this,"onTableInfosChanged"));this.page.register_subs(e.subscribe("matchmakingGameStart",this,"onMatchmakingGameStart"));this.page.register_subs(e.subscribe("matchmakingStatusUpdate",this,"onMatchmakingStatusUpdate"));this.page.register_subs(e.subscribe("matchmakingCanceled",this,"onMatchmakingCanceled"));this.page.register_subs(e.subscribe("matchmakingInvalidPreferences",this,"onMatchmakingInvalidPreferences"));this.page.register_subs(e.subscribe("matchmakingCreateTableError",this,"onMatchmakingCreateTableError"));var s,r,l=this.clockmode;this.updateMMButtonsWithMMInProgress();this.adaptScreenConnect=e.connect(mainsite,"onAdaptScreen",this,"onAdaptScreen");e.hasClass("ebd-body","mobile_version")&&this.onAdaptScreen(!0);e.connect($("pageheader_async"),"onclick",this,"onGameModeChange");e.connect($("pageheader_realtime"),"onclick",this,"onGameModeChange");e.connect($("pageheader_simple"),"onclick",this,"onRankingModeChange");e.connect($("pageheader_arena"),"onclick",this,"onRankingModeChange");e.connect($("pageheader_tournament"),"onclick",this,"onRankingModeChange");e.connect($("pageheader_manual"),"onclick",this,"onOpponentModeChange");e.connect($("pageheader_automatic"),"onclick",this,"onOpponentModeChange");e.connect($("pageheader_friends"),"onclick",this,"onOpponentModeChange");e.connect($("pageheader_mobile_switcher"),"onclick",this,"onGameModeChangeMobileSwitcher");e.connect($("pageheader_mobile_switcher_gamemode"),"onclick",this,"onGameModeChangeMobileSwitcherGamemode");e.connect($("pageheader_mobile_switcher_lobbymode"),"onclick",this,"onGameModeChangeMobileSwitcherLobbymode");e.connect($("playwithfriends_barcenter"),"onclick",this,"onShowPlayWithFriendsPanel");this.pageheader=new ebg.pageheader;this.pageheader.bDisableAdaptMenu=!0;this.pageheader.create(this,"pageheaderlobby",{},!1);this.page.addTooltip("play_any_favorite","",_("We will try to find opponents for you for ANY of you favorite games. You will play the first game with enough opponents :)"));e.connect($("play_any_favorite"),"onclick",this,"onPlayAnyFavorite");e.connect($("play_any_favorite_cancel"),"onclick",this,"onPlayAnyFavoriteCancel");e.connect($("accept_all_rankingmode_button"),"onclick",this,"onAcceptAllRankingMode");e.connect($("spotlight_only_toggle_button"),"onclick",this,function(){this.toggleNonSpotlightVisibility()});if("inprogress"==this.mode){e.parser.parse();this.div=$("gamelist_gameselect");this.div.value=_("Start typing a game name");e.connect(this.div,"onfocus",this,function(e){this.div.value=""});e.connect(dijit.byId("gamelist_gameselect"),"onChange",this,"onGoToGame")}e.query(".initial_favorite").forEach(e.hitch(this,function(e){var t=e.id.substr(23);this.displayGameInCategory(t,"favorite",!0)}));e.query(".initial_known").forEach(e.hitch(this,function(e){var t=e.id.substr(20);this.displayGameInCategory(t,"known",!0)}));e.query(".initial_suggested").forEach(e.hitch(this,function(e){var t=e.id.substr(24);this.displayGameInCategory(t,"suggested",!0)}));this.adaptGamesSectionsToPlayerProfile();this.adaptSectionOnResizeConnect=e.connect(window,"onresize",this,"adaptGamesSectionsToPlayerProfile");e.connect($("filter_name"),"onkeyup",this,"onUpdateFilters");e.connect($("favorite_see_all_tables"),"onclick",this,"onSeeAllTables");e.connect($("favorite_display_cantjoin"),"onclick",this,"onSeeCannotJoinFavorite");e.connect($("other_display_cantjoin"),"onclick",this,"onSeeCannotJoinOther");e.connect($("see_all_tables"),"onclick",this,"onSeeAllTables");e.connect($("see_all_tables_all_games"),"onclick",this,"onSeeAllTables");e.connect($("close_favorite_table_list"),"onclick",this,"onHideAllTables");e.query(".sectiontitle_dropdown_command").connect("onclick",this,function(t){e.stopEvent(t);var i=t.currentTarget.parentNode.id;e.query("#"+i+" .sectiontitle_dropdown_menu").toggleClass("sectiontitle_dropdown_menu_visible")});this.closeLobbyMenu=e.connect($("overall-content"),"onclick",this,function(t){e.query(".sectiontitle_dropdown_menu_visible").removeClass("sectiontitle_dropdown_menu_visible")});e.query(".sortby").connect("onclick",this,"onSortGamesBy");e.query(".displaysize").connect("onclick",this,"onChangeDisplaySize");e.query(".expcoll").connect("onclick",this,"onExpandCollapseAll");e.query(".myelo").connect("mouseenter",this,e.hitch(this,function(t){var i=t.currentTarget.id.substr(16);"X"==$("rankinginfos_"+i).innerHTML.split("/")[3]&&this.page.ajaxcall("/lobby/lobby/getGameRanking.html",{lock:!0,game:i},this,e.hitch(this,function(t){0!=t.rank_no&&"0"!=t.rank_no||(t.rank_no=_("Not available (not in Top 100)"));null==t.rank_no&&(t.rank_no="");$("rankinginfos_"+i).innerHTML=$("rankinginfos_"+i).innerHTML.replace("/X","/"+t.rank_no+"/"+t.ranking_disabled);e.query(".gamerankno_"+i).forEach(function(e){null===t.rank_no?e.innerHTML="":0===t.rank_no?e.innerHTML="toto":e.innerHTML=t.rank_no});this.page.tooltips["wannaplay_myelo_"+i]&&this.page.tooltips["wannaplay_myelo_"+i].attr("label",this.getEloTooltip(i));this.page.tooltips["Xannaplay_myelo_"+i].attr("label",this.getEloTooltip(i))}))}));(s=localStorage.getItem("favorite_displaysize"))?this.changeDisplaySize("favorite",s):this.changeDisplaySizeSpecific("favorite_section","compact",!1);(s=localStorage.getItem("known_displaysize"))?this.changeDisplaySize("known",s):this.changeDisplaySizeSpecific("known_section","compact",!1);this.updateRankingMode(!0);this.updateGameMode(!0);this.updateOpponentMode(!0);(r=localStorage.getItem("known_sort"))&&(this.current_game_sorting.known=r);(r=localStorage.getItem("favorite_sort"))&&(this.current_game_sorting.favorite=r);this.reorderGamesIn("known","current",null,!0);this.reorderGamesIn("favorite","current",null,!0);this.lazyload=new ebg.lazyload;this.lazyload.create();this.lazyload.addImagesToLazyLoad("gamelobbyauto");e.connect($("close_arena_tuto"),"onclick",this,function(t){e.stopEvent(t);e.style("arena_tuto_wrap","display","none");"realtime"==this.clockmode?mainsite.tutorialShowOnce(19):mainsite.tutorialShowOnce(20)});this.page.addTooltipToClass("ttalphagame",_('This game is "alpha": access is restricted to BGA reviewers and players invited by the developer'),"");this.page.addTooltipToClass("ttbetagame",_('This game is "beta": you can report issues under "Community / Report a bug, or make a suggestion"'),"");mainsite.updateAsyncCounters();this.inviteFriendsInit();setTimeout(e.hitch(this,function(){this.showNeededTutorialItems()}),500)},checkUnload:function(){return this.checkRealtimeMatchmakingUnload()},updateMMButtonsWithMMInProgress:function(){var t=this.clockmode;if("manual"==this.opponentMode){e.query(".wannaplay_waiting_async").forEach(e.hitch(this,function(t){var i=t.id.substr(10);if(null!=$("button_play_"+i)){null!=$("wannaplay_"+i)&&e.removeClass("wannaplay_"+i,"wannaplay_waiting");e.removeClass("Xannaplay_"+i,"wannaplay_waiting");null!=$("button_play_"+i)&&e.removeClass("button_play_"+i,"bgabutton_red");e.removeClass("Xutton_play_"+i,"bgabutton_red");null!=$("button_play_"+i)&&e.addClass("button_play_"+i,"bgabutton_blue");e.addClass("Xutton_play_"+i,"bgabutton_blue");null!=$("button_play_"+i)&&($("button_play_"+i).innerHTML=_("Play now!"));$("Xutton_play_"+i).innerHTML=_("Play now!");e.query("#wannaplay_"+i+" > .wannaplayauto_time").style("display","none");e.query("#Xannaplay_"+i+" > .wannaplayauto_time").style("display","none");e.query("#wannaplay_"+i+" > .wannaplayauto_loading").style("display","none");e.query("#Xannaplay_"+i+" > .wannaplayauto_loading").style("display","none")}}));this.updateLobbyTitle()}else e.query(".wannaplay_waiting_"+t).forEach(e.hitch(this,function(i){var a=i.id.substr(10);this.makeSureWannaplayItemExists(a);null!=$("wannaplay_"+a)&&e.addClass("wannaplay_"+a,"wannaplay_waiting");e.addClass("Xannaplay_"+a,"wannaplay_waiting");null!=$("button_play_"+a)&&e.removeClass("button_play_"+a,"bgabutton_blue");e.removeClass("Xutton_play_"+a,"bgabutton_blue");null!=$("button_play_"+a)&&e.addClass("button_play_"+a,"bgabutton_red");e.addClass("Xutton_play_"+a,"bgabutton_red");null!=$("button_play_"+a)&&($("button_play_"+a).innerHTML=_("Cancel"));$("Xutton_play_"+a).innerHTML=_("Cancel");e.query("#wannaplay_"+a+" > .quick_howtoplay").style("display","none");e.query("#Xannaplay_"+a+" > .quick_howtoplay").style("display","none");var n=$("wait_time_"+t+"_"+a).innerHTML;e.query("#wannaplay_"+a+" > .wannaplayauto_time").style("display","block");e.query("#Xannaplay_"+a+" > .wannaplayauto_time").style("display","block");null!=$("wannaplayauto_timevalue_"+a)&&($("wannaplayauto_timevalue_"+a).innerHTML=this.getEstimatedTimeValue(n));$("Xannaplayauto_timevalue_"+a).innerHTML=this.getEstimatedTimeValue(n);null!=$("wannaplayauto_timeunit_"+a)&&($("wannaplayauto_timeunit_"+a).innerHTML=this.getEstimatedTimeUnit(n));$("Xannaplayauto_timeunit_"+a).innerHTML=this.getEstimatedTimeUnit(n);e.query("#wannaplay_"+a+" > .wannaplayauto_loading").style("display","block");e.query("#Xannaplay_"+a+" > .wannaplayauto_loading").style("display","block");null!=$("wannaplayauto_loadingbar_"+a)&&e.style("wannaplayauto_loadingbar_"+a,"width",$("progress_"+t+"_"+a).innerHTML+"%");e.style("Xannaplayauto_loadingbar_"+a,"width",$("progress_"+t+"_"+a).innerHTML+"%");var o=toint($("remaining_"+t+"_"+a).innerHTML);e.query(".game_box_wrap_game_"+a+" .wannaplayauto_loadingbartxt").forEach(function(t){t.innerHTML=null===o?_("Searching for opponents..."):e.string.substitute(o<=1?_("Searching for ${opponent_nbr} opponent..."):_("Searching for ${opponent_nbr} opponents..."),{opponent_nbr:o})});this.updateLobbyTitle();null!=$("wannaplayauto_loadingbar_"+a)&&e.addClass("wannaplayauto_loadingbar_"+a,"wannaplayauto_loadingbar_tp"+$("timeprofile_"+t+"_"+a).innerHTML);e.addClass("Xannaplayauto_loadingbar_"+a,"wannaplayauto_loadingbar_tp"+$("timeprofile_"+t+"_"+a).innerHTML)}))},updateLobbyTitle:function(){var t=[];e.query(".wannaplay_waiting .wannaplayauto_loadingbartxt").forEach(function(e){t.push(e.innerHTML)});t.sort();0==t.length?mainsite.setPageTitle(_("Play")):mainsite.setPageTitle(t[0])},checkRealtimeMatchmakingUnload:function(){if(e.query(".wannaplay_waiting_realtime").length>0&&null===this.redirect_url){if(!confirm(_("You are currently waiting for realtime opponents on at least one game: do you really want to cancel and leave?")))return!1;this.page.ajaxcall("/lobby/lobby/cancelRealtimeMatchmaking.html",{lock:!0},this,function(e){})}return!0},unload:function(){e.disconnect(this.closeLobbyMenu);e.disconnect(this.adaptSectionOnResizeConnect);e.disconnect(this.adaptScreenConnect);this.lazyload.destroy();dijit.byId("gamelist_gameselect")&&dijit.byId("gamelist_gameselect").destroy();null!==this.pageheader&&this.pageheader.destroy();if(null!==this.evtScroll){e.disconnect(this.evtScroll);this.evtScroll=null}if(null!==this.evtResize){e.disconnect(this.evtResize);this.evtResize=null}this.inviteFriendsDestroy()},onUpdateFilters:function(){var t=$("filter_name").value;t=removeAccents(t.toLowerCase().replace(/\s/g,""));e.query("#other_games_list .game_box_wrap").style("display","block");if(""!=t){var i=0;for(var a in games_known){var n=games_known[a].NAME;if(-1==(n=removeAccents(n.toLowerCase().replace(/\s/g,""))).indexOf(t)||t.length<3&&n.indexOf(t)>0)$("game_box_wrap_other_"+a)&&e.style("game_box_wrap_other_"+a,"display","none");else{this.makeSureWannaplayItemExists(a);i++}}$("could_not_find").innerHTML=i>0?"":_("Could not find your game?")+' <a class="bga-link" href="/gamelist">'+_("Check out all the games we have")+"</a>";e.style("find_by_name_gamelist","display","block")}else e.style("find_by_name_gamelist","display","none");this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()},makeSureWannaplayItemExists:function(t){var i=!1;let a={PLAY_NOW:window._("Play now!"),LOOKING_FOR_PLAYERS:window._("Searching for opponents..."),THEMEURL:g_themeurl};if(!$("Xannaplay_"+t)&&void 0!==games_known[t]&&games_known[t]){var n=this.page.format_string(this.jstpl_xannaplay_game,{...a,...games_known[t]});e.place(n,"xgame_invisible_stack");this.setBoxImage($("Xannaplay_img_"+t),"compact",!1);this.setupGameXannaplayItem(t);null!==this.lazyload&&this.lazyload.addImagesToLazyLoad("Xannaplay_"+t);i=!0}if(!$("wannaplay_"+t)&&void 0!==games_known[t]&&games_known[t]){n=this.page.format_string(this.jstpl_wannaplay_game,{...a,...games_known[t]});e.place(n,"other_games_list");this.setBoxImage($("wannaplay_img_"+t),"compact",!1);this.setupGameWannaplayItem(t);null!==this.lazyload&&this.lazyload.addImagesToLazyLoad("wannaplay_"+t);i=!0}i&&this.updateTablesNumberAvailable(t,!0)},onAddToFavAndStartNewGame:function(t){var i=t.currentTarget.id.split("_")[2];this.doAddFavorite(i,e.hitch(this,function(){this.doStartNewGame(i);$("filter_name").value="";this.onUpdateFilters()}))},onStartNewGame:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[2];this.doStartNewGame(i)},doStartNewGame:function(t){var i=this.clockmode,a="Xutton_play_"+t;localStorage.setItem("bga-lobby-type","old");if("automatic"==this.opponentMode)if(e.hasClass(a,"bgabutton_disabled"));else if(e.hasClass(a,"bgabutton_darkgray"));else if(e.hasClass(a,"bgabutton_red"))this.cancelMatchmaking(t,i);else{var n=$("gamenameraw_"+t).innerHTML;analyticsPush({game_name:n,cta_location:"lobbyauto_playnow",event:"play_last_step"});this.startGame(t)}else if("manual"==this.opponentMode)e.hasClass(a,"bgabutton_disabled")||(e.hasClass(a,"bgabutton_darkgray")?this.collapseGame(t):this.expandGame(t));else if("friends"==this.opponentMode){i=this.clockmode,n=$("gamenameraw_"+t).innerHTML;analyticsPush({game_name:n,cta_location:"lobbyfriends_playnow",event:"play_last_step"});this.page.ajaxcall("/table/table/createnew.html",{game:t,gamemode:i,forceManual:!0,is_meeting:!1,friendsonly:!0},this,function(t){if(t.table){t.table;var i=t.table;e.publish("gotourl",[{module:"table",args:{table:i,tb:t.forceTB,nr:!0}}])}})}},getGameLobbyLocation:function(t){for(var i=$("Xannaplay_"+t);null!==i;){if(null==(i=i.parentNode))return null;if(e.hasClass(i,"wannaplay_games_list")||e.hasClass(i,"spotlight_games_list")){return i.id.split("_")[0]}if(e.hasClass(i,"expanded_games")){return i.id.split("_")[0]}if("xgame_invisible_stack"==i.id)return"other"}return null},toggleNonSpotlightVisibility:function(e){if($("gamelobby_inner")){var t=!e;"boolean"!=typeof e&&(t=void 0);$("gamelobby_inner").classList.toggle("spotlight_only",t)}},expandGame:function(t,i){if("object"!=typeof t){var a=t;(t=[]).push(a)}this.doHideAllTablesList();this.clockmode;var n=[];void 0===i&&(i=!0);for(var o in t){a=t[o];if($("Xannaplay_"+a)){this.manualLobbySubscribeToGame(a);var s=this.getGameLobbyLocation(a);if("none"==e.style("Xannaplay_"+a,"display")){e.style("Xannaplay_"+a,"display","block");this.page.placeOnObject("Xannaplay_"+a,"wannaplay_"+a)}$("button_play_"+a)&&e.addClass("button_play_"+a,"bgabutton_disabled");e.addClass("Xutton_play_"+a,"bgabutton_disabled");setTimeout(function(){e.query(".bgabutton_disabled").removeClass("bgabutton_disabled")},500);if(!e.hasClass("Xutton_play_"+a,"bgabutton_darkgray")){if($("button_play_"+a)){e.removeClass("button_play_"+a,"bgabutton_blue");e.addClass("button_play_"+a,"bgabutton_darkgray")}e.removeClass("Xutton_play_"+a,"bgabutton_blue");e.addClass("Xutton_play_"+a,"bgabutton_darkgray");var r="<div id='expandedgame_box_wrap_"+a+"' class='game_box_wrap'>                    <div id='new_table_group_"+a+"' class='clear gametable_list_cannotjoin gametable_list' style='display:block'>                    </div>                    <div id='Xannaplay_tables_list_"+a+"' class='gametable_list'>                        <div class='loading_icon'></div>                    </div>                    <div class='gametable_list gametable_list_arenavail' id='switch_to_arena_wrap_"+a+"'><span class='switch_to_arena_text'>"+_("Some players are available for Arena mode")+" </span><div id='switch_to_arena_"+a+"' class='bgabutton bgabutton_gray switch_to_arena'><div class='icon20 icon_arena'></div> "+_("Play in Arena mode now")+"</div></div>                    <div class='gametable_list gametable_list_cannotjoin' id='display_cannot_join_"+a+"' style='display:none;text-align:center'><a href='#' class='bga-link display_cannot_join'>"+_("Display tables I cannot join")+"</a></div>                    <div id='cannot_join_group_"+a+"' class='cannot_join_group'>                        <div id='Xannaplay_tables_list_"+a+"_cantjoin' class='clear gametable_list gametable_list_cannotjoin'>                        </div>                    </div>                    </div>";e.place(r,s+"_expanded");e.connect($("display_cannot_join_"+a),"onclick",function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(20);e.style("cannot_join_group_"+i,"display","block");e.destroy("display_cannot_join_"+i)});this.page.attachToNewParent("Xannaplay_"+a,"expandedgame_box_wrap_"+a);this.page.slideToObjectPos("Xannaplay_"+a,"expandedgame_box_wrap_"+a,0,0).play();this.setupGameXannaplayItem(a);this.page.addTooltip("Xutton_play_"+a,"",_("Collapse all tables for this game"));e.place("<span>"+_("Collapse")+"</span>","Xutton_play_"+a,"only");e.connect($("switch_to_arena_"+a),"onclick",this,"onSwitchToArenaForGame");n.push(a)}}}setTimeout(e.hitch(this,function(){for(var t in n){var i=n[t];$("expandedgame_box_wrap_"+i)&&e.addClass("expandedgame_box_wrap_"+i,"expandedgame_box_wrap");var a=this.getGameLobbyLocation(i);$("game_box_wrap_"+a+"_"+i)?e.addClass("game_box_wrap_"+a+"_"+i,"game_box_wrap_empty"):console.error("Could not found: game_box_wrap_"+a+"_"+i)}}),1);var l={status:this.clockmode+"_open",games:n.join(";")};this.page.ajaxcall("/tablemanager/tablemanager/tableinfos.html",l,this,function(e){this.reloadGameTables(n,e.tables,e.tableorder);for(var t in n){var i=n[t];this.updateTablesNumberAvailable(i);this.updateSwitchToArenaVisibility(i)}});if(i){a=t[0];setTimeout(e.hitch(this,function(){if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}this.scrollToGame(a)}),500)}else setTimeout(e.hitch(this,function(){if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}}),500);setTimeout(e.hitch(this,function(){this.updateExpandedGameListInStorage()}),50)},onSwitchToArenaForGame:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_").pop(),a=e.query("#Xannaplay_myelo_"+i+" .myelo_value")[0].innerHTML;if(toint(a)<100)this.page.showMessage(_("Sorry, you need to reach 100 ELO to unlock Arena mode for this game."),"error");else if(this.page&&this.page.simplified){var n=$("gamenameraw_"+i).innerHTML;window.location.href="/gamepanel?game="+n+"#arena,"+this.clockmode}else if(this.switchRankingMode("arena")){this.startGame(i);this.scrollToGame(i)}},scrollToGame:function(t,i){void 0===i&&(i=!1);if(i){$("Xutton_play_"+t).classList.add("bga_highlight")}var a=e.window.getBox(),n=null,o=null;if($("expandedgame_box_wrap_"+t)){var s=e.position("expandedgame_box_wrap_"+t);n=s.y;o=s.h}else e.query(".add_wannaplay_"+t).forEach(function(t){var i=e.coords(t);if(0!=i.y){n=null===n?i.y:Math.min(i.y,n);o=i.h}});if(null!==n){var r=!1;(n<a.t||n+o>a.t+a.h)&&(r=!0);r&&window.scrollBy({top:n-100,behavior:"smooth"})}else console.error("Could not scroll to game "+t)},collapseGame:function(t,i){this.clockmode;var a=this.getGameLobbyLocation(t);this.manualLobbyUnsubscribeToGame(t);if(e.hasClass("Xutton_play_"+t,"bgabutton_darkgray")){if($("button_play_"+t)){e.addClass("button_play_"+t,"bgabutton_blue");e.removeClass("button_play_"+t,"bgabutton_darkgray")}e.addClass("Xutton_play_"+t,"bgabutton_blue");e.removeClass("Xutton_play_"+t,"bgabutton_darkgray");e.removeClass("game_box_wrap_"+a+"_"+t,"game_box_wrap_empty");if("other"!=a){this.page.attachToNewParent("Xannaplay_"+t,"game_box_wrap_"+a+"_"+t);this.page.slideToObject("Xannaplay_"+t,"game_box_wrap_"+a+"_"+t).play()}else{this.page.attachToNewParent("Xannaplay_"+t,"xgame_invisible_stack");e.style("Xannaplay_"+t,"display","none")}this.setupGameXannaplayItem(t);this.updateTablesNumberAvailable(t);e.destroy("expandedgame_box_wrap_"+t)}void 0!==i&&i||this.updateExpandedGameListInStorage();if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}},updateExpandedGameListInStorage:function(){if($("favorite_table_list")){var t={};e.query(".expandedgame_box_wrap").forEach(e.hitch(this,function(e){var i=e.id.substr(22);t[i]=!0}));"block"==e.style("favorite_table_list","display")&&((t={}).all_favorite=!0);localStorage.setItem("explobby",JSON.stringify(t))}},onPlayAnyFavorite:function(t){e.stopEvent(t);var i=[],a="#favorite_games_list .game_box_wrap";"arena"==this.rankingMode&&(a+=" .arena_avail");e.query(a).forEach(e.hitch(this,function(e){var t=e.id.split("_").pop();i.push(t)}));for(var n in i){var o=i[n];this.startGame(o)}e.style("play_any_favorite","display","none");e.style("play_any_favorite_cancel","display","inline-block")},onPlayAnyFavoriteCancel:function(t){e.stopEvent(t);this.page.ajaxcall("/lobby/lobby/cancelRealtimeMatchmaking.html",{lock:!0},this,function(e){});e.style("play_any_favorite","display","inline-block");e.style("play_any_favorite_cancel","display","none")},startGame:function(t){var a=this.clockmode,n=this.rankingMode;this.makeSureWannaplayItemExists(t);null!=$("button_play_"+t)&&e.addClass("button_play_"+t,"bgabutton_disabled");e.addClass("Xutton_play_"+t,"bgabutton_disabled");setTimeout(function(){e.query(".bgabutton_disabled").removeClass("bgabutton_disabled")},500);null!=$("button_play_"+t)&&e.removeClass("button_play_"+t,"bgabutton_blue");e.removeClass("Xutton_play_"+t,"bgabutton_blue");null!=$("button_play_"+t)&&e.addClass("button_play_"+t,"bgabutton_darkgray");e.addClass("Xutton_play_"+t,"bgabutton_darkgray");i.stores.matchmakings.startMatchmaking(t,a,n).then(e.hitch(this,function(t){if(void 0!==t.table_id)e.publish("gotourl",[{module:"table",args:{table:t.table_id,nr:!0}}]);else if(!0===t.launched){null!=$("wannaplay_"+t.game_id)&&e.addClass("wannaplay_"+t.game_id,"wannaplay_waiting");e.addClass("Xannaplay_"+t.game_id,"wannaplay_waiting");null!=$("button_play_"+t.game_id)&&e.removeClass("button_play_"+t.game_id,"bgabutton_darkgray");e.removeClass("Xutton_play_"+t.game_id,"bgabutton_darkgray");null!=$("button_play_"+t.game_id)&&e.addClass("button_play_"+t.game_id,"bgabutton_red");e.addClass("Xutton_play_"+t.game_id,"bgabutton_red");null!=$("button_play_"+t.game_id)&&($("button_play_"+t.game_id).innerHTML=_("Cancel"));$("Xutton_play_"+t.game_id).innerHTML=_("Cancel");e.query(".add_wannaplay_"+t.game_id).addClass("wannaplay_waiting_"+t.game_mode);e.query("#wannaplay_"+t.game_id+" > .quick_howtoplay").style("display","none");e.query("#Xannaplay_"+t.game_id+" > .quick_howtoplay").style("display","none");var i=t.estimated_time;e.query("#wannaplay_"+t.game_id+" > .wannaplayauto_time").style("display","block");e.query("#Xannaplay_"+t.game_id+" > .wannaplayauto_time").style("display","block");null!=$("wannaplayauto_timevalue_"+t.game_id)&&($("wannaplayauto_timevalue_"+t.game_id).innerHTML=this.getEstimatedTimeValue(i));$("Xannaplayauto_timevalue_"+t.game_id).innerHTML=this.getEstimatedTimeValue(i);null!=$("wannaplayauto_timeunit_"+t.game_id)&&($("wannaplayauto_timeunit_"+t.game_id).innerHTML=this.getEstimatedTimeUnit(i));$("Xannaplayauto_timeunit_"+t.game_id).innerHTML=this.getEstimatedTimeUnit(i);$("wait_time_"+t.game_mode+"_"+t.game_id).innerHTML=i;$("progress_"+t.game_mode+"_"+t.game_id).innerHTML=t.progress;$("remaining_"+t.game_mode+"_"+t.game_id).innerHTML=t.remaining;$("timeprofile_"+t.game_mode+"_"+t.game_id).innerHTML=1;e.query("#wannaplay_"+t.game_id+" > .wannaplayauto_loading").style("display","block");e.query("#Xannaplay_"+t.game_id+" > .wannaplayauto_loading").style("display","block");null!=$("wannaplayauto_loadingbar_"+t.game_id)&&e.style("wannaplayauto_loadingbar_"+t.game_id,"width",$("progress_"+t.game_mode+"_"+t.game_id).innerHTML+"%");e.style("Xannaplayauto_loadingbar_"+t.game_id,"width",$("progress_"+t.game_mode+"_"+t.game_id).innerHTML+"%");null!=$("wannaplayauto_loadingbar_"+t.game_id)&&e.addClass("wannaplayauto_loadingbar_"+t.game_id,"wannaplayauto_loadingbar_tp1");e.addClass("Xannaplayauto_loadingbar_"+t.game_id,"wannaplayauto_loadingbar_tp1");e.query(".game_box_wrap_game_"+t.game_id+" .wannaplayauto_loadingbartxt").forEach(function(i){null===t.remaining?i.innerHTML=_("Searching for opponents..."):i.innerHTML=e.string.substitute(t.remaining<=1?_("Searching for ${opponent_nbr} opponent..."):_("Searching for ${opponent_nbr} opponents..."),{opponent_nbr:t.remaining})});this.updateLobbyTitle();if(t.show_premium_banner){var n='<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>';n+=" ";e.hasClass("ebd-body","premiummember")?n+=_("${game_name} is a premium game: thanks to your Premium account, you do not have to wait to play :)").replace("${game_name}",_(t.game_name+"_displayed")).replace("club","premium").replace("club","premium"):n+=_('${game_name} is a premium game, so you have to wait for a <a href="club" target="_blank">Premium member</a> who also wants to play this game. To play immediately, <a href="club" target="_blank">go Premium!</a> :)').replace("${game_name}",_(t.game_name+"_displayed")).replace("club","premium").replace("club","premium");$("Xannaplay_premium_banner_"+t.game_id).innerHTML=n;e.style("Xannaplay_premium_banner_"+t.game_id,"display","block");if(null!==$("wannaplay_premium_banner_"+t.game_id)){$("wannaplay_premium_banner_"+t.game_id).innerHTML=n;e.style("wannaplay_premium_banner_"+t.game_id,"display","block")}}if(t.show_premium_option_banner){n='<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>';n+=" ";e.hasClass("ebd-body","premiummember")?n+=_("Some options of ${game_name} are premium: thanks to your Premium account, you do not have to wait to play with them :)").replace("${game_name}",_(t.game_name+"_displayed")).replace("club","premium").replace("club","premium"):n+=_('You selected a premium option for ${game_name}: you have to wait for a <a href="club" target="_blank">Premium member</a> who also wants to play with this option. To play immediately, <a href="club" target="_blank">go Premium!</a> :)').replace("${game_name}",_(t.game_name+"_displayed")).replace("club","premium").replace("club","premium");$("Xannaplay_premium_banner_"+t.game_id).innerHTML=n;e.style("Xannaplay_premium_banner_"+t.game_id,"display","block");if(null!==$("wannaplay_premium_banner_"+t.game_id)){$("wannaplay_premium_banner_"+t.game_id).innerHTML=n;e.style("wannaplay_premium_banner_"+t.game_id,"display","block")}}if("realtime"==a){setTimeout(e.hitch(this,"tooltipYouCanStartAnotherGame"),4e3);setTimeout(e.hitch(this,"acceptAllRankingmode"),3e3)}else setTimeout(e.hitch(this,"tooltipYouCanStartAnotherGameAsync"),3e3)}})).catch(e.hitch(this,function(){null!=$("button_play_"+t)&&e.removeClass("button_play_"+t,"bgabutton_darkgray");e.removeClass("Xutton_play_"+t,"bgabutton_darkgray");null!=$("button_play_"+t)&&e.addClass("button_play_"+t,"bgabutton_blue");e.addClass("Xutton_play_"+t,"bgabutton_blue")}))},acceptAllRankingmode:function(){},hideAcceptAllRankingModeIfNeeded:function(){if(0==e.query(".wannaplay_waiting").length){e.style("favorite_switch_to_other_mode_wrap","display","none");e.style("favorite_switch_to_other_mode_action","display","block");e.style("favorite_switch_to_other_mode_done","display","none")}},onAcceptAllRankingMode:function(t){e.stopEvent(t);this.page.ajaxcall("/lobby/lobby/extendMatchmakingInProgress.html",{lock:!0},this,function(t){e.style("favorite_switch_to_other_mode_action","display","none");e.style("favorite_switch_to_other_mode_done","display","block");this.rankingMode,$("favorite_switch_to_other_mode_done").innerHTML="<b>"+_("If we can't find you a Simple game, we'll find you an Arena (competitive) game.")+"</b>"})},tooltipYouCanStartAnotherGame:function(){if("automatic"==this.opponentMode){var t=e.query(".wannaplayauto_button.bgabutton_blue");if(t.length>0){var i=t[0].id;mainsite.tutorialShowOnce(4)&&mainsite.highlightElementTutorial(i,_("To increase your chance to find opponents, you can wait for several games at the same time. You will automatically play the first game with enough opponents :)"))}}},tooltipYouCanStartAnotherGameAsync:function(){if("automatic"==this.opponentMode){var t=e.query(".wannaplay_waiting .wannaplayauto_loading");if(t.length>0){var i=t[0].id;mainsite.tutorialShowOnce(5)&&mainsite.highlightElementTutorial(i,_("We are looking for your opponents now. You have nothing more to do: you will receive an email when it will be your turn to play :)"))}}},cancelMatchmaking:function(t,i){null!=$("button_play_"+t)&&e.addClass("button_play_"+t,"bgabutton_disabled");e.addClass("Xutton_play_"+t,"bgabutton_disabled");setTimeout(function(){e.query(".bgabutton_disabled").length>0&&e.query(".bgabutton_disabled").removeClass("bgabutton_disabled")},500);$("button_play_"+t)&&null!=$("button_play_"+t)&&e.removeClass("button_play_"+t,"bgabutton_red");$("Xutton_play_"+t)&&e.removeClass("Xutton_play_"+t,"bgabutton_red");null!=$("button_play_"+t)&&e.addClass("button_play_"+t,"bgabutton_darkgray");e.addClass("Xutton_play_"+t,"bgabutton_darkgray");this.page.ajaxcall("/lobby/lobby/cancelMatchmaking.html",{game:t,gamemode:i,lock:!0},this,function(e){},function(i){null!=$("button_play_"+t)&&e.removeClass("button_play_"+t,"bgabutton_darkgray");null!=$("Xutton_play_"+t)&&e.removeClass("Xutton_play_"+t,"bgabutton_darkgray")});this.updateLobbyTitle()},onMatchmakingStatusUpdate:function(t){$("timeprofile_"+t.args.game_mode+"_"+t.args.game_id).innerHTML=t.args.time_profile;var i=$("progress_"+t.args.game_mode+"_"+t.args.game_id).innerHTML;t.args.progress>i&&($("progress_"+t.args.game_mode+"_"+t.args.game_id).innerHTML=t.args.progress);$("remaining_"+t.args.game_mode+"_"+t.args.game_id).innerHTML=t.args.remaining;var a=this.clockmode;if(a==t.args.game_mode){null!=$("wannaplayauto_loadingbar_"+t.args.game_id)&&e.removeClass("wannaplayauto_loadingbar_"+t.args.game_id,["wannaplayauto_loadingbar_tp1","wannaplayauto_loadingbar_tp2","wannaplayauto_loadingbar_tp3"]);e.removeClass("Xannaplayauto_loadingbar_"+t.args.game_id,["wannaplayauto_loadingbar_tp1","wannaplayauto_loadingbar_tp2","wannaplayauto_loadingbar_tp3"]);null!=$("wannaplayauto_loadingbar_"+t.args.game_id)&&e.addClass("wannaplayauto_loadingbar_"+t.args.game_id,"wannaplayauto_loadingbar_tp"+t.args.time_profile);e.addClass("Xannaplayauto_loadingbar_"+t.args.game_id,"wannaplayauto_loadingbar_tp"+t.args.time_profile);if(t.args.progress>i){null!=$("wannaplayauto_loadingbar_"+t.args.game_id)&&e.animateProperty({node:"wannaplayauto_loadingbar_"+t.args.game_id,properties:{width:{end:t.args.progress,units:"%"}}}).play();e.animateProperty({node:"Xannaplayauto_loadingbar_"+t.args.game_id,properties:{width:{end:t.args.progress,units:"%"}}}).play()}e.query(".game_box_wrap_game_"+t.args.game_id+" .wannaplayauto_loadingbartxt").forEach(function(i){null===t.args.remaining?i.innerHTML=_("Searching for opponents..."):i.innerHTML=e.string.substitute(t.args.remaining<=1?_("Searching for ${opponent_nbr} opponent..."):_("Searching for ${opponent_nbr} opponents..."),{opponent_nbr:t.args.remaining})});this.updateLobbyTitle();var n=$("wait_time_"+a+"_"+t.args.game_id).innerHTML-t.args.time_spent;null!=$("wannaplayauto_timevalue_"+t.args.game_id)&&($("wannaplayauto_timevalue_"+t.args.game_id).innerHTML=this.getEstimatedTimeValue(n));$("Xannaplayauto_timevalue_"+t.args.game_id).innerHTML=this.getEstimatedTimeValue(n);null!=$("wannaplayauto_timeunit_"+t.args.game_id)&&($("wannaplayauto_timeunit_"+t.args.game_id).innerHTML=this.getEstimatedTimeUnit(n));$("Xannaplayauto_timeunit_"+t.args.game_id).innerHTML=this.getEstimatedTimeUnit(n)}},getEstimatedTimeValue:function(e){var t=this.getMaxEstimatedTimetoDisplay();e>t&&(e=t);return e>=60?e<3600?Math.round(e/60):Math.round(e/3600):1},getEstimatedTimeUnit:function(e){var t=this.getMaxEstimatedTimetoDisplay();e>t&&(e=t);return e>=60?e<3600?"m":"h":"m"},getMaxEstimatedTimetoDisplay:function(){return"realtime"==this.clockmode?1200:259200},formatEstimatedWaitingTime:function(e){var t=this.getMaxEstimatedTimetoDisplay();return e>t?">"+mainsite.formatReflexionTime(t).string:mainsite.formatReflexionTime(e).string},cancelMatchmakingForGame:function(t,i){this.makeSureWannaplayItemExists(t);null!=$("wannaplay_"+t)&&e.removeClass("wannaplay_"+t,"wannaplay_waiting");e.removeClass("Xannaplay_"+t,"wannaplay_waiting");null!=$("button_play_"+t)&&e.removeClass("button_play_"+t,"bgabutton_darkgray");e.removeClass("Xutton_play_"+t,"bgabutton_darkgray");null!=$("button_play_"+t)&&e.removeClass("button_play_"+t,"bgabutton_red");e.removeClass("Xutton_play_"+t,"bgabutton_red");null!=$("button_play_"+t)&&e.addClass("button_play_"+t,"bgabutton_blue");e.addClass("Xutton_play_"+t,"bgabutton_blue");null!=$("button_play_"+t)&&($("button_play_"+t).innerHTML=_("Play now!"));$("Xutton_play_"+t).innerHTML=_("Play now!");e.query(".add_wannaplay_"+t).removeClass("wannaplay_waiting_"+i);e.query("#wannaplay_"+t+" > .wannaplayauto_time").style("display","none");e.query("#Xannaplay_"+t+" > .wannaplayauto_time").style("display","none");null!=$("wannaplayauto_loadingbar_"+t)&&e.removeClass("wannaplayauto_loadingbar_"+t,["wannaplayauto_loadingbar_tp1","wannaplayauto_loadingbar_tp2","wannaplayauto_loadingbar_tp3"]);e.removeClass("Xannaplayauto_loadingbar_"+t,["wannaplayauto_loadingbar_tp1","wannaplayauto_loadingbar_tp2","wannaplayauto_loadingbar_tp3"]);null!=$("wannaplayauto_loadingbar_"+t)&&e.style("wannaplayauto_loadingbar_"+t,"width","0%");e.style("Xannaplayauto_loadingbar_"+t,"width","0%");e.query("#wannaplay_"+t+" > .wannaplayauto_loading").style("display","none");e.query("#Xannaplay_"+t+" > .wannaplayauto_loading").style("display","none");null!=$("wannaplay_premium_banner_"+t)&&e.style("wannaplay_premium_banner_"+t,"display","none");e.style("Xannaplay_premium_banner_"+t,"display","none");this.hideAcceptAllRankingModeIfNeeded();this.updateLobbyTitle()},onMatchmakingCanceled:function(e){e.args.game_ids.forEach(t=>{this.cancelMatchmakingForGame(t,e.args.game_mode)})},onMatchmakingInvalidPreferences:function(e){this.page.showMessage(_("Your game options preferences for ${game_name} are invalid. You should check or reset them.").replace("${game_name}",_(e.args.game_name+"_displayed")),"error")},onMatchmakingCreateTableError:function(e){this.page.showMessage(_("Unexpected error: ")+_(e.args.message),"error")},promptToActivateNotifications:function(){if("Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window){this.popindialog=new ebg.popindialog;this.popindialog.create("notifications_prompt","main-content");this.popindialog.setTitle(_("Would you like to enable web notifications?"));var t='<br>                    <img src="'+getStaticAssetUrl("img/mainsite/prompt_webpush.png")+'" class="standard_popin_right_image"></img>                    {NOTIFICATIONS_PRESENTATION}<br/><br />                    {NOTIFICATIONS_ACTIVATION_INFO}<br/><br/>                    <div class="clear" style="text-align:center">                        <a href="#" id="notifications_prompt_notnow" class="bgabutton bgabutton_gray bgabutton_always_big">'+_("Maybe later")+'</a>                        <a href="#" id="notifications_prompt_enable" class="bgabutton bgabutton_blue bgabutton_always_big">'+_("Yes, please!")+'</a>                        <br /><a class="bga-link" href="#" id="notifications_prompt_notagain">'+_("I'm not interested, please do not ask me again")+"</a>                    </div>";t=(t=t.replace("{NOTIFICATIONS_PRESENTATION}",_("Web notifications allow to display notifications on your device through your browser. This is especially useful if you like to multitask or play turn-based games."))).replace("{NOTIFICATIONS_ACTIVATION_INFO}",_("You can test notifications and finetune events you want to be notified about in <a href='${url}' target='_blank'>your account preferences</a>.").replace("${url}","/preferences?section=notifications"));this.popindialog.setContent(t);this.popindialog.show();e.connect($("notifications_prompt_enable"),"onclick",this,function(t){e.stopEvent(t);this.popindialog.destroy();this.page.setupWebPush().then(e.hitch(this,function(){this.page.ajaxcall("/player/profile/setNotificationPreference.html",{type:"webNotifications",value:1},this,function(){this.page.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})})).then(null,e.hitch(this,function(e){console.error(e);this.page.showMessage(__("lang_mainsite","We haven't been able to setup notifications! Did you confirm authorization when prompted by the browser?"),"error")}))});e.connect($("notifications_prompt_notnow"),"onclick",this,function(t){e.stopEvent(t);this.popindialog.destroy()});e.connect($("notifications_prompt_notagain"),"onclick",this,function(t){e.stopEvent(t);this.page.ajaxcall("/player/profile/setNotificationPreference.html",{type:"webNotifications",value:2},this,function(){this.page.showMessage(__("lang_mainsite","Profile informations updated !"),"info");this.popindialog.destroy()})})}},onGamePreferencesClose:function(t){e.stopEvent(t);this.gamePreferencesPopindialog.destroy();"play_now"==t.currentTarget.id&&this.startGame(this.tablePreferencesCurrentGame)},onChangeGamePreferences:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(15),a=this.clockmode;this.page.ajaxcall("/lobby/lobby/getGamePreferences.html",{game:i,gamemode:a,ranking_mode:this.rankingMode,waiting_time:!0},this,function(t){var n=t.preferences,o=t.game_name,s=t.not_default_priorities,r=t.arena_priorities;this.tablePreferences[t.game_id]=n;this.tablePreferencesCurrentGame=t.game_id;this.gamePreferencesPopindialog=new ebg.popindialog;this.gamePreferencesPopindialog.create("game_preferences","main-content");this.gamePreferencesPopindialog.setTitle("");this.gamePreferencesPopindialog.setHelpLink("/faq?anchor=faq_playing_simplelobby");var l=_("My game options preferences for: <em>%s</em>").replace("%s",'<p class="gamename">'+_(o+"_displayed")+"</p>").replace("<em>","").replace("</em>",""),d="<div>";for(var c in n)c<295||c>299||(d+=this.getHtmlForOptionPreferences(c,n[c],t.player_is_premium));for(var c in n)if(!(c<200||c>294)){n[c];d+=this.getHtmlForOptionPreferences(c,n[c],t.player_is_premium)}for(var c in n)if(!(c<100||c>199)){0;n[c];d+=this.getHtmlForOptionPreferences(c,n[c],t.player_is_premium)}d+='<br/><br/><p><h2><a class="bga-link" href="#" id="toggle_advanced_link">'+_("Show advanced options")+"</a></h2></p>";d+="<p style='text-align: center'>";d+="<a class='bgabutton bgabutton_blue' id='second_close_btn' href='#'><span>"+__("lang_mainsite","Close")+"</span></a>";d+="&nbsp;&nbsp;<a class='bgabutton bgabutton_blue' id='play_now' href='#'><span>"+__("lang_mainsite","Play now!")+"</span></a>";d+="<br/>";d+='<br/><span class="smalltext">'+_("Estimated time to find opponents with your options")+': <b><span id="waiting_time_thisgame"><i class="fa fa-spinner fa-spin fa-fw"></i></span></b></span>';d+="</p>";var u='<div id="game_preferences_window"><img id="game_preferences_image" src="'+e.attr($("Xannaplay_img_"+i),"bga_lazyload")+'" class="game_box"/>                    <h2 id="game_preferences_title">'+l+'</h2>                    <div id="game_preferences_contents" class="clear">'+d+"</div>                    </div>";this.gamePreferencesPopindialog.setContent(u);this.gamePreferencesPopindialog.show();e.hasClass("Xannaplay_"+i,"wannaplay_waiting")&&e.style("play_now","display","none");$("waiting_time_thisgame").innerHTML='<i class="fa fa-spinner fa-spin fa-fw"></i>';this.page.ajaxcall("/lobby/lobby/getWaitingTime.html",{game:i,mode:a},this,function(e){$("waiting_time_thisgame")&&($("waiting_time_thisgame").innerHTML=this.formatEstimatedWaitingTime(e.time))});e.connect($("second_close_btn"),"onclick",this,"onGamePreferencesClose");e.connect($("play_now"),"onclick",this,"onGamePreferencesClose");for(var h in s)if(void 0===r[h]&&$("mm_prefs_wrapper_"+h)){this.changePref(h);e.style("mm_prefs_wrapper_"+h,"display","block")}this.page.addTooltipToClass("mm_pref_value_premium",_("Premium option: you will have to wait for a Premium member who also wants to play with this option. To play immediately, go Premium!"),"");e.query(".mm_pref_value").connect("onclick",this,"onClickOptionValue");e.query(".mm_pref_value_priority").connect("onclick",this,"onClickOptionValuePriority");e.connect($("toggle_advanced_link"),"onclick",this,function(t){e.stopEvent(t);for(var i in this.tablePreferences[this.tablePreferencesCurrentGame]){var a=this.tablePreferences[this.tablePreferencesCurrentGame][i];$("mm_prefs_wrapper_"+i)&&void 0!==a.advanced&&!0===a.advanced&&"none"==e.style("mm_prefs_wrapper_"+i,"display")&&e.style("mm_prefs_wrapper_"+i,"display","block")}e.destroy("toggle_advanced_link")});e.query(".mm_reset_default").connect("onclick",this,function(t){t.preventDefault();h=t.currentTarget.id.substr(17);var i=this.tablePreferencesCurrentGame,n=this.tablePreferences[i][h];for(var o in n.values){n.values[o];this.page.ajaxcall("/lobby/lobby/setGamePreference.html",{game:i,gamemode:a,pref_id:h,value_id:o},this,function(t){this.tablePreferences[t.game_id][t.pref_id].values[t.value_id].priority=t.priority;if(e.byId("mm_pref_"+t.pref_id+"_value_"+t.value_id)){e.removeClass("mm_pref_"+t.pref_id+"_value_"+t.value_id,["mm_pref_color_priority_0","mm_pref_color_priority_1","mm_pref_color_priority_2","mm_pref_color_priority_3","mm_pref_color_priority_9"]);e.addClass("mm_pref_"+t.pref_id+"_value_"+t.value_id,"mm_pref_color_priority_"+t.priority)}e.byId("mm_pref_priority_"+t.pref_id+"_"+t.value_id)&&($("mm_pref_priority_"+t.pref_id+"_"+t.value_id).innerHTML=this.priority_to_sentence[t.priority]);296==t.pref_id&&this.setOpponentReputationBasedOnActualPrefs();$("waiting_time_thisgame").innerHTML='<i class="fa fa-spinner fa-spin fa-fw"></i>';this.page.ajaxcall("/lobby/lobby/getWaitingTime.html",{game:i,mode:a},this,function(e){$("waiting_time_thisgame")&&($("waiting_time_thisgame").innerHTML=this.formatEstimatedWaitingTime(e.time))})})}e.style("mm_no_preference_"+h,"display","block");e.style("mm_prefs_values_"+h,"display","none")});e.connect($("game_preferences_window"),"onclick",this,function(t){e.query(".mm_pref_select").style("display","none")});e.query(".mm_change_pref").connect("onclick",this,function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(15);this.changePref(i)});e.query(".mm_change_pref_arena").connect("onclick",this,function(t){e.stopEvent(t);this.page.showMessage(_("Sorry, all games played in Arena mode must be played with this option."),"error")});1==e.query("#mm_prefs_wrapper_299 .mm_pref").length&&e.style("mm_prefs_wrapper_299","display","none");"realtime"==this.clockmode&&e.destroy("mm_prefs_wrapper_206");"arena"==this.rankingMode&&e.destroy("mm_prefs_wrapper_201");this.setOpponentReputationBasedOnActualPrefs();e.query(".reputation_option_value").connect("onchange",this,"onChangeOpponentReputationPref");e.query("#mm_prefs_values_296 .mm_prefs_values_contents").style("display","none")})},setOpponentReputationBasedOnActualPrefs:function(){var e=this.tablePreferencesCurrentGame,t=this.tablePreferences[e][296].values[1].priority;1==this.tablePreferences[e][296].values[3].priority?$("reputation_option_value_1").checked="checked":1==t?$("reputation_option_value_2").checked="checked":2==t?$("reputation_option_value_3").checked="checked":9==t&&($("reputation_option_value_4").checked="checked")},onChangeOpponentReputationPref:function(e){var t=e.currentTarget.id.substr(24);this.changeOpponentReputationPref(t)},getOpponentReputationPresets:function(){return{1:{0:9,1:9,2:9,3:0},2:{0:9,1:1,2:2,3:3},3:{0:1,1:2,2:3,3:9},4:{0:0,1:9,2:9,3:9}}},changeOpponentReputationPref:function(e){var t=this.getOpponentReputationPresets();for(var i in t[e])this.setCurrentGameOptionValue(296,i,t[e][i])},changePref:function(t){e.style("mm_no_preference_"+t,"display","none");e.style("mm_prefs_values_"+t,"display","inline-block")},getHtmlForOptionPreferences:function(e,t,i){var a=[];a[0]={id:1,label:_("I'm okay to play with")};a[1]={id:2,label:_("I prefer not playing with")};a[2]={id:3,label:_("I'm reluctant to play with")};a[3]={id:9,label:_("I never want to play with")};var n="";for(var o in t.values)t.values[o].arena_set&&1==t.values[o].arena_set&&(n=t.values[o].name);var s="";""!=n&&(s=" style='display:none' ");var r="";r+='<div class="mm_prefs_wrapper" id="mm_prefs_wrapper_'+e+'" style="display:'+(void 0!==t.advanced&&!0===t.advanced?"none":"block")+'">';r+='<div class="mm_prefs_option">'+t.name+"</div>";r+='<p class="mm_no_preference" id="mm_no_preference_'+e+'" '+s+">"+_("No preferences")+' (<a href="#" class="bga-link mm_change_pref" id="mm_change_pref_'+e+'">'+_("Change")+"</a>)</p>";""!=n&&(r+="<p>"+n+' (<a href="#" class="bga-link mm_change_pref_arena">'+_("Change")+")</a><p>");r+='<div class="mm_prefs_values" id="mm_prefs_values_'+e+'" style="display:none;"><div class="mm_prefs_values_contents">';206==e&&(r+="<p style='margin: 15px 5px;'><i class='fa fa-exclamation-triangle' aria-hidden='true'></i> "+_("Note: playing hours are only used with Fast Turn Based game speeds.")+"</p>");for(var o in t.values){var l=t.values[o];if(!(295==e&&o>=10)){var d=void 0===l.priority?void 0!==l.majorvariant&&!0===l.majorvariant?9:0:l.priority,c=void 0!==l.premium&&!0===l.premium,u=void 0!==t.default&&t.default===o||void 0!==l.default&&l.default,h='<span id="mm_pref_priority_'+e+"_"+o+'">'+this.priority_to_sentence[d]+'</span> <i class="fa fa-caret-down"></i>';206==e&&(l.name=mainsite.playingHoursToLocal(l.name));if(void 0===l.name);else{r+='<div class="mm_pref">';r+='<div id="mm_pref_'+e+"_value_"+o+'" class="mm_pref_value'+(u?" mm_pref_value_default":"")+(!i&&c?" mm_pref_value_premium":"")+" mm_pref_color_priority_"+d+'">'+h+'<div class="emblempremium"></div></div>';r+='<div id="mm_pref_'+e+"_select_"+o+'" class="mm_pref_select">';for(var p in a)if(!(295==e&&0==o&&p>0)){var m=a[p].id;r+='<div id="mm_pref_'+e+"_value_"+o+"_priority_"+m+'" class="mm_pref_value_priority mm_pref_color_priority_'+m+'" value="'+m+'" '+(m==d?"selected":"")+">"+("<b>"+a[p].label+'</b> "'+l.name+'"')+"</div>"}r+="</div>";r+="</div>";r+='&nbsp;<b class="option_value_label">'+l.name+"</b>&nbsp;";r+="<br/>"}}}r+="</div>";if(296==e){r+='<p><input type="radio" id="reputation_option_value_1" name="reputation_option_value" class="reputation_option_value" value="preset_1" >&nbsp;&nbsp;<label for="reputation_option_value_1"><b>'+_("No filter")+"</b> - "+_("I'm okay to play with anyone.")+"</label></input></p>";r+='<p><input type="radio" id="reputation_option_value_2" name="reputation_option_value" class="reputation_option_value" value="preset_2" checked>&nbsp;&nbsp;<label for="reputation_option_value_2"><b>'+_("Permissive")+"</b> - "+_("I would prefer to avoid players with a bad reputation (< 50).")+"</label></input></p>";r+='<p><input type="radio" id="reputation_option_value_3" name="reputation_option_value" class="reputation_option_value" value="preset_3" >&nbsp;&nbsp;<label for="reputation_option_value_3"><b>'+_("Restrictive")+"</b> - "+_("I never want to play with players with a very bad reputation (< 50).")+"</label></input></p>";r+='<p><input type="radio" id="reputation_option_value_4" name="reputation_option_value" class="reputation_option_value" value="preset_4" >&nbsp;&nbsp;<label for="reputation_option_value_4"><b>'+_("Very restrictive")+"</b> - "+_("I only want to play with players with a high reputation (75 and higher).")+"</label></input></p>";r+="</br>"}r+='<p class="mm_reset_default_wrap"><a href="#" class="bga-link mm_reset_default" id="mm_reset_default_'+e+'">'+_("Reset to default")+"</a></p>";r+="</div>";return r+="</div>"},onClickOptionValue:function(t){t.currentTarget.id;t.preventDefault();t.stopPropagation();this.tablePreferencesCurrentGame;var i=t.currentTarget.id.split("_")[2],a=t.currentTarget.id.split("_")[4];if("none"==e.style("mm_pref_"+i+"_select_"+a,"display")){e.query(".mm_pref_select").style("display","none");e.style("mm_pref_"+i+"_select_"+a,"display","block")}else e.style("mm_pref_"+i+"_select_"+a,"display","none")},onClickOptionValuePriority:function(t){t.currentTarget.id;t.preventDefault();t.stopPropagation();this.clockmode;var i=this.tablePreferencesCurrentGame,a=t.currentTarget.id.split("_")[2],n=t.currentTarget.id.split("_")[4],o=t.currentTarget.id.split("_")[6],s=o<=1;if(!s)for(var r in this.tablePreferences[i][a].values){var l=this.tablePreferences[i][a].values[r],d=void 0===l.priority?0:l.priority;if(n!=r&&d<=1){s=!0;break}}if(s){e.style("mm_pref_"+a+"_select_"+n,"display","none");this.setCurrentGameOptionValue(a,n,o)}else this.page.showMessage(_("You need at least one '${1}' or '${2}' value for this option.").replace("${1}",_("My first choice is to play with")).replace("${2}",_("I'm okay to play with")),"error")},setCurrentGameOptionValue:function(t,i,a){var n=this.tablePreferencesCurrentGame,o=this.clockmode;this.page.ajaxcall("/lobby/lobby/setGamePreference.html",{game:n,gamemode:o,pref_id:t,value_id:i,priority:a},this,function(a){this.tablePreferences[a.game_id][a.pref_id].values[a.value_id].priority=a.priority;e.removeClass("mm_pref_"+t+"_value_"+i,["mm_pref_color_priority_0","mm_pref_color_priority_1","mm_pref_color_priority_2","mm_pref_color_priority_3","mm_pref_color_priority_9"]);e.addClass("mm_pref_"+t+"_value_"+i,"mm_pref_color_priority_"+a.priority);$("mm_pref_priority_"+t+"_"+i).innerHTML=this.priority_to_sentence[a.priority];$("waiting_time_thisgame").innerHTML='<i class="fa fa-spinner fa-spin fa-fw"></i>';this.page.ajaxcall("/lobby/lobby/getWaitingTime.html",{game:n,mode:o},this,function(e){$("waiting_time_thisgame")&&($("waiting_time_thisgame").innerHTML=this.formatEstimatedWaitingTime(e.time))});for(var s in a.changes){var r=a.changes[s];this.tablePreferences[a.game_id][r.pref_id].values[r.value_id].priority=r.priority;e.removeClass("mm_pref_"+r.pref_id+"_value_"+r.value_id,["mm_pref_color_priority_0","mm_pref_color_priority_1","mm_pref_color_priority_2","mm_pref_color_priority_3","mm_pref_color_priority_9"]);e.addClass("mm_pref_"+r.pref_id+"_value_"+r.value_id,"mm_pref_color_priority_"+r.priority);$("mm_pref_priority_"+r.pref_id+"_"+r.value_id).innerHTML=this.priority_to_sentence[r.priority]}})},onMatchmakingGameStart:function(t){this.page.showMessage(_("Your game is about to start..."),"info");mainsite.showAcceptGameStart(t.args.table_id);this.makeSureWannaplayItemExists(t.args.game_id);this.redirect_game_id=t.args.game_id;$("wannaplayauto_timevalue_"+this.redirect_game_id).innerHTML=3;$("Xannaplayauto_timevalue_"+this.redirect_game_id).innerHTML=3;$("wannaplayauto_timeunit_"+this.redirect_game_id).innerHTML="s";$("Xannaplayauto_timeunit_"+this.redirect_game_id).innerHTML="s";"automatic"==this.opponentMode&&setTimeout(e.hitch(this,function(){this.cancelMatchmakingForGame(this.redirect_game_id,"realtime")}),3e3)},getArenaTooltipHtml:function(t){var i='<div style="width: 600px; max-width:100%;">';i+="<h2>"+_("Your Arena rank for ${game_name}").replace("${game_name}",games_known[t].NAME)+"</h2>";i+="<p>"+_("Arena season ${season_no}").replace("${season_no}",$("current_arena_season").innerHTML)+"</p><br/>";var a=$("nbleagues_"+t).innerHTML,n=$("arenaraw_"+t).innerHTML,o=this.page.arenaPointsDetails(n,toint(a)),s=this.page.arenaPointsHtml(o),r=o;r.league_id=r.league;r.arena_points_html=s.bar_content;r.arena_bottom_infos=s.bottom_infos;r.league_name=o.league_name;r.arenabarpcent=s.bar_pcent;if(5==o.league){r.league_name='<div class="icon_elite_bar"></div>';var l=e.query("#Xannaplay_myarena_"+t+" .arena_label")[0].innerHTML;r.league_name+=" "+this.page.getRankString(l);r.arena_bottom_infos=_("World rank")+": "+this.page.getRankString(l)}i+=this.page.format_string(this.jstpl_arena_bar_tooltip,r);i+="<br/><br/><p>"+_("Click to see the full leaderboard")+"</p>";return i+="</div>"},setupGameWannaplayItem:function(t){e.connect($("button_play_"+t),"onclick",this,"onAddToFavAndStartNewGame");e.query("#wannaplay_"+t+" .game_box").connect("onclick",this,"onAddToFavAndStartNewGame");e.connect($("wannaplay_pref_"+t),"onclick",this,"onChangeGamePreferences");e.connect($("wannaplay_premium_banner_"+t),"onclick",this,function(t){e.style(t.currentTarget.id,"display","none")});"automatic"==this.opponentMode?this.page.addTooltip("button_play_"+t,"",_("Play this game now")):this.page.addTooltip("button_play_"+t,"",_("See available tables for this game or create a new table"));this.page.addTooltip("wannaplay_pref_"+t,"",_("Set your preferences for this game"));this.page.addTooltip("wannaplayauto_time_"+t,_("Estimated waiting time"),"");this.page.addTooltipHtml("wannaplay_myarena_"+t,this.getArenaTooltipHtml(t));this.page.addTooltip("add_favorite_"+t,"",_("Add this game to my favorites"));this.page.addTooltip("del_favorite_"+t,"",_("Remove this game from my favorites"));this.page.addTooltip("wannaplay_howtoplay_"+t,"",_("Learn how to play this game"));e.connect($("add_favorite_"+t),"onclick",this,"onAddFavorite");e.connect($("del_favorite_"+t),"onclick",this,"onDelFavorite");this.page.addTooltipHtml("wannaplayauto_loading_"+t,"<b>"+_("Loading bar")+"</b><hr/><p>"+_("This bar indicates the progress gathering enough players to start.")+" "+_("If the color of the loading bar is:")+'</p><p><div class="mm_pref_help mm_pref_color_priority_1">'+_("Search has just started")+"</div> : "+_('the system is trying to find matches using your "I\'m okay to play with" settings.')+'</p><p><div class="mm_pref_help mm_pref_color_priority_2">'+_("After some time")+"</div> : "+_('the system is now also trying your "I prefer not playing with" settings.')+'</p><p><div class="mm_pref_help mm_pref_color_priority_3">'+_("After even more time")+"</div> : "+_('the system is now trying all settings up to "I\'m reluctant to play with".')+"</p>");var i=_('${game_name} is a premium game, so you have to wait for a <a href="club" target="_blank">Premium member</a> who also wants to play this game. To play immediately, <a href="club" target="_blank">go Premium!</a> :)').replace("${game_name}",games_known[t].NAME).replace("club","premium").replace("club","premium");e.hasClass("ebd-body","premiummember")&&(i=_("${game_name} is a premium game: thanks to your Premium account, you do not have to wait to play :)").replace("${game_name}",games_known[t].NAME).replace("club","premium").replace("club","premium"));this.page.addTooltipHtmlToClass("premium_game_"+t,i);this.page.addTooltipHtml("wannaplay_myelo_"+t,this.getEloTooltip(t))},setupGameXannaplayItem:function(t){e.connect($("Xutton_play_"+t),"onclick",this,"onStartNewGame");e.query("#Xannaplay_"+t+" .game_box").connect("onclick",this,"onStartNewGame");e.connect($("Xannaplay_pref_"+t),"onclick",this,"onChangeGamePreferences");e.connect($("Xannaplay_premium_banner_"+t),"onclick",this,function(t){e.style(t.currentTarget.id,"display","none")});"automatic"==this.opponentMode?this.page.addTooltip("Xutton_play_"+t,"",_("Play this game now")):this.page.addTooltip("Xutton_play_"+t,"",_("See available tables for this game or create a new table"));this.page.addTooltip("Xannaplay_pref_"+t,"",_("Set your preferences for this game"));this.page.addTooltip("Xannaplayauto_time_"+t,_("Estimated waiting time"),"");this.page.addTooltipHtml("Xannaplay_myarena_"+t,this.getArenaTooltipHtml(t));this.page.addTooltip("Xdd_favorite_"+t,"",_("Add this game to my favorites"));this.page.addTooltip("Xel_favorite_"+t,"",_("Remove this game from my favorites"));this.page.addTooltip("Xannaplay_howtoplay_"+t,"",_("Learn how to play this game"));e.connect($("Xdd_favorite_"+t),"onclick",this,"onAddFavorite");e.connect($("Xel_favorite_"+t),"onclick",this,"onDelFavorite");this.page.addTooltipHtml("Xannaplayauto_loading_"+t,"<b>"+_("Loading bar")+"</b><hr/><p>"+_("This bar indicates the progress gathering enough players to start.")+" "+_("If the color of the loading bar is:")+'</p><p><div class="mm_pref_help mm_pref_color_priority_1">'+_("Search has just started")+"</div> : "+_('the system is trying to find matches using your "I\'m okay to play with" settings.')+'</p><p><div class="mm_pref_help mm_pref_color_priority_2">'+_("After some time")+"</div> : "+_('the system is now also trying your "I prefer not playing with" settings.')+'</p><p><div class="mm_pref_help mm_pref_color_priority_3">'+_("After even more time")+"</div> : "+_('the system is now trying all settings up to "I\'m reluctant to play with".')+"</p>");var i=_('${game_name} is a premium game, so you have to wait for a <a href="club" target="_blank">Premium member</a> who also wants to play this game. To play immediately, <a href="club" target="_blank">go Premium!</a> :)').replace("${game_name}",games_known[t].NAME).replace("club","premium").replace("club","premium");e.hasClass("ebd-body","premiummember")&&(i=_("${game_name} is a premium game: thanks to your Premium account, you do not have to wait to play :)").replace("${game_name}",games_known[t].NAME).replace("club","premium").replace("club","premium"));this.page.addTooltipHtmlToClass("premium_game_"+t,i);this.page.addTooltipHtml("Xannaplay_myelo_"+t,this.getEloTooltip(t))},getEloTooltip:function(e){var t=$("rankinginfos_"+e).innerHTML.split("/"),i=_("?"),a=t[0];i=""==t[3]?a<1400?_("Not ranked (ELO < 100)"):_("Not ranked (no recent ranked game)"):"X"==t[3]?_("Loading..."):t[3];var n={rank:t[0],played:t[2],rank_no:i,victory:t[1],player_id:current_player_id,game_id:e,game_name:games_known[e].NAME};n.elo_label=this.page.getEloLabel(n.rank);if(t[4]){n.elo_label=this.page.getEloLabel(a,!1,!1,!0);n.rank_no=_("Unavailable for this game")}return this.page.format_string(this.jstpl_elo_details,n)},displayGameInCategory:function(t,a,n){if(void 0===this.games_to_section[t]||a!=this.games_to_section[t]){this.makeSureWannaplayItemExists(t);"spotlight"===a&&$("spotlight_section").classList.remove("hidden");if("none"==e.style("Xannaplay_"+t,"display")){e.style("Xannaplay_"+t,"display","block");n||this.page.placeOnObject("Xannaplay_"+t,"wannaplay_"+t)}"other"!=a&&($("game_box_wrap_"+a+"_"+t)||e.place('<div id="game_box_wrap_'+a+"_"+t+'" class="game_box_wrap game_box_wrap_game_'+t+'"></div>',a+"_games_list"));var o=!1;if("other"!=a){if($("Xannaplay_"+t).parentNode.id!="game_box_wrap_"+a+"_"+t){this.page.attachToNewParent("Xannaplay_"+t,"game_box_wrap_"+a+"_"+t);o=!0}}else{this.page.attachToNewParent("Xannaplay_"+t,"xgame_invisible_stack");e.style("Xannaplay_"+t,"display","none")}if(void 0===this.games_to_section[t]);else{this.reorderGamesIn(this.games_to_section[t],"remove",t);delete this.games_to_section[t]}if("favorite"==a){if($("wannaplay_"+t)){e.removeClass("wannaplay_"+t,"no_favorite_game");e.addClass("wannaplay_"+t,"favorite_game")}e.removeClass("Xannaplay_"+t,"no_favorite_game");e.addClass("Xannaplay_"+t,"favorite_game")}else{if($("wannaplay_"+t)){e.removeClass("wannaplay_"+t,"favorite_game");e.addClass("wannaplay_"+t,"no_favorite_game")}e.removeClass("Xannaplay_"+t,"favorite_game");e.addClass("Xannaplay_"+t,"no_favorite_game")}"other"!=a&&(this.games_to_section[t]=a);if(n)o&&this.page.placeOnObject("Xannaplay_"+t,"game_box_wrap_"+a+"_"+t);else{var s=i.stores.games.getBoxImage(t).w180;if($(a+"_section")&&e.hasClass(a+"_section","tiny_verycompactlobby")){var r=$("gamenameraw_"+t).innerHTML;s=getMediaUrl(r,"icon")}var l=$("Xannaplay_img_"+t);l.setAttribute("bga_lazyload",s);l.setAttribute("src",s);"other"==a&&this.makeSureWannaplayItemExists(t);this.page.slideToObject("Xannaplay_"+t,"game_box_wrap_"+a+"_"+t).play()}this.setupGameXannaplayItem(t)}},onAddFavorite:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(13);this.doAddFavorite(i)},doAddFavorite:function(t,i,a){if(e.query("#favorite_section #Xannaplay_"+t).length>0)null!=i&&i();else{void 0===a&&(a=!1);var n=!1;if($("expandedgame_box_wrap_"+t)){this.collapseGame(t);n=!0}$("filter_name").value="";this.onUpdateFilters();this.page.ajaxcall("/lobby/lobby/wannaplay.html",{game:t,wanna:1},this,function(e){var o=$("gamenameraw_"+t).innerHTML;analyticsPush({game_name:o,cta_location:"lobby",event:"add_to_favorites"});this.displayGameInCategory(t,"favorite",a);this.adaptGamesSectionsToPlayerProfile();this.reorderGamesIn("favorite","current");n&&this.expandGame(t);"manual"==this.opponentMode&&this.manualLobbySubscribeToGame(t);null!=i&&i()})}},onDelFavorite:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(13);$("expandedgame_box_wrap_"+i)&&this.collapseGame(i);this.page.ajaxcall("/lobby/lobby/wannaplay.html",{game:i,wanna:0},this,function(t){var a=$("gamenameraw_"+i).innerHTML;analyticsPush({game_name:a,cta_location:"lobby",event:"remove_from_favorites"});if(e.hasClass("Xannaplay_"+i,"howtoplay"))this.displayGameInCategory(i,"other",!1);else{this.displayGameInCategory(i,"known",!1);this.reorderGamesIn("known","current")}this.adaptGamesSectionsToPlayerProfile();"manual"==this.opponentMode&&this.manualLobbyUnsubscribeToGame(i)})},onSortGamesBy:function(t){e.stopEvent(t);e.query(".sectiontitle_dropdown_menu_visible").removeClass("sectiontitle_dropdown_menu_visible");var i=t.currentTarget.id.split("_"),a=i[0],n=i[2];this.reorderGamesIn(a,n);localStorage.setItem(a+"_sort",n)},onChangeDisplaySize:function(t){e.stopEvent(t);e.query(".sectiontitle_dropdown_menu_visible").removeClass("sectiontitle_dropdown_menu_visible");var i=t.currentTarget.id.split("_"),a=i[0],n=i[2];"vvcompact"==n&&mainsite.tutorialShowOnce(16)?this.page.confirmationDialog(__("lang_mainsite","'Tiny icons' displays less information and options. You should use this mode only if you are an experienced player."),e.hitch(this,function(){this.changeDisplaySize(a,n)})):this.changeDisplaySize(a,n)},setBoxImage:function(t,a,n){var o=t.getAttribute("bga_game_id"),s=i.stores.games.getBoxImage(o),r=s.w180;"vcompact"==a?r=e.hasClass("ebd-body","mobile_version")?s.w180:s.w75:"vvcompact"==a&&(r=s.icon);t.setAttribute("bga_lazyload",r);n&&t.setAttribute("src",r)},changeDisplaySizeSpecific:function(t,i,a){e.query("#"+t+" .game_box.bga_lazyload").forEach(e=>{this.setBoxImage(e,i,a)})},changeDisplaySize:function(t,i){if("compact"==i){e.removeClass(t+"_section","verycompactlobby tiny_verycompactlobby");e.addClass(t+"_section","compactlobby")}else if("vcompact"==i){e.removeClass(t+"_section","tiny_verycompactlobby");e.addClass(t+"_section","compactlobby verycompactlobby")}else"vvcompact"==i?e.addClass(t+"_section","compactlobby verycompactlobby tiny_verycompactlobby"):e.removeClass(t+"_section","compactlobby verycompactlobby tiny_verycompactlobby");this.changeDisplaySizeSpecific(t+"_section",i,!0);e.query("#"+t+"_sort_menu .display_section .fa-check").forEach(e.destroy);e.query("#"+t+"_sort_menu .display_section .displaysize").removeClass("selected");e.query("#"+t+"_sort_menu .display_section .displaysize").addClass("notselected");e.addClass(t+"_display_"+i,"selected");e.removeClass(t+"_display_"+i,"notselected");e.place(' <i class="fa fa-check" aria-hidden="true"></i>',t+"_display_"+i);localStorage.setItem(t+"_displaysize",i);if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}},reorderGamesIn:function(t,i,a,n){void 0===n&&(n=!1);if("remove"==i){to_remove=a;i="current"}"current"==i?i=void 0!==this.current_game_sorting[t]?this.current_game_sorting[t]:"popularity":this.current_game_sorting[t]=i;e.query("#"+t+"_sort_menu .sortby_section .fa-check").forEach(e.destroy);e.query("#"+t+"_sort_menu .sortby_section .sortby").removeClass("selected");e.query("#"+t+"_sort_menu .sortby_section .sortby").addClass("notselected");if($(t+"_sortby_"+i)){e.addClass(t+"_sortby_"+i,"selected");e.removeClass(t+"_sortby_"+i,"notselected");e.place(' <i class="fa fa-check" aria-hidden="true"></i>',t+"_sortby_"+i)}this.doReorderIn(t,t+"_games_list",i,n);this.doReorderIn(t,t+"_expanded",i,"move")},doReorderIn:function(t,i,a,n){var o=!1,s=[],r={};e.query("#"+i+" .game_box_wrap").forEach(function(e){var t=e.id.split("_"),i=t[4];void 0===i&&(i=t[3]);r[i]=!0});if("name"==a)e.query("#"+i+" .gamenameinner .gamenamedisplayed").forEach(function(e){var t=e.parentNode.parentNode.parentNode.id.substr(10);s.push([t,e.innerHTML]);delete r[t]});else if("popularity"==a){e.query("#"+i+" .game_popularity").forEach(function(e){var t=e.parentNode.id.substr(10);s.push([t,-toint(e.innerHTML)]);delete r[t]});o=!0}else if("recent"==a){e.query("#"+i+" .game_lastplay").forEach(function(e){var t=e.parentNode.id.substr(10);s.push([t,-toint(e.innerHTML)]);delete r[t]});o=!0}else{console.error("Unknow criteria : "+a);e.query("#"+i+" .game_popularity").forEach(function(e){var t=e.parentNode.id.substr(10);s.push([t,-toint(e.innerHTML)]);delete r[t]});o=!0}0==n&&s.length>30&&(n=!0);for(var l in r)$("expandedgame_box_wrap_"+l)||e.destroy("game_box_wrap_"+t+"_"+l);o?s.sort(function(e,t){return e[1]-t[1]}):s.sort(function(e,t){return e[1].toLowerCase()<t[1].toLowerCase()?-1:e[1].toLowerCase()>t[1].toLowerCase()?1:0});var d=i;if("move"==n){var c=null;for(var u in s){var h="expandedgame_box_wrap_"+(l=s[u][0]);if(null==c){e.place($(h),i,"first");c=h}else e.place($(h),c,"after")}}else if(n)for(var u in s){l=s[u][0];var p="other"==t?"wannaplay_"+l:"Xannaplay_"+l;h="game_box_wrap_"+t+"_"+l;if(null!=l)e.place(h,d);else{this.page.attachToNewParent(p,d);e.destroy(h)}}else{for(var u in s){l=s[u][0],p="other"==t?"wannaplay_"+l:"Xannaplay_"+l,h="game_box_wrap_"+t+"_"+l;this.page.attachToNewParent(p,d)}for(var u in s){l=s[u][0],p="other"==t?"wannaplay_"+l:"Xannaplay_"+l,h="game_box_wrap_"+t+"_"+l;e.destroy(h)}for(var u in s){if(null!=(l=s[u][0])){p="other"==t?"wannaplay_"+l:"Xannaplay_"+l,h="game_box_wrap_"+t+"_"+l;e.place('<div id="game_box_wrap_'+t+"_"+l+'" class="game_box_wrap game_box_wrap_game_'+l+'"></div>',t+"_games_list");this.page.attachToNewParent(p,h);this.page.slideToObject(p,h).play();"other"==t?this.setupGameWannaplayItem(l):this.setupGameXannaplayItem(l);this.updateTablesNumberAvailable(l)}}}"known"==t&&e.place('<div class="clear"></div>',i);if(this.lazyload)if(n){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}else setTimeout(e.hitch(this,function(){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}),500)},onGameModeChangeMobileSwitcher:function(t){e.stopEvent(t);if(e.hasClass("pageheader_mobile_switcher_wrap","dropdown_expanded"))"none"!=e.style("pageheader_mobile_switcher","display")&&e.removeClass("pageheader_mobile_switcher_wrap","dropdown_expanded");else{e.query(".dropdown_expanded").removeClass("dropdown_expanded");e.addClass("pageheader_mobile_switcher_wrap","dropdown_expanded")}},onGameModeChangeMobileSwitcherGamemode:function(t){e.stopEvent(t);if(e.hasClass("pageheader_mobile_switcher_wrap_gamemode","dropdown_expanded"))"none"!=e.style("pageheader_mobile_switcher","display")&&e.removeClass("pageheader_mobile_switcher_wrap_gamemode","dropdown_expanded");else{e.query(".dropdown_expanded").removeClass("dropdown_expanded");e.addClass("pageheader_mobile_switcher_wrap_gamemode","dropdown_expanded")}},onGameModeChangeMobileSwitcherLobbymode:function(t){e.stopEvent(t);if(e.hasClass("pageheader_mobile_switcher_wrap_lobbymode","dropdown_expanded"))"none"!=e.style("pageheader_mobile_switcher","display")&&e.removeClass("pageheader_mobile_switcher_wrap_lobbymode","dropdown_expanded");else{e.query(".dropdown_expanded").removeClass("dropdown_expanded");e.addClass("pageheader_mobile_switcher_wrap_lobbymode","dropdown_expanded")}},onGameModeChange:function(t){if(0!=this.checkRealtimeMatchmakingUnload()){"normal"==this.mode?"pageheader_async"==t.currentTarget.id?this.switchGameMode("async"):this.switchGameMode("realtime"):"inprogress"==this.mode&&("pageheader_async"==t.currentTarget.id?gotourl("lobby?mode=async"):gotourl("lobby?mode=realtime"));analyticsPush({game_mode:"pageheader_async"==t.currentTarget.id?"async":"realtime",event:"play_second_step"});e.query(".dropdown_expanded").removeClass("dropdown_expanded")}else e.query(".dropdown_expanded").removeClass("dropdown_expanded")},switchGameMode:function(t){if("async"==t){this.clockmode="async";e.query(".wannaplay_waiting_realtime").forEach(e.hitch(this,function(t){var i=t.id.substr(10);if(null!=$("button_play_"+i)){e.removeClass("wannaplay_"+i,"wannaplay_waiting");e.removeClass("Xannaplay_"+i,"wannaplay_waiting");e.removeClass("button_play_"+i,"bgabutton_red");e.removeClass("Xutton_play_"+i,"bgabutton_red");e.addClass("button_play_"+i,"bgabutton_blue");e.addClass("Xutton_play_"+i,"bgabutton_blue");$("button_play_"+i).innerHTML=_("Play now!");$("Xutton_play_"+i).innerHTML=_("Play now!");e.query("#wannaplay_"+i+" > .wannaplayauto_time").style("display","none");e.query("#Xannaplay_"+i+" > .wannaplayauto_time").style("display","none");e.query("#wannaplay_"+i+" > .wannaplayauto_loading").style("display","none");e.query("#Xannaplay_"+i+" > .wannaplayauto_loading").style("display","none")}}));e.query(".wannaplay_waiting_async").forEach(e.hitch(this,function(t){var i=t.id.substr(10);if(null!=$("button_play_"+i)){e.addClass("wannaplay_"+i,"wannaplay_waiting");e.addClass("Xannaplay_"+i,"wannaplay_waiting");e.removeClass("button_play_"+i,"bgabutton_blue");e.removeClass("Xutton_play_"+i,"bgabutton_blue");e.addClass("button_play_"+i,"bgabutton_red");e.addClass("Xutton_play_"+i,"bgabutton_red");$("button_play_"+i).innerHTML=_("Cancel");$("Xutton_play_"+i).innerHTML=_("Cancel");e.query("#wannaplay_"+i+" > .quick_howtoplay").style("display","none");e.query("#Xannaplay_"+i+" > .quick_howtoplay").style("display","none");var a=$("wait_time_async_"+i).innerHTML;e.query("#wannaplay_"+i+" > .wannaplayauto_time").style("display","block");e.query("#Xannaplay_"+i+" > .wannaplayauto_time").style("display","block");$("wannaplayauto_timevalue_"+i).innerHTML=this.getEstimatedTimeValue(a);$("Xannaplayauto_timevalue_"+i).innerHTML=this.getEstimatedTimeValue(a);$("wannaplayauto_timeunit_"+i).innerHTML=this.getEstimatedTimeUnit(a);$("Xannaplayauto_timeunit_"+i).innerHTML=this.getEstimatedTimeUnit(a);e.query("#wannaplay_"+i+" > .wannaplayauto_loading").style("display","block");e.query("#Xannaplay_"+i+" > .wannaplayauto_loading").style("display","block");e.style("wannaplayauto_loadingbar_"+i,"width",$("progress_async_"+i).innerHTML+"%");e.style("Xannaplayauto_loadingbar_"+i,"width",$("progress_async_"+i).innerHTML+"%");var n=toint($("remaining_async_"+i).innerHTML);e.query(".game_box_wrap_game_"+i+" .wannaplayauto_loadingbartxt").forEach(function(t){t.innerHTML=null===n?_("Searching for opponents..."):e.string.substitute(n<=1?_("Searching for ${opponent_nbr} opponent..."):_("Searching for ${opponent_nbr} opponents..."),{opponent_nbr:n})});this.updateLobbyTitle();e.removeClass("wannaplayauto_loadingbar_"+i,["wannaplayauto_loadingbar_tp1","wannaplayauto_loadingbar_tp2","wannaplayauto_loadingbar_tp3"]);e.removeClass("Xannaplayauto_loadingbar_"+i,["wannaplayauto_loadingbar_tp1","wannaplayauto_loadingbar_tp2","wannaplayauto_loadingbar_tp3"]);e.addClass("wannaplayauto_loadingbar_"+i,"wannaplayauto_loadingbar_tp"+$("timeprofile_async_"+i).innerHTML);e.addClass("Xannaplayauto_loadingbar_"+i,"wannaplayauto_loadingbar_tp"+$("timeprofile_async_"+i).innerHTML)}}))}else{this.clockmode="realtime";e.query(".wannaplay_waiting_async").forEach(e.hitch(this,function(t){var i=t.id.substr(10);if(null!=$("button_play_"+i)){e.removeClass("wannaplay_"+i,"wannaplay_waiting");e.removeClass("Xannaplay_"+i,"wannaplay_waiting");e.removeClass("button_play_"+i,"bgabutton_red");e.removeClass("Xutton_play_"+i,"bgabutton_red");e.addClass("button_play_"+i,"bgabutton_blue");e.addClass("Xutton_play_"+i,"bgabutton_blue");$("button_play_"+i).innerHTML=_("Play now!");$("Xutton_play_"+i).innerHTML=_("Play now!");e.query("#wannaplay_"+i+" > .wannaplayauto_time").style("display","none");e.query("#Xannaplay_"+i+" > .wannaplayauto_time").style("display","none");e.query("#wannaplay_"+i+" > .wannaplayauto_loading").style("display","none");e.query("#Xannaplay_"+i+" > .wannaplayauto_loading").style("display","none")}}));e.query(".wannaplay_waiting_realtime").forEach(e.hitch(this,function(t){var i=t.id.substr(10);if(null!=$("button_play_"+i)){e.addClass("wannaplay_"+i,"wannaplay_waiting");e.addClass("Xannaplay_"+i,"wannaplay_waiting");e.removeClass("button_play_"+i,"bgabutton_blue");e.removeClass("Xutton_play_"+i,"bgabutton_blue");e.addClass("button_play_"+i,"bgabutton_red");e.addClass("Xutton_play_"+i,"bgabutton_red");$("button_play_"+i).innerHTML=_("Cancel");$("Xutton_play_"+i).innerHTML=_("Cancel");e.query("#wannaplay_"+i+" > .quick_howtoplay").style("display","none");e.query("#Xannaplay_"+i+" > .quick_howtoplay").style("display","none");var a=$("wait_time_realtime_"+i).innerHTML;e.query("#wannaplay_"+i+" > .wannaplayauto_time").style("display","block");e.query("#Xannaplay_"+i+" > .wannaplayauto_time").style("display","block");$("wannaplayauto_timevalue_"+i).innerHTML=this.getEstimatedTimeValue(a);$("Xannaplayauto_timevalue_"+i).innerHTML=this.getEstimatedTimeValue(a);$("wannaplayauto_timeunit_"+i).innerHTML=this.getEstimatedTimeUnit(a);$("Xannaplayauto_timeunit_"+i).innerHTML=this.getEstimatedTimeUnit(a);e.query("#wannaplay_"+i+" > .wannaplayauto_loading").style("display","block");e.query("#Xannaplay_"+i+" > .wannaplayauto_loading").style("display","block");e.style("wannaplayauto_loadingbar_"+i,"width",$("progress_realtime_"+i).innerHTML+"%");e.style("Xannaplayauto_loadingbar_"+i,"width",$("progress_realtime_"+i).innerHTML+"%");var n=toint($("remaining_realtime_"+i).innerHTML);e.query(".game_box_wrap_game_"+i+" .wannaplayauto_loadingbartxt").forEach(function(t){t.innerHTML=null===n?_("Searching for opponents..."):e.string.substitute(n<=1?_("Searching for ${opponent_nbr} opponent..."):_("Searching for ${opponent_nbr} opponents..."),{opponent_nbr:n})});this.updateLobbyTitle();e.removeClass("wannaplayauto_loadingbar_"+i,["wannaplayauto_loadingbar_tp1","wannaplayauto_loadingbar_tp2","wannaplayauto_loadingbar_tp3"]);e.removeClass("Xannaplayauto_loadingbar_"+i,["wannaplayauto_loadingbar_tp1","wannaplayauto_loadingbar_tp2","wannaplayauto_loadingbar_tp3"]);e.addClass("wannaplayauto_loadingbar_"+i,"wannaplayauto_loadingbar_tp"+$("timeprofile_realtime_"+i).innerHTML);e.addClass("Xannaplayauto_loadingbar_"+i,"wannaplayauto_loadingbar_tp"+$("timeprofile_realtime_"+i).innerHTML)}}))}this.updateGameMode();this.updateLobbyTitle();this.saveLobbyMode()},reloadAllNumberOfAvailableTables:function(){var t={status:this.clockmode+"_open",accessinfosonly:!0};this.page.ajaxcall("/tablemanager/tablemanager/tableinfos.html",t,this,function(t){this.game_to_table_to_access={};e.query(".wannaplayauto_button.bgabutton_blue").forEach(e.hitch(this,function(t){e.place("<span>"+_("Play now!")+"</span>",t,"only");this.page.addTooltip(t.id,"",_("See available tables for this game or create a new table"))}));this.bReloadAllInProgress=!0;for(var i in t.tables){var a=t.tables[i];this.updateAccessPossibilityForTable(a)}this.bReloadAllInProgress=!1})},onExpandCollapseAll:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_"),a=i[0],n=i[1];e.query(".sectiontitle_dropdown_menu_visible").removeClass("sectiontitle_dropdown_menu_visible");"expandall"==n?this.doExpandAll(a):this.doCollapseAll(a)},onSeeCannotJoinFavorite:function(t){e.stopEvent(t);e.style(t.currentTarget,"display","none");e.style("favorite_table_gamelist_cantjoin","display","block")},onSeeCannotJoinOther:function(t){e.stopEvent(t);e.style(t.currentTarget,"display","none");e.style("other_table_gamelist_cantjoin","display","block")},onHideAllTables:function(t){e.stopEvent(t);this.doHideAllTablesList()},onSeeAllTables:function(t){e.stopEvent(t);"favorite_see_all_tables"==t.currentTarget.id?category="favorite":category="other";if("none"==e.style(category+"_table_list","display")){this.doDisplayAllTables(category);var i=e.position(category+"_table_list");window.scrollBy({top:i.y-50,behavior:"smooth"})}else this.doHideAllTablesList()},doDisplayAllTables:function(t){if("none"==e.style(t+"_table_list","display")){this.doCollapseAll(t);e.style(t+"_table_list","display","block");var i={status:this.clockmode+"_open"},a=[];if("favorite"==t){e.query("#"+t+"_section .wannaplay_item").forEach(e.hitch(this,function(e){var t=e.id.split("_")[1];a.push(t)}));i.games=a.join(";")}this.page.ajaxcall("/tablemanager/tablemanager/tableinfos.html",i,this,function(e){this.reloadGameTables(a,e.tables,e.tableorder,t+"_table_gamelist");for(var i in a){var n=a[i];this.game_to_target[n]=t+"_table_gamelist";this.updateTablesNumberAvailable(n)}if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}});this.updateExpandedGameListInStorage();"favorite"==t?$("favorite_see_all_tables_label").innerHTML=_("Hide available tables list"):e.style("see_all_tables","display","none")}},doHideAllTablesList:function(){var t="favorite";if("block"==e.style(t+"_table_list","display")){e.style(t+"_table_list","display","none");e.empty(t+"_table_gamelist");e.empty(t+"_table_gamelist_cantjoin");e.empty(t+"_table_gamelist_newtable");e.style(t+"_display_cantjoin","display","inline");e.style(t+"_table_gamelist_cantjoin","display","none");$(t+"_see_all_tables_label").innerHTML=_("See all available tables")}t="other";if("block"==e.style(t+"_table_list","display")){e.style(t+"_table_list","display","none");e.empty(t+"_table_gamelist");e.empty(t+"_table_gamelist_cantjoin");e.empty(t+"_table_gamelist_newtable");e.style(t+"_display_cantjoin","display","inline");e.style(t+"_table_gamelist_cantjoin","display","none")}this.game_to_target={};this.updateExpandedGameListInStorage();if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}},doCollapseAll:function(t){e.query("#"+t+"_section .expandedgame_box_wrap").forEach(e.hitch(this,function(e){var t=e.id.substr(22);this.collapseGame(t)}))},doExpandAll:function(t){var i=[];e.query("#"+t+"_games_list .game_box_wrap").forEach(e.hitch(this,function(e){var t=e.id.split("_")[4];i.push(t)}));this.expandGame(i)},updateOpponentMode:function(t){e.query("#pageheader_lobbymenunav_lobbymode .pageheader_menuitem").removeClass("pageheader_menuitemselected");if("manual"==this.opponentMode){e.removeClass("gamelobby-module","opponentmode_manual opponentmode_automatic opponentmode_choice opponentmode_friends");e.addClass("gamelobby-module","opponentmode_manual");e.addClass("pageheader_manual","pageheader_menuitemselected");this.manualLobbySubscribeToAllFavorites();this.reloadAllNumberOfAvailableTables();var i=localStorage.getItem("explobby");if(i){var a=JSON.parse(i);if(void 0!==a.all_favorite){this.doDisplayAllTables("favorite");delete a.all_favorite}else(a=Object.keys(a)).length>0&&this.expandGame(a,!1)}t||this.cancelGameSession()}else if("automatic"==this.opponentMode){e.query(".expandedgame_box_wrap").forEach(e.hitch(this,function(e){var t=e.id.substr(22);this.collapseGame(t,!0)}));this.doHideAllTablesList();e.query(".tables_available").removeClass("tables_available");e.removeClass("gamelobby-module","opponentmode_manual opponentmode_automatic  opponentmode_choice opponentmode_friends");e.addClass("gamelobby-module","opponentmode_automatic");e.addClass("pageheader_automatic","pageheader_menuitemselected");e.query(".wannaplayauto_button.bgabutton_blue").forEach(e.hitch(this,function(t){e.place("<span>"+_("Play now!")+"</span>",t,"only");this.page.addTooltip(t.id,"",_("Play this game now"))}));this.manualLobbyUnsubscribeAllGames();this.game_to_table_to_access={};t||this.cancelGameSession()}else if("friends"==this.opponentMode){e.query(".expandedgame_box_wrap").forEach(e.hitch(this,function(e){var t=e.id.substr(22);this.collapseGame(t,!0)}));this.doHideAllTablesList();e.query(".tables_available").removeClass("tables_available");e.removeClass("gamelobby-module","opponentmode_manual opponentmode_automatic  opponentmode_choice opponentmode_friends");e.addClass("gamelobby-module","opponentmode_friends");e.addClass("pageheader_friends","pageheader_menuitemselected");e.query(".wannaplayauto_button.bgabutton_blue").forEach(e.hitch(this,function(t){e.place("<span>"+_("Play now!")+"</span>",t,"only");this.page.addTooltip(t.id,"",_("Play this game now"))}));this.manualLobbyUnsubscribeAllGames();this.showPlayWithFriendsPanel()}else if("choice"==this.opponentMode){e.removeClass("gamelobby-module","opponentmode_manual opponentmode_automatic  opponentmode_choice");e.addClass("gamelobby-module","opponentmode_choice")}if(e.query("#pageheader_"+this.opponentMode+" .firstline")[0]){$("mobile_switcher_firstline_lobbymode").innerHTML=e.query("#pageheader_"+this.opponentMode+" .firstline")[0].innerHTML;$("mobile_switcher_secondline_lobbymode").innerHTML=e.query("#pageheader_"+this.opponentMode+" .secondshortline")[0].innerHTML;e.place(e.query("#pageheader_"+this.opponentMode+" .pageheader_big_switch_icon")[0].innerHTML,"mobile_switcher_icon_lobbymode","only")}else{$("mobile_switcher_firstline_lobbymode").innerHTML=_("Play with?");$("mobile_switcher_secondline_lobbymode").innerHTML="&nbsp;";e.place('<i class="fa fa-arrow-down fa-3x"></i>',"mobile_switcher_icon_lobbymode","only")}this.updateMMButtonsWithMMInProgress();this.adaptGamesSectionsToPlayerProfile();this.showNeededTutorialItems();if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}},manualLobbySubscribeToAllFavorites:function(){var t=[];e.query("#favorite_games_list .game_box_wrap").forEach(e.hitch(this,function(e){var i=e.id.split("_").pop();t.push(i)}));for(var i in t){var a=t[i];this.manualLobbySubscribeToGame(a)}},manualLobbySubscribeToGame:function(e){if(void 0===this.tablemanagerGlobalSub[e]){if("realtime"==this.clockmode)var t="/tablemanager/global/";else t="/tablemanager/globalasync/";this.tablemanagerGlobalSub[e]=this.page.register_centrifuge_subs(mainsite.subscribeCentrifugeChannel(t+e,this.notifqueue,"onNotification"))}},manualLobbyUnsubscribeToGame:function(e){if(void 0!==this.tablemanagerGlobalSub[e]){g_sitecore.unsubscribeCentrifugeChannel(this.tablemanagerGlobalSub[e]);delete this.tablemanagerGlobalSub[e]}},manualLobbyUnsubscribeAllGames:function(){for(var e in this.tablemanagerGlobalSub)g_sitecore.unsubscribeCentrifugeChannel(this.tablemanagerGlobalSub[e]);this.tablemanagerGlobalSub={}},updateAccessPossibilityForTable:function(e){var t=e.id,i=e.game_id;void 0===this.game_to_table_to_access[i]&&(this.game_to_table_to_access[i]={});var a=null;void 0!==this.game_to_table_to_access[i][t]&&(a=this.game_to_table_to_access[i][t]);var n=this.canIJoinTable(e);if(""==n)var o=!0;else if(n==_("This table is not open for joining"))o="delete";else o=!1;if(o!==a){"delete"==o?void 0!==this.game_to_table_to_access[i][t]&&delete this.game_to_table_to_access[i][t]:this.game_to_table_to_access[i][t]=o;this.updateTablesNumberAvailable(i)}},updateSwitchToArenaVisibility:function(t){if("automatic"!=this.opponentMode&&null!==$("switch_to_arena_wrap_"+t)){e.query(".arena_table_"+t+" .gametable_content").length>0?e.addClass("switch_to_arena_wrap_"+t,"arena_available"):e.removeClass("switch_to_arena_wrap_"+t,"arena_available");this.updateSwitchToArenaTitleVisibility()}},updateSwitchToArenaTitleVisibility:function(){$("favorite_table_gamelist_switchtoarena_title")&&(e.query(".arena_available").length>0?$("favorite_table_gamelist_switchtoarena_title").innerHTML=_("Some players are available for Arena mode"):$("favorite_table_gamelist_switchtoarena_title").innerHTML="")},updateTablesNumberAvailable:function(t,i){if("automatic"!=this.opponentMode){void 0===i&&(i=!1);if(null!==$("Xutton_play_"+t)){var a=0,n=0;for(var o in this.game_to_table_to_access[t])this.game_to_table_to_access[t][o]?a++:n++;$("display_cannot_join_"+t)&&(n>0?e.style("display_cannot_join_"+t,"display","block"):e.style("display_cannot_join_"+t,"display","none"));var s=0;void 0!==this.game_to_table_nbr[t]&&(s=this.game_to_table_nbr[t]);this.game_to_table_nbr[t]=a;if(!e.hasClass("Xutton_play_"+t,"bgabutton_darkgray")){if(a>1){e.place("<span>"+a+' <div class="icon20 icon20_manual"></div><span class="avail_label">'+e.string.substitute(_("${several_tables} available"),{several_tables:"&nbsp;"})+"</span></span>","Xutton_play_"+t,"only");$("button_play_"+t)&&e.place("<span>"+a+' <div class="icon20 icon20_manual"></div><span class="avail_label">'+e.string.substitute(_("${several_tables} available"),{several_tables:"&nbsp;"})+"</span></span>","button_play_"+t,"only")}else if(1==a){e.place("<span>"+a+' <div class="icon20 icon20_manual"></div> <span class="avail_label">'+e.string.substitute(_("${one_table} available"),{one_table:"&nbsp;"})+"</span></span>","Xutton_play_"+t,"only");$("button_play_"+t)&&e.place("<span>"+a+' <div class="icon20 icon20_manual"></div> <span class="avail_label">'+e.string.substitute(_("${one_table} available"),{one_table:"&nbsp;"})+"</span></span>","button_play_"+t,"only")}else{e.place("<span>"+_("Play now!")+"</span>","Xutton_play_"+t,"only");$("button_play_"+t)&&e.place("<span>"+_("Play now!")+"</span>","button_play_"+t,"only")}a>=1?e.query(".game_box_wrap_game_"+t).addClass("tables_available"):e.query(".game_box_wrap_game_"+t).removeClass("tables_available");if((void 0===this.bReloadAllInProgress||0==this.bReloadAllInProgress)&&0==i&&a>s){e.addClass("Xutton_play_"+t,"faa-vertical animated");$("button_play_"+t)&&e.addClass("button_play_"+t,"faa-vertical animated");setTimeout(function(){$("Xutton_play_"+t)&&e.removeClass("Xutton_play_"+t,"faa-vertical animated");$("button_play_"+t)&&e.removeClass("button_play_"+t,"faa-vertical animated")},1e3)}}}}},updateRankingMode:function(t){e.query("#pageheader_lobbymenunav_gamemode .pageheader_menuitem").removeClass("pageheader_menuitemselected");if("simple"==this.rankingMode){e.removeClass("gamelobby-module","rankingmode_simple rankingmode_arena rankingmode_choice");e.addClass("gamelobby-module","rankingmode_simple");e.addClass("pageheader_simple","pageheader_menuitemselected")}else if("arena"==this.rankingMode){e.removeClass("gamelobby-module","rankingmode_simple rankingmode_arena rankingmode_choice");e.addClass("gamelobby-module","rankingmode_arena");e.addClass("pageheader_arena","pageheader_menuitemselected");t||this.cancelGameSession();this.hidePlayWithFriendsPanel();this.opponentMode="automatic";this.updateOpponentMode()}else if("choice"==this.rankingMode){e.removeClass("gamelobby-module","rankingmode_simple rankingmode_arena rankingmode_choice");e.addClass("gamelobby-module","rankingmode_choice")}if(e.query("#pageheader_"+this.rankingMode+" .firstline")[0]){$("mobile_switcher_firstline_gamemode").innerHTML=e.query("#pageheader_"+this.rankingMode+" .firstline")[0].innerHTML;$("mobile_switcher_secondline_gamemode").innerHTML=e.query("#pageheader_"+this.rankingMode+" .secondshortline")[0].innerHTML;e.place(e.query("#pageheader_"+this.rankingMode+" .pageheader_big_switch_icon")[0].innerHTML,"mobile_switcher_icon_gamemode","only")}else{$("mobile_switcher_firstline_gamemode").innerHTML=_("Select a game mode");$("mobile_switcher_secondline_gamemode").innerHTML="&nbsp;";e.place('<i class="fa fa-arrow-down fa-3x"></i>',"mobile_switcher_icon_gamemode","only")}},onRankingModeChange:function(e){var t=e.currentTarget.id.split("_")[1];this.switchRankingMode(t);analyticsPush({game_mode:t,event:"play_first_step"})},switchRankingMode:function(t){this.rankingMode;if(0==this.checkRealtimeMatchmakingUnload()){e.query(".dropdown_expanded").removeClass("dropdown_expanded");return!1}if("simple"==t&&"simple"!=this.rankingMode){this.rankingMode="simple";this.updateRankingMode()}else if("arena"==t&&"arena"!=this.rankingMode){if(0==e.query(".arena_avail").length){this.page.showMessage(_("Sorry, you need to reach 100 ELO for a game to unlock Arena mode."),"error");return!1}this.rankingMode="arena";this.updateRankingMode()}else if("tournament"==t&&"tournament"!=this.rankingMode){if(0==e.query(".arena_avail").length){this.page.showMessage(_("Sorry, you need to reach 100 ELO for a game to unlock Tournaments."),"error");return!1}gotourl("tournamentlist");return}this.saveLobbyMode();e.query(".dropdown_expanded").removeClass("dropdown_expanded");"arena"==t&&""==$("season-progress-histogram").innerHTML&&this.loadArenaProgress();return!0},loadArenaProgress:function(){var t=toint($("season_start_ts").innerHTML),i=toint($("season_end_ts").innerHTML),a=toint($("season_daysleft").innerHTML),n=Math.min((Date.now()/1e3-t)/(i-t),1);e.query(".season-progress-bar").style("width",100*n+"%");$("season-progress-text").innerHTML=a+" "+_("DAYS TO GO");if(1==n){e.removeClass("season-progress-bar","season-progress-bar-clip-path");e.query(".season-progress-bubble-wrap").style("display","none")}else{e.hasClass("season-progress-bar","season-progress-bar-clip-path")||e.addClass("season-progress-bar","season-progress-bar-clip-path");e.query(".season-progress-bubble-wrap").style("left",90*n+"%");e.query(".season-progress-bubble-wrap").style("display","initial");e.query(".season-progress-bubble-wrap").style("visibility","visible")}n<.1?e.query("#season-progress-bubble").addClass("season-progress-bubble-pointer-left"):n>.9?e.query("#season-progress-bubble").addClass("season-progress-bubble-pointer-right"):e.query("#season-progress-bubble").addClass("season-progress-bubble");$("season-progress-text").innerHTML=a>0?a+" "+_("DAYS TO GO"):_("LAST DAY!");this.page.ajaxcall("/halloffame/halloffame/getDailyTables.html",{},this,function(e){e.shift();var t=100/e.length+"%",i=Math.max.apply(Math,e),a=$("season-progress-histogram");a.innerHTML="";for(var n=0;n<e.length;n++){var o=e[n],s=100*n/e.length+"%",r="<div class='season-progress-histogram-bar' style='left:"+s+";height:"+(100*o/Math.max(i,1)+"%")+";width:"+t+"'></div>";a.innerHTML+=r;if(n>0){var l="<div class='histogram-bar-separator' style='left:"+s+"'></div>";a.innerHTML+=l}}})},onOpponentModeChange:function(t){if(0!=this.checkRealtimeMatchmakingUnload()){if("pageheader_manual"==t.currentTarget.id&&"manual"!=this.opponentMode){this.opponentMode="manual";this.updateOpponentMode()}else if("pageheader_automatic"==t.currentTarget.id&&"automatic"!=this.opponentMode){this.opponentMode="automatic";this.updateOpponentMode()}else if("pageheader_friends"==t.currentTarget.id&&"friends"!=this.opponentMode){this.opponentMode="friends";this.updateOpponentMode()}this.saveLobbyMode();e.query(".dropdown_expanded").removeClass("dropdown_expanded");analyticsPush({game_participant:this.opponentMode,event:"play_third_step"})}else e.query(".dropdown_expanded").removeClass("dropdown_expanded")},saveLobbyMode:function(){var e=this.clockmode;this.page.ajaxcall("/player/profile/setGameMode.html",{async:"async"==e?1:0,realtime:"realtime"==e?1:0,simple:"automatic"==this.opponentMode,friends:"friends"==this.opponentMode,arena:"simple"!=this.rankingMode},this,function(e){if("arena"!=this.rankingMode&&"automatic"==this.opponentMode&&"m"==e[2]){this.opponentMode="manual";this.updateOpponentMode()}if("arena"!=this.rankingMode&&"automatic"==this.opponentMode&&"f"==e[2]){this.opponentMode="friends";this.updateOpponentMode()}})},updateGameMode:function(t){var i=this.clockmode;e.removeClass("gamelobby_inner","mask_async mask_realtime");e.removeClass("gamelobby-module","gamemode_async gamemode_realtime gamemode_choice");if("inprogress"!=this.mode){e.query("#pageheader_lobbymenunav .pageheader_menuitemselected").removeClass("pageheader_menuitemselected");"realtime"==i&&(i="realtime");"async"==i&&(i="async");$("pageheader_lobbymenunav_wrap").scrollLeft=440}if("realtime"==i){e.addClass("gamelobby_inner","mask_async");e.addClass("gamelobby-module","gamemode_realtime");"inprogress"!=this.mode&&e.addClass("pageheader_realtime","pageheader_menuitemselected");$("pageheader_lobbymenunav_wrap").scrollLeft=0}if("async"==i){e.addClass("gamelobby_inner","mask_realtime");e.addClass("gamelobby-module","gamemode_async");"inprogress"!=this.mode&&e.addClass("pageheader_async","pageheader_menuitemselected");$("pageheader_lobbymenunav_wrap").scrollLeft=220}"choice"==i&&e.addClass("gamelobby-module","gamemode_choice");if("realtime"==i){$("mobile_switcher_firstline").innerHTML=e.query("#pageheader_realtime .firstline")[0].innerHTML;$("mobile_switcher_secondline").innerHTML=e.query("#pageheader_realtime .secondshortline")[0].innerHTML;e.removeClass("mobile_switcher_icon","icon32_turnbased");e.addClass("mobile_switcher_icon","icon32_realtime");e.removeClass("pageheader_mobile_switcher","gametable_status_asyncopen");e.style("mobile_switcher_icon","display","block");e.query("#pageheader_mobile_switcher .pageheader_big_switch_icon").addClass("gametable_colored_indicator");e.query("#pageheader_mobile_switcher .fa-arrow-down").forEach(e.destroy)}else if("async"==i){$("mobile_switcher_firstline").innerHTML=e.query("#pageheader_async .firstline")[0].innerHTML;$("mobile_switcher_secondline").innerHTML=e.query("#pageheader_async .secondshortline")[0].innerHTML;e.removeClass("mobile_switcher_icon","icon32_realtime");e.addClass("mobile_switcher_icon","icon32_turnbased");e.addClass("pageheader_mobile_switcher","gametable_status_asyncopen");e.style("mobile_switcher_icon","display","block");e.query("#pageheader_mobile_switcher .pageheader_big_switch_icon").addClass("gametable_colored_indicator");e.query("#pageheader_mobile_switcher .fa-arrow-down").forEach(e.destroy)}else if("choice"==i){$("mobile_switcher_firstline").innerHTML=_("Select a speed");$("mobile_switcher_secondline").innerHTML="&nbsp;";e.style("mobile_switcher_icon","display","none");e.query("#pageheader_mobile_switcher .pageheader_big_switch_icon").removeClass("gametable_colored_indicator");e.place('<i class="fa fa-arrow-down fa-3x"></i>',"mobile_switcher_icon","after")}if((void 0===t||0==t)&&"manual"==this.opponentMode){this.manualLobbyUnsubscribeAllGames();this.manualLobbySubscribeToAllFavorites();e.query(".tables_available").removeClass("tables_available");this.reloadAllNumberOfAvailableTables();this.doHideAllTablesList();e.query(".expandedgame_box_wrap").forEach(e.hitch(this,function(e){var t=e.id.substr(22);this.collapseGame(t);this.expandGame(t,!1)}))}this.hideAcceptAllRankingModeIfNeeded();this.showNeededTutorialItems();if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}},onGoToGame:function(e){var t=dijit.byId("gamelist_gameselect").get("value").substr(11);gotourl("gametables?game="+t)},adaptGamesSectionsToPlayerProfile:function(){var t=e.query("#favorite_section .wannaplayauto_item").length,i=e.query("#known_section .wannaplayauto_item").length;if(0==t){e.style("favorite_section","display","none");$("known_games_title_label").innerHTML=_("Your games")}else{e.style("favorite_section","display","block");$("known_games_title_label").innerHTML=_("Other games you know")}0==i?e.style("known_section","display","none"):e.style("known_section","display","block");e.addClass("gamelobbyauto","enable_favorites");e.style("favorite_sort_menu","display",t<=2?"none":"block");e.style("known_sort_menu","display",i<=2?"none":"block");e.style("favorite_see_all_tables","display","manual"==this.opponentMode&&t>2?"block":"none");e.style("play_any_favorite_enough_favorites","display",t<=2?"none":"inline")},inviteFriendsInit:function(){e.connect($("lobby_add_friend_button"),"onclick",this,"onAddFriend");e.connect($("friend_nearby_button"),"onclick",this,"onAddHotseatFriend");e.connect($("friend_on_another_screen_button"),"onclick",this,"onAddFriendPlayingOnAnotherScreen");e.connect($("validate_hotseat_player_name"),"onclick",this,"onValidateHotseatPlayerName");e.connect($("lobby_invite_more_friend_button"),"onclick",this,"onInviteMoreFriends");e.connect($("filter_friends"),"onclick",this,function(t){e.stopEvent(t)});e.connect($("filter_friends"),"onkeyup",this,"onFilterFriends");e.connect($("lobby_friend_section_cancel_button"),"onclick",this,"onFriendSectionCancel");e.connect($("friend_is_registered_button"),"onclick",this,"displayFriendSearch");e.connect($("search_all_players_button"),"onclick",this,"displayFriendSearch");e.connect($("friend_not_registered_button"),"onclick",this,"displayInvitationLink");e.connect($("lobby_friend_player_name_unknown_button"),"onclick",this,"displayInvitationLink");e.connect($("copy_trigger"),"onclick",this,"onCopyContent");this.expectedFriends=[];this.updateGamingSession(gaming_session,!0);this.page.register_subs(e.subscribe("updateGamingSession",this,"onUpdateGamingSession"));if(null!==gaming_session&&gaming_session.members){var t=0;for(var i in gaming_session.members){var a=gaming_session.members[i];toint(a.id)!=toint(current_player_id)&&t++}t>0&&this.showPlayWithFriendsPanel()}this.filteringSelectAddToFriend=new ebg.comboajax;this.filteringSelectAddToFriend.create("findplayer","/player/player/findplayer.html?nofriends",__("lang_mainsite","Type a player name..."));e.connect(this.filteringSelectAddToFriend,"onChange",this,function(e){if(0!=toint(e)){this.page.ajaxcall("/community/community/addToFriend.html",{id:e},this,function(){},function(e){});this.onInviteSomeFriend(e)}});e.attr("lobby_friend_section","data-state",this.getDefaultFriendSectionState());this.updateFriendCancelButtonVisibility();"arena"==this.rankingMode&&this.cancelGameSession()},inviteFriendsDestroy:function(){if(void 0!==this.inviteFriendsPopup){this.inviteFriendsPopup.destroy();this.inviteFriends.destroy();e.disconnect(this.closingInviteFriend)}void 0!==this.evtAdaptFriendsPosition&&e.disconnect(this.evtAdaptFriendsPosition);$("findplayer")&&dijit.byId("findplayer").destroy()},onUpdateGamingSession:function(e){this.updateGamingSession(e.args.updateGamingSession)},updateGamingSession:function(t,i){var a,n=0;gaming_session=t;null===gaming_session||void 0!==gaming_session.members[current_player_id]&&"invited"!=gaming_session.members[current_player_id].status||(gaming_session=null);var o=e.query("#lobby_invited_friend_list .lobby_invite_friend_item_player"),s=o.length>0;o.forEach(e.destroy);if(null!=gaming_session&&gaming_session.members){for(var r in gaming_session.members){var l=gaming_session.members[r];if(l.id!==current_player_id){if(!$("gamesession_player_"+l.id)){n++;a=l;id_to_path(l.id);l.emblem=getPlayerAvatar(l.id,l.avatar,92);e.place(e.string.substitute('<div id="gamesession_player_${id}" class="lobby_invite_friend_item lobby_invite_friend_item_player lobby_invite_friend_item_${status}">                            <div class="lobby_invite_friend_content">                            <div class="lobby_invite_friend_avatar emblemwrap_xl">                                <img id="emblemfriend_${id}" src="${emblem}" alt="${player_name}" class="emblem"/><div class="emblempremium"></div>                                </div>                                <div class="lobby_invite_friend_name playername">${player_name}</div>                            </div>                            <i id="lobby_invite_remove_${id}" class="fa fa-lg fa-times-circle lobby_invite_friend_remove"></i>                        </div>',l),"lobby_invited_friend_list","first");e.connect($("gamesession_player_"+l.id),"onclick",this,"onRemoveFromGameSession");"member"==l.status&&e.connect($("lobby_invite_remove_"+l.id),"onclick",this,"onRemoveFromGameSession")}i||this.expectedFriends.includes(l.id)||this.page.showMessage(e.string.substitute(_("${player_name} is online and was added to your friends"),{player_name:l.player_name}),"info");this.expectedFriends.push(l.id)}}gaming_session.admin===current_player_id?e.removeClass("lobby_invite_friend_zone","passive_guest_on_gamesession"):e.addClass("lobby_invite_friend_zone","passive_guest_on_gamesession");n>=1&&mainsite.createChatBarWindow({type:"group",id:gaming_session.id,label:gaming_session.gname,group_avatar:gaming_session.group_avatar,group_type:gaming_session.group_type,url:"/group?id="+gaming_session.id,channel:"/group/g"+gaming_session.id,window_id:"group_"+gaming_session.id,start:e.hasClass("ebd-body","mobile_version")?"collapsed":"expanded"},!0)}else e.removeClass("lobby_invite_friend_zone","passive_guest_on_gamesession");if(n>0){e.hasClass("lobby_invite_friend_zone","visible");e.addClass("lobby_invite_friend_zone","lobby_invited_friend_section_visible");if(mainsite.tutorialShowOnce(17)){var d=this.getFirstPlayButton();mainsite.highlightElementTutorial(d,e.string.substitute(_("Hit any *Play button* to start playing with ${friend} right now!"),{friend:a.player_name}));mainsite.highlightElementTutorial("lobby_invite_friend_plus",_("Hit here to play with multiple friends"))}$("lobby_invited_friend_section_title").innerHTML=1===n?e.string.substitute(_("Choose any game below to start playing with ${friend}"),{friend:a.player_name}):e.string.substitute(_("Choose any game below to start playing with ${nbr} friends"),{nbr:n});s||e.removeClass("lobby_invite_friend_zone","lobby_friend_section_visible");e.addClass("gamelobby_inner","some_friends");if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}}else{e.removeClass("lobby_invite_friend_zone","lobby_invited_friend_section_visible");e.addClass("lobby_invite_friend_zone","lobby_friend_section_visible");e.removeClass("gamelobby_inner","some_friends")}},onFilterFriends:function(e){this.currentFilter=$("filter_friends").value;this.refreshFriends()},onAddToGameSession:function(t){e.stopEvent(t);this.onInviteSomeFriend(t.currentTarget.id.split("_")[2])},onRemoveFromGameSession:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_").pop(),a=this.expectedFriends.indexOf(i);-1!==a&&this.expectedFriends.splice(a,1);this.page.ajaxcall("/group/group/removeFromGameSession.html",{player:i},this,function(e){})},onInviteMoreFriends:function(t){e.stopEvent(t);e.addClass("lobby_invite_friend_zone","lobby_friend_section_visible");e.attr("lobby_friend_section","data-state",this.getDefaultFriendSectionState());this.updateFriendCancelButtonVisibility()},onInviteSomeFriend:function(e){if($("gamesession_player_"+e))this.page.showMessage(_("This friend is already invited"),"info");else{this.expectedFriends.push(e);this.page.ajaxcall("/group/group/inviteToGameSession.html",{player:e},this,function(e){});this.refreshFriends()}},onFriendSectionCancel:function(t){e.stopEvent(t);if(e.hasClass("lobby_invite_friend_zone","lobby_invited_friend_section_visible"))e.removeClass("lobby_invite_friend_zone","lobby_friend_section_visible");else if(e.attr("lobby_friend_section","data-state")===this.getDefaultFriendSectionState()){this.cancelGameSession();this.showPlayWithFriendsPanel()}else e.attr("lobby_friend_section","data-state",this.getDefaultFriendSectionState());this.updateFriendCancelButtonVisibility()},updateFriendCancelButtonVisibility:function(){e.attr("lobby_friend_section","data-state")===this.getDefaultFriendSectionState()?e.hasClass("lobby_invite_friend_zone","lobby_invited_friend_section_visible")&&e.hasClass("lobby_invite_friend_zone","lobby_friend_section_visible")?e.style("lobby_friend_section_cancel_button","display","block"):e.style("lobby_friend_section_cancel_button","display","none"):e.style("lobby_friend_section_cancel_button","display","block")},onShowPlayWithFriendsPanel:function(t){e.stopEvent(t);e.hasClass("lobby_invite_friend_zone","visible")?this.cancelGameSession():this.showPlayWithFriendsPanel()},cancelGameSession:function(){var e=0;if(null!==gaming_session&&gaming_session.members)for(var t in gaming_session.members){gaming_session.members[t].id!=current_player_id&&e++}e>0&&this.page.ajaxcall("/group/group/removeAllFromGameSession.html",{},this,function(e){});this.hidePlayWithFriendsPanel();this.expectedFriends=[];if("undefined"!=typeof gaming_session&&null!==gaming_session){gaming_session;mainsite.closeChatWindow("group_"+gaming_session.id);gaming_session=null}this.updateGamingSession(null)},showPlayWithFriendsPanel:function(){e.addClass("lobby_invite_friend_zone","visible");$("playwithfriends_icon").innerHTML="-";this.refreshFriends();if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}},refreshFriends:function(){var t=this.currentFilter,i=e.hasClass("ebd-body","mobile_version")?7:8;this.page.ajaxcall("/community/community/friends.html",{limit:i,filter:t},this,function(a){var n=a.friends;if(n.length>0){this.hasFriend=!0;e.attr("lobby_friend_section","data-state","friends_list");this.updateFriendCancelButtonVisibility()}if(t){if(0===n.length){e.style("filter_without_result","display","block");e.style("lobby_add_friend_button","display","none")}}else{n.length<i?e.style("filter_friends","display","none"):e.style("filter_friends","display","inline-block");e.style("filter_without_result","display","none");e.style("lobby_add_friend_button","display","block")}e.query("#lobby_friend_list .lobby_invite_friend_item_player").forEach(e.destroy);n.length>i&&n.splice(i-n.length);for(var o in n){var s=n[o];id_to_path(s.id);s.emblem=getPlayerAvatar(s.id,s.avatar,92);e.place(e.string.substitute('<div id="friend_player_${id}" class="lobby_invite_friend_item lobby_invite_friend_item_player lobby_invite_friend_item_${status}">                            <div class="lobby_invite_friend_content">                            <div class="lobby_invite_friend_avatar emblemwrap_xl">                                <img id="emblemfriend_${id}" src="${emblem}" alt="${name}" class="emblem"/><div class="emblempremium"></div>                                <i class="fa fa-${device} playerstatus status_${status}"></i>                                </div>                                <div class="lobby_invite_friend_name playername">${name}</div>                            </div>                        </div>',s),"lobby_add_friend_button","before");e.connect($("friend_player_"+s.id),"onclick",this,"onAddToGameSession")}})},hidePlayWithFriendsPanel:function(){e.removeClass("lobby_invite_friend_zone","visible");$("playwithfriends_icon").innerHTML="+";if(this.lazyload){this.lazyload.clearImagePositionCache();this.lazyload.checkLazyImages()}},getDefaultFriendSectionState:function(){return this.hasFriend?"friends_list":"friend_location_question"},onAddFriend:function(t){e.stopEvent(t);e.attr("lobby_friend_section","data-state","friend_location_question");this.updateFriendCancelButtonVisibility()},onAddHotseatFriend:function(t){e.stopEvent(t);e.attr("lobby_friend_section","data-state","hotseat_player_name");this.updateFriendCancelButtonVisibility()},onAddFriendPlayingOnAnotherScreen:function(t){e.stopEvent(t);e.attr("lobby_friend_section","data-state","friend_registered_question");this.updateFriendCancelButtonVisibility()},onValidateHotseatPlayerName:function(t){e.stopEvent(t);var i=$("hotseat_player_name").value;""!==i?this.page.ajaxcall("/group/group/inviteToGameSession.html",{player:-99,hotseat:i},this,function(e){}):this.page.showMessage(_("You must choose a name (ex: John) for your hotseat player."),"error")},displayFriendSearch:function(t){e.stopEvent(t);e.attr("lobby_friend_section","data-state","search_friend");this.updateFriendCancelButtonVisibility()},displayInvitationLink:function(t){e.stopEvent(t);e.attr("lobby_friend_section","data-state","invitation_link");this.updateFriendCancelButtonVisibility()},onCopyContent:function(t){e.stopEvent(t);var i=document.getElementById("copy_content"),a=document.createElement("textarea");a.value=i.textContent;document.body.appendChild(a);a.select();document.execCommand("Copy");a.remove();e.style("copy_success","display","block");e.fadeIn({node:"copy_success"}).play();setTimeout(e.hitch(this,"cleanCopyConfirmation"),2e3)},cleanCopyConfirmation:function(t){var i=e.fadeOut({node:"copy_success"});e.connect(i,"onEnd",this,function(t){e.style(t,"display","none")});i.play()},reloadGameTables:function(t,i,a,n){var o=null,s=null;if(void 0!==n)e.empty(n);else for(var r in t){var l="Xannaplay_tables_list_"+(h=t[r]);if(!$(l)){console.error("Table list wrapper no more exists for game "+h);return}e.empty(l)}this.table_to_status={};for(var r in a){var d=a[r];if(void 0!==i[d]){var c=i[d],u="last";void 0!==c.players[current_player_id]&&"inprogress"!=this.mode&&(u="first");l=void 0===n?"Xannaplay_tables_list_"+c.game_id:n;""!=this.canIJoinTable(c)?l+="_cantjoin":o=c;if(l){e.place(this.page.format_string(this.jstpl_table_wrap,{id:c.id,game_id:c.game_id}),l,u);this.table_to_location[c.id]=l}this.display_table(c)}}if(void 0!==n){l=n+"_switchtoarena";if($(l))for(var r in t){var h=t[r];if(mainsite.gamefilter[h]){var p=$("gamenameraw_"+h).innerHTML,m=getMediaUrl(p,"icon"),g='<div class="bgabutton bgabutton_gray switch_to_arena_inline" id="switch_to_arena_wrap_'+h+'" >                                    <p><a class="gamename" href="">'+games_known[h].NAME+'</a></p>                                    <img src="'+m+'" class="game_icon" alt=""/>                                    <p><div class="icon20 icon_arena"></div> '+_("Play now")+"</p>                                </div> ";e.place(g,l,"last");this.updateSwitchToArenaVisibility(h);e.connect($("switch_to_arena_wrap_"+h),"onclick",this,"onSwitchToArenaForGame")}}}for(var r in t){h=t[r];if(null==mainsite.gamefilter[h]);else{l=void 0===n?"new_table_group_"+h:n+"_newtable";e.place(this.page.format_string(this.jstpl_table_wrap,{id:"create_"+h,game_id:h}),l,"last");var f=this.clockmode,b=Math.max(1,Math.round(toint($("waiting_time_"+h).innerHTML)/60)),y=' <span class="table_status_additional">'+e.string.substitute(_("Waiting time: ${time}mn"),{time:b})+"</span>";"async"==this.clockmode&&(y="");p=$("gamenameraw_"+h).innerHTML;empty_table={id:"create_"+h,game_id:h,realtable:"",status:("realtime"==f?"init":"asyncinit")+" gametable_newtable",game_url:"",game_name:p,game_icon_url:getMediaUrl(p,"icon"),game_version:mainsite.gamefilter[h]?mainsite.gamefilter[h]:"current",game_name_displayed:games_known[h].NAME,status_detailled:_("Create a new table")+y,table_date_info:"",filters:"",presentation:"",optionstxt:""};s=empty_table;var v=this.page.format_string(this.jstpl_table,empty_table);e.place(v,"gametable_"+empty_table.id);var w=e.query("#Xannaplay_"+h+" .game_minplayers")[0].innerHTML;for(r=0;r<w;r++){var x="("+_("Free")+")";e.place(this.page.format_string(this.jstpl_player_table_free,{freeplacetype:"freeplace",text:x}),"players_table_"+empty_table.id)}$("joingame_"+empty_table.id).innerHTML=_("Create");e.style("joingame_"+empty_table.id,"display","inline");e.connect($("joingame_"+empty_table.id),"onclick",this,"onQuickCreateNewTable");e.connect($("gametableblock_create_"+h),"onclick",this,"onCreateNewTable")}}null!==o&&mainsite.tutorialShowOnce(12)&&setTimeout(e.hitch(this,function(){var t="<p>"+e.string.substitute(_("This is an available game table to play ${game_name}."),{game_name:"*"+this.page.getGameNameDisplayed(o.game_name)+"*"})+"</p>";t+="<p>"+_("You can hit *anywhere here* to get more details about this table: game options, opponents details...")+"</p>";t+="<p>"+_("Don't be shy: *join the table* :) The community is very welcoming.")+"</p>";mainsite.highlightElementTutorial("gametable_"+o.id,t)}),500);null!==s&&mainsite.tutorialShowOnce(13)&&setTimeout(e.hitch(this,function(){var t="<p>"+e.string.substitute(_("No available table for you at now? This is an empty game table to play ${game_name}."),{game_name:"*"+this.page.getGameNameDisplayed(s.game_name)+"*"})+"</p>";t+="<p>"+_("Hit here to join and thus *create a new game table*.")+"</p>";t+="<p>"+_("Don't be shy, the community is very welcoming :)")+"</p>";mainsite.highlightElementTutorial("gametable_"+s.id,t)}),600)},onCreateNewTable:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(22),a=this.clockmode,n=$("gamenameraw_"+i).innerHTML;analyticsPush({game_name:n,cta_location:"lobbysimple_create",event:"play_last_step"});this.page.ajaxcall("/table/table/createnew.html",{game:i,gamemode:a,forceManual:!0,is_meeting:!1},this,function(t){if(t.table){t.table;var i=t.table;e.publish("gotourl",[{module:"table",args:{table:i,tb:t.forceTB,nr:!0}}])}})},onQuickCreateNewTable:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[2],a=this.clockmode,n=t.currentTarget.id;if(!e.hasClass(t.currentTarget.id,"disabled")){e.addClass(t.currentTarget.id,"disabled");var o=$("gamenameraw_"+i).innerHTML;analyticsPush({game_name:o,cta_location:"lobbysimple_create",event:"play_last_step"});this.page.ajaxcall("/table/table/createnew.html",{game:i,gamemode:a,forceManual:!0,is_meeting:!1},this,function(t){var i=t.table;e.publish("gotourl",[{module:"table",args:{table:i,tb:t.forceTB,nr:!0}}])},function(){$(n)&&e.removeClass(n,"disabled")})}},display_table:function(t){t.id;$("gametable_"+t.id)&&e.empty("gametable_"+t.id);if(1==t.destroyed)return!1;if("play"==t.status||"asyncplay"==t.status){var i=$("gameserver_url").innerHTML;t.game_url=i+"/"+t.gameserver+"/"+t.game_name+"?table="+t.id}else t.game_url="/table?table="+t.id+"&nr=true";var a=new Date;"play"==t.status||"asyncplay"==t.status?t.table_date_info=e.string.substitute(_("Game started ${time}"),{time:date_format(t.gamestart,!1)}):t.scheduled<=a.getTime()/1e3?t.table_date_info=e.string.substitute(_("Created ${time}"),{time:date_format(t.scheduled,!1)}):t.table_date_info=e.string.substitute(_("Game starts ${time}"),{time:date_format(t.scheduled,!0)});var n="";n=20!=t.options[200]?t.options[200]<=12?" ("+_("Fast turn-based")+")":" ("+_("turn-based")+")":" ("+_("No time limit")+")";t.status_detailled="";if("open"==t.status)$("opt_t_t_"+t.options[200])?1==t.options[201]?t.status_detailled=_("Open for joining")+' <span class="table_status_additional">('+_("Training mode")+")</span>":t.status_detailled=_("Open for joining")+' <span class="table_status_additional">('+$("opt_t_t_"+t.options[200]).innerHTML+")</span>":t.status_detailled=_("Open for joining")+' <span class="table_status_additional">('+_("realtime")+")</span>";else if("setup"==t.status)t.status_detailled=_("Game is about to start");else if("play"==t.status)t.status_detailled=_("Game in progress")+' <span class="table_status_additional">('+_("realtime")+")</span>";else if("asyncplay"==t.status)t.status_detailled=_("Game in progress")+n;else if("finished"==t.status)t.status_detailled=_("Game has ended");else if("meeting"==t.status)t.status_detailled=_("Meeting");else if("asyncopen"==t.status)if($("opt_t_t_"+t.options[200]))if(1==t.options[201])t.status_detailled=_("Open for joining")+' <span class="table_status_additional">('+_("Training mode")+")</span>";else if(void 0!==t.options[206]&&0!=t.options[206]){var o=toint(t.options[206])-1+":00",s=mainsite.playingHoursToLocal(o,!0);t.status_detailled=_("Open for joining")+' <span class="table_status_additional">('+$("opt_t_t_"+t.options[200]).innerHTML+" "+e.string.substitute(_("between ${start_hour} and ${end_hour}"),s)+")</span>"}else t.status_detailled=_("Open for joining")+' <span class="table_status_additional">('+$("opt_t_t_"+t.options[200]).innerHTML+")</span>";else t.status_detailled=_("Open for joining")+' <span class="table_status_additional">('+_("turn-based")+")</span>";else("init"==t.status||"asyncinit"==t.status)&&(t.status_detailled=_("You did not open this table for joining yet"));if("First game on BGA"==t.presentation&&e.query("#game_know_wrapper #game_beacon_"+t.game_id+"_0").length>0){t.presentation=e.string.substitute(_("First game on BGA: help this player to discover BGA and get ${points}!"),{points:'3<div class="icon20 icon20_gift2"></div>'})}else t.presentation=this.page.nl2br(t.presentation,!1);var r=2==t.options[201];r&&(t.presentation+="<div  style='margin-bottom: 8px;'><div class='icon20 icon_arena imgtext'></div> "+_("Arena mode")+"</div>");void 0!==t.reputation_filter.label&&(t.reputation_filter=t.reputation_filter.label);void 0!==t.level_filter.label&&(t.level_filter=t.level_filter.label);t.filters=this.page.format_string_recursive(t.level_filter.log,t.level_filter.args);if(""!=t.reputation_filter){""!=t.filters&&(t.filters+=", ");t.filters+=t.reputation_filter}if(null!==t.filter_group){""!=t.filters&&(t.filters+=", ");var l=!1;"public"!=t.filter_group_visibility&&"member"==t.filter_group_visibility&&1!==mainsite.groupList[t.filter_group]&&(l=!0);t.filter_group_label="";l?t.filter_group_label="("+_("private group")+")":"normal"==t.filter_group_type?t.filter_group_label=t.filter_group_name:"friend"==t.filter_group_type&&(t.filter_group_label=e.string.substitute(_("${player}'s friends"),{player:t.filter_group_name}));t.filters+=t.filter_group_label}if(null!==t.filter_lang){""!=t.filters&&(t.filters+=", ");t.filters+=t.filter_lang_label}t.optionstxt="";for(var d in t.options){var c=t.options[d];"object"==typeof c&&(c=c.value);var u="opt_"+t.game_id+"_"+d+"_"+c;if($(u)){""!=t.optionstxt&&(t.optionstxt+=", ");var h=_("gameoptions_"+t.game_id+"_"+$(u).value);h=h.replace("gameoptions_"+t.game_id+"_","");t.optionstxt+=h}}t.game_name_displayed=this.page.getGameNameDisplayed(t.game_name);t.game_icon_url=getMediaUrl(t.game_name,"icon");t.realtable="realtable";t.game_version=mainsite.gamefilter[t.game_id];null===t.game_version&&(t.game_version="current");var p=this.page.format_string(this.jstpl_table,t);e.place(p,"gametable_"+t.id);t.id,t.id;if(r){e.style("gametable_"+t.id,"display","none");e.addClass("gametable_"+t.id,"arena_table_"+t.game_id)}var m=0,g=!1;e.removeClass("gametable_"+t.id,"player_is_at_table");for(player_display_index in t.player_display){var f=t.player_display[player_display_index],b=t.players[f];if(void 0===b){var y="ERROR (please report to contact@boardgamearena.com) : Found player "+f+" in player_display for table "+t.id+" that is not present in table.player";console.error(y);console.error(b);this.page.showMessage(y,"only_to_log")}else{var v="";0==b.ranksummary?v=_("Beginner"):1300==b.ranksummary?v=_("Apprentice"):1400==b.ranksummary?v="":1500==b.ranksummary?v=_("Good player"):1600==b.ranksummary?v=_("Strong player"):1800==b.ranksummary?v=_("Expert"):2e3==b.ranksummary&&(v=_("Master"));var w="";"expected"==b.table_status&&(w="tableplace_expected");var x="";1==b.is_premium&&(x="is_premium");var k=id_to_path(b.id);if(r&&b.id!=current_player_id){b.fullname=_("Arena player");x="";b.avatar="";k="";b.id=0}var C=this.page.format_string(this.jstpl_player_table,{player_id:b.id,armsdir:k,table_id:t.id,player_name:b.fullname,player_avatar:getPlayerAvatar(b.id,b.avatar,32),player_summary:v,tableplaceclass:w,emblem_class:x});e.place(C,"players_table_"+t.id);if($("availableplayertable_"+b.id)){$("availableplayertable_"+b.id).innerHTML=t.game_name_displayed+" n"+t.id;e.style("availableplayertable_"+b.id,"display","block")}if(b.id==current_player_id&&"expected"!=b.table_status){e.addClass("gametable_"+t.id,"player_is_at_table");g=!0}m++}}var T=0,j=0;if("open"==t.status||"meeting"==t.status||"asyncopen"==t.status)for(;m<t.max_player;){m++;var S="freeplace",M="("+_("Free")+")";if(m>t.min_player){S="freeplaceopt";M="("+_("Free")+")"}else j++;e.place(this.page.format_string(this.jstpl_player_table_free,{freeplacetype:S,text:M}),"players_table_"+t.id);T++}T>0&&!g&&e.style("joingame_"+t.id,"display","inline");!g||"open"!=t.status&&"init"!=t.status&&"asyncopen"!=t.status&&"asyncinit"!=t.status||e.style("quitgame_"+t.id,"display","inline");if(t.admin_id!=current_player_id||"init"!=t.status&&"asyncinit"!=t.status)e.style("viewgame_"+t.id,"display","inline");else{e.style("opengame_"+t.id,"display","inline");e.style("configgame_"+t.id,"display","inline")}t.admin_id!=current_player_id||"open"!=t.status&&"asyncopen"!=t.status||0==j&&e.style("startgame_"+t.id,"display","inline");this.reconnect_table_buttons(t.id);1!=toint(t.max_player)||"open"!=t.status&&"meeting"!=t.status&&"asyncopen"!=t.status||e.addClass("gametable_"+t.id,"soloGameTable");var A=this.table_to_status[t.id];void 0!==A?"normal"==this.mode?"open"!=A&&"setup"!=A&&"asyncopen"!=A||"open"==t.status||"setup"==t.status||"asyncopen"==t.status||e.fx.wipeOut({node:"gametable_"+t.id,duration:500,onEnd:e.hitch(this,function(){e.destroy("gametable_"+t.id);this.updateSwitchToArenaVisibility(t.game_id)})}).play():"inprogress"==this.mode&&("play"!=A&&"asyncplay"!=A||"play"==t.status||"asyncplay"==A||e.fx.wipeOut({node:"gametable_"+t.id,duration:500,onEnd:e.hitch(this,function(){e.destroy("gametable_"+t.id);this.updateSwitchToArenaVisibility(t.game_id)})}).play()):"normal"!=this.mode||"play"!=t.status&&"asyncplay"!=t.status&&"finished"!=t.status||e.destroy("gametable_"+t.id);this.table_to_status[t.id]=t.status;this.updateTableCanJoinStatus(t);return!0},onJoinGame:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1],a=t.currentTarget.id;if(!e.hasClass(t.currentTarget.id,"disabled")){e.addClass(t.currentTarget.id,"disabled");var n=event.target.closest(".gametable_list");if(n&&n.id){var o=n.id.split("_")[3];if(o){var s=$("gamenameraw_"+o).innerHTML;analyticsPush({game_name:s,cta_location:"lobbysimple_join",event:"play_last_step"})}}this.page.ajaxcall("/table/table/joingame.html",{table:i},this,function(t){setTimeout(e.hitch(this,function(){if($("gametable_"+i)){var t=!1;"realtime"==this.clockmode?mainsite.tutorialShowOnce(14)&&(t=!0):mainsite.tutorialShowOnce(15)&&(t=!0);if(t){var a="<p>"+e.string.substitute(_("*Welcome* at this game table :)"))+"</p>";if("realtime"==this.clockmode)a+="<p>"+_("The creator of this table is going to starts the game when appropriate (enough opponents...).")+"</p>";else{a+="<p>"+_("This turn based game will automatically starts when it's full :)")+"</p>";a+="<p>"+_("You have nothing else to do, and you may join other tables if you like.")+"</p>"}a+="<p>"+_("Tip: you to get more details about this table (game options, opponents details...) by *clicking anywhere on the table* or using 'View' button.")+"</p>";a+="<p>"+_("Tip: if you don't like to wait, you may join or create other game tables.")+"</p>";mainsite.highlightElementTutorial("gametable_"+i,a);if("realtime"==this.clockmode){a="<p>"+_("Chat here with your opponents")+"</p>";mainsite.highlightElementTutorial("chatwindowcollapsed_table_"+i,a)}}}}),1e3)},function(){e.removeClass(a,"disabled")})}},onQuitGame:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1],a=t.currentTarget.id;if(!e.hasClass(t.currentTarget.id,"disabled")){e.addClass(t.currentTarget.id,"disabled");mainsite.leaveTable(i,e.hitch(this,function(){null!==mainsite.room&&mainsite.room.indexOf("T")>=0&&mainsite.doLeaveRoom()}),function(){e.removeClass(a,"disabled")})}},onOpenGame:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1],a=t.currentTarget.id;if(!e.hasClass(t.currentTarget.id,"disabled")){e.addClass(t.currentTarget.id,"disabled");this.page.ajaxcall("/table/table/openTableNow.html",{table:i},this,function(e){},function(){e.removeClass(a,"disabled")})}},onStartGame:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1],a=t.currentTarget.id;if(!e.hasClass(t.currentTarget.id,"disabled")){e.addClass(t.currentTarget.id,"disabled");mainsite.autoredirectedWhenTableStarts=i;this.page.ajaxcall("/table/table/startgame.html",{table:i},this,function(e){},function(){e.removeClass(a,"disabled")})}},canIJoinTable:function(t){if(void 0!==t.players[current_player_id])return"open"==t.status||"asyncopen"==t.status||"setup"==t.status||"init"==t.status||"asyncinit"==t.status?"":_("This table is not open for joining");if(2==t.options[201])return _("This table can only be joined using the Arena mode");if("open"!=t.status&&"asyncopen"!=t.status&&"setup"!=t.status)return _("This table is not open for joining");if(current_player_id<0)return"";if(t.current_player_nbr>=t.max_player)return _("There is no place left at this table");var i=Math.floor(t.reputation_filter_r/64);if(i>0&&toint($("opt_k_k_k").innerHTML)<{0:0,1:50,2:65,3:75,4:85}[i])return _("Your reputation is not high enough for this table");if(127!=t.level_filter_r){if($("opt_"+t.game_id+"_r_r")){var a=$("opt_"+t.game_id+"_r_r").innerHTML;n=a>=2e3?64:a>=1800?32:a>=1600?16:a>=1500?8:a>=1400?4:a>1300?2:1}else var n=1;if(!(t.level_filter_r&n))return _("Your cannot join this table due to your level")}if(t.filter_group&&void 0===mainsite.allGroupList[t.filter_group]){void 0===t.filter_group_label&&(t.filter_group_label="");return e.string.substitute(_("Only members of `${group}` can join this table"),{group:t.filter_group_label})}if(t.filter_lang&&void 0===mainsite.allLanguagesList[t.filter_lang]){void 0===t.filter_lang_label&&(t.filter_lang_label="");return e.string.substitute(_("Only players speaking `${lang}` can join this table"),{lang:t.filter_lang_label})}for(var o in t.players){if(void 0!==mainsite.red_thumbs_given&&void 0!==mainsite.red_thumbs_given[o])return _("You added one participant to your blacklist (red thumb)");if(void 0!==mainsite.red_thumbs_taken&&void 0!==mainsite.red_thumbs_taken[o])return _("One participant added you to his/her blacklist (red thumb)")}return""},updateTableCanJoinStatus:function(t){var i=this.canIJoinTable(t);if(""!=i){if($("gametable_"+t.id)){$("cannotJoinTable_"+t.id).innerHTML='<i class="fa fa-ban" aria-hidden="true"></i> '+i;e.addClass("gametable_"+t.id,"cannotJoinTable");if(void 0!==this.table_to_location[t.id]&&"_cantjoin"!=this.table_to_location[t.id].slice(-9)){target=this.table_to_location[t.id]+"_cantjoin";var a=t.id;this.table_to_location[a]=target;e.fx.wipeOut({node:"gametable_"+a,duration:500,onEnd:e.hitch(this,function(t){var i=e.clone(t);e.destroy(t);e.place(i,target,"last");this.reconnect_table_buttons(a);var n=e.fx.wipeIn({node:i.id,duration:500});e.connect(n,"onEnd",function(t){e.style(t.id,"overflow","visible")});n.play()})}).play()}}}else if($("gametable_"+t.id)){e.removeClass("gametable_"+t.id,"cannotJoinTable");if(void 0!==this.table_to_location[t.id]&&"_cantjoin"==this.table_to_location[t.id].slice(-9)){target=this.table_to_location[t.id].slice(0,-9);a=t.id;this.table_to_location[a]=target;e.fx.wipeOut({node:"gametable_"+a,duration:500,onEnd:e.hitch(this,function(t){var i=e.clone(t);e.destroy(t);e.place(i,target,"last");this.reconnect_table_buttons(a);var n=e.fx.wipeIn({node:i.id,duration:500});e.connect(n,"onEnd",function(t){e.style(t.id,"overflow","visible")});n.play()})}).play()}}},reconnect_table_buttons:function(t){$("joingame_"+t)&&e.connect($("joingame_"+t),"onclick",this,"onJoinGame");$("quitgame_"+t)&&e.connect($("quitgame_"+t),"onclick",this,"onQuitGame");$("opengame_"+t)&&e.connect($("opengame_"+t),"onclick",this,"onOpenGame");$("startgame_"+t)&&e.connect($("startgame_"+t),"onclick",this,"onStartGame")},onTableInfosChanged:function(t){var i=t.args;void 0===i.filter_group&&(i.filter_group=null);void 0===i.filter_group_name&&(i.filter_group_name=null);void 0===i.filter_group_visibility&&(i.filter_group_visibility=null);void 0===i.filter_group_type&&(i.filter_group_type=null);void 0===i.filter_lang&&(i.filter_lang=null);void 0===i.presentation&&(i.presentation="");void 0===i.level_filter&&(i.level_filter={label:{log:"",args:[]}});void 0===i.level_filter_r&&(i.level_filter_r=127);void 0===i.reputation_filter&&(i.reputation_filter={label:"",details:{opinion:0,leave:0,clock:0,karma:0}});void 0===i.reputation_filter_r&&(i.reputation_filter_r=0);void 0===i.gameserver&&(i.gameserver=0);void 0===i.progression&&(i.progression=0);if("realtime"==this.clockmode){if("asyncinit"==i.status||"asyncopen"==i.status||"asyncplay"==i.status)return}else if("async"==this.clockmode&&("init"==i.status||"open"==i.status||"play"==i.status||"setup"==i.status))return;this.updateAccessPossibilityForTable(i);if($("gametable_"+i.id))this.display_table(i);else if("finished"!=i.status){var a=null,n="last";if(this.game_to_target[i.game_id]){a=this.game_to_target[i.game_id];n="first";if(i.admin_id==current_player_id){a="gametable_create_"+i.game_id;n="before"}}else if($("expandedgame_box_wrap_"+i.game_id))a="Xannaplay_tables_list_"+i.game_id;else if("block"==e.style("other_table_list","display")){a="other_table_gamelist";n="first"}if(null!=a){""!=this.canIJoinTable(i)&&(a+="_cantjoin");e.place(this.page.format_string(this.jstpl_table_wrap,{id:i.id,game_id:i.game_id}),a,n);this.table_to_location[i.id]=a;this.display_table(i);if($("gametable_"+i.id)){e.style("gametable_"+i.id,"display","none");e.fx.wipeIn({node:"gametable_"+i.id,duration:500}).play()}}}this.updateSwitchToArenaVisibility(i.game_id)},getFirstPlayButton:function(){var t=e.query("#favorite_section .wannaplayauto_button.bgabutton_blue");return t.length>0||(t=e.query("#suggested_games_list .wannaplayauto_button.bgabutton_blue")).length>0||(t=e.query("#known_section .wannaplayauto_button.bgabutton_blue")).length>0?t[0].id:null},showNeededTutorialItems:function(){if($("favorite_section")){var t=this.getFirstPlayButton(),i=null,a=e.query("#favorite_section .howtoplay .how_to_play_button");(a.length>0||(a=e.query("#suggested_games_list .howtoplay .how_to_play_button")).length>0||(a=e.query("#known_section .howtoplay .how_to_play_button")).length>0)&&(i=a[0].id);$("arena_tuto_wrap")&&e.style("arena_tuto_wrap","display","none");if("arena"==this.rankingMode){if(e.hasClass("gamelobby-module","rankingmode_choice")||e.hasClass("gamelobby-module","gamemode_choice")||e.hasClass("gamelobby-module","opponentmode_choice"));else{if(mainsite.tutorialShowOnce(18)){var n="<p>"+_("Welcome to the *Arena*: compete and become the world champion this season!")+"</p>";n+="<p>"+e.string.substitute(_("Gain ${points} each time you win a game."),{points:'<span class="icon20 icon_arena"></span>'})+"</p>";n+="<p>"+e.string.substitute(_("Get enough ${points} to be promoted to the higher league."),{points:'<span class="icon20 icon_arena"></span>'})+"</p>";n+="<p><br/></p>";n+='<div style="width:92px;display:inline-block;text-align:center;margin-bottom:15px;"><div class="trophyimg trophyimg_large" style="background-image:url(\''+getStaticAssetUrl("img/awards/100-92.png")+"')\"></div>*"+_("Bronze")+"*</div>";n+='<div style="width:92px;display:inline-block;text-align:center;margin-bottom:15px;"><div class="trophyimg trophyimg_large" style="background-image:url(\''+getStaticAssetUrl("img/awards/101-92.png")+"')\"></div>*"+_("Silver")+"*</div>";n+='<div style="width:92px;display:inline-block;text-align:center;margin-bottom:15px;"><div class="trophyimg trophyimg_large" style="background-image:url(\''+getStaticAssetUrl("img/awards/102-92.png")+"')\"></div>*"+_("Gold")+"*</div>";n+='<div style="width:92px;display:inline-block;text-align:center;margin-bottom:15px;"><div class="trophyimg trophyimg_large" style="background-image:url(\''+getStaticAssetUrl("img/awards/103-92.png")+"')\"></div>*"+_("Platinum")+"*</div>";n+='<div style="width:92px;display:inline-block;text-align:center;margin-bottom:15px;"><div class="trophyimg trophyimg_large" style="background-image:url(\''+getStaticAssetUrl("img/awards/104-92.png")+"')\"></div>*"+_("Diamond")+"*</div>";n+='<div style="width:92px;display:inline-block;text-align:center;margin-bottom:15px;"><div class="trophyimg trophyimg_large" style="background-image:url(\''+getStaticAssetUrl("img/awards/105-92.png")+"')\"></div>*"+_("Elite")+"*</div>";mainsite.highlightElementTutorial("pageheader_mobile_switcher_wrap_gamemode",n)}if($("arena_tuto_wrap"))if("realtime"==this.clockmode)if(mainsite.tutorialShowOnce(19,!1)){e.style("arena_tuto_wrap","display","block");e.style("tuto_arena_realtime","display","block");e.style("tuto_arena_async","display","none")}else e.style("arena_tuto_wrap","display","none");else if(mainsite.tutorialShowOnce(20,!1)){e.style("arena_tuto_wrap","display","block");e.style("tuto_arena_realtime","display","none");e.style("tuto_arena_async","display","block")}else e.style("arena_tuto_wrap","display","none")}if(""!=arena_disabled_message){e.style("gamelobby_inner","display","none");$("arena_disabled")||e.place('<h2 id="arena_disabled">'+arena_disabled_message+"</h2>","gamelobby_inner","after")}}else if(""!=arena_disabled_message){e.style("gamelobby_inner","display","block");$("arena_disabled")&&e.destroy("arena_disabled")}if(e.hasClass("gamelobby-module","rankingmode_choice")||e.hasClass("gamelobby-module","gamemode_choice")||e.hasClass("gamelobby-module","opponentmode_choice"));else if("none"!=e.style("gamelobby_inner","display")&&mainsite.tutorialShowOnce(21)){mainsite.highlightElementTutorial("find_a_game",_("*Find the game* you want to play."));null!==i&&mainsite.highlightElementTutorial(i,_("Learn how to play a game."));mainsite.highlightElementTutorial(t,_("Hit any *Play button* to start playing right now. *Let's play!*"))}if(e.query("#wannaplay_gamelist .wannaplay_item").length>=10){e.hasClass("ebd-body","mobile_version")||e.hasClass("favorite_section","compactlobby")||e.hasClass("favorite_section","verycompactlobby")||e.hasClass("gamelobby-module","rankingmode_choice")||e.hasClass("gamelobby-module","gamemode_choice")||e.hasClass("gamelobby-module","opponentmode_choice")||mainsite.tutorialShowOnce(7)&&mainsite.highlightElementTutorial("favorite_sort_menu",_("It looks like you have many favorites. Did you know you can reduce their sizes from this menu if you prefer?"),"display_option_highlight")}e.query("#wannaplay_gamelist .wannaplay_item").length>=3&&"manual"==this.opponentMode&&(e.hasClass("gamelobby-module","rankingmode_choice")||e.hasClass("gamelobby-module","gamemode_choice")||e.hasClass("gamelobby-module","opponentmode_choice")||mainsite.tutorialShowOnce(11)&&mainsite.highlightElementTutorial("favorite_see_all_barcenter",_("Many favorite games? Did you know you can display *all available tables for all your games* in one click from there?")))}},onAdaptScreen:function(e){}})})},"ebg/site/moderation":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","ebg/comboajax"],function(e,t,i){return t("ebg.site.moderation",ebg.core.mainsitemodule,{constructor:function(){},doesNeedServerSideLoad:function(){return!1},onLoad:function(e){mainsite.setPageTitle("Player reports moderation");window.globalUserInfos.user_rights.includes("report_access")?this.moderationPanel=new i.ms.moderation.BgaModerationPanel({target:document.querySelector("#main-content"),props:{}}):mainsite.gotourl("/")},onOnUnload:function(){this.moderationPanel&&this.moderationPanel.$destroy()}})})},"ebg/site/newgroup":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.newgroup",ebg.core.mainsitemodule,{constructor:function(){},onLoad:function(t){mainsite.setPageTitle(_("Create new group"));e.connect($("create_button"),"onclick",this,"onCreateNewGroup")},onOnUnload:function(){},onCreateNewGroup:function(e){e.preventDefault();this.ajaxcall("/newgroup/newgroup/create.html",{form_id:"createnewgroup"},this,function(e){gotourl("group?id="+e)},function(e){},"post")}})})},"ebg/site/news":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule","ebg/lazyload","ebg/headlines_unread"],function(e,t){return t("ebg.site.news",ebg.core.mainsitemodule,{constructor:function(){this.lazyload=null},onLoad:function(t){null!==$("this_news_title")&&mainsite.setPageTitle($("this_news_title").innerText);e.query(".news_show_translated").connect("onclick",this,"onClickToggleNewsTranslation");e.query(".news_show_untranslated").connect("onclick",this,"onClickToggleNewsTranslation");$("newsletter_optin")&&e.connect($("newsletter_optin"),"onclick",this,"onClickNewsLetterOptin");this.addTooltipHtml("translation_details_news_0",this.format_string(this.jstpl_news_translation_details,{}));this.lazyload=new ebg.lazyload;this.lazyload.create();this.lazyload.addImagesToLazyLoad("news-module");this.headlines_unread=new ebg.headlines_unread;this.headlines_unread.create(this)},onClickNewsLetterOptin:function(e){if(!(current_player_id<=0)){e.preventDefault();e.stopPropagation();this.ajaxcall("/player/profile/newsletter.html",{value:1},this,function(){this.showMessage(__("lang_mainsite",'You successfully subcribed to our newsletter. You can change this anytime by going to <a href="%s">your email preferences</a>.').replace("%s","/preferences?section=email"),"info")})}},onOnUnload:function(){if(this.lazyload){this.lazyload.destroy();this.lazyload=null}}})})},"ebg/site/newtournament":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","dijit/dijit","dijit/Calendar"],function(e,t,i){return t("ebg.site.newtournament",ebg.core.mainsitemodule,{constructor:function(){this.tournamentStart=null;this.dateCalendars={}},doesNeedServerSideLoad:function(){return!globalUserInfos.flags.tournament_rework},onLoad:function(t){if(globalUserInfos.flags.tournament_rework){document.documentElement.classList.add("bga-white-background");this.tournamentCreationComponent=new i.ms.tournaments.create.BgaNewTournament({target:document.querySelector("#main-content"),props:{gameId:t.game,tournamentId:parseInt(t.id)}})}else{mainsite.setPageTitle($("thispagemaintitle").innerHTML);if($("createnewtournament")){e.connect($("create_tournament_button"),"onclick",this,"onCreateNewTournament");e.connect($("save_tournament_button"),"onclick",this,"onSaveTournament");this.polyfillDateHour();$("registration_type").value=$("registration_type_initial").innerHTML;e.connect($("registration_type"),"onchange",this,"updateRegistrationType");this.updateRegistrationType();$("filter_karma").value=$("filter_karma_initial").innerHTML;e.connect($("tableaccess_Beginners"),"onclick",this,"onTryToGiveAccessToBeginners");e.connect($("tableaccess_Apprentices"),"onclick",this,"onTryToGiveAccessToBeginners");this.updateStageTypeOptions();this.initStageTypeSelector();this.updateTimePerPlayer();e.connect($("game_max_duration"),"onchange",this,"updateTimePerPlayer");e.connect($("stage_playernbr"),"onchange",this,"updateTimePerPlayer");e.connect($("gameoption_206"),"onchange",this,"updateTimePerPlayer");this.initTwoStageSpecifics()}else if($("tournamentdate")){e.query(".editdate").connect("onclick",this,"onEditDate");e.query(".datetype").connect("onchange",this,"onDateTypeChange");e.query(".datetype").forEach(e.hitch(this,function(e){var t=e.id.substr(9);this.updateDateFromValue(t)}));e.connect($("save_dates"),"onclick",this,"onSaveDates")}e.query('select[name="gameoption_206"] > option').forEach(function(e){e.innerHTML=mainsite.playingHoursToLocal(e.innerHTML)})}},onOnUnload:function(){document.documentElement.classList.remove("bga-white-background");this.tournamentCreationComponent&&this.tournamentCreationComponent.$destroy();if(this.tournamentStart){this.tournamentStart.destroy();this.tournamentStart=null}for(var e in this.dateCalendars)this.dateCalendars[e].destroy();this.dateCalendars={}},onTryToGiveAccessToBeginners:function(t){e.stopEvent(t);this.showMessage(_("Sorry, tournaments cannot be accessed by beginner or apprentice players for this game (ELO < 100), except if you invite them personnally"),"error")},onCreateNewTournament:function(e){e.preventDefault();this.ajaxcall("/newtournament/newtournament/create.html",{form_id:"createnewtournament"},this,function(e){gotourl("tournament?id="+e)},function(e){},"post")},onSaveTournament:function(e){e.preventDefault();this.ajaxcall("/newtournament/newtournament/create.html",{form_id:"createnewtournament",tournament_id:$("tournament_id").innerHTML},this,function(e){gotourl("tournament?id="+$("tournament_id").innerHTML)},function(e){},"post")},updateRegistrationType:function(){var t=$("registration_type").value;e.style($("registration_group"),"display","open"===t?"none":"")},updateStageTypeOptions:function(){var t=$("stage_type").value;e.query("[data-tournament-types-only]").forEach(function(e){var i=e.getAttribute("data-tournament-types-only-from");if(i)try{var a=document.querySelector('[data-mode-option-id-key="'+i+'"]');t=a.querySelector('option[value="'+a.value+'"]').getAttribute("data-value")}catch(o){console.error(o);t=null}var n=e.getAttribute("data-tournament-types-only");t&&n.match(new RegExp("\\b"+t+"\\b"))?e.style.display="block":e.style.display="none"})},initStageTypeSelector:function(){var t=$("stage_type").value;t?this.toggleStageTypeSelector(!1,t):this.toggleStageTypeSelector(!0);this.connectClass("tournaments-mode-selection__item","onclick",function(e){var t=e.target.closest(".tournaments-mode-selection__item").getAttribute("data-tournament-type");$("stage_type").value=t;this.toggleStageTypeSelector(!1,t);this.updateStageTypeOptions()});this.connectClass("tournaments-mode-selection__change-btn","onclick",function(){this.toggleStageTypeSelector(!0)});var i=[];document.querySelectorAll("[data-tournament-types-only-from]").forEach(function(e){var t=e.getAttribute("data-tournament-types-only-from");i.includes(t)||i.push(t)});i.forEach(e.hitch(this,function(e){var t=document.querySelector('[data-mode-option-id-key="'+e+'"]');t&&this.connect(t,"onchange",function(){this.updateStageTypeOptions()})}))},toggleStageTypeSelector:function(t,i){if(t){e.query(".tournaments-mode-selection").addClass("active");e.query(".tournaments-mode-selection__item").addClass("visible");e.query(".tournaments-mode-selection__change-btn").removeClass("visible")}else{e.query(".tournaments-mode-selection").removeClass("active");e.query(".tournaments-mode-selection__item").forEach(function(e){var t=e.getAttribute("data-tournament-type");i===t?e.classList.add("visible"):e.classList.remove("visible")});e.query(".tournaments-mode-selection__change-btn").addClass("visible")}},onEditDate:function(t){t.preventDefault();var i=t.currentTarget.id.substr(9);e.style($("editdate_wrap_"+i),"display","block");e.style($("editdate_"+i),"display","none");var a=new Date(1e3*toint($("originaldate_"+i).innerHTML));this.dateCalendars[i]=new dijit.Calendar({value:a},"editdate_calendar_"+i);$("editdate_hour_"+i).value=60*a.getHours()+a.getMinutes();$("datetype_"+i).value=1;this.updateDateFromControls(i);e.connect(this.dateCalendars[i],"onChange",this,function(){this.updateDateFromControls(i)});e.connect($("editdate_hour_"+i),"onchange",this,"onTournamentHourChange")},updateDateFromValue:function(e){1==$("datetype_"+e).value?$("datelabel_"+e).innerHTML=date_format_simple($("date_"+e).value):$("datelabel_"+e).innerHTML=""},updateDateFromControls:function(e){var t=this.dateCalendars[e].value,i=$("editdate_hour_"+e).value,a=Math.floor(i/60),n=i-60*a;t.setHours(a,n,0,0);var o=Math.round(t.getTime()/1e3);$("date_"+e).value=o;this.updateDateFromValue(e)},onTournamentHourChange:function(e){var t=e.currentTarget.id.substr(14);this.updateDateFromControls(t)},onDateTypeChange:function(e){var t=e.currentTarget.id.substr(9);this.updateDateFromValue(t)},onSaveDates:function(e){e.preventDefault();this.ajaxcall("/newtournament/newtournament/savedates.html",{form_id:"tournamentdate"},this,function(e){var t=$("tournament").value;gotourl("tournament?id="+t)},function(e){},"post")},updateTimePerPlayer:function(){var t=toint($("stage_playernbr").value),i=toint($("game_max_duration").value),a=0;t>0&&(a=Math.round(i/t));if(i>14400){$("gameoption_200").value=21;e.style("gameoption_206_wrap","display","block");$("gameoption_206").value>0&&(a/=2)}else{$("gameoption_200").value=5;e.style("gameoption_206_wrap","display","none")}e.style("gameoption_201_wrap","display","none");$("time_per_player").innerHTML=this.formatReflexionTime(a).string;$("gameoption_204").value=Math.round(a)},polyfillDateHour:function(){var t=document.createElement("input");t.type="time";if("time"!==t.type){document.querySelectorAll(".input-date").forEach(e.hitch(this,function(t){t.type="text";t.readOnly=!0;this.connect(t,"onclick",function(){if(!t.classList.contains("input-date-open")){var i=document.createElement("div");t.classList.add("input-date-open");t.parentElement.insertBefore(i,t.nextSibling);var a=new dijit.Calendar({value:t.value},i),n=e.connect(a,"onChange",this,function(o){var s=o.getTimezoneOffset();o=new Date(o.getTime()-60*s*1e3);t.value=o.toISOString().split("T")[0];e.disconnect(n);a.destroy();t.classList.remove("input-date-open");i.remove()})}})}));document.querySelectorAll(".input-time").forEach(e.hitch(this,function(t){t.type="hidden";t.readOnly=!0;var i,a,n=document.createElement("select"),o=document.createElement("select");for(i=0;i<23;i++){(a=document.createElement("option")).value=("0"+i).substr(-2);a.innerHTML=i;n.appendChild(a)}for(i=0;i<55;i+=5){(a=document.createElement("option")).value=("0"+i).substr(-2);a.innerHTML=i;o.appendChild(a)}t.parentElement.insertBefore(o,t.nextSibling);t.parentElement.insertBefore(document.createTextNode(" h "),t.nextSibling);t.parentElement.insertBefore(n,t.nextSibling);var s=(t.value||"00:00").split(":");n.value=s[0];o.value=s[1];e.connect(n,"onchange",function(){var e=t.value||"00:00";e=e.replace(/^\d\d/,n.value);t.value=e});e.connect(o,"onchange",function(){var e=t.value||"00:00";e=e.replace(/\d\d$/,o.value);t.value=e})}))}},initTwoStageSpecifics:function(){var t=document.querySelector('[data-mode-option-id-key="twoStage:stage_1_num_groups"]'),i=document.querySelector('[data-mode-option-id-key="twoStage:stage_1_num_players_to_keep"]'),a=document.querySelector('input[name="min_players"]'),n=document.querySelector('input[name="max_players"]'),o=a.value,s=n.value,r=e.create("div");r.classList.add("form-hint");document.querySelector('[data-tournament-types-only="twoStage"]').appendChild(r);var l=function(){if("twoStage"===$("stage_type").value){var e=t.value,l=i.value,d=e*l;a.value=Math.max(d,o);var c=2*d;n.value=Math.max(c,s);var u=e+" "+_("groups")+"  "+l+" "+_("players")+" : "+d+" "+_("players")+" "+_("in the second stage");r.innerHTML=u}else{a.value=o;n.value=s;r.innerHTML=""}};this.connect(t,"onchange",l);this.connect(i,"onchange",l);this.connect(a,"oninput",function(){o=a.value});this.connect(n,"oninput",function(){s=n.value})}})})},"dijit/dijit":function(){define(["./main","./_base","dojo/parser","./_Widget","./_TemplatedMixin","./_Container","./layout/_LayoutWidget","./form/_FormWidget","./form/_FormValueWidget"],function(e){return e})},"dijit/_base":function(){define(["./main","./a11y","./WidgetSet","./_base/focus","./_base/manager","./_base/place","./_base/popup","./_base/scroll","./_base/sniff","./_base/typematic","./_base/wai","./_base/window"],function(e){return e._base})},"dijit/WidgetSet":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","./registry"],function(e,t,i,a){var n=t("dijit.WidgetSet",null,{constructor:function(){this._hash={};this.length=0},add:function(e){if(this._hash[e.id])throw new Error("Tried to register widget with id=="+e.id+" but that id is already registered");this._hash[e.id]=e;this.length++},remove:function(e){if(this._hash[e]){delete this._hash[e];this.length--}},forEach:function(e,t){t=t||i.global;var a,n=0;for(a in this._hash)e.call(t,this._hash[a],n++,this._hash);return this},filter:function(e,t){t=t||i.global;var a,o=new n,s=0;for(a in this._hash){var r=this._hash[a];e.call(t,r,s++,this._hash)&&o.add(r)}return o},byId:function(e){return this._hash[e]},byClass:function(e){var t,i,a=new n;for(t in this._hash)(i=this._hash[t]).declaredClass==e&&a.add(i);return a},toArray:function(){var e=[];for(var t in this._hash)e.push(this._hash[t]);return e},map:function(t,i){return e.map(this.toArray(),t,i)},every:function(e,t){t=t||i.global;var a,n=0;for(a in this._hash)if(!e.call(t,this._hash[a],n++,this._hash))return!1;return!0},some:function(e,t){t=t||i.global;var a,n=0;for(a in this._hash)if(e.call(t,this._hash[a],n++,this._hash))return!0;return!1}});e.forEach(["forEach","filter","byClass","map","every","some"],function(e){a[e]=n.prototype[e]});return n})},"dijit/_base/focus":function(){define(["dojo/_base/array","dojo/dom","dojo/_base/lang","dojo/topic","dojo/_base/window","../focus","../selection","../main"],function(e,t,i,a,n,o,s,r){var l={_curFocus:null,_prevFocus:null,isCollapsed:function(){return r.getBookmark().isCollapsed},getBookmark:function(){return(n.global==window?s:new s.SelectionManager(n.global)).getBookmark()},moveToBookmark:function(e){return(n.global==window?s:new s.SelectionManager(n.global)).moveToBookmark(e)},getFocus:function(e,i){var a=!o.curNode||e&&t.isDescendant(o.curNode,e.domNode)?r._prevFocus:o.curNode;return{node:a,bookmark:a&&a==o.curNode&&n.withGlobal(i||n.global,r.getBookmark),openedForWindow:i}},_activeStack:[],registerIframe:function(e){return o.registerIframe(e)},unregisterIframe:function(e){e&&e.remove()},registerWin:function(e,t){return o.registerWin(e,t)},unregisterWin:function(e){e&&e.remove()}};o.focus=function(e){if(e){var t="node"in e?e.node:e,i=e.bookmark,a=e.openedForWindow,s=!!i&&i.isCollapsed;if(t){var l="iframe"==t.tagName.toLowerCase()?t.contentWindow:t;if(l&&l.focus)try{l.focus()}catch(d){}o._onFocusNode(t)}if(i&&n.withGlobal(a||n.global,r.isCollapsed)&&!s){a&&a.focus();try{n.withGlobal(a||n.global,r.moveToBookmark,null,[i])}catch(c){}}}};o.watch("curNode",function(e,t,i){r._curFocus=i;r._prevFocus=t;i&&a.publish("focusNode",i)});o.watch("activeStack",function(e,t,i){r._activeStack=i});o.on("widget-blur",function(e,t){a.publish("widgetBlur",e,t)});o.on("widget-focus",function(e,t){a.publish("widgetFocus",e,t)});i.mixin(r,l);return r})},"dijit/_base/place":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/window","../place","../main"],function(e,t,i,a,n){var o={getViewport:function(){return i.getBox()}};o.placeOnScreen=a.at;o.placeOnScreenAroundElement=function(e,i,n,o){var s;if(t.isArray(n))s=n;else{s=[];for(var r in n)s.push({aroundCorner:r,corner:n[r]})}return a.around(e,i,s,!0,o)};o.placeOnScreenAroundNode=o.placeOnScreenAroundElement;o.placeOnScreenAroundRectangle=o.placeOnScreenAroundElement;o.getPopupAroundAlignment=function(t,i){var a={};e.forEach(t,function(e){var t=i;switch(e){case"after":a[i?"BR":"BL"]=i?"BL":"BR";break;case"before":a[i?"BL":"BR"]=i?"BR":"BL";break;case"below-alt":t=!t;case"below":a[t?"BL":"BR"]=t?"TL":"TR";a[t?"BR":"BL"]=t?"TR":"TL";break;case"above-alt":t=!t;default:a[t?"TL":"TR"]=t?"BL":"BR";a[t?"TR":"TL"]=t?"BR":"BL"}});return a};t.mixin(n,o);return n})},"dijit/_base/popup":function(){define(["dojo/dom-class","dojo/_base/window","../popup","../BackgroundIframe"],function(e,t,i){var a=i._createWrapper;i._createWrapper=function(i){i.declaredClass||(i={_popupWrapper:i.parentNode&&e.contains(i.parentNode,"dijitPopup")?i.parentNode:null,domNode:i,destroy:function(){},ownerDocument:i.ownerDocument,ownerDocumentBody:t.body(i.ownerDocument)});return a.call(this,i)};var n=i.open;i.open=function(e){if(e.orient&&"string"!=typeof e.orient&&!("length"in e.orient)){var t=[];for(var i in e.orient)t.push({aroundCorner:i,corner:e.orient[i]});e.orient=t}return n.call(this,e)};return i})},"dijit/_base/scroll":function(){define(["dojo/window","../main"],function(e,t){t.scrollIntoView=function(t,i){e.scrollIntoView(t,i)}})},"dijit/_base/sniff":function(){define(["dojo/uacss"],function(){})},"dijit/_base/typematic":function(){define(["../typematic"],function(){})},"dijit/typematic":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/lang","dojo/on","dojo/sniff","./main"],function(e,t,i,a,n,o){var s=o.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(this._currentTimeout<0?this._initialDelay:this._subsequentDelay>1?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(i.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(e,t,a,n,o,s,r,l){if(o!=this._obj){this.stop();this._initialDelay=r||500;this._subsequentDelay=s||.9;this._minDelay=l||10;this._obj=o;this._node=a;this._currentTimeout=-1;this._count=-1;this._callback=i.hitch(t,n);this._evt={faux:!0};for(var d in e)if("layerX"!=d&&"layerY"!=d){var c=e[d];"function"!=typeof c&&void 0!==c&&(this._evt[d]=c)}this._fireEventAndReload()}},stop:function(){if(this._timer){clearTimeout(this._timer);this._timer=null}if(this._obj){this._callback(-1,this._node,this._evt);this._obj=null}},addKeyListener:function(n,o,r,l,d,c,u){var h="keyCode"in o?"keydown":"charCode"in o?"keypress":t._keypress,p="keyCode"in o?"keyCode":"charCode"in o?"charCode":"charOrCode",_=[a(n,h,i.hitch(this,function(e){if(e[p]!=o[p]||void 0!==o.ctrlKey&&o.ctrlKey!=e.ctrlKey||void 0!==o.altKey&&o.altKey!=e.altKey||void 0!==o.metaKey&&o.metaKey!=(e.metaKey||!1)||void 0!==o.shiftKey&&o.shiftKey!=e.shiftKey)s._obj==o&&s.stop();else{e.stopPropagation();e.preventDefault();s.trigger(e,r,n,l,o,d,c,u)}})),a(n,"keyup",i.hitch(this,function(){s._obj==o&&s.stop()}))];return{remove:function(){e.forEach(_,function(e){e.remove()})}}},addMouseListener:function(t,o,r,l,d,c){var u=[a(t,"mousedown",i.hitch(this,function(e){e.preventDefault();s.trigger(e,o,t,r,t,l,d,c)})),a(t,"mouseup",i.hitch(this,function(e){this._obj&&e.preventDefault();s.stop()})),a(t,"mouseout",i.hitch(this,function(e){this._obj&&e.preventDefault();s.stop()})),a(t,"dblclick",i.hitch(this,function(e){e.preventDefault();if(n("ie")<9){s.trigger(e,o,t,r,t,l,d,c);setTimeout(i.hitch(this,s.stop),50)}}))];return{remove:function(){e.forEach(u,function(e){e.remove()})}}},addListener:function(t,i,a,n,o,s,r,l){var d=[this.addKeyListener(i,a,n,o,s,r,l),this.addMouseListener(t,n,o,s,r,l)];return{remove:function(){e.forEach(d,function(e){e.remove()})}}}};return s})},"dijit/_base/wai":function(){define(["dojo/dom-attr","dojo/_base/lang","../main","../hccss"],function(e,t,i){var a={hasWaiRole:function(e,t){var i=this.getWaiRole(e);return t?i.indexOf(t)>-1:i.length>0},getWaiRole:function(i){return t.trim((e.get(i,"role")||"").replace("wairole:",""))},setWaiRole:function(t,i){e.set(t,"role",i)},removeWaiRole:function(i,a){var n=e.get(i,"role");if(n)if(a){var o=t.trim((" "+n+" ").replace(" "+a+" "," "));e.set(i,"role",o)}else i.removeAttribute("role")},hasWaiState:function(e,t){return e.hasAttribute?e.hasAttribute("aria-"+t):!!e.getAttribute("aria-"+t)},getWaiState:function(e,t){return e.getAttribute("aria-"+t)||""},setWaiState:function(e,t,i){e.setAttribute("aria-"+t,i)},removeWaiState:function(e,t){e.removeAttribute("aria-"+t)}};t.mixin(i,a);return i})},"dijit/_base/window":function(){define(["dojo/window","../main"],function(e,t){t.getDocumentWindow=function(t){return e.get(t)}})},"dijit/Calendar":function(){define(["dojo/_base/array","dojo/date","dojo/date/locale","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/_base/kernel","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","./CalendarLite","./_Widget","./_CssStateMixin","./_TemplatedMixin","./form/DropDownButton"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m,g){var f=a("dijit.Calendar",[h,p,_],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(e){r.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",e)},_createMonthWidget:function(){return new f._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,onMonthSelect:d.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(c(this.domNode,"keydown",d.hitch(this,"_onKeyDown")),c(this.dateRowsNode,"mouseover",d.hitch(this,"_onDayMouseOver")),c(this.dateRowsNode,"mouseout",d.hitch(this,"_onDayMouseOut")),c(this.dateRowsNode,"mousedown",d.hitch(this,"_onDayMouseDown")),c(this.dateRowsNode,"mouseup",d.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(e){var t=new this.dateClassObj(this.currentFocus);t.setDate(1);t.setMonth(e);var i=this.dateModule.getDaysInMonth(t),a=this.currentFocus.getDate();t.setDate(Math.min(a,i));this._setCurrentFocusAttr(t)},_onDayMouseOver:function(e){var t=o.contains(e.target,"dijitCalendarDateLabel")?e.target.parentNode:e.target;if(t&&(t.dijitDateValue&&!o.contains(t,"dijitCalendarDisabledDate")||t==this.previousYearLabelNode||t==this.nextYearLabelNode)){o.add(t,"dijitCalendarHoveredDate");this._currentNode=t}},_onDayMouseOut:function(e){if(this._currentNode&&(!e.relatedTarget||e.relatedTarget.parentNode!=this._currentNode)){var t="dijitCalendarHoveredDate";o.contains(this._currentNode,"dijitCalendarActiveDate")&&(t+=" dijitCalendarActiveDate");o.remove(this._currentNode,t);this._currentNode=null}},_onDayMouseDown:function(e){var t=e.target.parentNode;if(t&&t.dijitDateValue&&!o.contains(t,"dijitCalendarDisabledDate")){o.add(t,"dijitCalendarActiveDate");this._currentNode=t}},_onDayMouseUp:function(e){var t=e.target.parentNode;t&&t.dijitDateValue&&o.remove(t,"dijitCalendarActiveDate")},handleKey:function(e){var t,i=-1,a=this.currentFocus;switch(e.keyCode){case l.RIGHT_ARROW:i=1;case l.LEFT_ARROW:t="day";this.isLeftToRight()||(i*=-1);break;case l.DOWN_ARROW:i=1;case l.UP_ARROW:t="week";break;case l.PAGE_DOWN:i=1;case l.PAGE_UP:t=e.ctrlKey||e.altKey?"year":"month";break;case l.END:a=this.dateModule.add(a,"month",1);t="day";case l.HOME:(a=new this.dateClassObj(a)).setDate(1);break;default:return!0}t&&(a=this.dateModule.add(a,t,i));this._setCurrentFocusAttr(a);return!1},_onKeyDown:function(e){if(!this.handleKey(e)){e.stopPropagation();e.preventDefault()}},onValueSelected:function(){},onChange:function(e){this.onValueSelected(e)},getClassForDate:function(){}});f._MonthDropDownButton=a("dijit.Calendar._MonthDropDownButton",g,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new f._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(e){var t=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,e);this.dropDown.set("months",t);this.containerNode.innerHTML=(6==u("ie")?"":"<div class='dijitSpacer'>"+this.dropDown.domNode.innerHTML+"</div>")+"<div class='dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'>"+t[e.getMonth()]+"</div>"}});f._MonthDropDown=a("dijit.Calendar._MonthDropDown",[p,m,_],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"<div data-dojo-attach-event='ondijitclick:_onClick'></div>",_setMonthsAttr:function(t){this.domNode.innerHTML="";e.forEach(t,function(e,t){s.create("div",{className:"dijitCalendarMonthLabel",month:t,innerHTML:e},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(e){this.onChange(n.get(e.target,"month"))},onChange:function(){}});return f})},"dojo/date/locale":function(){define(["../_base/lang","../_base/array","../date","../cldr/supplemental","../i18n","../regexp","../string","../i18n!../cldr/nls/gregorian","module"],function(e,t,i,a,n,o,s,r,l){var d={};e.setObject(l.id.replace(/\//g,"."),d);function c(e,t,i,n){return n.replace(/([a-z])\1*/gi,function(o){var r,l,c=o.charAt(0),u=o.length,h=["abbr","wide","narrow"];switch(c){case"G":r=t[u<4?"eraAbbr":"eraNames"][e.getFullYear()<0?0:1];break;case"y":r=e.getFullYear();switch(u){case 1:break;case 2:if(!i.fullYear){r=(r=String(r)).substr(r.length-2);break}default:l=!0}break;case"Q":case"q":r=Math.ceil((e.getMonth()+1)/3);l=!0;break;case"M":case"L":var p=e.getMonth();if(u<3){r=p+1;l=!0}else{var _=["months","L"==c?"standAlone":"format",h[u-3]].join("-");r=t[_][p]}break;case"w":r=d._getWeekOfYear(e,0);l=!0;break;case"d":r=e.getDate();l=!0;break;case"D":r=d._getDayOfYear(e);l=!0;break;case"e":case"c":var m=e.getDay();if(u<2){r=(m-a.getFirstDayOfWeek(i.locale)+8)%7;break}case"E":m=e.getDay();if(u<3){r=m+1;l=!0}else{var g=["days","c"==c?"standAlone":"format",h[u-3]].join("-");r=t[g][m]}break;case"a":var f=e.getHours()<12?"am":"pm";r=i[f]||t["dayPeriods-format-wide-"+f];break;case"h":case"H":case"K":case"k":var b=e.getHours();switch(c){case"h":r=b%12||12;break;case"H":r=b;break;case"K":r=b%12;break;case"k":r=b||24}l=!0;break;case"m":r=e.getMinutes();l=!0;break;case"s":r=e.getSeconds();l=!0;break;case"S":r=Math.round(e.getMilliseconds()*Math.pow(10,u-3));l=!0;break;case"v":case"z":if(r=d._getZone(e,!0,i))break;u=4;case"Z":var y=d._getZone(e,!1,i),v=[y<=0?"+":"-",s.pad(Math.floor(Math.abs(y)/60),2),s.pad(Math.abs(y)%60,2)];if(4==u){v.splice(0,0,"GMT");v.splice(3,0,":")}r=v.join("");break;default:throw new Error("dojo.date.locale.format: invalid pattern char: "+n)}l&&(r=s.pad(r,u));return r})}d._getZone=function(e,t,a){return t?i.getTimezoneName(e):e.getTimezoneOffset()};d.format=function(t,i){i=i||{};var a,o=n.normalizeLocale(i.locale),s=i.formatLength||"short",r=d._getGregorianBundle(o),l=[],h=e.hitch(this,c,t,r,i);if("year"==i.selector)return u(r["dateFormatItem-yyyy"]||"yyyy",h);"date"!=i.selector&&(a=i.timePattern||r["timeFormat-"+s])&&l.push(u(a,h));"time"!=i.selector&&(a=i.datePattern||r["dateFormat-"+s])&&l.push(u(a,h));return 1==l.length?l[0]:r["dateTimeFormat-"+s].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(e,t){return l[t]})};d.regexp=function(e){return d._parseInfo(e).regexp};d._parseInfo=function(t){t=t||{};var i=n.normalizeLocale(t.locale),a=d._getGregorianBundle(i),o=t.formatLength||"short",s=t.datePattern||a["dateFormat-"+o],r=t.timePattern||a["timeFormat-"+o],l=[];return{regexp:u("date"==t.selector?s:"time"==t.selector?r:a["dateTimeFormat-"+o].replace(/\{(\d+)\}/g,function(e,t){return[r,s][t]}),e.hitch(this,p,l,a,t)),tokens:l,bundle:a}};d.parse=function(e,a){var n=/[\u200E\u200F\u202A\u202E]/g,o=d._parseInfo(a),s=o.tokens,r=o.bundle,l=new RegExp("^"+o.regexp.replace(n,"")+"$",o.strict?"":"i").exec(e&&e.replace(n,""));if(!l)return null;var c=["abbr","wide","narrow"],u=[1970,0,1,0,0,0,0],h="",p=t.every(l,function(e,i){if(!i)return!0;var n=s[i-1],o=n.length,l=n.charAt(0);switch(l){case"y":if(2!=o&&a.strict)u[0]=e;else if(e<100){e=Number(e);var d=""+(new Date).getFullYear(),p=100*d.substring(0,2),_=Math.min(Number(d.substring(2,4))+20,99);u[0]=e<_?p+e:p-100+e}else{if(a.strict)return!1;u[0]=e}break;case"M":case"L":if(o>2){var m=r["months-"+("L"==l?"standAlone":"format")+"-"+c[o-3]].concat();if(!a.strict){e=e.replace(".","").toLowerCase();m=t.map(m,function(e){return e.replace(".","").toLowerCase()})}if(-1==(e=t.indexOf(m,e)))return!1}else e--;u[1]=e;break;case"E":case"e":case"c":var g=r["days-"+("c"==l?"standAlone":"format")+"-"+c[o-3]].concat();if(!a.strict){e=e.toLowerCase();g=t.map(g,function(e){return e.toLowerCase()})}if(-1==(e=t.indexOf(g,e)))return!1;break;case"D":u[1]=0;case"d":u[2]=e;break;case"a":var f=a.am||r["dayPeriods-format-wide-am"],b=a.pm||r["dayPeriods-format-wide-pm"];if(!a.strict){var y=/\./g;e=e.replace(y,"").toLowerCase();f=f.replace(y,"").toLowerCase();b=b.replace(y,"").toLowerCase()}if(a.strict&&e!=f&&e!=b)return!1;h=e==b?"p":e==f?"a":"";break;case"K":24==e&&(e=0);case"h":case"H":case"k":if(e>23)return!1;u[3]=e;break;case"m":u[4]=e;break;case"s":u[5]=e;break;case"S":u[6]=e}return!0}),_=+u[3];"p"===h&&_<12?u[3]=_+12:"a"===h&&12==_&&(u[3]=0);var m=new Date(u[0],u[1],u[2],u[3],u[4],u[5],u[6]);a.strict&&m.setFullYear(u[0]);var g=s.join(""),f=-1!=g.indexOf("d"),b=-1!=g.indexOf("M");if(!p||b&&m.getMonth()>u[1]||f&&m.getDate()>u[2])return null;(b&&m.getMonth()<u[1]||f&&m.getDate()<u[2])&&(m=i.add(m,"hour",1));return m};function u(e,i,a,n){var o=function(e){return e};i=i||o;a=a||o;n=n||o;var s=e.match(/(''|[^'])+/g),r="'"==e.charAt(0);t.forEach(s,function(e,t){if(e){s[t]=(r?a:i)(e.replace(/''/g,"'"));r=!r}else s[t]=""});return n(s.join(""))}var h=["abbr","wide","narrow"];function p(e,t,i,a){a=o.escapeString(a);i.strict||(a=a.replace(" a"," ?a"));return a.replace(/([a-z])\1*/gi,function(a){var n,o=a.charAt(0),s=a.length,r="",l="";if(i.strict){s>1&&(r="0{"+(s-1)+"}");s>2&&(l="0{"+(s-2)+"}")}else{r="0?";l="0{0,2}"}switch(o){case"y":n="\\d{2,4}";break;case"M":case"L":if(s>2){n=t["months-"+("L"==o?"standAlone":"format")+"-"+h[s-3]].slice(0).join("|");i.strict||(n="(?:"+(n=n.replace(/\./g,""))+")\\.?")}else n="1[0-2]|"+r+"[1-9]";break;case"D":n="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+r+"[1-9][0-9]|"+l+"[1-9]";break;case"d":n="3[01]|[12]\\d|"+r+"[1-9]";break;case"w":n="[1-4][0-9]|5[0-3]|"+r+"[1-9]";break;case"E":case"e":case"c":n=".+?";break;case"h":n="1[0-2]|"+r+"[1-9]";break;case"k":n="1[01]|"+r+"\\d";break;case"H":n="1\\d|2[0-3]|"+r+"\\d";break;case"K":n="1\\d|2[0-4]|"+r+"[1-9]";break;case"m":case"s":n="[0-5]\\d";break;case"S":n="\\d{"+s+"}";break;case"a":var d=i.am||t["dayPeriods-format-wide-am"],c=i.pm||t["dayPeriods-format-wide-pm"];n=d+"|"+c;if(!i.strict){d!=d.toLowerCase()&&(n+="|"+d.toLowerCase());c!=c.toLowerCase()&&(n+="|"+c.toLowerCase());-1!=n.indexOf(".")&&(n+="|"+n.replace(/\./g,""))}n=n.replace(/\./g,"\\.");break;default:n=".*"}e&&e.push(a);return"("+n+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var _=[],m={};d.addCustomFormats=function(e,t){_.push({pkg:e,name:t});m={}};d._getGregorianBundle=function(i){if(m[i])return m[i];var a={};t.forEach(_,function(t){var o=n.getLocalization(t.pkg,t.name,i);a=e.mixin(a,o)},this);return m[i]=a};d.addCustomFormats(l.id.replace(/\/date\/locale$/,".cldr"),"gregorian");d.getNames=function(e,t,i,a){var n,o=d._getGregorianBundle(a),s=[e,i,t];if("standAlone"==i){1==(n=o[s.join("-")])[0]&&(n=void 0)}s[1]="format";return(n||o[s.join("-")]).concat()};d.isWeekend=function(e,t){var i=a.getWeekend(t),n=(e||new Date).getDay();if(i.end<i.start){i.end+=7;n<i.start&&(n+=7)}return n>=i.start&&n<=i.end};d._getDayOfYear=function(e){return i.difference(new Date(e.getFullYear(),0,1,e.getHours()),e)+1};d._getWeekOfYear=function(e,t){1==arguments.length&&(t=0);var i=new Date(e.getFullYear(),0,1).getDay(),a=(i-t+7)%7,n=Math.floor((d._getDayOfYear(e)+a-1)/7);i==t&&n++;return n};return d})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(e,t){var i={};e.setObject("dojo.cldr.supplemental",i);i.getFirstDayOfWeek=function(e){var t={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,do:0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,in:0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[i._region(e)];return void 0===t?1:t};i._region=function(e){var i=(e=t.normalizeLocale(e)).split("-"),a=i[1];a?4==a.length&&(a=i[2]):a={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us",in:"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de",new:"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[i[0]];return a};i.getWeekend=function(e){var t=i._region(e),a={in:0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[t],n={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[t];void 0===a&&(a=6);void 0===n&&(n=0);return{start:a,end:n}};return i})},"dijit/CalendarLite":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/cldr/supplemental","dojo/date","dojo/date/locale","dojo/date/stamp","dojo/dom","dojo/dom-class","dojo/dom-attr","dojo/_base/lang","dojo/on","dojo/sniff","dojo/string","./_WidgetBase","./_TemplatedMixin","dojo/text!./templates/Calendar.html","./a11yclick","./hccss"],function(e,t,i,a,n,o,s,r,l,d,c,u,h,p,_,m){var g=t("dijit.CalendarLite",[p,_],{templateString:m,dowTemplateString:'<th class="dijitReset dijitCalendarDayLabelTemplate" role="columnheader" scope="col"><span class="dijitCalendarDayLabel">${d}</span></th>',dateTemplateString:'<td class="dijitReset" role="gridcell" data-dojo-attach-point="dateCells"><span class="dijitCalendarDateLabel" data-dojo-attach-point="dateLabels"></span></td>',weekTemplateString:'<tr class="dijitReset dijitCalendarWeekTemplate" role="row">${d}${d}${d}${d}${d}${d}${d}</tr>',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(e){return e&&!isNaN(e)&&"object"==typeof e&&e.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var e=this._get("value");if(e&&!isNaN(e)){var t=new this.dateClassObj(e);t.setHours(0,0,0,0);t.getDate()<e.getDate()&&(t=this.dateModule.add(t,"hour",1));return t}return null},_setValueAttr:function(e,t){"string"==typeof e&&(e=o.fromISOString(e));e=this._patchDate(e);if(this._isValidDate(e)&&!this.isDisabledDate(e,this.lang)){this._set("value",e);this.set("currentFocus",e);this._markSelectedDates([e]);this._created&&(t||void 0===t)&&this.onChange(this.get("value"))}else{this._set("value",null);this._markSelectedDates([])}},_patchDate:function(e){(e||0===e)&&(e=new this.dateClassObj(e)).setHours(1,0,0,0);return e},_setText:function(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(e.ownerDocument.createTextNode(t))},_populateGrid:function(){var t=new this.dateClassObj(this.currentFocus);t.setDate(1);var a=(t=this._patchDate(t)).getDay(),o=this.dateModule.getDaysInMonth(t),s=this.dateModule.getDaysInMonth(this.dateModule.add(t,"month",-1)),r=new this.dateClassObj,d=this.dayOffset>=0?this.dayOffset:i.getFirstDayOfWeek(this.lang);d>a&&(d-=7);if(!this.summary){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,t);this.gridNode.setAttribute("summary",c[t.getMonth()])}this._date2cell={};e.forEach(this.dateCells,function(e,i){var c,u=i+d,h=new this.dateClassObj(t),p="dijitCalendar",_=0;if(u<a){c=s-a+u+1;_=-1;p+="Previous"}else if(u>=a+o){c=u-a-o+1;_=1;p+="Next"}else{c=u-a+1;p+="Current"}_&&(h=this.dateModule.add(h,"month",_));h.setDate(c);this.dateModule.compare(h,r,"date")||(p="dijitCalendarCurrentDate "+p);if(this.isDisabledDate(h,this.lang)){p="dijitCalendarDisabledDate "+p;e.setAttribute("aria-disabled","true")}else{p="dijitCalendarEnabledDate "+p;e.removeAttribute("aria-disabled");e.setAttribute("aria-selected","false")}var m=this.getClassForDate(h,this.lang);m&&(p=m+" "+p);e.className=p+"Month dijitCalendarDateTemplate";var g=h.valueOf();this._date2cell[g]=e;e.dijitDateValue=g;var f=h.getDateLocalized?h.getDateLocalized(this.lang):h.getDate();this._setText(this.dateLabels[i],f);l.set(e,"aria-label",n.format(h,{selector:"date",formatLength:"long"}))},this)},_populateControls:function(){var t=new this.dateClassObj(this.currentFocus);t.setDate(1);this.monthWidget.set("month",t);var i=t.getFullYear()-1,a=new this.dateClassObj;e.forEach(["previous","current","next"],function(e){a.setFullYear(i++);this._setText(this[e+"YearLabelNode"],this.dateLocaleModule.format(a,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(e){this.dateModule=e.datePackage?d.getObject(e.datePackage,!1):a;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=e.datePackage?d.getObject(e.datePackage+".locale",!1):n},_createMonthWidget:function(){return g._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var e=this.dowTemplateString,t=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),a=this.dayOffset>=0?this.dayOffset:i.getFirstDayOfWeek(this.lang);this.dayCellsHtml=h.substitute([e,e,e,e,e,e,e].join(""),{d:""},function(){return t[a++%7]});var n=h.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[n,n,n,n,n,n].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);s.setSelectable(this.domNode,!1);var o=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",o,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var e=d.hitch(this,function(e,t,i){this[e].dojoClick=!0;return c(this[e],"click",d.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,t,i))}))});this.own(e("incrementMonth","month",1),e("decrementMonth","month",-1),e("nextYearLabelNode","year",1),e("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(e,t){var i=this.currentFocus,a=this._getNodeByDate(i);e=this._patchDate(e);this._set("currentFocus",e);if(!this._date2cell||0!=this.dateModule.difference(i,e,"month")){this._populateGrid();this._populateControls();this._markSelectedDates([this.value])}var n=this._getNodeByDate(e);n.setAttribute("tabIndex",this.tabIndex);(this.focused||t)&&n.focus();a&&a!=n&&(u("webkit")?a.setAttribute("tabIndex","-1"):a.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(e){e.stopPropagation();e.preventDefault();for(var t=e.target;t&&!t.dijitDateValue&&0!==t.dijitDateValue;t=t.parentNode);t&&!r.contains(t,"dijitCalendarDisabledDate")&&this.set("value",t.dijitDateValue)},_getNodeByDate:function(e){return(e=this._patchDate(e))&&this._date2cell?this._date2cell[e.valueOf()]:null},_markSelectedDates:function(t){function i(e,t){r.toggle(t,"dijitCalendarSelectedDate",e);t.setAttribute("aria-selected",e?"true":"false")}e.forEach(this._selectedCells||[],d.partial(i,!1));this._selectedCells=e.filter(e.map(t,this._getNodeByDate,this),function(e){return e});e.forEach(this._selectedCells,d.partial(i,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});g._MonthWidget=t("dijit.CalendarLite._MonthWidget",p,{_setMonthAttr:function(t){var i=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,t),a=6==u("ie")?"":"<div class='dijitSpacer'>"+e.map(i,function(e){return"<div>"+e+"</div>"}).join("")+"</div>";this.domNode.innerHTML=a+"<div class='dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'>"+i[t.getMonth()]+"</div>"}});return g})},"ebg/site/page":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.page",ebg.core.mainsitemodule,{constructor:function(){this.currentPage=null;this.editor=null},onLoad:function(t){void 0===t.pageid&&(t.pageid="aide");"premium"==t.pageid&&gotourl("premium");"legal"==t.pageid&&gotourl("legal");if("sponsor"!=t.pageid){this.currentPage=t.pageid;mainsite.setPageTitle($("pagetitle").innerHTML);if(""===t.modify){e.require("dijit.Editor");e.require("dijit._editor.plugins.FontChoice");e.require("dijit._editor.plugins.TextColor");e.require("dijit._editor.plugins.LinkDialog");e.require("dijit._editor.plugins.ViewSource");var i=e.byId("mytexteditor");this.editor=dijit.byId("mytexteditor");this.editor&&this.editor.destroy();this.editor=new dijit.Editor({extraPlugins:["fontSize","fontName","formatBlock","foreColor","createLink","insertImage","viewsource"]},i);this.editor.onLoadDeferred.addCallback(e.hitch(this,function(){this.editor.attr("value",$("pagecontent").innerHTML)}));e.connect($("savemodifications"),"onclick",this,"savemodifications")}}else gotourl("sponsorship")},onOnUnload:function(){},savemodifications:function(e){this.currentPage;e.preventDefault();var t={};t.content=this.editor.attr("value");t.title=$("pagetitle_edit").value;t.alias=$("pagealias_edit").value;""!=$("pageparent_edit").value&&(t.parent=$("pageparent_edit").value);t.weight=$("pageweight_edit").value;t.pageid=this.currentPage;this.ajaxcall("/page/"+this.currentPage+"?save",t,this,function(e){gotourl("page/"+this.currentPage)},function(e){},"post")}})})},"ebg/site/player":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","ebg/board","ebg/chatinput","ebg/thumb","ebg/textdescription","ebg/sendmessage","ebg/pageheader"],function(e,t,i){return t("ebg.site.player",ebg.core.mainsitemodule,{constructor:function(){this.board=null;this.activityboard=null;this.newsfeed=null;this.player_id=null;this.newlang=null;this.textdescription=null;this.stickynote=null;this.pageheader=null;this.cuesList=null;this.eventLogs=null;this.punishCheaters=[];this.reportDlg=null;this.signedToken=null;this.jstpl_reputation_details="<h3>"+_("Reputation")+"</h3><p>"+_("Each player reputation is a Karma (${karmaicon}) number between 0 (very bad) and 100 (excellent)")+"</p><p> &bull; "+_("Playing a game within time limit")+" : +1 </p><p> &bull; "+_("Leaving a game in progress")+" : -10 </p><p> &bull; "+_("Tournament game forfeit")+" : -4 </p><p> &bull; "+_("Leaving a game in progress less than 1 month after a first penalty")+" : -20 </p>"},onLoad:function(t){if("viewprofile"!=t.mode){if(null!==$("pageheader")){0==$("last_seen").innerHTML?$("last_seen").innerHTML=_("Few seconds ago"):$("last_seen").innerHTML=time_ago_format($("last_seen").innerHTML);var i=[{btn:"pageheader_publicinfos",section:"pagesection_publicinfos"},{btn:"pageheader_reputation",section:"pagesection_reputation",onShow:e.hitch(this,"showReputationDetails")},{btn:"pageheader_prestige",section:"pagesection_prestige"},{btn:"pageheader_recent",section:"pagesection_recent"},{btn:"pageheader_lastresults",section:"pagesection_lastresults"},{btn:"pageheader_friends",section:"pagesection_friends",onShow:e.hitch(this,"showFriends")},{btn:"pageheader_groups",section:"pagesection_groups"}];$("pageheader_admininfos")&&i.push({btn:"pageheader_admininfos",section:"pagesection_admininfos"});void 0!==t.section&&t.section;this.pageheader=new ebg.pageheader;this.pageheader.create(this,"pageheader",i,!0);void 0!==t.section&&this.pageheader.showSectionFromButton("pageheader_"+t.section);if(location.hash){let e=document.getElementById(location.hash.substring(1));e&&e.scrollIntoView&&e.scrollIntoView(!0)}if($("player_name")){var a=$("real_player_name").innerHTML;mainsite.setPageTitle(a);this.player_id=$("player_displayed_id").innerHTML}current_player_id!=this.player_id&&e.destroy("update_my_avatar");e.connect($("playertab-activity"),"onclick",this,"onSetBoardActivity");e.connect($("playertab-news"),"onclick",this,"onSetBoardNews");this.player_id==current_player_id?this.onSetBoardNews():this.onSetBoardActivity();if($("player_board")){this.board=new ebg.board;this.board.board_uid="r";this.board.create(this,$("player_board"),"playerresult",this.player_id,!1);e.connect($("jump_to_reputation_details"),"onclick",this,"onJumpToReputationDetails");e.query(".ipdetails").connect("onclick",this,"onIpDetails");e.query(".fpdetails").connect("onclick",this,"onFpDetails");e.query("#sponsorship-details_"+this.player_id).connect("onclick",this,"onSponsorshipDetails");if(void 0!==t.showlang){e.style("langinfos","display","none");e.style("updateLanguages_panel","display","block")}e.query(".ilove_btn").connect("onclick",this,"onLoveGame");e.query(".nolove_btn").connect("onclick",this,"onUnloveGame");this.addTooltipToClass("gamerank",this.format_string(_("${player_name} ELO score at this game"),{player_name:a}),"");this.addTooltipToClass("gamerank_no",this.format_string(_("${player_name} rank at this game"),{player_name:a}),"");this.addTooltipToClass("loveicon",this.format_string(_("${player_name} loves this game"),{player_name:a}),"");this.addTooltipToClass("noloveicon",_("I love this game"),_("Stop loving this game"));this.addTooltipToClass("iloveicon","",_("love this game"));e.query(".trophytooltip").forEach(e.hitch(this,function(e){var t=e.id.substr(14),i=$("trophytooltip_"+t).innerHTML;this.addTooltipHtml("awardimg_"+t,'<div class="trophytooltip_displayed">'+i+"</div>")}));this.playerawardsCollapsedAlignement();e.query(".cancelpenalty").connect("onclick",this,"onCancelPenalty");e.query(".profile-penalty-date").forEach(e.hitch(this,function(e){var t=1e3*+e.getAttribute("data-penalty-timestamp"),i=new Date(t);this.addTooltip(e.id,i.toLocaleString(),"")}));e.connect($("addToFriend"),"onclick",this,"onAddToFriend");e.connect($("inboundFriend"),"onclick",this,"onAddToFriend");e.connect($("outboundFriend"),"onclick",this,"onClickFriendRequestSent");e.connect($("removeFromFriend"),"onclick",this,"onRemoveFromFriend");e.connect($("seefriends"),"onclick",this,"onSeeFriends");e.connect($("clearExpiredFriendRequest"),"onclick",this,"onClearExpiredFriendRequests");const i=e.query(".accept_friend_request");for(var n=0;n<i.length;n++)e.connect(i[n],"onclick",this,"onAcceptFriendRequest");const o=e.query(".decline_friend_request");for(n=0;n<o.length;n++)e.connect(o[n],"onclick",this,"onDeclineFriendRequest");const s=e.query(".cancel_friend_request");for(n=0;n<s.length;n++)e.connect(s[n],"onclick",this,"onCancelFriendRequest");e.connect($("see_more_friends_btn"),"onclick",this,"onSeeMoreFriends");e.connect($("startchat"),"onclick",this,"onStartChat");if($("pagesection_admininfos")){e.connect($("up_grade_btn"),"onclick",this,"onUpGrade");e.connect($("down_grade_btn"),"onclick",this,"onDownGrade");e.connect($("remove_avatar"),"onclick",this,"onRemoveAvatar");e.connect($("remove_presentation"),"onclick",this,"onRemovePresentation");const t=document.getElementById("send-studio-credentials-btn");t&&t.addEventListener("click",()=>this.onSendStudioCredentials(t.dataset.email));e.connect($("give_club_1m"),"onclick",this,()=>this.onGiveFreePremiumToPlayer(1,"1 month"));e.connect($("give_club_3m"),"onclick",this,()=>this.onGiveFreePremiumToPlayer(3,"3 months"));e.connect($("give_club_6m"),"onclick",this,()=>this.onGiveFreePremiumToPlayer(6,"6 months"));e.connect($("give_club_y"),"onclick",this,()=>this.onGiveFreePremiumToPlayer(12,"1 year"));e.connect($("transfer_club"),"onclick",this,"onTransferClub");e.connect($("transfer_club_btn"),"onclick",this,"onTransferClubButton");e.connect($("allow_another_username_change"),"onclick",this,"onAllowUsernameChange");e.connect($("logout_player_account"),"onclick",this,"onLogoutPlayerAccount");e.connect($("ban_player_account"),"onclick",this,"onBanPlayerAccount");e.connect($("remove_player_account"),"onclick",this,"onRemovePlayerAccount");e.connect($("set_email"),"onclick",this,"onSetEmail");e.connect($("set_username"),"onclick",this,"onSetUsername");e.connect($("set_studio_bga_username"),"onclick",this,"onSetStudioBgaUsername");e.connect($("set_account_email_btn"),"onclick",this,"onSetEmailButton");e.connect($("set_account_username_btn"),"onclick",this,"onSetUsernameButton");e.connect($("set_studio_bga_username_btn"),"onclick",this,"onSetStudioBgaUsernameButton");e.connect($("reset_password"),"onclick",this,"onResetPassword");e.connect($("reset_password_btn"),"onclick",this,"onResetPasswordButton");["discord","apple","myasmodee","facebook","google","altered"].forEach(t=>e.connect($("unlink_socials_"+t),"onclick",this,e=>this.onUnlinkSocials(e,t)));e.connect($("set_karma"),"onclick",this,"onSetKarma");e.connect($("set_karma_btn"),"onclick",this,"onSetKarmaButton");e.connect($("set_giftpoints"),"onclick",this,"onSetGiftPoints");e.connect($("set_giftpoints_btn"),"onclick",this,"onSetGiftPointsButton");e.connect($("reactiveaccount"),"onclick",this,"onReactivateAccount");e.connect($("reactiveaccountpayment"),"onclick",this,"onReactivateAccountAfterPayment");e.connect($("restoreelos"),"onclick",this,"onRestoreElos");e.connect($("translatorstatus"),"onclick",this,"onGiveTranslatorStatus");e.connect($("translatorblacklist"),"onclick",this,"onBlacklistTranslator");e.connect($("see_last_chatmessage"),"onclick",this,"onSeeLastMesage");e.connect($("see_last_emails"),"onclick",this,"onSeeLastEmails");e.connect($("see_last_emails_old"),"onclick",this,"onSeeLastEmails");e.connect($("see_payments"),"onclick",this,"onSeePayments");e.connect($("revoke_premium"),"onclick",this,"onRevokePremium");e.connect($("payment_contested"),"onclick",this,"onPaymentContested");e.connect($("see_shopvisit"),"onclick",this,"onSeeShopVisit");e.connect($("reset_elo"),"onclick",this,"onResetElo");e.connect($("reset_arena_points"),"onclick",this,"onResetArenaPoints");e.connect($("unlock_beginner"),"onclick",this,"onUnlockBeginner");e.connect($("remove_ban"),"onclick",this,"onRemoveBan");e.connect($("remove_comments"),"onclick",this,"onRemoveAllPostsAndComments");e.connect($("edit_cues"),"onclick",this,"onEditCues");e.connect($("event_logs"),"onclick",this,"onShowEventLogs")}e.connect($("display_reports"),"onclick",this,function(t){t.preventDefault();e.style("display_reports","display","none");e.style("reports","display","block")});(new ebg.thumb).create(this,"myopinion",this.player_id,toint($("current_player_opinion").innerHTML))}else this.player_id==current_player_id&&gotourl("account");$("initial_player_status").innerHTML;if($("player_name"))if(this.player_id==current_player_id){this.textdescription=new ebg.textdescription;this.textdescription.create(this,"textdescription","player",current_player_id);e.connect(this.textdescription,"onEditText",this,function(){e.style("notextdescription","display","none")})}else{this.stickynote=new ebg.textdescription;this.stickynote.display_mode="inline";this.stickynote.create(this,"stickynote","stickynote",this.player_id);e.connect(this.stickynote,"onEditText",this,function(){e.style("nostickynote","display","none")});this.addTooltip("stickynote_wrap",e.string.substitute(_("A personal note on ${player}, for your eyes only"),{player:a}),"")}this.addTooltipHtml("reputation_details_"+this.player_id,this.format_string(this.jstpl_reputation_details,{karmaicon:""}));this.addTooltipToClass("palmares_details__training_games",_("Additional games played in friendly mode"),"");this.addTooltipToClass("palmares_details__hit_percent",_("Win % is calculated based on the number of players at the tables you won divided by the number of games played"),"");e.query(".editelo").connect("onclick",this,"onEditElo");$("give_special_trophy")&&e.connect($("give_special_trophy"),"onclick",this,function(){e.style("give_special_trophy_wrap","display","block")});e.query(".give_special_trophy_button").connect("onclick",this,"onGiveSpecialTrophy");e.query(".give_specific_right_button").connect("onclick",this,"onGiveSpecificRight");e.query(".revoke_specific_right_button").connect("onclick",this,"onRevokeSpecificRight")}}else gotourl("player?id="+$("player_displayed_id").innerHTML)},adjustProgressBubble:function(){var t=.9*$("profilecompleted-progress-bar").clientWidth-.5*($("profilecompleted-progress-bubble").clientWidth+4);e.query(".profilecompleted-progress-bubble-wrap").style("left",t+"px")},onSetBoardActivity:function(){if($("player_board")){$("newsfeed").style.display="none";$("player_board_activity").style.display="block";e.removeClass("playertab-activity","bga-link bg-bga-gray-211 text-bga-gray-78 bg-bga-gray-244");e.removeClass("playertab-news","bga-link bg-bga-gray-211 text-bga-gray-78 bg-bga-gray-244");e.addClass("playertab-news","bga-link bg-bga-gray-211");e.addClass("playertab-activity","text-bga-gray-78 bg-bga-gray-244");if(null==this.activityboard){this.activityboard=new ebg.board;this.activityboard.bStatusUpdate=!0;this.activityboard.board_uid="a";this.activityboard.create(this,$("player_board_activity"),"player",this.player_id,!1)}}},onSetBoardNews:function(){if($("player_board")){$("newsfeed").style.display="block";$("player_board_activity").style.display="none";e.removeClass("playertab-activity","bga-link bg-bga-gray-211 text-bga-gray-78 bg-bga-gray-244");e.removeClass("playertab-news","bga-link bg-bga-gray-211 text-bga-gray-78 bg-bga-gray-244");e.addClass("playertab-news","text-bga-gray-78 bg-bga-gray-244");e.addClass("playertab-activity","bga-link bg-bga-gray-211");if(null==this.newsfeed){this.newsfeed=new ebg.board;this.newsfeed.per_page=14;this.newsfeed.per_page_after_init=7;this.newsfeed.bStatusUpdate=!0;this.newsfeed.board_uid="f";this.newsfeed.create(this,$("newsfeed"),"player",this.player_id,!0)}}},onOnUnload:function(){this.unsubscribe_all();this.cuesList&&this.cuesList.$destroy();this.eventLogs&&this.eventLogs.$destroy();this.punishCheaters.forEach(e=>{e.$destroy()});if(null!==$("pageheader")){null!==this.textdescription&&this.textdescription.destroy();this.textdescription=null;null!==this.pageheader&&this.pageheader.destroy()}},onEditElo:function(t){var a=t.currentTarget.id.split("_")[1];let n=parseFloat(t.currentTarget.dataset.true_elo),o=parseFloat(t.currentTarget.dataset.true_arena);[int,dec]=o.toFixed(4).toString().split(".");let s=parseInt(int/100),r=parseInt(int%10),l=parseInt(dec)*(int<0?-1:1),d=`\n                $('arena_rating_value_${a}').innerHTML =\n                    ($('arena_league_value_${a}').value * 100) +\n                    $('arena_league_points_value_${a}').value*1 +\n                    ($('arena_elo_value_${a}').value / 1_0000);\n                `;var c,u=`\n                <div id="editelowrap_${a}" style="border: 1px solid red; background-color: #FFE4B5; border-radius: 10px; margin: 20px 0px 10px 0px; padding: 5px;">\n                    <div>\n                        Elo:\n                        <input oninput="${`\n                $('elo_value_display_${a}').innerHTML =\n                    Math.round($('elo_value_${a}').value - 1300)\n                `}" type="number" value="${n}" min="1300.00" max="9999.99" step="0.01" id="elo_value_${a}">\n                        </input><input type="button" id="elosave_${a}" value="ok" />\n                        <span style="color: gray" id="elo_value_display_${a}">${c=n,Math.floor(c-1300)}</span>\n                    </div>\n                    <br>\n                    <div>\n                        Arena:\n                        <input type="button" id="arenasave_${a}" value="ok" />\n                        <span style="color: gray" id="arena_rating_value_${a}">${((e,t,i)=>100*e+t+i/1e4)(s,r,l)}</span>\n                        <br> - league <input oninput="${d}" type="number" min="0" max="5" value="${s}" id="arena_league_value_${a}"></input>\n                        <br> - league points <input oninput="${d}" type="number" min="0" max="9" value="${r}" id="arena_league_points_value_${a}"></input>\n                        <br> - arena elo <input oninput="${d}" type="number" min="1500" max="9999" value="${l}" id="arena_elo_value_${a}"></input>\n                    </div>\n                </div>`;let h=document.getElementById("punishcheatingwrap_"+a);h||(u+=`<div class="mt-2" id="punishcheatingwrap_${a}"></div>`);t.currentTarget;e.place(u,t.currentTarget,"replace");e.connect($("elosave_"+a),"onclick",this,"onSaveElo");e.connect($("arenasave_"+a),"onclick",this,"onSaveArena");h=document.getElementById("punishcheatingwrap_"+a);h.hasChildNodes()||this.punishCheaters.push(new i.ms.admin.BgaPunishRankingCheatingPanel({target:h,props:{gameId:a,playerId:this.player_id}}))},onSaveElo:function(t){var i=t.currentTarget.id.split("_")[1];let a=$("elo_game_"+i),n=a.parentElement,o=a.className.includes("textual"),s=parseFloat($("elo_value_"+i).value);this.ajaxcall("/player/profile/elochange.html",{player:this.player_id,game:i,elo:s},this,function(){this.showMessage("done","info");let t=e.place(this.getEloLabel(s,!1,!0,o),n.id,"replace");t.id=n.id;t.querySelector(".gamerank_value").id="elo_game_"+i;e.place(`<i id="editelo_${i}" data-true_elo="${s}" data-true_arena="${parseFloat($("arena_rating_value_"+i).innerHTML)}" class="fa fa-pencil editelo" aria-hidden="true"></i>`,`editelowrap_${i}`,"replace");e.connect($("editelo_"+i),"onclick",this,"onEditElo")})},onSaveArena:function(t){var i=t.currentTarget.id.split("_")[1],a=parseFloat($("arena_rating_value_"+i).innerHTML);this.ajaxcall("/player/profile/arenapointschange.html",{player:this.player_id,game:i,arenapoints:a},this,function(){this.showMessage("done","info");e.place(`<i id="editelo_${i}" data-true_elo="${$("elo_value_"+i).value}" data-true_arena="${a}" class="fa fa-pencil editelo" aria-hidden="true"></i>`,`editelowrap_${i}`,"replace");e.connect($("editelo_"+i),"onclick",this,"onEditElo")})},onGiveSpecialTrophy:function(t){var i=t.currentTarget.id.split("_")[3];this.confirmationDialog('Do you really want to "'+t.currentTarget.innerHTML+' " to '+$("real_player_name").innerHTML+" ?",e.hitch(this,function(){this.ajaxcall("/award/award/giveSpecial.html",{id:this.player_id,trophy:i},this,function(){this.showMessage("Done","info")},function(e){})}))},onGiveSpecificRight:function(e){this.onModifySpecificRight(e,"give")},onRevokeSpecificRight:function(e){this.onModifySpecificRight(e,"revoke")},onModifySpecificRight:function(t,i){var a=t.currentTarget.getAttribute("data-specific-right-name"),n=t.currentTarget.getAttribute("data-specific-right-argument");this.confirmationDialog(this.format_string("Do you really want to ${target_action} to ${player_name}?",{target_action:t.currentTarget.innerHTML,player_name:$("real_player_name").innerHTML}),e.hitch(this,function(){var e=i+"SpecificRight.html";this.ajaxcall("/community/moderation/"+e,{right_name:a,right_argument:n,id:this.player_id},this,function(){this.showMessage("Done","info");mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onSubmitNewPseudo:function(e){e.preventDefault();this.ajaxcall("/player/profile/newPseudo.html",{form_id:"change_pseudo_form"},this,function(e){0===e.valid?this.showMessage(e.invalidity_reason,"error"):this.showMessage(_("Success"),"info")},function(){},"post")},onLoveGame:function(t){t.preventDefault();var i=t.currentTarget.id.substr(10);this.ajaxcall("/player/profile/loveGame.html",{game_id:i,love:1},this,function(t){e.style($("nolove_btn_"+i),"display","inline");e.style($("ilove_btn_"+i),"display","none")},function(){})},onUnloveGame:function(t){t.preventDefault();var i=t.currentTarget.id.substr(11);this.ajaxcall("/player/profile/loveGame.html",{game_id:i,love:0},this,function(t){e.style($("nolove_btn_"+i),"display","none");e.style($("ilove_btn_"+i),"display","inline")},function(){})},onJumpToReputationDetails:function(e){e.preventDefault();this.showReputationDetails()},showReputationDetails:function(t){e.style("reputation_details_wrap","display","block")},onSaveLanguages:function(e){e.preventDefault()},onWantedGameChange:function(e){for(var t="",i=0;i<3;i++){var a=this.wantedgame[i].getSelection();null!==a&&(t+=a+";")}this.ajaxcall("/player/profile/wantedGames.html",{wantedGames:t},this,function(){},function(e){})},onSeeMoreFriends:function(t){t.preventDefault();e.style($("seemorefriendsholder"),{display:"none"});$("expired_outboundfrienddetails").children.length>0&&e.style($("expiredoutboundholder"),{display:"block"});$("outboundfrienddetails").children.length>0&&e.style($("outboundholder"),{display:"block"})},onCancelPenalty:function(e){e.preventDefault();var t=e.currentTarget.id.substr(8);this.ajaxcall("/admin/admin/cancelpenalty.html",{id:t},this,function(){this.showMessage("Done","info");mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})},onAddToFriend:function(e){e.preventDefault();this.ajaxcall("/community/community/addToFriend.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id);this.showMessage(_("Friend request sent"),"info")},function(e){})},onClickFriendRequestSent:function(e){this.showMessage(_("Friend request already sent and waiting for approval"),"info")},onRemoveFromFriend:function(t){t.preventDefault();this.confirmationDialog(_("Are you sure you want to remove this player as a friend?"),e.hitch(this,function(){this.ajaxcall("/community/community/removeFromFriend.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onClearExpiredFriendRequests:function(t){t.preventDefault();this.confirmationDialog(_("Are you sure you want to clear all expired friend requests?"),e.hitch(this,function(){this.ajaxcall("/community/community/clearExpiredFriendRequests.html",{},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id+"&section=friends")},function(e){})},function(e){}))},onAcceptFriendRequest:function(e){e.preventDefault();const t=e.currentTarget.getAttribute("data-friend-request-id");this.ajaxcall("/community/community/acceptFriendRequest.html",{id:t},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id+"&section=friends")},function(e){})},onDeclineFriendRequest:function(e){e.preventDefault();const t=e.currentTarget.getAttribute("data-friend-request-id");this.ajaxcall("/community/community/declineFriendRequest.html",{id:t},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id+"&section=friends")},function(e){})},onCancelFriendRequest:function(e){e.preventDefault();const t=e.currentTarget.getAttribute("data-friend-request-id");this.ajaxcall("/community/community/cancelFriendRequest.html",{id:t},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id+"&section=friends")},function(e){})},onSeeFriends:function(e){e.preventDefault();this.showFriends()},showFriends:function(){e.style($("mutfrienddetails"),"display","block");e.style($("seefriends_wrap"),"display","none")},onStartChat:function(e){e.preventDefault();mainsite.createChatBarWindow({type:"privatechat",id:this.player_id,label:$("real_player_name").innerHTML,url:"/player?id="+this.player_id,channel:"/player/p"+this.player_id,window_id:"privatechat_"+this.player_id,avatar:$("avatar_hash").innerHTML,subscribe:!1,start:"expanded"},!1);mainsite.expandChatWindow("privatechat_"+this.player_id);mainsite.ackUnreadMessage("privatechat_"+this.player_id);mainsite.loadPreviousMessage("privatechat",this.player_id)},onUpGrade:function(t){t.preventDefault();this.confirmationDialog("Do you really want to UPGRADE this player?",e.hitch(this,function(){this.ajaxcall("/community/moderation/upGrade.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onDownGrade:function(t){t.preventDefault();this.confirmationDialog("Do you really want to DOWNGRADE this player?",e.hitch(this,function(){this.ajaxcall("/community/moderation/downGrade.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onRemoveAvatar:function(t){t.preventDefault();this.confirmationDialog("Do you really want to remove this player avatar?",e.hitch(this,function(){this.ajaxcall("/community/moderation/removeAvatar.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onRemovePresentation:function(t){t.preventDefault();this.confirmationDialog('Do you really want to remove this player "about me" text?',e.hitch(this,function(){this.ajaxcall("/community/moderation/removePresentation.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onRevokePremium:function(t){t.preventDefault();this.confirmationDialog("Do you really want to revoke this player's FREE premium?",e.hitch(this,function(){this.ajaxcall("/community/moderation/revokePremium.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onGiveFreePremiumToPlayer:function(e,t){this.confirmationDialog(`Do you really want to GIVE ${t} Premium to this player ?`,()=>this.ajaxcall("/community/moderation/giveFreePremiumToPlayer.html",{id:this.player_id,months:e},this,()=>mainsite.gotourl_forcereload("player?id="+this.player_id),()=>{}))},onTransferClub:function(t){t.preventDefault();e.style("transfer_club_form","display","block")},onTransferClubButton:function(e){this.ajaxcall("/community/moderation/transferClub.html",{from:this.player_id,to:$("transfer_club_name").value},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})},onSendStudioCredentials:function(e){this.ajaxcall("/account/account/welcomeemail.html",{email:e},this,()=>this.showMessage("Mail sent!","info"),()=>{})},onAllowUsernameChange:function(t){e.stopEvent(t);this.ajaxcall("/community/moderation/allowUsernameChange.html",{from:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})},onLogoutPlayerAccount:function(t){t.preventDefault();this.confirmationDialog("Do you really want to log this player out on all devices? The player will be logged out immediately.",e.hitch(this,function(){this.ajaxcall("/community/moderation/logoutAccount.html",{id:this.player_id},this,function(){this.showMessage("Done!","info")},function(e){})}))},onBanPlayerAccount:function(e){e.preventDefault();i.bgaReadText({title:"Ban player account",description:'Do you really want to <b class="red">ban</b> this player account?<br/>\n                    <br/>\n                    NOTE:<br/>\n                    - This will remove them from any Premium subscription<br/>\n                    - This will reset all their ELO and Arena rating<br/>\n                    <br/>\n                    If you wish to attach a moderation report for this ban, enter a message below:',isDescriptionHtml:!0,value:"Please note that creating multiple accounts to avoid moderation penalties, to play for ELO, or to collect Gift Points is against our Terms of Service.",yesButton:"BAN ACCOUNT"}).then(e=>{!1!==e&&this.ajaxcall("/community/moderation/banAccount.html",{id:this.player_id,report:e},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})})},onRemovePlayerAccount:function(e){e.preventDefault();i.bgaReadText({title:"Remove player account",description:'Do you really want to <b class="red">delete</b> this player account ?<br/><br/>- This will <b>not</b> unsubscribe them from Premium subscriptions so please make sure there is none!<br/>- An email will be sent to the user, indicating <span class="italic">"As per your request, your account has been deleted"</span><br/><br/>Please enter the user ID to confirm the action:',isDescriptionHtml:!0,yesButton:"REMOVE ACCOUNT"}).then(e=>{!1!==e&&(e==this.player_id?this.ajaxcall("/community/moderation/deleteAccount.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){}):this.showMessage("Invalid player ID","error"))})},onSetEmail:function(t){t.preventDefault();e.style("set_email_account_form","display","block")},onSetEmailButton:function(e){this.ajaxcall("/community/moderation/setAccountEmail.html",{player:this.player_id,email:$("set_account_email").value},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id);this.showMessage("A confirmation email has been sent to player with a confirmation link => he/she needs to click on it to change his/her email","info")},function(e){})},onSetUsername:function(t){t.preventDefault();e.style("set_username_account_form","display","block")},onSetUsernameButton:function(e){this.ajaxcall("/community/moderation/setAccountUsername.html",{player:this.player_id,username:$("set_account_username").value},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id);this.showMessage("Username has been changed","info")},function(e){})},onSetStudioBgaUsername:function(t){t.preventDefault();e.style("set_studio_bga_username_form","display","block")},onSetStudioBgaUsernameButton:function(e){this.ajaxcall("/community/moderation/setStudioBgaUsername.html",{player:this.player_id,bga_username:$("set_studio_bga_username_value").value},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id+"&section=admininfos");this.showMessage("Studio BGA username has been changed","info")},function(e){})},onResetPassword:function(t){t.preventDefault();e.style("reset_password_form","display","block")},onResetPasswordButton:function(e){this.ajaxcall("/community/moderation/resetPassword.html",{player:this.player_id,email:$("reset_password_name").value},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})},onUnlinkSocials:function(t,i){e.stopEvent(t);this.confirmationDialog(`This will unlink this player's social media account for <b>${i}</b> and send them a password reset link. Do you confirm?`,e.hitch(this,function(){this.ajaxcall("/community/moderation/unlinkSocial.html",{player:this.player_id,provider:i},this,function(e){mainsite.gotourl_forcereload("player?id="+this.player_id+"&section=admininfos")},function(e){})}))},onSetKarma:function(t){t.preventDefault();e.style("set_karma_form","display","block")},onSetKarmaButton:function(e){this.ajaxcall("/community/moderation/setKarma.html",{player:this.player_id,karma:$("set_karma_value").value},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})},onSetGiftPoints:function(t){t.preventDefault();e.style("set_giftpoints_form","display","block")},onSetGiftPointsButton:function(e){this.ajaxcall("/community/moderation/setGiftPoints.html",{player:this.player_id,giftpoints:$("set_giftpoints_value").value},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})},onResetElo:function(t){e.stopEvent(t);this.confirmationDialog("ALL this player ELO rank will be reset to 0. Action is impossible to cancel. Do you confirm?",e.hitch(this,function(){this.ajaxcall("/community/moderation/resetElo.html",{id:this.player_id},this,function(e){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onResetArenaPoints:function(t){e.stopEvent(t);this.confirmationDialog("ALL this player Arena points will be reset to 0. Action is impossible to cancel. Do you confirm?",e.hitch(this,function(){this.ajaxcall("/community/moderation/resetArenaPoints.html",{id:this.player_id},this,function(e){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onUnlockBeginner:function(t){e.stopEvent(t);this.confirmationDialog("This will give 3 games played, ELO 100 and registration is moved 24h before",e.hitch(this,function(){this.ajaxcall("/community/moderation/unlockBeginner.html",{id:this.player_id},this,function(e){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onRemoveBan:function(t){e.stopEvent(t);this.confirmationDialog("This player will be allowed again to access BGA and to chat + Karma reset to 80",e.hitch(this,function(){this.ajaxcall("/community/moderation/removeBan.html",{id:this.player_id},this,function(e){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onRemoveAllPostsAndComments:function(t){e.stopEvent(t);this.ajaxcall("/community/moderation/countAllPostsAndComments.html",{id:this.player_id},this,function(t){+t.numComments+ +t.numPosts==0?this.infoDialog("This player has no comments or posts.","Info"):this.confirmationDialog("This will remove ALL of this player's comments and posts. This will delete:<br> - "+t.numComments+" comment(s)<br> - "+t.numPosts+" post(s)<br>This is irreversible. Are you sure?",e.hitch(this,function(){this.ajaxcall("/community/moderation/removeAllPostsAndComments.html",{id:this.player_id},this,function(t){this.infoDialog(t.numComments+" comment(s) and "+t.numPosts+" post(s) were deleted.","Done",e.hitch(this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)}))},function(e){})}))},function(e){})},onEditCues:function(e){if(this.cuesList){this.cuesList.$destroy();this.cuesList=null}else{var t=document.getElementById("edit_cues_list");this.cuesList=new i.ms.admin.BgaPlayerCuesList({target:t,props:{playerId:this.player_id}})}},onShowEventLogs:function(e){if(this.eventLogs){this.eventLogs.$destroy();this.eventLogs=null}else{var t=document.getElementById("event_logs_display");this.eventLogs=new i.ms.admin.BgaPlayerEventLogs({target:t,props:{playerId:this.player_id}})}},onIpDetails:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-id"),i=$(e.currentTarget.id),a=i.innerHTML;let n=$("ipdetails_output_"+t);n?""==n.innerText?this.ajaxcall("/community/moderation/ipdetails.html",{ip:a},this,function(e){n.innerHTML='<td colspan="4" class="text-sm">'+e+"</td>"},function(e){}):n.classList.toggle("hidden"):this.ajaxcall("/community/moderation/ipdetails.html",{ip:a},this,function(e){let t=$("ipdetail_header_div");if(!t){t=i.parentNode.appendChild(document.createElement("div"));t.setAttribute("id","ipdetail_header_div")}t.innerHTML=e},function(e){})},onFpDetails:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-fp");let i=$("fpdetails_output_"+t);""==i.innerText?this.ajaxcall("/community/moderation/fpdetails.html",{fp:t},this,function(e){i.innerHTML='<td colspan="3" class="text-sm">'+e+"</td>"},function(e){}):i.classList.toggle("hidden")},onSponsorshipDetails:function(e){e.preventDefault();e.target.nextElementSibling.style.display="block"},onSeePayments:function(t){t.preventDefault();e.place('<img alt="loading" src="'+getStaticAssetUrl("img/logo/waiting.gif")+'"/>',"payments_list");this.ajaxcall("/admin/tool/getPaymentsAssociatedToPlayer.html",{id:this.player_id},this,function(t){e.place("<div>"+t+"</div>","payments_list","only")},function(e){})},onPaymentContested:function(t){t.preventDefault();this.confirmationDialog("Do you confirm that this user contest a payment though its bank without asking the support about it? His/her account will be suspended immediately. (Click confirm and accept the dispute in Stripe)",e.hitch(this,function(){this.ajaxcall("/admin/tool/paymentContested.html",{id:this.player_id},this,function(e){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onSeeShopVisit:function(t){t.preventDefault();e.place('<img alt="loading" src="'+getStaticAssetUrl("img/logo/waiting.gif")+'"/>',"payments_list");this.ajaxcall("/admin/tool/getShopVisit.html",{id:this.player_id},this,function(t){e.place("<div>"+t+"</div>","payments_list","only")},function(e){})},onSeeLastEmails:function(t){t.preventDefault();var i=0;"see_last_emails_old"==t.currentTarget.id&&(i=1);e.place('<img alt="loading" src="'+getStaticAssetUrl("img/logo/waiting.gif")+'"/>',"last_emails");this.ajaxcall("/community/moderation/lastEmailsSent.html",{id:this.player_id,withOld:i},this,function(t){e.place("<div>"+t+"</div>","last_emails","only");e.query(".seeemail").connect("onclick",this,"onSeeEmailDetail")},function(e){})},onSeeEmailDetail:function(t){t.preventDefault();var i=t.currentTarget.innerHTML.substr(0,t.currentTarget.innerHTML.indexOf("["));e.place('<img alt="loading" src="'+getStaticAssetUrl("img/logo/waiting.gif")+'"/>',t.currentTarget);var a=t.currentTarget;this.ajaxcall("/community/moderation/seeEmailSent.html",{id:this.player_id,date:i},this,function(t){e.place("<div><br/><br/><hr/><br/><br/>"+t+"<br/><br/><hr/><br/><br/></div>",a,"replace")},function(e){})},onSeeLastMesage:function(t){t.preventDefault();e.place('<img alt="loading" src="'+getStaticAssetUrl("img/logo/waiting.gif")+'"/>',"last_chatmessage");e.style("see_last_chatmessage","display","none");this.ajaxcall("/community/moderation/lastChatmessage.html",{id:this.player_id},this,function(e){$("last_chatmessage").innerHTML=e},function(e){})},onReactivateAccount:function(e){e.preventDefault();this.ajaxcall("/community/moderation/reactivateAccount.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})},onReactivateAccountAfterPayment:function(e){e.preventDefault();this.ajaxcall("/community/moderation/reactivePaymentContester.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})},onRestoreElos:function(t){t.preventDefault();this.confirmationDialog("Do you really want to restore ELO of this player for ALL games to their more recent known values?",e.hitch(this,function(){this.ajaxcall("/community/moderation/restorePlayerElos.html",{id:this.player_id},this,function(){this.showMessage("done","info")},function(e){})}))},onGiveTranslatorStatus:function(t){t.preventDefault();this.confirmationDialog("Do you really want to give translator status to "+$("real_player_name").innerHTML+" ?",e.hitch(this,function(){this.ajaxcall("/community/moderation/giveTranslatorStatus.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))},onBlacklistTranslator:function(t){t.preventDefault();this.confirmationDialog("Do you really want to blacklist from translation this user: "+$("real_player_name").innerHTML+" ?",e.hitch(this,function(){this.ajaxcall("/community/moderation/blacklistTranslator.html",{id:this.player_id},this,function(){mainsite.gotourl_forcereload("player?id="+this.player_id)},function(e){})}))}})})},"ebg/sendmessage":function(){define(["dojo","dojo/_base/declare"],function(e,t){return t("ebg.sendmessage",null,{constructor:function(){this.page=null;this.dlg=null;this.recipient_type=null;this.recipient_id=null},create:function(t,i,a,n){this.page=t;this.recipient_type=a;this.recipient_id=n;$("sendMessageContent")&&e.destroy("sendMessageContent");this.dlg=new dijit.Dialog({title:e.string.substitute(__("lang_mainsite",i),{})});var o='<div id="sendMessageContent">';o+="<p>"+_("Subject")+":<br/>";o+='<input id="msgSubject" size="50"></input></p><br/>';o+="<p>"+_("Message")+":<br/>";o+='<textarea id="msgContent" class="private_msg_textarea"></textarea>';o+="</p><br/>";o+='<a id="sendMessage_cancel" class="button"><span>'+_("Cancel")+"</span></a>";o+='<a id="sendMessage_send" class="button" style="float:right"><span>'+_("Send")+"</span></a>";o+="</div>";this.dlg.attr("content",o);this.dlg.show();e.connect($("sendMessage_cancel"),"onclick",this,"onCancel");e.connect($("sendMessage_send"),"onclick",this,"onSend")},destroy:function(){},onCancel:function(t){e.stopEvent(t);this.dlg.hide();e.destroy("sendMessageContent")},onSend:function(t){e.stopEvent(t);var i=$("msgSubject").value,a=$("msgContent").value;this.dlg.hide();this.page.ajaxcall("/message/text/sendprivate.html",{subject:i,txt:a,rctp_type:this.recipient_type,rctp_id:this.recipient_id},this,function(e){this.page.showMessage(_("Message sent!"),"info")})}})})},"ebg/site/playernotif":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule","ebg/site/playernotif","ebg/board","ebg/popindialog"],function(e,t){return t("ebg.site.playernotif",ebg.core.mainsitemodule,{constructor:function(){this.board=null;this.player_id=null;this.dialogboard=null;this.displayNewsDlg=null;this.popindialog=null},onLoad:function(t){var i=$("player_name").innerHTML;mainsite.setPageTitle(i);this.board=new ebg.board;this.board.bSocialButtons=!1;e.connect(this.board,"onNewPosts",this,"onNewPlayerNotifs");this.board.create(this,$("notif_board"),"playernotif",current_player_id,!1)},onOnUnload:function(){},onNewPlayerNotifs:function(){e.query(".board .displayNews").attr("href","#").connect("onclick",this,"onDisplayNews").removeClass("displayNews")},onDisplayNews:function(t){t.preventDefault();var i=t.currentTarget.getAttribute("data-news-id");$("displayNewsContent")&&e.destroy("displayNewsContent");this.popindialog=new ebg.popindialog;this.popindialog.create("news_content","main-content");this.popindialog.setTitle("&nbsp;");0;0;this.popindialog.setContent('<div id="displayNewsContent"><div id="board_displayNews"></div></div>');this.dialogboard=new ebg.board;this.dialogboard.board_uid="d";this.dialogboard.bSeeMore=!1;this.dialogboard.onNewPosts=e.hitch(this,function(){this.popindialog.show()});this.dialogboard.create(this,$("board_displayNews"),"uniquenews",i,!1)}})})},"ebg/site/playerstat":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule","ebg/board","dojox/charting/Chart2D","dojox/charting/themes/Wetland","ebg/pageheader"],function(e,t){return t("ebg.site.playerstat",ebg.core.mainsitemodule,{constructor:function(){this.board=null;this.player_id=null;this.player_name=null;this.game_name_displayed=null;this.game_id=null;this.chart=null},onLoad:function(t){void 0!==t.section&&t.section;this.pageheader=new ebg.pageheader;this.pageheader.create(this,"pageheader",[{btn:"pageheader_rankevolution",section:"pagesection_rankevolution"},{btn:"pageheader_profile",section:"pagesection_profile"},{btn:"pageheader_lastresults",section:"pagesection_lastresults"}],!0);this.player_name=$("player_name").innerHTML;this.game_name_displayed=$("game_name_displayed").innerHTML;this.game_id=$("game_id").innerHTML;mainsite.setPageTitle(this.player_name+": "+this.game_name_displayed);this.player_id=$("player_displayed_id").innerHTML;if($("graph_example")){e.style($("chartwait"),"display","none");e.style($("chart"),"display","none")}else{this.chart=new dojox.charting.Chart2D("chart");this.ajaxcall("/playerstat/playerstat/getrankevol.html",{player:this.player_id,game:this.game_id},this,"displayChart")}this.addTooltipToClass("statmasked",_("You must be a Premium member to see statistics"),"");this.board=new ebg.board;this.board.create(this,$("player_board"),"lastresult",this.game_id,!1,this.player_id);this.addTooltip("unreal-games-played",_("Training mode, alpha games and games against an AI"),"")},onOnUnload:function(){null!==this.pageheader&&this.pageheader.destroy()},displayChart:function(t){hideY=t.hide_y;t=t.rank_evolution;for(var i in t.values)t.values[i].y=Math.max(0,t.values[i].y-1300);e.style($("chartwait"),"display","none");this.chart.addPlot("default",{type:"Areas"}).addPlot("Grid",{type:"Grid",hAxis:"x",vAxis:"y",hMajorLines:!0,hMinorLines:!1,vMajorLines:!0,vMinorLines:!1}).addAxis("x",{fixLower:"major",fixUpper:"major",labels:t.labels}).addAxis("y",{vertical:!0,fixLower:"major",fixUpper:"major",majorLabels:!hideY}).setTheme(dojox.charting.themes.Wetland).addSeries("Series A",t.values,{stroke:"red",fill:"lightblue"}).render()}})})},"ebg/site/preferences":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","ebg/pageheader"],function(e,t,i){return t("ebg.site.preferences",ebg.core.mainsitemodule,{constructor:function(){this.newlang=null;this.googleApiLoaded=!1;this.jtpl_citychoice="<input type='radio' name='cityChoice' id='cityChoiceLink_${id}' class='cityChoiceLink' ${checked}>${description}</input><br/>";this.locationDialog=null;this.cityChoiceResult=null;this.langchoice=null;this.avatarSelectHandle=null;this.args},onLoad:function(t){this.args=t;if(!$("pagesection_publicinfos")){gotourl("account");return}e.query(".pagesection_account__social-provider").style("display","none");let a=document.querySelector("#pagesection_account__linked-services"),n=[];try{n=!!a.dataset.sources&&JSON.parse(a.dataset.sources)}catch(h){n=!1}this.identityProvidersListComponent=new i.ms.preferences.BgaPreferencesIdentityProvidersList({target:a,props:{identityProviders:n||window.globalUserInfos?.login_sources||[],isReadOnly:n}});mainsite.setPageTitle(_("Preferences"));var o=[{btn:"pageheader_playing",section:"pagesection_playing"},{btn:"pageheader_publicinfos",section:"pagesection_publicinfos"},{btn:"pageheader_avatar",section:"pagesection_avatar"},{btn:"pageheader_lang",section:"pagesection_lang"},{btn:"pageheader_sound",section:"pagesection_sound"},{btn:"pageheader_email",section:"pagesection_email"},{btn:"pageheader_notifications",section:"pagesection_notifications"},{btn:"pageheader_account",section:"pagesection_account"},{btn:"pageheader_advanced",section:"pagesection_advanced"}],s="playing";void 0!==t.section&&(s=t.section);for(var r in o)o[r].btn=="pageheader_"+s&&(o[r].defaults=!0);this.pageheader=new ebg.pageheader;this.pageheader.create(this,"pageheader",o,!1);e.connect(this.pageheader,"onSectionChanged",this,"onSectionChanged");e.query(".removelang").connect("onclick",this,"onRemoveLang");e.query(".switchlevel").connect("onclick",this,"onSwitchLangLevel");let l=document.querySelector(".birthdate-value").value.split("-");this.birthDayComponent=new i.ms.player.BgaPlayerBirthDaySelector({target:document.querySelector(".birthdate-wrapper"),props:{birthDate:document.querySelector(".birthdate-value").value?new Date(l[0],l[1]-1,l[2],12,0,0):null}});e.connect($("change_emblem_submit"),"onclick",this,"onSubmitNewEmblem");e.connect($("do_not_display_premium"),"onchange",this,"onChangeDisplayPremium");e.connect($("upload_my_own_avatar"),"onclick",this,"onUploadMyOwnAvatar");e.connect($("newemblem"),"onchange",this,"onSubmitNewEmblem");this.langchoice=new dijit.form.Select({id:"langchoice",name:"langchoice"},"langchoice");e.connect(this.langchoice,"onChange",this,"onChangeLanguage");this.newlang=new dijit.form.Select({id:"newlanguage",name:"newlanguage"},"newlanguage");e.connect(this.newlang,"onChange",this,"onAddLanguage");e.connect($("updateProfileInfos_save"),"onclick",this,"onSaveProfileInfos");e.connect($("updateAsyncInfos_save"),"onclick",this,"onSaveAsyncInfos");e.connect($("profileinfos"),"onsubmit",this,"onSaveProfileInfos");e.style("changesound_list","display","none");if(soundManager.html5){soundManager.useOgg?$("currentSoundMode").innerHTML=__("lang_mainsite","HTML5 audio (Ogg Vorbis)"):$("currentSoundMode").innerHTML=__("lang_mainsite","HTML5 audio (Mp3)");soundManager.initOk?e.style("changesound_list","display","block"):$("currentSoundMode").innerHTML+=" ("+__("lang_mainsite","failed to set up!")+")"}else $("currentSoundMode").innerHTML=__("lang_mainsite","Failed to set up sound");e.query(".soundEvent").connect("onchange",this,"onChangeSoundEvent");e.query(".testsound").connect("onclick",this,"onTestSound");e.connect($("reset_sounds"),"onclick",this,"onResetSounds");e.connect($("newstranslation1"),"onclick",this,"onNewstranslation");e.connect($("newstranslation0"),"onclick",this,"onNoNewstranslation");if("Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window)e.connect($("pageheader_notifications"),"onclick",this,function(t){$("notifications1").checked&&this.setupWebPush().then(e.hitch(this,function(e){mainsite.gotourl_forcereload("preferences?section=notifications")}),e.hitch(this,function(e){console.error(e);this.showMessage(__("lang_mainsite","We haven't been able to setup notifications on this browser! Did you confirm authorization when prompted by the browser?"),"error")}))});else{e.style("notifications_notsupported","display","");e.style("notifications_prefs","display","none");e.style("notifications_subscriptions","display","none");e.style("notifications_activate","display","none")}e.connect($("notifications1"),"onclick",this,"onEnableNotifications");e.connect($("notifications0"),"onclick",this,"onDisableNotifications");this.connectClass("notifications_test","onclick","onSendTestNotification");this.connectClass("notifications_editlabel","onclick","onEditLabelNotification");e.connect($("rtnotifs1"),"onclick",this,"onYourTurnRTNotifications");e.connect($("rtnotifs0"),"onclick",this,"onNoYourTurnRTNotifications");e.connect($("tbnotifs1"),"onclick",this,"onYourTurnTBNotifications");e.connect($("tbnotifs0"),"onclick",this,"onNoYourTurnTBNotifications");e.connect($("tbnotifs2"),"onclick",this,"onH4YourTurnTBNotifications");e.connect($("tbnotifs3"),"onclick",this,"onH24YourTurnTBNotifications");e.connect($("tablenotifs1"),"onclick",this,"onTableNotifications");e.connect($("tablenotifs0"),"onclick",this,"onNoTableNotifications");e.connect($("joinnotifs1"),"onclick",this,"onJoinNotifications");e.connect($("joinnotifs0"),"onclick",this,"onNoJoinNotifications");e.connect($("newsnotifs1"),"onclick",this,"onNewsNotifications");e.connect($("newsnotifs0"),"onclick",this,"onNoNewsNotifications");e.connect($("stickynotifs1"),"onclick",this,"onStickyNotifications");e.connect($("stickynotifs0"),"onclick",this,"onNoStickyNotifications");e.connect($("receiveInvitationEmail0"),"onclick",this,"onNoInvitationEmail");e.connect($("receiveInvitationEmail1"),"onclick",this,"onInvitationEmail");e.connect($("receiveChatWhileOfflineEmail0"),"onclick",this,"onNoChatWhileOfflineEmail");e.connect($("receiveChatWhileOfflineEmail1"),"onclick",this,"onChatWhileOfflineEmail");e.connect($("receiveBugSuggestionEmail0"),"onclick",this,"onNoBugSuggestionEmail");e.connect($("receiveBugSuggestionEmail1"),"onclick",this,"onBugSuggestionEmail");e.connect($("receiveGiftPointsEmail0"),"onclick",this,"onNoGiftPointsEmail");e.connect($("receiveGiftPointsEmail1"),"onclick",this,"onGiftPointsEmail");e.connect($("receiveTournamentStartsEmail0"),"onclick",this,"onNoTournamentStartsEmail");e.connect($("receiveTournamentStartsEmail1"),"onclick",this,"onTournamentStartsEmail");e.connect($("newsletter1"),"onclick",this,"onNewsletter");e.connect($("newsletter0"),"onclick",this,"onNoNewsletter");e.connect($("newsletter_more_infos_btn"),"onclick",this,function(){e.style("newsletter_more_infos_btn","display","none");e.style("newsletter_more_infos","display","block")});e.connect($("banners1"),"onclick",this,"onBanners");e.connect($("banners0"),"onclick",this,"onNoBanners");e.connect($("personalised1"),"onclick",this,"onPersonalisedContent");e.connect($("personalised0"),"onclick",this,"onNoPersonalisedContent");e.query(".social_account_unlink").connect("onclick",this,"onSocialUnlink");$("social_account_stay_connected")&&e.connect($("social_account_stay_connected"),"onclick",this,"onRememberMe");$("cancel_stripe_subscription")&&e.connect($("cancel_stripe_subscription"),"onclick",this,"onCancelSubscription");$("cancel_stripe_subscription_trial")&&e.connect($("cancel_stripe_subscription_trial"),"onclick",this,"onCancelSubscription");e.connect($("delete_bga_account"),"onclick",this,"onDeleteBgaAccount");e.connect($("delete_account_confirm"),"onclick",this,"onDeleteBgaAccountConfirm");e.connect($("lostpassword_btn"),"onclick",this,"onLostPassword");e.connect($("testemail_btn"),"onclick",this,"onTestEmail");e.connect($("logout_all_devices_btn"),"onclick",this,"onLogoutPlayerAccount");e.connect($("changeusername_btn"),"onclick",this,"onChangeUsername");e.connect($("changeusername_confirm"),"onclick",this,"onChangeUsernameConfirm");e.query(".refund_player").connect("onclick",this,"onRefundPlayer");e.connect($("changeemail_btn"),"onclick",this,"onChangeEmail");e.connect($("changeemail_submit_btn"),"onclick",this,"onChangeEmailSubmit");void 0!==t.email&&this.showMessage(_("Your email address has been updated"),"info");e.connect($("display_email_errors"),"onclick",this,"onDisplayEmailErrors");e.connect($("custom_css_save"),"onclick",this,"onCustomCss");var d=document.createElement("script");d.type="text/javascript";var c=dojoConfig.locale.substr(0,2);d.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCqQrHQteHU0LgsT-npSaP-pRfdMW8Kzlw&sensor=false&callback=initGoogleApi&language="+c;initGoogleApi=e.hitch(this,function(){this.googleApiLoaded=!0});e.connect($("see_all_invoices"),"onclick",this,function(t){e.stopEvent(t);e.query(".premiumpass_invoice").style("display","block");e.style("see_all_invoices","display","none")});$("async_myturn").value=$("async_myturn_value").innerHTML;$("async_report").value=$("async_report_value").innerHTML;$("async_warning").value=$("async_warning_value").innerHTML;$("async_endofgame").value=$("async_endofgame_value").innerHTML;$("colorssupportedgames")&&e.connect($("colorssupportedgames"),"onclick",this,"onShowGamesSupportingColors");e.query(".colorselector").connect("onchange",this,"onColorSelectorChange");if($("reduced_motion_select")){e.query("#reduced_motion_select").connect("onchange",this,"onReducedMotionSelectChange");var u;i.stores.userPrefs.subscribe(e=>{u=e})();$("reduced_motion_select").value=u.hasReducedMotion?1:0}document.body.appendChild(d);this.evtScroll=e.connect(window,"onscroll",this,"checkNeedMoreAvatars");this.evtResize=e.connect(window,"onresize",this,"checkNeedMoreAvatars");this.onSectionChanged();this.ajaxcall("/player/profile/checkProfileCompleted.html",{},this,function(){});null!==$("today_displayed")&&($("today_displayed").innerHTML=date_format(Date.now()/1e3,!1,!0,!0));$("iso_dateformat")&&e.connect($("iso_dateformat"),"onclick",this,"onSwitchIsoDateFormat")},onSwitchIsoDateFormat:function(){var e=$("iso_dateformat").checked?1:0;this.ajaxcall("/player/profile/setIsoDatePreference.html",{value:e},this,function(){this.showMessage(__("lang_mainsite","Date format change in progress... Please note that it may takes up to one hour to apply this change to the whole site."),"info");$("iso_dateformat").checked?globalUserInfos.date_use_iso=!0:globalUserInfos.date_use_iso=!1;null!==$("today_displayed")&&($("today_displayed").innerHTML=date_format(Date.now()/1e3,!1,!0))})},onSectionChanged:function(){if(e.hasClass("pageheader_avatar","pageheader_menuitemselected")){this.loadMoreDefaultAvatar();e.disconnect(this.avatarSelectHandle);this.avatarSelectHandle=e.connect($("default_avatar_list"),"onclick",this,function(e){var t=e.target.closest("[data-avatar-id]");if(t){var a=t.getAttribute("data-avatar-id");this.ajaxcall("/player/profile/newDefaultEmblem.html",{id:a},this,function(){mainsite.gotourl_forcereload("preferences?section=avatar");i.stores.userInfos.load()})}})}},loadMoreDefaultAvatar:function(){isNaN(this.defaultAvatarPage)&&(this.defaultAvatarPage=current_player_id);this.defaultAvatarPage++;this.bLoadModeAvatarsInProgress=!0;this.ajaxcall("/preferences/preferences/getDefaultsAvatar.html",{page:this.defaultAvatarPage},this,e.hitch(function(t){var i="";t.defaults.forEach(function(e){i+='<div class="default_avatar" data-avatar-id="'+e.id+'">';i+='<img class="bgavatar bgavatar_92" src="'+e.url+'"></img>';i+="</div>"});e.place(i,"default_avatar_list");this.bLoadModeAvatarsInProgress=!1}))},checkNeedMoreAvatars:function(){if($("pageheader_avatar")&&e.hasClass("pageheader_avatar","pageheader_menuitemselected")){if(this.bLoadModeAvatarsInProgress)return;var t=e.window.getBox(),i=e.position("tag_display_more_avatars");i.y>0&&i.y<t.h&&this.loadMoreDefaultAvatar()}},onRefundPlayer:function(t){let i=function(e,t,i){mainsite.gotourl_forcereload("preferences?section=account"+t);if(!0===e.success)if(0==e.nb_months_to_refund){analyticsPush({ecommerce:null});analyticsPush({event:"refund",ecommerce:{transaction_id:e.transaction_id,payment_type:e.payment_type}})}else{analyticsPush({ecommerce:null});analyticsPush({event:"refund",ecommerce:{transaction_id:e.transaction_id,payment_type:e.payment_type,currency:e.currency,value:e.value}})}else i.showMessage("WARNING: "+e+": you must in addition proceed to the manual refund of the payment","error")};e.stopEvent(t);var a=t.currentTarget.id.substr(14);this.askForValueDialog("How many months would you like to refund?",e.hitch(this,function(t){var n=0;""!=t&&(n=tofloat(t));this.ajaxcall("/premium/premium/refundPlayer.html",{id:a,nb_month:n},this,e.hitch(function(e){var t=this.args.as?"&as="+this.args.as:"";i(e,t,this)}),function(t){t&&this.confirmationDialog('<p class="text-bga-link-red font-bold">There as been an error refunding the user.</p><p>You can confirm to try to force the refund, but be careful, it could cause an issue! (IE: The payment could show as refunded on our side and not be.)</p><p>Please make sure that there is indeed a refund on paypal before confirming.</p>',e.hitch(this,function(){this.ajaxcall("/premium/premium/refundPlayer.html",{id:a,nb_month:n,forceRefund:!0},this,function(e){var t=this.args.as?"&as="+this.args.as:"";i(e,t,this)},function(e){})}))})}),"Leave blank to refund everything.")},onDisplayEmailErrors:function(t){e.stopEvent(t);this.ajaxcall("/account/account/emailerror.html",{},this,function(t){null===t?e.place("<br/>Sorry, we did not sent you any emails recently and cannot display error message. You should use `Send me a test email` button. Note: if you just sent a test email, please retry in 10-15mn.","display_email_errors","replace"):e.place('<br/>Received from your email service provider (timezone is Western Europe - CET/CEST):<br/><pre style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;">'+t+"</pre><p> Note: if you just sent a test email, please retry in 10-15mn.</p>","display_email_errors","replace")})},onColorSelectorChange:function(t){var i=t.currentTarget.id.substr(14);""!=t.currentTarget.value?e.style(t.currentTarget,"backgroundColor","#"+t.currentTarget.value):e.style(t.currentTarget,"backgroundColor","#ddd");this.ajaxcall("/player/profile/favoriteColor.html",{id:i,color:t.currentTarget.value},this,function(e){})},onReducedMotionSelectChange:function(e){var t=1==e.currentTarget.value;i.stores.userPrefs.toggleReducedMotion(t)},onRememberMe:function(t){e.stopEvent(t);this.confirmationDialog(_("Do you want to always stay connected when using this web browser?"),e.hitch(this,function(){this.ajaxcall("/account/account/rememberMe.html",{},this,function(t){localStorage.removeItem("stay_connected_"+current_player_id);e.style("social_account_stay_connected","display","none");this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})}))},onSocialUnlink:function(t){t.preventDefault();var i=_("If you proceed:");i+='<ul style="padding-left: 30px; margin: 10px 0px 10px 0px;"><li style="list-style-type: disc;">'+_("your account will be disassociated from your social network ID")+"</li>";if("altered_social_account_unlink"!=t.target.id){i+='<li style="list-style-type: disc;">'+_("you will get an email enabling you to reset your BGA account password.")+"</li></ul>";null!==$("youremail")&&(i+='<span style="color: red;">'+_('Important: please make sure that your current email address "${email}" is valid before proceeding, otherwise you will lose access to your account!').replace("${email}",$("youremail").innerHTML)+"</span>")}this.confirmationDialog(i,e.hitch(this,function(){"facebook_social_account_unlink"==t.target.id&&"undefined"!=typeof FB&&FB.login(e.hitch(this,function(t){if("connected"===t.status){this.signedToken=t.authResponse.signedRequest;FB.api("/me/permissions","delete",e.hitch(this,function(e){e.success?this.doSocialUnlink(e,"facebook"):this.showMessage(_("Something went wrong: social network authorizations could not be revoked.")+" "+_("Please make sure that you are connected with the social media account you subscribed with."),"error")}))}else this.showMessage(_("Not connected."),"info")}),!0);if("google_social_account_unlink"==t.target.id&&"undefined"!=typeof google&&void 0!==google.accounts&&void 0!==google.accounts.id){if(null===$("google_social_media_id")){this.showMessage(_("Something went wrong: social network authorizations could not be revoked.")+" "+_("Please make sure that you are connected with the social media account you subscribed with."),"error");return}console.error("Google login authorization, revoke for ID: "+$("google_social_media_id").value);google.accounts.id.initialize({client_id:bgaConfig.googleAppId});google.accounts.id.revoke($("google_social_media_id").value,e=>{if(e.successful)this.doSocialUnlink($("google_social_media_id").value,"google");else{e.error;this.showMessage(_("Something went wrong: social network authorizations could not be revoked.")+" "+_("Please make sure that you are connected with the social media account you subscribed with."),"error")}})}"altered_social_account_unlink"==t.target.id&&this.ajaxcall("/account/oauth2/disconnectAccount.html",{provider:"altered"},this,function(e){if(e.success){this.showMessage(_("Your account has been unlinked from Altered"),"info");setTimeout(function(){window.location.reload()},5e3)}else this.showMessage(_("Something went wrong: social network authorizations could not be revoked.")+" "+_("Please make sure that you are connected with the social media account you subscribed with."),"info")},function(e){e&&this.showMessage(_("Something went wrong: social network authorizations could not be revoked.")+" "+_("Please make sure that you are connected with the social media account you subscribed with."),"error")})}))},doSocialUnlink:function(e,t){this.ajaxcall("/account/oauth2/disconnectAccount.html",{provider:t},this,function(e){if(e.success){this.showMessage(_("Your account has been unlinked from your social network ID"),"info");$("connected_with_social_media")&&($("connected_with_social_media").innerHTML="");mainsite.gotourl("/");mainsite.onLogout(new Event("onclick",$("social_account_unlink")))}else this.showMessage(e.reason,"error")},function(e){},"post")},onOnUnload:function(){if(null!==this.newlang&&void 0!==this.newlang){this.newlang.destroy();this.newlang=null}if(null!==this.langchoice&&void 0!==this.langchoice){this.langchoice.destroy();this.langchoice=null}null!==this.pageheader&&void 0!==this.pageheader&&this.pageheader.destroy();this.birthDayComponent&&this.birthDayComponent.$destroy();this.identityProvidersListComponent&&this.identityProvidersListComponent?.$destroy()},onSaveProfileInfos:function(t){t.preventDefault();var i=$("city").value,a=$("country").value;if(""!=i)if(this.googleApiLoaded){geocoder=new google.maps.Geocoder;geocoder.geocode({address:i,language:dojoConfig.locale.substr(0,2),region:a},e.hitch(this,function(t,i){if(i==google.maps.GeocoderStatus.OK){this.cityChoiceResult=t;$("locationDialog_content")&&e.destroy("locationDialog_content");this.locationDialog=new ebg.popindialog;this.locationDialog.create("locationDialog");this.locationDialog.setTitle(_("Please confirm your city"));this.locationDialog.setMaxWidth(500);var a="<div id='locationDialog_content'>";for(var n in t){var o=t[n],s=getLocationDescriptionFromResult(o);a+=e.string.substitute(this.jtpl_citychoice,{id:n,description:s,checked:0==toint(n)?"checked='checked'":""})}a+="<br/><div style='text-align:center'><a id='validCityChoice' class='bgabutton bgabutton_blue'><span>"+_("Ok")+"</span></a></div>";a+="</div>";this.locationDialog.setContent(a);this.locationDialog.show();e.connect($("validCityChoice"),"onclick",this,"onCityChoiceConfirm")}else i==google.maps.GeocoderStatus.ZERO_RESULTS?this.showMessage(_("Sorry, we couldn't find your city"),"error"):this.showMessage("Google Maps error: "+i,"error")}))}else this.showMessage(_("Failed to load Google Maps"),"error");else{document.querySelector(".birthdate-value").value=this.birthDayComponent.textBirthDate;this.ajaxcall("/player/profile/updateProfile.html",{form_id:"profileinfos"},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info");mainsite.gotourl_forcereload("preferences?section=publicinfos")},function(e){},"post")}},onSaveAsyncInfos:function(t){e.stopEvent(t);var i={myturn:$("async_myturn").value,report:$("async_report").value,warning:$("async_warning").value,endofgame:$("async_endofgame").value};this.ajaxcall("/player/profile/changeAsyncPrefs.html",i,this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info");mainsite.gotourl_forcereload("preferences?section=playing")},function(e){})},sanitiseCityName:function(e){return e.replace(/[^0-9a-zA-Z_ ,'-]/g,"")},onCityChoiceConfirm:function(t){e.stopEvent(t);var i=0;e.query(".cityChoiceLink").forEach(function(e){e.checked&&(i=e.id.substr(15))});var a=this.cityChoiceResult[i],n=parseFloat(a.geometry.location.lat()),o=parseFloat(a.geometry.location.lng());$("lon").value=o;$("lat").value=n;var s=analyseLocationDescriptionFromResult(a);$("loc_city").value=s.city;$("loc_area1").value=s.area1;$("loc_area2").value=s.area2;$("loc_country").value=s.country;""!=s.country&&($("country").value=s.country);""!=s.city&&($("city").value=this.sanitiseCityName(s.city+($("city").value.indexOf(",")>0?$("city").value.substring($("city").value.indexOf(",")):"")));this.locationDialog.destroy();document.querySelector(".birthdate-value").value=this.birthDayComponent.textBirthDate;this.ajaxcall("/player/profile/updateProfile.html",{form_id:"profileinfos"},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info");mainsite.gotourl_forcereload("player")},function(e){},"post")},onChangeLanguage:function(e){this.ajaxcall("/player/profile/changeLanguage.html",{target_lang:e},this,function(){this.showMessage(__("lang_mainsite","Language change in progress... Please note that it may takes up to one hour to apply this change to all your existing games."),"info");$("websitebaseurl").innerHTML;setTimeout(function(){document.location.reload()},6e3)},function(e){})},onAddLanguage:function(e){this.ajaxcall("/player/profile/addLanguage.html",{target_lang:e},this,function(){window.location="/preferences?section=lang"},function(e){})},onRemoveLang:function(e){e.preventDefault();var t=e.currentTarget.id.substr(11);this.ajaxcall("/player/profile/removeLanguage.html",{target_lang:t},this,function(){window.location="/preferences?section=lang"},function(e){})},onSwitchLangLevel:function(e){e.preventDefault();var t=e.currentTarget.id.substr(12);this.ajaxcall("/player/profile/switchLanguageLevel.html",{target_lang:t},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info");mainsite.gotourl_forcereload("preferences?section=lang")},function(e){})},onChangeSoundEvent:function(t){var i=t.currentTarget.id.substr(11),a=t.currentTarget.value;a=a.split("_");newsound=a[0];a.shift();a=a.join("_");this.ajaxcall("/player/profile/changeSound.html",{event:i,sound:newsound},this,function(){soundManager.bMuteSound||0==soundManager.volume?e.hasClass("ebd-body","mobile_version")?this.showMessage(__("lang_mainsite","Your sound is currently muted. Use your device volume buttons to unmute it."),"error"):this.showMessage(__("lang_mainsite","Your sound is currently muted. Click on the speaker icon to unmute it."),"error"):playSoundFile(a)},function(e){})},onTestSound:function(t){t.preventDefault();if(soundManager.bMuteSound||0==soundManager.volume)e.hasClass("ebd-body","mobile_version")?this.showMessage(__("lang_mainsite","Your sound is currently muted. Use your device volume buttons to unmute it."),"error"):this.showMessage(__("lang_mainsite","Your sound is currently muted. Click on the speaker icon to unmute it."),"error");else{var i=t.currentTarget.id.substr(10),a=$("soundEvent_"+i).value;(a=a.split("_")).shift();a=a.join("_");playSoundFile(a)}},onResetSounds:function(t){t.preventDefault();this.confirmationDialog(_("All your customized sounds will be reseted to defaults. Are you sure?"),e.hitch(this,function(){this.ajaxcall("/player/profile/resetSounds.html",{},this,function(){window.location.reload()})}))},onDeleteBgaAccount:function(t){t.preventDefault();this.confirmationDialog(_("This operation is definitive and cannot be cancelled. Are you really sure?"),function(){e.style($("delete_bga_account_wrap"),"display","block");e.style($("delete_bga_account"),"display","none")})},onDeleteBgaAccountConfirm:function(e){e.preventDefault();var t=$("delete_account_password").value;this.ajaxcall("/player/profile/deleteAccount.html",{password:t},this,function(){this.showMessage(__("lang_mainsite","Your account has been removed"),"info");window.location.reload()},function(e){})},onEnableNotifications:function(t){this.setupWebPush().then(e.hitch(this,this.onNotificationsEnabled)).then(e.hitch(this,function(e){mainsite.gotourl_forcereload("preferences?section=notifications")}),e.hitch(this,function(e){console.error(e);this.showMessage(__("lang_mainsite","We haven't been able to setup notifications! Did you confirm authorization when prompted by the browser?"),"error");$("notifications0").checked=1}))},onNotificationsEnabled:function(){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"webNotifications",value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info");e.style("notifications_prefs","display","");e.style("notifications_subscriptions","display","")})},onDisableNotifications:function(t){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"webNotifications",value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info");e.style("notifications_prefs","display","none");e.style("notifications_subscriptions","display","none")})},onSendTestNotification:function(e){e.preventDefault();var t=e.currentTarget.id.split("_")[2];this.ajaxcall("/player/profile/sendTestNotification.html",{bs_id:t},this,function(){this.showMessage(__("lang_mainsite","A test notification has been sent!"),"info");window.setTimeout(function(){mainsite.gotourl_forcereload("preferences?section=notifications")},3e3)})},onEditLabelNotification:function(t){t.preventDefault();var i=t.currentTarget.id.split("_")[2];if($("notifications_subscriptionlabel_"+i).readOnly){$("notifications_subscriptionlabel_"+i).readOnly=!1;e.style("notifications_subscriptionlabel_"+i,"text-align","left");$("notifications_editlabel_"+i).innerHTML=_("Save label");e.style("notifications_test_"+i,"display","none")}else{var a=$("notifications_subscriptionlabel_"+i).value;this.ajaxcall("/player/profile/updatePushSubscriptionLabel.html",{bs_id:i,bs_label:a},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info");$("notifications_subscriptionlabel_"+i).readOnly=!0;e.style("notifications_subscriptionlabel_"+i,"text-align","right");$("notifications_editlabel_"+i).innerHTML=_("Edit label");e.style("notifications_test_"+i,"display","")})}},onYourTurnRTNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"yourTurnRTNotifications",value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoYourTurnRTNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"yourTurnRTNotifications",value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onYourTurnTBNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"yourTurnTBNotifications",value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoYourTurnTBNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"yourTurnTBNotifications",value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onH4YourTurnTBNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"yourTurnTBNotifications",value:2},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onH24YourTurnTBNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"yourTurnTBNotifications",value:3},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onTableNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"tableNotifications",value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoTableNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"tableNotifications",value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onJoinNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"joinNotifications",value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoJoinNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"joinNotifications",value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNewsNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"bgaNewsNotifications",value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoNewsNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"bgaNewsNotifications",value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onStickyNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"stickyNotifications",value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoStickyNotifications:function(e){this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"stickyNotifications",value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNewstranslation:function(e){this.ajaxcall("/player/profile/newstranslation.html",{value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoNewstranslation:function(e){this.ajaxcall("/player/profile/newstranslation.html",{value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onInvitationEmail:function(e){this.ajaxcall("/player/profile/setInvitationEmail.html",{value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoInvitationEmail:function(e){this.ajaxcall("/player/profile/setInvitationEmail.html",{value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onChatWhileOfflineEmail:function(e){this.ajaxcall("/player/profile/setChatWhileOfflineEmail.html",{value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoChatWhileOfflineEmail:function(e){this.ajaxcall("/player/profile/setChatWhileOfflineEmail.html",{value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onBugSuggestionEmail:function(e){this.ajaxcall("/player/profile/setBugSuggestionEmail.html",{value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoBugSuggestionEmail:function(e){this.ajaxcall("/player/profile/setBugSuggestionEmail.html",{value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onGiftPointsEmail:function(e){this.ajaxcall("/player/profile/setGiftPointsEmail.html",{value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoGiftPointsEmail:function(e){this.ajaxcall("/player/profile/setGiftPointsEmail.html",{value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onTournamentStartsEmail:function(e){this.ajaxcall("/player/profile/setTournamentStartsEmail.html",{value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoTournamentStartsEmail:function(e){this.ajaxcall("/player/profile/setTournamentStartsEmail.html",{value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNewsletter:function(e){this.ajaxcall("/player/profile/newsletter.html",{value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoNewsletter:function(e){this.ajaxcall("/player/profile/newsletter.html",{value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onBanners:function(e){this.ajaxcall("/player/profile/banners.html",{value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoBanners:function(e){this.ajaxcall("/player/profile/banners.html",{value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onPersonalisedContent:function(e){this.ajaxcall("/player/profile/setPersonalisedContentPreference.html",{value:1},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onNoPersonalisedContent:function(e){this.ajaxcall("/player/profile/setPersonalisedContentPreference.html",{value:0},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info")})},onLostPassword:function(t){e.stopEvent(t);var i=$("lostpassword_email").value;""!=i&&this.ajaxcall("/account/passwordretrieval/sendEmail.html",{username:i},this,function(e){e.success?this.showMessage(_("If we have an account with that email, we have sent it a message. Please check your mailbox (and SPAM folder)."),"info"):this.showMessage(e.message||_("Unknown email"),"error")})},onLogoutPlayerAccount:function(t){t.preventDefault();this.confirmationDialog(_("Do you really want to log out of your account on all devices?")+"<br />"+_("You will be logged out immediately from this device; however, it could take up to %s minutes to log you out from all other devices.").replace("%s",40),e.hitch(this,function(){this.ajaxcall("/community/moderation/logoutAccount.html",{id:current_player_id},this,function(){mainsite.onLogout(t)},function(e){})}))},onChangeUsername:function(t){e.stopEvent(t);this.ajaxcall("/account/account/changeUsernameCheck.html",{},this,function(t){"ok"==t&&this.confirmationDialog(_("We allow only ONE username change per account. Cancelling this action is IMPOSSIBLE.")+" "+_("Are you sure you want to continue?"),e.hitch(this,function(){e.style("changeusername_btn","display","none");e.style("changeusername_wrap","display","block")}))})},onChangeUsernameConfirm:function(t){e.stopEvent(t);$("changeusername_password").value;var i=$("changeusername_username").value;this.confirmationDialog(e.string.substitute(_("Your username will be '${username}' forever. This action cannot be cancelled."),{username:i}),e.hitch(this,"doChangeUsername"))},doChangeUsername:function(){var t=$("changeusername_password").value,i=$("changeusername_username").value;this.ajaxcall("/account/account/changeUsername.html",{username:i,password:t},this,e.hitch(this,function(e){if("ok"==e){this.showMessage(__("lang_mainsite","Your username has been changed"),"info");window.location.reload()}else"takeover"==e&&this.takeOverUsername()}),function(e){})},takeOverUsername:function(){$("changeusername_password").value;var t=$("changeusername_username").value;this.confirmationDialog(e.string.substitute(_("The '${username}' is already taken, BUT the ${username} account seems inactive. If you really want this username, we are going to ask ${username} account owner if he/she wants to keep this username, and if not we will attribute this username to you in 15 days. Do you want to continue?"),{username:t}),e.hitch(this,"doChangeUsernameTakeOver"))},doChangeUsernameTakeOver:function(){var t=$("changeusername_password").value,i=$("changeusername_username").value;this.ajaxcall("/account/account/changeUsername.html",{username:i,password:t,takeover:1},this,e.hitch(this,function(t){if("ok"==t){this.showMessage(__("lang_mainsite","Your username request has been recorded. Your username will change in 15 days if the current owner agree with it."),"info");e.style("changeusername_wrap","display","none");e.style("changeusername_btn","display","inline-block")}}),function(e){})},onTestEmail:function(t){e.stopEvent(t);this.ajaxcall("/account/account/testemail.html",{},this,function(e){this.showMessage(_("An email has been sent to you. Please check your mailbox."),"info");mainsite.gotourl_forcereload("preferences?section=email")})},onChangeEmail:function(t){e.stopEvent(t);e.style("changeemail_btn","display","none");e.style("changeemail_form","display","block")},onChangeEmailSubmit:function(t){e.stopEvent(t);var i=$("changeemail_email").value,a=$("changeemail_password").value;this.ajaxcall("/account/account/changeemail.html",{email:i,password:a},this,function(e){this.showMessage(_("An email has been sent to your new email. Please check your mailbox."),"info");gotourl("welcome")})},onUploadMyOwnAvatar:function(t){e.stopEvent(t);if(0==$("can_upload_avatar").innerHTML)this.showMessage(e.string.substitute(_("Sorry, you need to play at least ${nbr} games to unlock this feature. In the meantime please choose an avatar below."),{nbr:20}),"error");else{e.style("upload_my_own_avatar","display","none");e.style("change_emblem_form","display","block")}},onSubmitNewEmblem:function(e){e.preventDefault();this.ajaxcall("/player/profile/newEmblem.html",{form_id:"change_emblem_form"},this,function(e){if(0===e.valid)this.showMessage(e.invalidity_reason,"error");else{this.showMessage(_("New avatar loaded !"),"info");mainsite.gotourl_forcereload("preferences?section=avatar");i.stores.userInfos.load()}},function(){},"iframe")},onChangeDisplayPremium:function(t){var i=$("do_not_display_premium").checked;this.ajaxcall("/player/profile/doNotDisplayPremium.html",{value:i},this,function(t){i?e.addClass("ebd-body","dontdisplaycm"):e.removeClass("ebd-body","dontdisplaycm")})},onCustomCss:function(e){e.preventDefault();this.ajaxcall("/player/profile/updateCustomCss.html",{form_id:"custom_css_form"},this,function(){this.showMessage(__("lang_mainsite","Profile informations updated !"),"info");location.reload()},function(e){},"post")},onShowGamesSupportingColors:function(t){t.preventDefault();this.ajaxcall("/gamelist/gamelist/gamessupportingcolors.html",{},this,function(t){$("gamecolorsupport_content")&&e.destroy("gamecolorsupport_content");this.gamecolorsupportDialog=new ebg.popindialog;this.gamecolorsupportDialog.create("locationDialog");this.gamecolorsupportDialog.setTitle(_("Games supporting favorite colors"));this.gamecolorsupportDialog.setMaxWidth(500);var i="<div id='gamecolorsupport_content' class='smalltext'>",a=!0;for(var n in t.items){a||(i+=", ");a=!1;i+=t.items[n]}i+="<br class='clear'/><div><a id='closeGameSupportingColors' class='bgabutton bgabutton_blue'><span>"+_("Ok")+"</span></a></div>";i+="</div>";this.gamecolorsupportDialog.setContent(i);this.gamecolorsupportDialog.show();e.connect($("closeGameSupportingColors"),"onclick",this,function(){this.gamecolorsupportDialog.destroy()})})},onCancelSubscription:function(t){e.stopEvent(t);"cancel_stripe_subscription_trial"==t.currentTarget.id?this.confirmationDialog(_("If you end your Premium trial, your account will imediately be downgraded to Standard. The automatic membership renewal for your account will be cancelled, and you will not be charged."),e.hitch(this,function(){var e=$("cancel_subscription_user"),t={};e&&e.value&&(t.playerId=e.value);this.ajaxcall("/premium/premium/cancelSubscription.html",t,this,function(e){mainsite.gotourl_forcereload("premium?src=cancelsub");this.showMessage(_("Done! The automatic membership renewal has been removed, and your account is not Premium anymore."),"info")})})):this.confirmationDialog(_("Your account will remains Premium until the end of the current period, then there will be no automatic renewal."),e.hitch(this,function(){var e=$("cancel_subscription_user"),t={};e&&e.value&&(t.playerId=e.value);this.ajaxcall("/premium/premium/cancelSubscription.html",t,this,function(e){mainsite.gotourl_forcereload("premium?src=cancelsub");this.showMessage(_("Done! The automatic membership renewal has been removed. Your account will be downgraded to Standard at the end of the current period."),"info")})}))}})})},"ebg/site/premium":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule"],function(e,t,i){return t("ebg.site.premium",ebg.core.mainsitemodule,{constructor:function(){},doesNeedServerSideLoad:function(){return!1},onLoad:function(e){mainsite.setPageTitle(_("Go Premium!"),_("Premium"));const t=new URLSearchParams(window.location.search);let a=[],n=t.get("offer"),o=t.get("status");if(o){a.status=o;const e=new URL(window.location.href);e.searchParams.delete("status");window.history.replaceState({},document.title,e.toString())}if(null!=n)this.premiumPageComponent=new i.ms.premium.BgaGiftCodePage({target:document.querySelector("#main-content"),props:a});else{let e=t.get("country");e&&(a.country=e);document.documentElement.classList.add("bga-white-background");this.premiumPageComponent=new i.ms.premium.BgaPremiumPage({target:document.querySelector("#main-content"),props:a})}var s="";e.src&&(s=e.src);analyticsPush({cta_location:s,event:"premium_access"})},onOnUnload:function(){if(this.premiumPageComponent){document.documentElement.classList.remove("bga-white-background");this.premiumPageComponent.$destroy()}}})})},"ebg/site/prestige":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.prestige",ebg.core.mainsitemodule,{constructor:function(){this.lastRankDisplayed=1;this.jstpl_prestigerank='<div class="player_in_list player_in_list_l player_in_list_withbaseline player_in_list_fullwidth player_in_list_rank">                    <div class="rank">${RANK}</div>                    <div class="emblemwrap emblemwrap_l ${premium}">                        <img class="pl_avatar emblem" src="${avatar}"/>                        <div class="emblempremium"></div>                    </div>                    <a href="/player?id=${ID}" class="playername">${NAME}</a>                    <div class="player_baseline"><div class="bga-flag" data-country="${COUNTRY_CODE}" id="flag_${ID}" title="${COUNTRY_NAME}"></div></div>                    <div class="ranking"><a href="/achievements?id=${ID}"><div class="xp_container">${PRESTIGE} XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div></a></div>                </div>'},onLoad:function(e){gotourl("leaderboard")},onOnUnload:function(){},onPrestigeSeeMore:function(e){e.preventDefault();this.showMorePlayers()},showMorePlayers:function(){e.style("loading","display","block");this.ajaxcall("/prestige/prestige/seeMorePrestige.html",{start:this.lastRankDisplayed},this,function(t){e.style("loading","display","none");for(var i in t){var a=t[i];a.avatar=getPlayerAvatar(a.id,a.avatar,50);a.rank=this.getRankString(a.rank);e.place(e.string.substitute(this.jstpl_prestigerank,{PRESTIGE:Intl.NumberFormat(dojoConfig.locale.replace(/_/,"-"),{notation:"compact",maximumSignificantDigits:3}).format(a.prestige),RANK:a.rank,COUNTRY_CODE:a.country.code,COUNTRY_NAME:a.country.name,NAME:a.name,premium:a.is_premium,avatar:a.avatar,ID:a.id}),"prestige_more_players");this.lastRankDisplayed++}})}})})},"ebg/site/report":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule"],function(e,t,i){return t("ebg.site.report",ebg.core.mainsitemodule,{constructor:function(){},doesNeedServerSideLoad:function(){return!1},onLoad:function(e){this.reportPanel=new i.ms.moderation.BgaReportPanel({target:document.querySelector("#main-content"),props:{reportId:e.id,playerId:e.player}})},onOnUnload:function(){this.reportPanel&&this.reportPanel.$destroy()}})})},"ebg/site/shopsupport":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.shopsupport",ebg.core.mainsitemodule,{constructor:function(){},onLoad:function(e){},onOnUnload:function(){},onShopSupportSubmit:function(t){e.stopEvent(t);e.style("ordersubmiterror","display","none");this.showMessage(_("Please wait, we are interrogating the shop..."),"info");this.ajaxcall("/shopsupport/shopsupport/submitorder.html",{form_id:"shopsupport_request"},this,function(t){$("order_id").value="";if("notfound"==t)e.style("ordersubmiterror","display","block");else if("notenough"==t)e.style("ordernotenough","display","block");else if("waiting"==t)e.style("ordersubmitwaiting","display","block");else{this.showMessage(e.string.substitute(_("Congratulations, you just gain a free ${nb} month(s) Premium membership!"),{nb:t}),"info");mainsite.gotourl("player")}},function(e){},"post")}})})},"ebg/site/table":function(){define(["dojo","dojo/_base/declare","svelte/index","dijit/focus","ebg/core/mainsitemodule","ebg/gamenotif","ebg/selfedit","ebg/chatinput","ebg/thumb","ebg/comboajax","ebg/board","dijit/dijit","ebg/textdescription","ebg/tableresults","ebg/invitefriends","ebg/popindialog"],function(e,t,i){return t("ebg.site.table",ebg.core.mainsitemodule,{constructor:function(){this.player_id=current_player_id;this.table=null;this.tablechannel="";this.game_url=null;this.last_visitorlist={};this.popindialog=null;this.is_admin=!1;this.is_at_table=!1;this.is_expected_at_table=!1;this.is_still_at_table=!1;this.previous_status="";this.tableProgression=0;this.jstpl_player_table='<div id="active_player_${player_id}" class="active_player whiteblock ${hotseat}"><div class="active_player_left"><div class="player_presentation"><div class="${emblem_class} emblemwrap_xl"><img id="emblem_${player_id}" src="${emblem}" alt="${player_name}" class="emblem"/><div class="emblempremium"></div></div><div class=""><a href="player?id=${player_id}" class="active_player_fullname playername">${player_name}</a><br/><i id="player_${player_id}_status" class="player_status fa fa-${statusicon} status_${status}"></i>&nbsp;<div class="playersubinfos"><div class="fa ${genderclass}" id="gender_${player_id}"></div> <div class="bga-flag" data-country="${flag}" id="flag_${player_id}"></div> <span id="current_reput_${player_id}" class="active_player_reput"></span></div></div><div class="playersubinfos_lang"><span id="speak_${player_id}" class="playersubinfos_lang_content"></span><div class="playersubinfos_lang_speecharrow"></div></div></div><div class="active_player_action_block"><span style="display:${fire_visibility}" class="smalltext" id="fire_player_wrap_${player_id}"><a class="bga-link" href="#" id="fire_player_${player_id}">['+_("Expel player")+']</a></span><div class="smalltext">${details}</div></div></div>${player_right_status}<div class="active_player_right"><div class="playergamedetails player_elo_details" id="elo_details_${player_id}"><a class="no-underline" href="/playerstat?id=${player_id}&game=${game}" id="elo_details_${player_id}_bar" target="_blank" rel="nofollow"><div class="progressbar_with_info"><div class="progressbar_inner"><div id="elobar_${player_id}" class="progressbar progressbar_elo elo_${rank_class}"><div class="progressbar_label"><span class="symbol icon20 icon20_rankw"  style="position: relative;top:2px;"></span><span  style="position: relative;top:-2px;">${rank}</span></div><div class="progressbar_bar"><div class="grad grad100"></div><div class="grad grad200"></div><div class="grad grad300"></div><div class="grad grad500"></div><span class="progressbar_valuename">${rank_label}</span><div class="progressbar_content" style="width:${elobarpcent}%"><span class="progressbar_valuename">${rank_label}</span></div></div></div></div><i class="fa fa-lg fa-info-circle more_infos" style="color: black"></i></div></a></div><div class="playergamedetails player_arena_details" id="arena_details_${player_id}" style="display:none"><div class="progressbar_with_info"><div class="progressbar_inner"><div id="arenabar_${player_id}" class="progressbar progressbar_arena arena_${league_id}"><div class="progressbar_label"><div class="progressbar_label_content">${league_name}</div></div><div class="progressbar_bar"><div class="progressbar_content"  style="${arenabarpcent}"><div class="arena_container">${arena_points_html}</div></div></div></div></div><i class="fa fa-lg fa-info-circle more_infos" style="color: black"></i><div class="progressbar_bottom_infos">${arena_bottom_infos}</div></div></div><div class="tabletrophylist" style="display:block"><div id="trophies_${player_id}" class="trophies_won"><div class="prestige" style="display:none;""><div class="xp_container"><span class="prestigerank ${prestige_mask}" id="prestigerank_${player_id}">${prestige}</span> XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div>&nbsp;&nbsp;</div></div><a href="player?id=${player_id}&section=prestige" target="_blank"><i class="fa fa-lg fa-info-circle more_infos" style="color: black" id="prestige_details_${player_id}"></i></a></div><div class="clear"></div><div class="playerdetails" id="reputation_details_${player_id}"><div class="progressbar_with_info"><div class="progressbar_inner"><div id="reputationbar_${player_id}" class="progressbar  progressbar_reputation reputation_${karma_class}"><div class="progressbar_label"><span class="symbol"></span><span class="value">${karma}%</span></div><div class="progressbar_bar"><span class="progressbar_valuename">${karma_label}</span><div class="progressbar_content" style="width:${karma}%"><span class="progressbar_valuename">${karma_label}</span></div></div></div></div><i class="fa fa-lg fa-info-circle more_infos"></i></div></div></div><div id="warnings_${player_id}" class="warnings"></div></div>';this.jstpl_reputation_details="<h3>"+_("Reputation")+"</h3><hr/><p>"+_("Each player reputation is a Karma (${karmaicon}) number between 0 (very bad) and 100 (excellent)")+"</p><p> &bull; "+_("Playing a game within time limit")+" : +1 </p><p> &bull; "+_("Leaving a game in progress")+" : -10 </p><p> &bull; "+_("Leaving a game in progress less than 1 month after a first penalty")+" : -20 </p><p> &bull; "+_("Tournament game forfeit")+" : -4 </p><p> &bull; "+_("Too much negative feedback (red thumbs) from other players may also limit your Karma")+"</p><h4>"+_("Reputation details for ${player_name}")+'</h4><div class="playerdetails"> ${recent_leave} <div class="icon20 icon20_penaltyleave"></div> '+_("and")+' ${recent_clock} <div class="icon20 icon20_penaltyclock"></div> <span class="smalltext">(${on_recent_games})</span>${karma_alert}</div>';this.jstpl_elo_details='<div class="elodetails_tooltips"><h3>'+_("ELO rank at this game")+" : ${elo_label}</h3><hr/><p>"+_("This ELO score is an evaluation of your skill for this game.")+'</p><div class="row-data-large"><div class="row-label">'+_("World BGA rank")+'</div><div class="row-value"><b><span id="gamerankno_${player_id}">${rank_no}</span></b></div></div><div class="row-data-large"><div class="row-label">'+_("Games played")+'</div><div class="row-value"><b>${realPlayed}</b></div></div><div class="row-data-large"><div class="row-label">'+_("Games played")+"<br> ("+_("incl. alpha games & training mode")+')</div><div class="row-value"><b>${played}</b></div></div><div class="row-data-large"><div class="row-label">'+_("Victories")+'</div><div class="row-value"><b>${victory}</b></div></div><div class="icon20 icon20_stat"></div> '+_("Click on bar to see detailled stats")+"</div>";this.jstpl_prestige_details="<h3>"+_("Most prestigious trophies won by this player at this game")+"</h3><hr/><p>"+_("Each trophy brings prestige points.")+"</p>"+_("Total prestige points won by this player at this game")+' : <div class="xp_container">${prestige} XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div><p>'+_("Click to see all players trophies.")+"</p>";this.jstpl_player_table_free='<div class="active_player freeplace_slot whiteblock"><div class="emblemwrap"><div class="emblem ${freeplacetype}"></div></div><span class="active_player_name">(${text}) </span><span class="invite_ai"><a class="bga-link invite_ai_action" href="#" >[${invite_ai_text}]</a> </span></div>';this.jstpl_visitor='<div class="visitor_player" id="visitor_player_${player_id}"><a class="playername" href="player?id=${player_id}">${player_fullname}</a></div>';this.jstpl_trophy='<a id="award_${id}" class="trophy" href="${link}"><div class="trophyimg_wrap"><div class="trophyimg microtrophyimg" id="awardimg_${id}" style="background-image: url(\'${base_img}\')">${addimg}</div></div><div class="trophytooltip" id="trophytooltip_${id}"><b>${name}</b></div></a>';this.jstpl_warning='<div class="warning ${warning_type}"><i class="fa fa-${warning_icon} fa-2x imgtext"></i>&nbsp; ${text}</div>';this.jstpl_availableplayer='<div id="availableplayer_${id}" class="availableplayer"><div class="availableplayername"><a class="playername" href="/player?id=${id}">${name}</a></div><div class="availableplayerrank">${rankformatted}&nbsp;<div class="imgtext icon16 icon16_reput${reput}" style="display:${reputvisibility}"></div>&nbsp;<i id="sticky_avail_${id}" class="fa fa-sticky-note-o" style="display:${stickyvisibility}"></i></div><div id="availableplayertable_${id}" class="availableplayertable" style="display:${gamevisibility}">${game_name} #${table_id}</div><div class="availableplayersuggest"><a href="#" id="suggestjoin_${id}" class="bgabutton bgabutton_gray suggestbutton"><i class="fa fa-lightbulb-o"></i>&nbsp;&nbsp;${suggest_label}</a><span id="suggestsent_${id}" class="suggestsent"><i class="fa fa-lightbulb-o"></i> '+_("Suggestion sent!")+"</span></div></div>";this.description_se=new ebg.selfedit;this.descriptionmob_se=new ebg.selfedit;this.gameoptionCtrl={};this.gamemoboptionCtrl={};this.tabledatas=null;this.pma=!1;this.invitePlayer=null;this.tableHour=null;this.tableMinute=null;this.tableDate=null;this.playeropinion={};this.availablePlayersToEloDiff={};this.stickynotes={};this.gamelobbyStatsCentrifugeSub=null;this.countDownTimeout=null;this.restrictTableDialog=null;this.lobby=null;this.lobbyInitTimeout=null},onLoad:function(t){var a=$("table_name");if(a){t.table;this.table=t.table;this.autoredirect=void 0!==t.autoredirect;mainsite.setPageTitle(a.textContent);mainsite.setBackButton();if(0!=mainsite.rtc_mode){this.mediaConstraints.audio=!0;this.mediaConstraints.video=this.getRtcVideoConstraints(mainsite.rtc_mode)}this.description_se.create(this,"game_presentation","textarea","","/table/table/setpresentation.html",{table:this.table});this.descriptionmob_se.create(this,"mob_game_presentation","textarea","","/table/table/setpresentation.html",{table:this.table});if(""!=$("important_message").innerHTML){this.showMessage($("important_message").innerHTML,"error");gotourl("lobby")}this.ajaxcall("/table/table/tableinfos.html",{id:this.table},this,function(a){e.style($("loading"),"display","none");e.style($("gametable_box"),"display","block");this.pma=a.pma;this.playeropinion=a.thumbs;if(mainsite.pma){e.query(".startaudiochat").connect("onclick",mainsite,"onStartStopAudioChat");this.addTooltipToClass("startaudiochat","",_("Audio call"));e.query(".startvideochat").connect("onclick",mainsite,"onStartStopVideoChat");this.addTooltipToClass("startvideochat","",_("Video call"))}else{this.addTooltipToClass("startaudiochat",mainsite.premiumMsgAudioVideo,"");e.query(".startaudiochat").addClass("bgabutton_premium");e.query(".startaudiochat").connect("onclick",this,function(t){e.stopEvent(t);window.location.href="/premium?src=avchat"});this.addTooltipToClass("startvideochat",mainsite.premiumMsgAudioVideo,"");e.query(".startvideochat").addClass("bgabutton_premium");e.query(".startvideochat").connect("onclick",this,function(t){e.stopEvent(t);window.location.href="/premium?src=avchat"})}$("current_player_elo")?this.player_elo=$("current_player_elo").innerHTML:this.player_elo=1500;this.updateCurrentPlayerStatus(a);this.loadTable(a);this.tablechannel="/table/t"+this.table;this.tablechannelSpectators="/table/ts"+this.table;this.register_subs(e.subscribe("tableInfosChanged",this,"onTableInfosChanged"));this.register_subs(e.subscribe("playerstatus",this,"onPlayerStatusChanged"));this.register_subs(e.subscribe("allPlayersAccepted",this,"onAllPlayersAccepted"));this.register_subs(e.subscribe("gameStateChange",this,"onGameStateChange"));this.register_subs(e.subscribe("updateSpectatorList",this,"onUpdateSpectatorList"));this.register_subs(e.subscribe("tablesuggest",this,"onTableSuggest"));this.register_subs(e.subscribe("lobbystats",this,"onLobbyStats"));this.register_centrifuge_subs(mainsite.subscribeCentrifugeChannel(this.tablechannel,mainsite.notifqueue,"onNotification"));this.register_centrifuge_subs(mainsite.subscribeCentrifugeChannel(this.tablechannelSpectators,mainsite.notifqueue,"onNotification"));mainsite.socket.getSubscription(this.tablechannelSpectators).on("join",e=>this.updateVisitors({...this.last_visitorlist,[e.info.client]:e.info})).on("leave",e=>{delete this.last_visitorlist[e.info.client];this.updateVisitors(this.last_visitorlist)});"undefined"!=typeof FB&&void 0!==FB.XFBML?this.onFBReady():e.subscribe("FBReady",this,"onFBReady");"open"!=a.status&&"init"!=a.status||(this.gamelobbyStatsCentrifugeSub=this.register_centrifuge_subs(mainsite.subscribeCentrifugeChannel("/gamelobby/stats",this.notifqueue,"onNotification")));this.table_game_id=a.game_id;"finished"==a.status&&"First game on BGA"==a.presentation&&e.query("#game_result #score_entry_"+current_player_id).length>0&&null!==a.result.time_end&&1!=toint(a.cancelled)&&this.tutorialThankYouDialog(a);"init"!=a.status&&"asyncinit"!=a.status||!this.is_admin||e.query(".will_open_in").connect("onclick",this,"onOpenTableNow");this.is_expected_at_table&&void 0!==t.acceptinvit&&this.joinGame();void 0===t.invit||a.status.match(/(init|open)$/)||i.bgaMessage({description:_("This table is no longer available, try opening one of your own!")})});e.connect($("join_game"),"onclick",this,"onJoinGame");e.connect($("register_game"),"onclick",this,"onRegisterGame");e.connect($("quit_game"),"onclick",this,"onQuitGame");e.connect($("refuse_invitation"),"onclick",this,"onRefuseInvitation");e.connect($("confirm_participation"),"onclick",this,"onConfirmParticipation");e.connect($("startgame"),"onclick",this,"onStartGame");e.connect($("start_game_accept"),"onclick",this,"onStartGameAccept");e.connect($("start_game_refuse"),"onclick",this,"onStartGameRefuse");e.connect($("start_game_cancel"),"onclick",this,"onStartGameRefuse");e.connect($("access_game_normal"),"onclick",this,function(e){e.preventDefault();window.location.href=this.game_url});e.connect($("cantstartgame"),"onclick",this,function(e){e.preventDefault()});e.connect($("open_table_final_situation"),"onclick",this,function(e){e.preventDefault();window.location.href=this.game_url});e.connect($("open_table_last_turn"),"onclick",this,function(e){e.preventDefault();window.location.href=this.game_url+"&replayLastTurn=1&replayLastTurnPlayer="+current_player_id});$("realtime_anyway")&&e.connect($("realtime_anyway"),"onclick",this,"onRealTimeAnyway");$("display_chatlog")&&e.connect($("display_chatlog"),"onclick",this,"onDisplayChatlog");$("display_gamelog")&&e.connect($("display_gamelog"),"onclick",this,"onDisplayGamelog");e.connect($("limit_table_access"),"onclick",this,"onLimitTableAccess");e.connect($("show_players_available"),"onclick",this,function(t){e.stopEvent(t);if("none"==e.style("available_players_for_game_wrap_wrap","display")){e.style("available_players_for_game_wrap_wrap","display","block");e.window.getBox();var i=e.position(available_players_for_game_wrap_wrap);window.scrollBy({top:i.y-100,behavior:"smooth"});this.getAvailablePlayersInitialList();g_sitecore.unsubscribeCentrifugeChannel(this.gamelobbyStatsCentrifugeSub);this.gamelobbyStatsCentrifugeSub=null}else e.style("available_players_for_game_wrap_wrap","display","none")});e.connect($("buygame"),"onclick",this,function(e){analyticsPush({game_name:this.tabledatas.game_name,cta_location:"table_join",event:"buy_game",url:this.href})});e.connect($("create_new_table"),"onclick",this,"onCreateNewTable");e.connect($("rematch"),"onclick",this,"onRematch");$("express_start")&&e.connect($("express_start"),"onclick",this,"onExpressStart");$("express_stop")&&e.connect($("express_stop"),"onclick",this,"onExpressStop");e.connect($("wanted_min_min"),"onclick",this,"onWantedMinMin");e.connect($("wanted_min_plus"),"onclick",this,"onWantedMinPlus");e.connect($("wanted_max_min"),"onclick",this,"onWantedMaxMin");e.connect($("wanted_max_plus"),"onclick",this,"onWantedMaxPlus");e.connect($("wanted_minus"),"onclick",e=>{e.preventDefault();this.changeWantedPlayers(-1,null)});e.connect($("wanted_plus"),"onclick",e=>{e.preventDefault();this.changeWantedPlayers(1,null)});e.connect($("invite_friend"),"onclick",this,"onInviteFriend");e.query(".startchat").connect("onclick",this,"onStartChat");this.addTooltip("game_progression_bar",_("Current game progression"),"");e.hasClass("realtime_turnbased_icon","icon32_realtime")?this.addTooltip("realtime_turnbased_icon",_("Realtime game"),""):this.addTooltip("realtime_turnbased_icon",_("Turn-based game"),"");this.invitePlayer=new ebg.comboajax;this.invitePlayer.create("inviteplayer","/player/player/findplayer.html",__("lang_mainsite","Type a player name..."));e.connect(this.invitePlayer,"onChange",this,e.hitch(this,function(e){if(0!==toint(e)){this.ajaxcall("/table/table/invitePlayer.html",{table:this.table,player:e},this,function(e){});this.invitePlayer.setSelection("",!0);dijit.focus.curNode&&dijit.focus.curNode.blur()}}));e.connect(this.invitePlayer.div,"onfocus",this,function(t){e.style("invite_player_help","display","block")});e.connect(this.invitePlayer.div,"onblur",this,function(t){e.style("invite_player_help","display","none")});this.tableProgression=toint($("game_progression_value").innerHTML);this.addTooltipToClass("wikimenu","",_("Go to the corresponding BGA wiki page, and edit it if you like."));this.addTooltipToClass("ttpremiumgame",_("This game is Premium: you must be a Premium member to create new tables"),"");this.addTooltipToClass("ttexpansionpremiumgame",_("Expansions for this game are Premium: you can create a table for the base game, but you must be a Premium member to enable expansions"),"");this.addTooltipToClass("ttalphagame",_('This game is "alpha": access is restricted to BGA reviewers and players invited by the developer'),"");this.addTooltipToClass("ttbetagame",_('This game is "beta": you can report issues under "Community / Report a bug, or make a suggestion"'),"")}},onInviteAi:function(t){e.stopEvent(t);var i=e.query("#ai_list .ai")[0].id.substr(3);this.ajaxcall("/table/table/invitePlayer.html",{table:this.table,player:i},this,function(e){})},onFBReady:function(){FB.XFBML.parse();e.forEach(e.query(".fb_button_text"),function(e){e.innerHTML=__("lang_mainsite","Publish on my Facebook profile")})},onOnUnload:function(){if(this.is_admin&&("init"==this.tabledatas.status||"asyncinit"==this.tabledatas.status)&&!confirm(_("Your did not open your table for joining : do you really want to leave?")))return!1;"undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==mainsite.room&&mainsite.room.indexOf("T")>=0&&mainsite.doLeaveRoom();this.unsubscribe_all();dijit.byId("inviteplayer").destroy();if(null!=this.countDownTimeout){clearTimeout(this.countDownTimeout);this.countDownTimeout=null}null!==this.tableDate&&dijit.byId("table_scheduled_date").destroy();null!==this.tableMinute&&dijit.byId("table_minute").destroy();null!==this.tableHour&&dijit.byId("table_hour").destroy();if(void 0!==this.inviteFriendsPopup){this.inviteFriendsPopup.destroy();this.inviteFriends.destroy();e.disconnect(this.closingInviteFriend)}},loadTable:function(e){this.tabledatas=e;this.updateTableInfos(e);this.updateStatus(e)},updateStatus:function(t){var i="",a="";a=20!=t.options[200].value?t.options[200].value<=12?" ("+_("Fast turn-based")+")":" ("+_("turn-based")+")":" ("+_("No time limit")+")";"init"==t.status||"asyncinit"==t.status?i=_("Configuring a new game table"):"open"==t.status?i=_("Open for joining")+" ("+_("realtime")+")":"asyncopen"==t.status?i=_("Open for joining")+a:"setup"==t.status?i=_("Game is about to start"):"play"==t.status?i=_("Game in progress")+" ("+_("realtime")+")":"asyncplay"==t.status?i=_("Game in progress")+a:"finished"==t.status?i=_("Game has ended"):"pause"==t.status?i=_("Game is paused"):"archive"==t.status?i=_("Game has ended"):"tournamentopen"==t.status?i=_("Tournament game is ready to start"):"tournamentmeeting"==t.status&&(i=_("Planned tournament game"));"setup"==t.status?mainsite.setPageTitle(_("Game is about to start")+" "+$("table_name").textContent):mainsite.setPageTitle($("table_name").textContent);$("status_detailled").innerHTML=i;e.style($("change_presentation"),"display","none");e.style($("access_game_panel"),"display","none");e.style($("current_players"),"display","none");e.style($("game_result_panel"),"display","none");e.style($("statistics"),"display","none");e.style($("gamesetup_panel"),"display","none");e.query(".will_open_in").style("display","none");"setup"==t.status&&"open"==this.previous_status&&this.is_at_table;var n=$("tableurl").innerHTML;this.game_url=n+"/"+t.gameserver+"/"+t.game_name+"?table="+t.id;e.removeClass("gametable_box");e.addClass("gametable_box"," ");e.addClass("gametable_box","detailledgametable gametable_status_"+t.status);this.updatePlayers(t);this.updateButtonVisibility(t);"setup"==t.status&&this.updateSetupStatus(t);"play"!=t.status&&"asyncplay"!=t.status&&"pause"!=t.status||this.updatePlayStatus(t);"finished"!=t.status&&"archive"!=t.status||this.updateFinished(t);if("meeting"==t.status||"tournamentmeeting"==t.status){e.style("table_scheduled","display","block");if(this.is_admin){if(!dijit.byId("table_hour")){for(var o=new Date,s=o.getHours(),r="<div id='table_hour'>",l=s+1;l<24;l++)r+="<span value='"+l+"'>"+l+"</span>";for(l=0;l<=s;l++)r+="<span value='"+l+"'>"+l+"</span>";r+="</div>:<div id='table_minute'>";for(var d=0;d<60;d+=15)r+="<span value='"+d+"'>"+zeroFill(d,2)+"</span>";r+="</div>";o.setHours(0,0,0,0);for(var c=o.getTime(),u="<div id='table_date'>",h=o,p=0;p<10;p++){date_label=0==p?_("today"):1==p?_("tomorrow"):e.string.substitute(__("lang_mainsite","${M}/${D}/${Y}"),{M:zeroFill(h.getMonth()+1,2),D:zeroFill(h.getDate(),2),Y:1900+h.getYear()});u+="<span value='"+h.getTime()+"'>"+date_label+"</span>";h=new Date(c+=864e5)}u+="</div>";e.place(e.string.substitute("<div>"+_("Game starts ${date} at ${time}"),{time:r,date:u})+"</div>","table_scheduled_date_string","only");var m=new Date(1e3*t.scheduled);this.tableHour=new dijit.form.Select({id:"table_hour",name:"table_hour",value:m.getHours()},"table_hour");this.tableMinute=new dijit.form.Select({id:"table_minute",name:"table_minute",value:m.getMinutes()},"table_minute");m.setHours(0,0,0,0);this.tableDate=new dijit.form.Select({id:"table_scheduled_date",name:"table_scheduled_date",value:m.getTime()},"table_date");e.connect(this.tableDate,"onChange",this,"onTableDateChange");e.connect(this.tableHour,"onChange",this,"onTableDateChange");e.connect(this.tableMinute,"onChange",this,"onTableDateChange")}}else $("table_scheduled_date_string").innerHTML=$("creationtime").innerHTML}if("tournamentopen"==t.status)if(21==this.gameoptionCtrl[200].value){e.style("table_scheduled","display","block");$("table_scheduled_date_string").innerHTML=_("Game will starts automatically in few minutes (or immediately if everyone joins the table).");e.addClass("gametable_box","gametable_status_tournamentopenturnbased")}else{m=new Date(1e3*toint(t.scheduled));var g=new Date(1e3*(toint(t.scheduled)+300));e.style("table_scheduled","display","block");$("table_scheduled_date_string").innerHTML=e.string.substitute(_("Game scheduled for ${hour}:${mn}.<br/>The game starts as soon as all players has joined the game, or starts at ${hourlate}:${mnlate} with present players."),{hour:zeroFill(m.getHours(),2),mn:zeroFill(m.getMinutes(),2),hourlate:zeroFill(g.getHours(),2),mnlate:zeroFill(g.getMinutes(),2)})}if("init"!=t.status&&"asyncinit"!=t.status&&null!=this.countDownTimeout){clearTimeout(this.countDownTimeout);this.countDownTimeout=null}if(t.tournament){e.style($("tournament_link"),"display","block");e.empty("tournament_link");t.tournament.header=_("This game count for tournament");e.place(e.string.substitute("<p>${header}: <a class='bga-link' href='/tournament?id=${id}'>${championship_name} ${tournament_name}</a></p>",t.tournament),"tournament_link")}this.previous_status=t.status},updateButtonVisibility:function(t){var i;e.style($("join_game"),"display","none");e.style($("quit_game"),"display","none");e.style($("startgame"),"display","none");e.style($("cantstartgame"),"display","none");e.style($("view_end_btn"),"display","none");e.style($("reviewgame"),"display","none");e.style($("buygame"),"display","none");e.style($("refuse_invitation"),"display","none");e.style($("confirm_participation"),"display","none");e.style($("register_game"),"display","none");e.style($("rematch"),"display","none");e.style($("how_to_play_top"),"display","none");e.query(".will_open_in").style("display","none");var a="inline";e.hasClass("ebd-body","mobile_version")&&(a="block");this.is_admin?e.addClass("gametable_box","gametable_adminview"):e.removeClass("gametable_box","gametable_adminview");i="none";if("open"==t.status||"asyncopen"==t.status||"init"==t.status||"asyncinit"==t.status)if(this.is_expected_at_table)i=a;else{i=a;toint(t.current_player_nbr)>=toint(t.game_max_players)&&(i="none");this.is_at_table&&(i="none")}else i="tournamentopen"==t.status&&this.is_expected_at_table?a:"none";e.style($("join_game"),"display",i);if("meeting"!=t.status)i="none";else if(this.is_expected_at_table)i="none";else{i=a;toint(t.current_player_nbr)>=toint(t.game_max_players)&&(i="none")}e.style($("register_game"),"display",i);"tournamentopen"!=t.status&&"tournamentmeeting"!=t.status&&this.is_expected_at_table&&e.style($("refuse_invitation"),"display",a);this.is_expected_at_table&&"meeting"==t.status&&0==toint(t.players[current_player_id].is_confirmed)&&e.style($("confirm_participation"),"display",a);i=this.is_still_at_table&&"tournamentopen"!=t.status?a:"none";e.style($("quit_game"),"display",i);var n=toint(t.current_present_player_nbr);["open","asyncopen","init","asyncinit"].includes(t.status)&&this.is_admin&&(void 0!==t.game_player_number[n]?e.style($("startgame"),"display",a):this.is_admin&&e.style($("cantstartgame"),"display",a));!this.is_admin||"open"!=t.status&&"meeting"!=t.status&&"init"!=t.status&&"asyncinit"!=t.status&&"asyncopen"!=t.status?e.style("limit_table_access","display","none"):e.style("limit_table_access","display","block");if(!this.is_admin||"open"!=t.status&&"meeting"!=t.status&&"init"!=t.status&&"asyncinit"!=t.status&&"asyncopen"!=t.status){e.style("player_number_wanted","display","none");e.style("invite_player","display","none")}else{e.style("player_number_wanted","display","block");e.style("invite_player","display","block")}this.is_at_table&&"finished"==t.status&&e.style($("view_end_btn"),"display",a);if("finished"==t.status||"archive"==t.status){null!==t.gamestart&&e.style($("reviewgame"),"display",a);e.query(".may_display_buybutton").style("display",a);e.style($("create_new_table"),"display",a);$("playerstatheader_"+current_player_id)&&(2==t.options[201].value||e.style($("rematch"),"display",a))}1==$("is_beginner").innerHTML&&e.style($("how_to_play_top"),"display",a);if($("express_start")){e.style($("express_start"),"display","none");"open"!=t.status&&"init"!=t.status&&"asyncinit"!=t.status&&"asyncopen"!=t.status||!this.is_admin||e.style($("express_start"),"display",a)}if($("express_stop")){e.style($("express_stop"),"display","none");"play"!=t.status&&"asyncplay"!=t.status||!this.is_admin||e.style($("express_stop"),"display",a)}"init"!=t.status&&"asyncinit"!=t.status||!this.is_admin||n==t.max_player||e.query(".will_open_in").style("display",a);t.game_max_players==t.game_min_players&&e.style("player_number_wanted","display","none")},updateTableInfos:function(t){if("First game on BGA"==t.presentation&&e.query("#game_know_wrapper #game_beacon_"+t.game_id+"_0").length>0){t.presentation=e.string.substitute(_("First game on BGA: help this player to discover BGA and get ${points}!"),{points:'3<div class="icon20 icon20_gift2"></div>'})+"<br/>";t.presentation+="<span class='smalltext'>("+_("Note: gift points are awarded only if the beginner confirm you've been helpful")+")</span>"}if(""==t.presentation)if(this.is_admin){e.style("game_presentation_wrap","display","block");this.description_se.setValue(_("(no presentation yet)"));this.descriptionmob_se.setValue(_("(no presentation yet)"))}else e.style("game_presentation_wrap","display","none");else{e.style("game_presentation_wrap","display","block");this.description_se.setValue(t.presentation);this.descriptionmob_se.setValue(t.presentation)}if(!this.is_admin||"open"!=t.status&&"meeting"!=t.status&&"init"!=t.status&&"asyncinit"!=t.status&&"asyncopen"!=t.status){this.description_se.disable();this.descriptionmob_se.disable()}var i;for(i in t.options){var a=t.options[i];if(i>=100&&i<=199&&null!==$("gameoption_description_"+i)){$("gameoption_description_"+i).innerHTML="";$("mob_gameoption_description_"+i).innerHTML="";if(void 0!==a.values[a.value]&&void 0!==a.values[a.value].description){$("gameoption_description_"+i).innerHTML=a.values[a.value].description;$("mob_gameoption_description_"+i).innerHTML=a.values[a.value].description}}if(a.name&&null!=$("gameoption_"+i)){if(this.gameoptionCtrl[i]){this.gameoptionCtrl[i].setValue(a.value);this.gamemoboptionCtrl[i].setValue(a.value)}else{this.gameoptionCtrl[i]=new ebg.selfedit;this.gamemoboptionCtrl[i]=new ebg.selfedit;var n,o={};if(206==i)for(var s in a.values){a.values[s].id=s;a.values[s].name=mainsite.playingHoursToLocal(a.values[s].name)}if(a.template){this.gameoptionCtrl[i].create(this,"gameoption_"+i,"num",this.formatReflexionTime(a.value).string,"/table/table/changeoption.html",{table:this.table,id:i},n,o);this.gamemoboptionCtrl[i].create(this,"mob_gameoption_"+i,"num",this.formatReflexionTime(a.value).string,"/table/table/changeoption.html",{table:this.table,id:i},n,o)}else{if("enum"==a.type){n={};for(var s in a.values){var r=s;void 0!==a.values[s].id&&(r=a.values[s].id);if(200==toint(i)&&toint(r)>=10&&"no"==$("game_turnbased_config").innerHTML);else if(200==toint(i)&&toint(r)<10&&"no"==$("game_realtime_config").innerHTML);else if(void 0!==a.values[s].no_player_selection&&s!=a.value);else{n[s+""]=a.values[s].name;a.values[s].disable&&(o[r]=!0)}}}this.gameoptionCtrl[i].create(this,"gameoption_"+i,a.type,a.value,"/table/table/changeoption.html",{table:this.table,id:i},n,o);this.gamemoboptionCtrl[i].create(this,"mob_gameoption_"+i,a.type,a.value,"/table/table/changeoption.html",{table:this.table,id:i},n,o)}}if(!this.is_admin||"open"!=t.status&&"meeting"!=t.status&&"init"!=t.status&&"asyncinit"!=t.status&&"asyncopen"!=t.status){this.gameoptionCtrl[i].disable();this.gamemoboptionCtrl[i].disable()}else{this.gameoptionCtrl[i].valueEditMode();this.gamemoboptionCtrl[i].valueEditMode()}}if(void 0!==a.displaycondition){e.style("gameoption_"+i+"_wrap","display","none");e.style("mob_gameoption_"+i+"_wrap","display","none");var l=void 0!==a.displayconditionoperand?a.displayconditionoperand:"and",d="and"==l;for(var c in a.displaycondition){var u=a.displaycondition[c];if("minplayers"==u.type)if("object"==typeof u.value){var h=!1;for(var s in u.value)t.min_player==u.value[s]&&(h=!0);h?"or"==l&&(d=!0):"and"==l&&(d=!1)}else t.min_player==u.value?"or"==l&&(d=!0):"and"==l&&(d=!1);if("maxplayers"==u.type)if("object"==typeof u.value){h=!1;for(var s in u.value)t.max_player==u.value[s]&&(h=!0);h?"or"==l&&(d=!0):"and"==l&&(d=!1)}else t.max_player==u.value?"or"==l&&(d=!0):"and"==l&&(d=!1);if("otheroption"==u.type&&void 0!==t.options[u.id])if("object"==typeof u.value){h=!1;for(var s in u.value)t.options[u.id].value==u.value[s]&&(h=!0);h?"or"==l&&(d=!0):"and"==l&&(d=!1)}else t.options[u.id].value==u.value?"or"==l&&(d=!0):"and"==l&&(d=!1);if("otheroptionisnot"==u.type)if(void 0===t.options[u.id]);else if("object"==typeof u.value){var p=!1;for(var s in u.value)t.options[u.id].value==u.value[s]&&(p=!0);p?"and"==l&&(d=!1):"or"==l&&(d=!0)}else t.options[u.id].value!=u.value?"or"==l&&(d=!0):"and"==l&&(d=!1)}if(d){e.style("gameoption_"+i+"_wrap","display","block");e.style("mob_gameoption_"+i+"_wrap","display","block")}if(void 0!==a.notdisplayedmessage&&("none"==e.style("gameoption_"+i+"_wrap","display")||"none"==e.style("mob_gameoption_"+i+"_wrap","display"))){e.style("gameoption_"+i+"_wrap","display","block");e.style("mob_gameoption_"+i+"_wrap","display","block");e.style("gameoption_description_"+i,"display","none");e.style("mob_gameoption_description_"+i,"display","none");this.gameoptionCtrl[i].disable();this.gamemoboptionCtrl[i].disable();$("gameoption_"+i+"_displayed_value")&&($("gameoption_"+i+"_displayed_value").innerHTML=a.notdisplayedmessage);$("mob_gameoption_"+i+"_displayed_value")&&($("mob_gameoption_"+i+"_displayed_value").innerHTML=a.notdisplayedmessage)}}}var m=this.format_string_recursive(t.level_filter.label.log,t.level_filter.label.args);if(""!=t.reputation_filter.label){""!=m&&(m+=", ");m+=t.reputation_filter.label}if(null!==t.filter_group){""!=m&&(m+=", ");var g=!1;"public"!=t.filter_group_visibility&&"member"==t.filter_group_visibility&&1!==mainsite.groupList[t.filter_group]&&(g=!0);g?m+="("+_("private group")+")":"normal"==t.filter_group_type?m+='<a class="bga-link" href="/group?id='+t.filter_group+'">'+t.filter_group_name+"</a>":"friend"==t.filter_group_type&&(m+='<a class="bga-link" href="/group?id='+t.filter_group+'">'+e.string.substitute(_("${player}'s friends"),{player:t.filter_group_name})+"</a>")}if(null!==t.filter_lang){""!=m&&(m+=", ");m+=t.filter_lang_label}$("tableaccess").innerHTML=""==m?"":_("Access restricted to")+": &nbsp;"+m;$("wanted_min").innerHTML=t.min_player;$("wanted_max").innerHTML=t.max_player;$("wanted").innerHTML=t.min_player;C=(C=new Date).getTime()/1e3;t.scheduled<=C?$("creationtime").innerHTML=e.string.substitute(_("Created ${time}"),{time:date_format(t.scheduled,!1)}):$("creationtime").innerHTML=e.string.substitute(_("Game starts ${time}"),{time:date_format(t.scheduled,!0)});e.empty("table_warnings");if($("game_translation_warning")){var f="/translation?module_id="+$("game_translation_warning_gameid").innerHTML+"&source_locale=en_US&dest_locale="+$("game_translation_warning_locale").innerHTML,b=$("game_translation_warning_machineratio").innerHTML,y=_('The translation for this game in your language is incomplete (untranslated text will appear in English). You can help from the <a href="${url}" target="_blank">translation center</a>.');b>=10&&(y=_('Some translations for this game have been automatically generated and need to be reviewed to improve their quality. You can help from the <a href="${url}" target="_blank">translation center</a>.'));e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"language",text:y.replace("${url}",f)}),"table_warnings")}"open"!=t.status&&"init"!=t.status||"notreco"!=$("game_realtime_config").innerHTML||e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This game has a long playing time: we suggest you to play it turn-based.")}),"table_warnings");"asyncopen"!=t.status&&"asyncinit"!=t.status||"notreco"!=$("game_turnbased_config").innerHTML||e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This game is not recommended for turn-based play. Please consider playing in real-time mode for a better experience.")}),"table_warnings");"beta"==t.game_status?e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This game is a BETA version.")+" "+_("By playing it, you may encounter some bugs or unstability: in some cases, it could affect your reputation.")+" "+_("If you would be bothered by that, you should play in Training Mode.")+" "+_("Please report any issue in the <a href='%s' target='_blank'>bug management system</a>.").replace("%s","/bug?id=0&table="+this.table)}),"table_warnings"):t.beta_option_selected&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("A BETA option has been selected for this game.")+" "+_("By playing it, you may encounter some bugs or unstability: in some cases, it could affect your reputation.")+" "+_("If you would be bothered by that, you should play in Training Mode.")+" "+_("Please report any issue in the <a href='%s' target='_blank'>bug management system</a>.").replace("%s","/bug?id=0&table="+this.table)}),"table_warnings");["private_alpha","alpha"].includes(t.game_status)?e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This game is an ALPHA version.")+" "+_("It is started in Training Mode, so you can quit anytime without penalties.")+" "+_("Please report any issue in the <a href='%s' target='_blank'>bug management system</a>.").replace("%s","/bug?id=0&table="+this.table)}),"table_warnings"):t.alpha_option_selected&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("An ALPHA option has been selected for this game.")+" "+_("It is started in Training Mode, so you can quit anytime without penalties.")+" "+_("Please report any issue in the <a href='%s' target='_blank'>bug management system</a>.").replace("%s","/bug?id=0&table="+this.table)}),"table_warnings");var v=!1;for(var w in t.players)0==toint(t.players[w].played)?v=!0:w==current_player_id&&!1;if(v)for(i in t.options){(a=t.options[i]).values&&a.values[a.value]&&a.values[a.value].nobeginner&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:e.string.substitute(_("The option `${option_label}: ${option_name}` is STRONGLY discouraged with beginners at table."),{option_name:a.values[a.value].name,option_label:a.name})}),"table_warnings")}else for(i in t.options){(a=t.options[i]).values&&a.values[a.value]&&a.values[a.value].firstgameonly&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:e.string.substitute(_("The option `${option_label}: ${option_name}` is recommended ONLY for beginners on their first game."),{option_name:a.values[a.value].name,option_label:a.name})}),"table_warnings")}$("gameserver_id")&&($("gameserver_id").innerHTML=t.gameserver);var x=t.estimated_duration,k=!1;if(null!=t.gamestart)if(void 0!==t.result&&null!==t.result.time_duration){$("table_duration_label").innerHTML=_("Game duration:");x=Math.round(t.result.time_duration/60)}else{$("table_duration_label").innerHTML=_("Game started");var C=Math.floor(Date.now()/1e3);x=Math.round((C-t.gamestart)/60);k=!0}var T=x+" mn";if(k)T=time_ago_format(x);else if(x>1440)T=x>5760?Math.round(x/1440)+" "+_("days"):Math.round(10*x/1440)/10+" "+_("days");else if(x>120){var j=x%60;j<10&&(j="0"+j);T=Math.floor(x/60)+"h"+j}$("estimated_duration").innerHTML=T;$("estimated_duration_setup").innerHTML=T;e.style("estimated_duration_wrap","display","?"==t.estimated_duration?"none":"block");var S=_("${initial_time} + ${additional_time} / turn");$("time_to_think_descr").innerHTML=e.string.substitute(S,{initial_time:this.formatReflexionTime(t.time_profile.initial_time_to_thing).string,additional_time:this.formatReflexionTime(t.time_profile.additional_time_per_move).string});20==t.options[200].value?$("gameoption_description_200").innerHTML="":$("gameoption_description_200").innerHTML=$("time_to_think_descr").innerHTML;1==t.options[201].value?$("gameoption_description_201").innerHTML=_("Training mode: no rankings, no time limit, no penalties."):0==t.options[201].value?$("gameoption_description_201").innerHTML="":2==t.options[201].value&&($("gameoption_description_201").innerHTML='<div class="icon20 icon_arena"></div> '+_("Arena mode: compete for the seasonal BGA trophy."))},onAcknowledgeWarning:function(t){t.preventDefault();if(null!=$("warning_accept")){e.style("warning_accept","display","none");e.style("warning_accepted","display","")}if(null!=$("join_confirm")){e.removeClass("join_confirm","bgabutton_darkgray");e.addClass("join_confirm","bgabutton_blue")}},updateCurrentPlayerStatus:function(e){this.is_admin=e.admin_id==current_player_id;e.options&&e.options[201]&&2==e.options[201].value&&($("go_to_table_id")||(this.is_admin=!1));var t;this.is_at_table=!1;this.is_still_at_table=!1;this.is_expected_at_table=!1;for(t in e.players)if(e.players[t].id==current_player_id)if("play"==e.players[t].table_status||"playasync"==e.players[t].table_status){this.is_at_table=!0;this.is_still_at_table=!0}else"expected"==e.players[t].table_status&&(this.is_expected_at_table=!0)},updatePlayers:function(t){e.empty("players_at_table");var a,n=!1;if(!t.arePlayerAnonymized){if(void 0===this.was_expected_at_table){this.was_expected_at_table={};this.bFirstUpdatePlayers=!0}else this.bFirstUpdatePlayers=!1;if(t.result);else{e.style($("current_players"),"display","block");var o=0;for(a in t.player_display){var s=t.player_display[a],r=t.players[s],l=r.fullname,d=r.rank,c=null===r.rank_no,u=this.getRankString(r.rank_no),h=r.prestige,p=this.getRankClassFromElo(d),m=this.getRankClassFromEloUntranslated(d),g=this.eloToBarPercentage(d,t.game_hide_ranking),f=p;d>=1400&&!t.game_hide_ranking&&0!==r.rank_no&&(f+=" - "+u);var b=r.arena_points;null===b&&(b=1);var y=this.arenaPointsDetails(b,t.league_number),v=(R=this.arenaPointsHtml(y)).bar_content,w=R.bottom_infos,x=y.league_name,k=R.bar_pcent;if(5==y.league){x='<div class="icon_elite_bar"></div>';x+=" "+this.getRankString(r.rank_no)}var C=!1;this.is_admin?C=s!=current_player_id&&("open"==t.status||"meeting"==t.status||"init"==t.status||"asyncinit"==t.status||"asyncopen"==t.status):t.admin_id==s&&"offline"==r.status&&this.is_at_table&&(C=!0);var T=t.admin_id==s?"("+_("table administrator")+")":"",j=getPlayerAvatar(s,r.avatar,92);if("zombie"==r.table_status){""!=T&&(T+="<br/>");T+=_("This player left the game")}else if("expected"==r.table_status){""!=T&&(T+="<br/>");T+=_("This player is expected at this table");if(!this.bFirstUpdatePlayers&&void 0===this.was_expected_at_table[s]&&this.is_admin&&"offline"==r.status&&this.is_admin&&"offline"==r.status){const e=_("You just invited an offline player. Do you want to send him this invitation by email?");i.bgaConfirm({title:_("Email invitation"),description:e,noButton:_("No"),yesButton:_("Send email")}).then(e=>{"yes"===e&&this.ajaxcall("/table/table/invitePlayerEmail.html",{table:this.table,player:s},this,function(e){var t=_("Done");e&&"refused-by-preference"===e.result&&(t=_("Invitation email not sent: this player doesn't want to receive an invitation email"));this.showMessage(t,"info")})})}if(void 0!==mainsite.invitedOfflinePlayerToConfirm&&void 0!==mainsite.invitedOfflinePlayerToConfirm[this.table]&&void 0!==mainsite.invitedOfflinePlayerToConfirm[this.table][s]&&this.is_admin&&"offline"==r.status){const t=e.string.substitute(_("You just invited an offline player (${player}). Do you want to send him this invitation by email?"),{player:mainsite.invitedOfflinePlayerToConfirm[this.table][s].name});i.bgaConfirm({title:_("Email invitation"),description:t,noButton:_("No"),yesButton:_("Send email")}).then(e=>{"yes"===e&&this.ajaxcall("/table/table/invitePlayerEmail.html",{table:this.table,player:s},this,function(e){var t=_("Done");e&&"refused-by-preference"===e.result&&(t=_("Invitation email not sent: this player doesn't want to receive an invitation email"));this.showMessage(t,"info")})});delete mainsite.invitedOfflinePlayerToConfirm[this.table][s]}this.was_expected_at_table[s]=!0}else if("eliminated"==r.table_status){""!=T&&(T+="<br/>");T+=_("This player has been eliminated")}var S="beginner",M="";if(1==r.freeaccount)S="free";else if(1==r.premiumaccount){S="premium";M="is_premium"}var A=this.getKarmaLabel(r.karma),E={player_id:s,player_name:l,status:r.status,statusicon:playerDeviceToIcon(r.device),fire_visibility:C?"inline":"none",rank:t.game_hide_ranking?"":this.formatElo(d),rank_no:u,rank_class:m,rank_label:f,elobarpcent:g,arena_points:b,arena_points_html:v,arena_bottom_infos:w,arenabarpcent:k,league_name:x,league_id:y.league,played:r.played,realPlayed:r.realPlayed,grade:r.grade,emblem:j,genderclass:null===r.gender?"gender_not_specified":1==r.gender?"fa-mars male":"fa-venus female",flag:r.country.code,prestige:h,prestige_mask:"",details:T,accounttype:S,emblem_class:M,victory:r.victory,hit:r.hit,thumb_up:r.thumb_up,thumb_down:r.thumb_down,karma:r.karma,karma_label:A.label,karma_class:A.css,karma_alert:"",on_recent_games:e.string.substitute(_("on ${recent_games} recent games"),{recent_games:r.recent_games}),recent_leave:r.recent_leave,recent_clock:r.recent_clock,game:this.tabledatas.game_id,hotseat:"",player_right_status:""};if(null!=r.th_name){E.player_name=r.th_name;E.hotseat="hotseat_player";E.emblem=getStaticAssetUrl("img/mainsite/hotseat.png");E.player_right_status='<p style="text-align:center;margin-top:10px;">('+_("Hotseat player")+') <span class="beta_label">BETA</span></p>'}var N=this.format_string(this.jstpl_player_table,E);e.place(N,"players_at_table");c&&this.addTooltip("gamerankno_"+s,__("lang_mainsite","This player is not ranked because he did not play this game recently"),"");if(null!=r.th_name){e.style("flag_"+s,"display","none");e.query("#active_player_"+s+" .playersubinfos_lang").style("display","none")}E.karmaicon="";if("no"!=r.karma_alert&&s==current_player_id){E.karma_alert='<div class="warning warning_high warning_big">';E.karma_alert+=_("A significant proportion of players (more than %s) report that they do not like to play with you.").replace("%s",("low"==r.karma_alert?10:20)+"%");E.karma_alert+=_("You should try to get more positive feedback. In the meantime, your reputation is limited.");E.karma_alert+="</div>"}this.addTooltipHtml("reputation_details_"+s,this.format_string(this.jstpl_reputation_details,E));E.elo_label=this.getEloLabel(d);if(t.game_hide_ranking){E.elo_label=this.getEloLabel(d,!1,!1,!0);E.rank_no=_("Unavailable for this game")}else 0==E.rank_no?E.rank_no=_("Not available (not in Top 100)"):d<1400&&(E.rank_no=_("Not ranked (ELO < 100)"));this.addTooltipHtml("elo_details_"+s,this.format_string(this.jstpl_elo_details,E));if(this.isTouchDevice){$("elo_details_"+s+"_bar").href="javascript:void(0)";$("elo_details_"+s+"_bar").target=""}this.addTooltipHtml("prestige_details_"+s,this.format_string(this.jstpl_prestige_details,E));for(var L=!0,D=1;D>=0;D--)for(var P in r.languages)if(r.languages[P].level==D){var I=P;1===toint(r.languages[P].level)&&(I="<b>"+P+"</b>");var R='<span id="lang_'+s+"_"+P+'">'+this.ucFirst(I)+"</span>";L?L=!1:R="<span>, </span>"+R;e.place(R,"speak_"+s);this.addTooltip("lang_"+s+"_"+P,r.languages[P].name,"")}for(var F in r.awards){var O=r.awards[F];O.name=__("lang_mainsite",O.nametr);if(toint(O.type_id)>1e3){O.base_img=getStaticAssetUrl("img/awards/"+O.type_id+"_"+O.prestigeclass+"-25.png");O.base_img_large=getStaticAssetUrl("img/awards/"+O.type_id+"_"+O.prestigeclass+".png");var B=getGroupAvatar(O.tgroup,O.group_avatar,"tournament",50);O.addimg='<img src="'+B+'"/>';O.link="/tournament?id="+O.linked_tournament;O.name=O.championship_name+" "+O.tournament_name+": "+O.name}else{O.base_img=getStaticAssetUrl("img/awards/"+O.type_id+"-25.png");O.base_img_large=getStaticAssetUrl("img/awards/"+O.type_id+".png");O.addimg="";O.link="/award?game="+O.game+"&award="+O.type_id}var H=this.format_string(this.jstpl_trophy,Object.assign({},O,{name:O.name.replace("%s",O.namearg)}));e.place(H,"trophies_"+s);var z='<div class="trophytooltip_displayed"><h3>'+$("trophytooltip_"+O.id).innerHTML+"</h3>";z+="<hr/>";z+='<div class="trophyimg_wrap"><div class="trophyimg trophyimg_xlarge trophyimg_'+O.tpe_id+'"  style="background-image: url(\''+O.base_img_large+"');\">";z+=O.addimg;z+="</div></div>";z+='<div class="xp_container">'+O.prestige+' XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div>';z+="</div>";this.addTooltipHtml("awardimg_"+O.id,z)}if(C){this.addTooltip("fire_player_"+s,"",_("Kick this player from the table"));e.connect($("fire_player_"+s),"onclick",this,"onFirePlayer")}"beginner"==S&&this.addTooltip("accounttype_"+s,_("Beginner account"),"");"free"==S?this.addTooltip("accounttype_"+s,_("Standard account"),""):"premium"==S&&this.addTooltip("accounttype_"+s,_("Premium member: this player helps us to develop this service :)"),"");if(s!=current_player_id&&this.playeropinion[s]){var q=new ebg.thumb,G=this.playeropinion[s].t;q.staticControl=!0;q.create(this,"current_reput_"+s,s,G);-1==G&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("You dislike to play with this player")}),"warnings_"+r.id);if(1==this.playeropinion[s].n){e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_low",warning_icon:"sticky-note-o",text:'<span id="stickynote_'+s+'">'+_("Loading...")+"</span>"}),"warnings_"+r.id);this.ajaxcall("/community/community/loadStickyNote.html",{player:s},this,function(e){$("stickynote_"+e.player)&&($("stickynote_"+e.player).innerHTML=e.note)});this.addTooltip("stickynote_"+s,e.string.substitute(_("A personal note on ${player}, for your eyes only"),{player:l}),"")}}0==r.is_confirmed&&"expected"==r.table_status&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This player didn't confirm his participation yet")}),"warnings_"+r.id);0==r.played&&s!=current_player_id&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("It is the first game of this player. Does he know the rules ?")}),"warnings_"+r.id);0==r.played&&(n=!0);toint(r.thumb_up)+toint(r.thumb_down)>0&&toint(r.thumb_down)/(toint(r.thumb_up)+toint(r.thumb_down));toint(r.karma)<50&&s!=current_player_id?e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This player has a very bad reputation.")}),"warnings_"+r.id):toint(r.karma)<65&&s!=current_player_id&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This player does not have a good reputation.")}),"warnings_"+r.id);1==toint(r.grade)&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("Due to moderatation, this player cannot chat.")}),"warnings_"+r.id);if(1==r.same_ip){R=_("This player plays from the same internet address than another player.");R+=' <a class="bga-link" href="/doc/multipleaccounts" target="_blank">'+_("Please read our multiple accounts policy.")+"</a>";e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_low",warning_icon:"exclamation-circle",text:R}),"warnings_"+r.id)}if(toint(r.recent_games)>0){toint(r.recent_leave)/toint(r.recent_games);toint(r.recent_clock)/toint(r.recent_games)}else{toint(r.recent_leave)>0&&1;toint(r.recent_clock)>0&&1}if("expected"==r.table_status){T=_("This player is expected");e.addClass("active_player_"+s,"active_player_expected")}this.addTooltipToClass("gamerank_mask",_("Player rank is hidden for player with free account"),"");this.addTooltipToClass("gamerank",_("Player rank at this game"),"");this.addTooltipToClass("reputation",_("Player reputation"),"");this.addTooltip("flag_"+s,r.country.name,"");o++}this.addTooltipToClass("icon20_speak",_("Languages spoken"),"");this.addTooltipToClass("gender_not_specified",_("Gender not specified"),"");this.addTooltipToClass("male",_("Man"),"");this.addTooltipToClass("female",_("Woman"),"");if("open"==t.status||"meeting"==t.status||"init"==t.status||"asyncinit"==t.status||"asyncopen"==t.status)for(;o<t.max_player;){o++;var W="freeplace",U=_("Free");if(o>t.min_player){W="freeplaceopt";U=_("Free - a player is welcome")}e.place(this.format_string(this.jstpl_player_table_free,{freeplacetype:W,text:U,invite_ai_text:_("Play against computer")}),"players_at_table")}e.query(".invite_ai_action").connect("onclick",this,"onInviteAi");if(1==t.options[201].value){e.query(".player_elo_details").style("display","none");e.query(".player_arena_details").style("display","none")}else if(0==t.options[201].value){e.query(".player_elo_details").style("display","block");e.query(".player_arena_details").style("display","none")}else if(2==t.options[201].value){e.query(".player_elo_details").style("display","none");e.query(".player_arena_details").style("display","block")}}e.query("#ai_list .ai").length>0&&e.query(".invite_ai").style("display","inline");e.empty("table_players_warnings");var V=toint(t.current_present_player_nbr);for(var Y in t.not_recommend_player_number)t.not_recommend_player_number[Y]==V&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:e.string.substitute(_("We don't recommended to play this game with ${nbr} players."),{nbr:V})}),"table_players_warnings");if(n)for(var Y in t.beginner_not_recommended_player_number)t.beginner_not_recommended_player_number[Y]==V&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:e.string.substitute(_("With beginners at table, we STRONGLY discourage you to play this game with ${nbr} players."),{nbr:V})}),"table_players_warnings");20==t.options[200].value&&1!=t.options[201].value&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This table is configured with 'No time limit': this is IMPOSSIBLE to expel a player who does not play.")+" "+_("Thus, we recommend you to only play with friends only.")}),"table_players_warnings");if(isset(t.players[this.player_id])&&"zombie"!=t.players[this.player_id].table_status&&"expected"!=t.players[this.player_id].table_status&&t.rtc_mode>0){if(null===mainsite.room||mainsite.room.indexOf("T")>=0)mainsite.setNewRTCMode(this.table,null,t.rtc_mode);else if(mainsite.room.indexOf("P")>=0){R='<div  class="rtc_dialog"><br />';R+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+(!1!==this.mediaConstraints.video?_("A Premium user has set up a video chat session for this table!"):_("A Premium user has set up an audio chat session for this table!"))+"</i></div><br /><br />";R+='<div style="text-align: center; font-weight: bold;">'+_("But you are already taking part in another live chat session!")+"<br /><br /> "+_("Do you want to join the call?")+" ("+_("you will be disconnected from your current live chat session to join the new one")+")</div><br /><br />";R+=_('If you choose "no" then change your mind, just refresh the page (F5) to get this prompt again!');R+="</div>";this.confirmationDialog(R,e.hitch(this,function(){var e=mainsite.room.substr(1).split("_"),i=e[0]==current_player_id?e[1]:e[0];this.mediaConstraints.video?this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:i},this,function(e){mainsite.setNewRTCMode(this.table,null,t.rtc_mode)}):this.mediaConstraints.audio&&this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:i},this,function(e){mainsite.setNewRTCMode(this.table,null,t.rtc_mode)})}),e.hitch(this,function(){}))}if(null!==mainsite.room&&mainsite.room.indexOf("T")>=0)for(player_id in t.players)null!=$("rtc_container_"+player_id)&&null!=$("emblem_"+player_id)&&e.hasClass($("rtc_container_"+player_id),"rtc_video_container")&&this.placeOnObject($("rtc_container_"+player_id),$("emblem_"+player_id))}mainsite.updatePremiumEmblemLinks()}},updateVisitors:function(t){e.empty("players_around_table");this.last_visitorlist=t;var i=0;let a=new Map;for(const e in t)a.set(t[e].user,t[e].connInfo.username);for(const o of a){const t=o[0],a=o[1];e.place(this.format_string(this.jstpl_visitor,{player_id:t,player_fullname:a}),"players_around_table");i++}var n="inline";e.hasClass("ebd-body","mobile_version")&&(n="block");i>1?e.style("startchat_tablemenu","display",n):e.style("startchat_tablemenu","display","none")},updatePlayStatus:function(t){e.style("access_game_panel","display","block");var i=Math.max(0,3*toint(this.tableProgression));e.style($("game_progression_inner"),"width",i+"px")},updateSetupStatus:function(t){var i;if("setup"==t.status&&this.is_at_table){if("1"==t.players[current_player_id].decision){e.style($("start_game_accept_wrap"),"display","none");e.style($("start_game_status_wrap"),"display","block");this.is_admin&&e.style($("start_game_cancel_wrap"),"display","block");$("wait_for_players").innerHTML="";for(i in t.players){var a=t.players[i];"play"==a.table_status&&1!=a.decision&&($("wait_for_players").innerHTML+=a.fullname+" ")}}else{e.style($("start_game_accept_wrap"),"display","block");e.style($("start_game_status_wrap"),"display","none");e.style($("start_game_cancel_wrap"),"display","none")}}},updateFinished:function(t){e.style("game_result_panel","display","block");e.style("statistics","display","none");var i="dojo/i18n!ebg/nls/lang_"+t.game_name;""!=mainsite.jsbundlesversion&&(i+="-"+mainsite.jsbundlesversion);require([i],e.hitch(this,function(e){globalThis.g_i18n.loadBundle("lang_"+t.game_name).finally(()=>{this.tableresults=new ebg.tableresults;this.tableresults.create(this,"game_result_content","statistics_content",t,this.pma);this.updateButtonVisibility(t)})}));if("normal_end"===t.result.endgame_reason||"normal_concede_end"===t.result.endgame_reason||"neutralized_after_skipturn"===t.result.endgame_reason||"neutralized_after_skipturn_error"===t.result.endgame_reason){e.style("statistics","display","block");if("finished"==t.status&&!e.hasClass("realtime_turnbased_icon","icon32_realtime"))for(id in t.players)id==current_player_id&&e.style("game_end_links","display","block")}},getTurnBasedConfirmDlg:function(t){var i=new ebg.popindialog;i.create("joinGameDialog");i.setTitle(_("Play a turn-based game"));i.setMaxWidth(600);i.tableModule=this;var a='<div id="joinGameDialog">';a+="<p>"+_("You are about to play a turn-based game with <b>real opponents</b>.")+"</p>";-1==$("estimated_duration").innerHTML.indexOf("?")&&(a+="<p>"+_("LB_GAMEREADY_MESSAGE_THE_DURATION")+" <b>"+$("estimated_duration").innerHTML+"</b></p>");a+="<p>"+_("LB_GAMEREADY_MESSAGE_BY_CLIQUING")+"</p>";a+="<br/><div id='join_confirm_warnings'></div>";a+="<br/><p><a class='bgabutton bgabutton_gray bgabutton_big' id='join_cancel' href='#'>"+_("I refuse")+"</a>&nbsp;&nbsp;&nbsp;<a class='bgabutton bgabutton_blue bgabutton_big' id='join_confirm' href='#'>"+_("I accept")+"</a></p><br/>";a+='<p class="smaller">'+$("ttt_wrap").innerHTML+"</p>";a+='<p class="smaller">'+_("LB_GAMEREADY_MESSAGE_A_TEMPORARY_ABSENCE")+"</p>";a+="</div>";i.setContent(a);i.show();if("beta"==this.tabledatas.game_status){var n=e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This game is a BETA version.")+" "+_("By playing it, you may encounter some bugs or unstability: in some cases, it could affect your reputation.")+" "+_("If you would be bothered by that, you should play in Training Mode.")+" "+_("Please report any issue in the <a href='%s' target='_blank'>bug management system</a>.").replace("%s","/bug?id=0&table="+this.table)}),"join_confirm_warnings");e.place(' <a class="bgabutton bgabutton_red bgabutton_small_margin" id="warning_accept" href="#" ><i class="fa fa-square-o"></i> <span>'+_("Agree?")+"</span></a> ",n);e.place(' <a class="bgabutton bgabutton_gray bgabutton_small_margin" id="warning_accepted" href="#" ><i style="color:darkgreen" class="fa fa-check-square-o"></i> <span>'+_("Agreed!")+"</span></a> ",n);e.style("warning_accept","display","none");e.style("warning_accepted","display","none");if(void 0!==this.tabledatas.players[current_player_id])if(0==this.tabledatas.players[current_player_id].played){e.style("warning_accept","display","");e.style("warning_accepted","display","none");e.connect($("warning_accept"),"onclick",this,"onAcknowledgeWarning");e.connect($("warningbis_accept"),"onclick",this,"onAcknowledgeWarning");if(null!=$("join_confirm")){e.removeClass("join_confirm","bgabutton_blue");e.addClass("join_confirm","bgabutton_darkgray")}}else{e.style("warning_accept","display","none");e.style("warning_accepted","display","")}}else this.tabledatas.beta_option_selected&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("A BETA option has been selected for this game.")+" "+_("By playing it, you may encounter some bugs or unstability: in some cases, it could affect your reputation.")+" "+_("If you would be bothered by that, you should play in Training Mode.")+" "+_("Please report any issue in the <a href='%s' target='_blank'>bug management system</a>.").replace("%s","/bug?id=0&table="+this.table)}),"join_confirm_warnings");["private_alpha","alpha"].includes(this.tabledatas.game_status)?e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("This game is an ALPHA version.")+" "+_("It is started in Training Mode, so you can quit anytime without penalties.")+" "+_("Please report any issue in the <a href='%s' target='_blank'>bug management system</a>.").replace("%s","/bug?id=0&table="+this.table)}),"join_confirm_warnings"):this.tabledatas.alpha_option_selected&&e.place(this.format_string(this.jstpl_warning,{warning_type:"warning_high",warning_icon:"exclamation-triangle",text:_("An ALPHA option has been selected for this game.")+" "+_("It is started in Training Mode, so you can quit anytime without penalties.")+" "+_("Please report any issue in the <a href='%s' target='_blank'>bug management system</a>.").replace("%s","/bug?id=0&table="+this.table)}),"join_confirm_warnings");e.connect($("join_cancel"),"onclick",e.hitch(i,function(e){e.preventDefault();this.destroy()}));e.connect($("join_confirm"),"onclick",e.hitch(i,function(i){i.preventDefault();if(null!=$("join_confirm")&&e.hasClass("join_confirm","bgabutton_darkgray"))this.tableModule.showMessage(_("You need to acknowlege the BETA warning first (only for your first game)"),"error");else{e.destroy("joinGameDialog");this.destroy();t(this.tableModule)}}))},confirmStartWithoutExpectedPlayers:function(){var e=Object.values(this.tabledatas.players).filter(function(e){return"expected"===e.table_status});if(0!==e.length){var t=new ebg.popindialog;t.create("confirmStartWithoutExpectedPlayersDialog");t.setTitle(_("Start game without all expected players ?"));t.setMaxWidth(600);var i=[];i.push('<div id="confirmStartWithoutExpectedPlayersDialog">');i.push("<p>"+_("You are about to start the game without :")+"</p>");i.push("<ul>");e.forEach(function(e){i.push('<li class="playername">&nbsp;&bull;&nbsp;'+e.fullname+"</li>")});i.push("</ul>");i.push('<div style="display: flex; justify-content: flex-end; align-items: flex-end;">');i.push('<a style="margin-left: 10px" href="#" class="bgabutton bgabutton_gray" id="confirmStart_no">'+_("Wait a little bit more")+"</a>");i.push('<a style="margin-left: 10px" href="#" class="bgabutton bgabutton_blue bgabutton_big" id="confirmStart_yes">'+_("Start anyway !")+"</a>");i.push("</div>");i.push("</div>");t.setContent(i.join(""));t.show();this.connect($("confirmStart_yes"),"onclick",function(){t.destroy();this.doStartGame(!0)});this.connect($("confirmStart_no"),"onclick",function(){t.destroy()})}else this.doStartGame(!0)},onJoinGame:function(e){this.table;e.preventDefault();analyticsPush({game_name:this.tabledatas.game_name,cta_location:"table_join",event:"play_last_step"});this.joinGame()},joinGame:function(){localStorage.setItem("bga-lobby-type","old");"asyncopen"==this.tabledatas.status||"asyncinit"==this.tabledatas.status?this.getTurnBasedConfirmDlg(e.hitch(this,function(e){e.ajaxcall("/table/table/joingame.html",{table:e.table},this,function(e){})})):this.ajaxcall("/table/table/joingame.html",{table:this.table},this,function(e){})},onRegisterGame:function(e){this.table;e.preventDefault();this.ajaxcall("/table/table/registergame.html",{table:this.table},this,function(e){})},onQuitGame:function(t){this.table;t.preventDefault();mainsite.leaveTable(this.table,e.hitch(this,function(){null!==mainsite.room&&mainsite.room.indexOf("T")>=0&&mainsite.doLeaveRoom();1==$("automatic_matchmaking_config").innerHTML&&gotourl("lobby")}))},onRefuseInvitation:function(t){t.preventDefault();var i,a=!1;1===toint(this.tabledatas.players[current_player_id].is_confirmed)&&(a=!0);var n=0;for(i in this.tabledatas.players)1==toint(this.tabledatas.players[i].is_confirmed)&&n++;1==n&&(a=!1);if(a){e.require("dijit.Dialog");e.destroy("quitConfirmContent");var o=new dijit.Dialog({title:_("Do not attend this meeting")});o.tableModule=this;var s='<div id="quitConfirmContent">';s+=_("You are about to cancel your participation to a meeting.")+"<br/>";s+=_("Some of your opponents confirmed their participation to this meeting.")+"<br/>";s+=_("These opponents will probably give you a <div class='icon20 icon20_reputdown'></div>.<br/><br/>");s+="<p><a class='bigbutton' id='quitgame_confirm' href='#'>"+_("I confirm")+"</a> <a class='bigbutton' id='quitgame_cancel' href='#'>"+_("Cancel")+"</a></p>";s+="</div>";o.attr("content",s);o.show();e.connect($("quitgame_cancel"),"onclick",e.hitch(o,function(t){t.preventDefault();e.destroy("quitConfirmContent");this.hide()}));e.connect($("quitgame_confirm"),"onclick",e.hitch(o,function(t){t.preventDefault();e.destroy("quitConfirmContent");this.hide();this.tableModule.ajaxcall("/table/table/refuseInvitation.html",{table:this.tableModule.table},this,function(e){})}))}else this.ajaxcall("/table/table/refuseInvitation.html",{table:this.table},this,function(e){})},onConfirmParticipation:function(e){e.preventDefault();this.ajaxcall("/table/table/confirmParticipation.html",{table:this.table},this,function(e){})},onStartGame:function(e){e.preventDefault();this.doStartGame(!1)},doStartGame:function(e){if(!0===e){this.table;mainsite.autoredirectedWhenTableStarts=this.table;this.ajaxcall("/table/table/startgame.html",{table:this.table},this,function(e){})}else this.confirmStartWithoutExpectedPlayers()},onFirePlayer:function(e){e.preventDefault();var t=e.currentTarget.id.substr(12);this.ajaxcall("/table/table/fireplayer.html",{table:this.table,player:t},this,function(e){})},onStartGameAccept:function(t){t.preventDefault();e.style($("start_game_accept_wrap"),"display","none");this.is_admin&&e.style($("start_game_cancel_wrap"),"display","block");this.ajaxcall("/table/table/acceptGameStart.html",{table:this.table},this,function(e){})},onStartGameRefuse:function(t){t.preventDefault();e.style($("start_game_accept_wrap"),"display","none");e.style($("start_game_cancel_wrap"),"display","none");this.ajaxcall("/table/table/refuseGameStart.html",{table:this.table},this,function(e){})},onCreateNewTable:function(e){e.preventDefault();this.ajaxcall("/table/table/createnew.html",{game:this.tabledatas.game_id,lastTableId:this.table},this,function(e){gotourl("gamepanel?id="+this.tabledatas.game_id+"#"+e.gameStatus+","+e.gameMode+",fromTable="+this.table)})},onRematch:function(e){e.preventDefault();this.ajaxcall("/table/table/createnew.html",{game:this.tabledatas.game_id,rematch:this.table,src:"r"},this,function(e){if(e.table){e.table;gotourl("gamepanel?id="+this.tabledatas.game_id)}else e.mmstarted?i.stores.matchmakings.loadMatchmakings().then(()=>{gotourl("gamepanel?id="+this.tabledatas.game_id)}):gotourl("gamepanel?id="+this.tabledatas.game_id)})},onExpressStart:function(e){e.preventDefault();mainsite.autoredirectedWhenTableStarts=this.table;this.ajaxcall("/tablemanager/tablemanager/expressStart.html",{table:this.table},this,function(e){})},onExpressStop:function(t){t.preventDefault();this.ajaxcall("/table/table/expressGameStopTable.html",{table:this.table},this,e.hitch(this,function(e,t){}))},getAvailablePlayersInitialList:function(){this.ajaxcall("/lobby/lobby/availableforgame.html",{game:this.tabledatas.game_id},this,function(t){e.empty("available_players_for_game");for(var i in t){var a=t[i];this.addAvailablePlayer(a)}this.updateAvailablePlayersNumber();toint(t.length)<=5&&"yes"==$("game_turnbased_config").innerHTML&&e.style("suggest_turnbased","display","block")})},addAvailablePlayer:function(t){if($("availableplayer_"+t.id)){e.destroy("availableplayer_"+t.id);this.availablePlayersToEloDiff[t.id]&&delete this.availablePlayersToEloDiff[t.id]}if(!$("active_player_"+t.id)){t.reputvisibility="none";t.stickyvisibility="none";t.reput="";if(this.playeropinion[t.id]){if(0!=this.playeropinion[t.id].t){t.reputvisibility="inline-block";t.reput=-1==this.playeropinion[t.id].t?"down":"up"}0!=this.playeropinion[t.id].n&&(t.stickyvisibility="inline-block")}t.gamevisibility=null!=t.table_id?"inline-block":"none";null==t.table_id&&(t.table_id="");null==t.game_name?t.game_name="":t.game_name=this.getGameNameDisplayed(t.game_name);t.suggest_label=_("Suggest to join table");placeNodeAfter="";void 0!==t.ranks&&(t.ranks[this.tabledatas.game_id]?t.rank=t.ranks[this.tabledatas.game_id]:t.rank="?");var i=Math.abs(toint(t.rank)-this.player_elo),a=0,n=9999999;for(var o in this.availablePlayersToEloDiff)if(toint(this.availablePlayersToEloDiff[o])>=-toint(i)&&toint(this.availablePlayersToEloDiff[o])<=n){a=o;n=toint(this.availablePlayersToEloDiff[o])}0!=a?$("availableplayer_"+a)&&(placeNodeAfter="availableplayer_"+a):placeNodeAfter="first";this.availablePlayersToEloDiff[t.id]=-toint(i);t.rankformatted=this.getEloLabel(t.rank);""!=placeNodeAfter?"first"==placeNodeAfter?e.place(e.string.substitute(this.jstpl_availableplayer,t),"available_players_for_game","first"):e.place(e.string.substitute(this.jstpl_availableplayer,t),placeNodeAfter,"after"):e.place(e.string.substitute(this.jstpl_availableplayer,t),"available_players_for_game");e.connect($("suggestjoin_"+t.id),"onclick",this,"onSuggestJoin");if("inline-block"==t.stickyvisibility){e.connect($("sticky_avail_"+t.id),"onmouseenter",e.hitch(this,function(e){var t=e.currentTarget.id.substr(13),i=$("sticky_avail_"+t),a="<span id='stickynote_content_"+t+"'>"+_("Loading...")+"</span>";dijit.Tooltip.show(a,i);this.ajaxcall("/community/community/loadStickyNote.html",{player:t},this,function(e){$("stickynote_content_"+t)&&($("stickynote_content_"+t).innerHTML=e.note)})}));e.connect($("sticky_avail_"+t.id),"onmouseleave",e.hitch(this,function(e){var t=e.currentTarget.id.substr(13),i=$("sticky_avail_"+t);dijit.Tooltip.hide(i)}))}for(o in this.tabledatas.suggested)t.id==this.tabledatas.suggested[o]&&this.setPlayerAsSuggested(t.id);this.updateAvailablePlayersNumber()}},updateAvailablePlayersNumber:function(){var t=e.query("#available_players_for_game .availableplayer").length;$("nb_available_players_nb").innerHTML=t},onLobbyStats:function(e){void 0!==e.args.stats[this.table_game_id]&&($("nb_available_players_nb").innerHTML=e.args.stats[this.table_game_id])},onNewPlayersAvailable:function(e){for(var t in e.args.players)this.addAvailablePlayer(e.args.players[t])},onRemovePlayersAvailable:function(t){for(var i in t.args.players){var a=t.args.players[i];if($("availableplayer_"+a)){e.fx.wipeOut({node:"availableplayer_"+a,duration:200,onEnd:e.hitch(this,function(t){e.destroy(t);this.updateAvailablePlayersNumber()})}).play();this.fadeOutAndDestroy("availableplayer_"+a);this.availablePlayersToEloDiff[a]&&delete this.availablePlayersToEloDiff[a]}}},onSuggestJoin:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(12);this.ajaxcall("/lobby/lobby/suggest.html",{table:this.table,player:i},this,function(t){e.addClass("available_players_for_game","disable_suggest");setTimeout(e.hitch(this,function(){if($("available_players_for_game")){e.removeClass("available_players_for_game","disable_suggest");this.getAvailablePlayersInitialList()}}),5100)})},setPlayerAsSuggested:function(t){if($("suggestjoin_"+t)){e.style("suggestjoin_"+t,"display","none");e.style("suggestsent_"+t,"display","inline")}},onTableSuggest:function(e){if(e.args.table_id==this.table){this.setPlayerAsSuggested(e.args.suggested_id);this.tabledatas.suggested&&this.tabledatas.suggested.push&&this.tabledatas.suggested.push(e.args.suggested_id)}},onTableInfosChanged:function(e){if(e.args.id==this.table){this.tabledatas=e.args;this.updateCurrentPlayerStatus(e.args);var t=!1;"playerJoinGame"!=e.args.reload_reason&&"expectedPlayerJoinGame"!=e.args.reload_reason&&"playerQuitGame"!=e.args.reload_reason||e.args.status==this.previous_status&&(t=!0);if(t){this.updatePlayers(e.args);this.updateButtonVisibility(e.args);"playerJoinGame"==e.args.reload_reason||"expectedPlayerJoinGame"==e.args.reload_reason?playSound("joinTable"):playSound("move")}else this.loadTable(e.args)}},onPlayerStatusChanged:function(t){var i=t.args.player_id,a=t.args.player_status;if($("player_"+i+"_status")){e.removeClass("player_"+i+"_status","status_online");e.removeClass("player_"+i+"_status","status_inactive");e.removeClass("player_"+i+"_status","status_offline");e.addClass("player_"+i+"_status","status_"+a);i==this.tabledatas.admin_id&&(this.is_at_table&&!this.is_admin&&"offline"==a?e.style("fire_player_wrap_"+this.tabledatas.admin_id,"display","inline"):e.style("fire_player_wrap_"+this.tabledatas.admin_id,"display","none"))}},onAllPlayersAccepted:function(e){e.args.table==this.table&&this.showMessage(_("Everyone accepted to start. Game setup in progress ..."),"info")},onGameStateChange:function(t){if(void 0!==t.args.updateGameProgression){this.tableProgression=t.args.updateGameProgression;var i=3*toint(t.args.updateGameProgression);e.style($("game_progression_inner"),"width",i+"px")}},onUpdateSpectatorList:function(e){e.channelorig=="/table/ts"+this.table&&this.updateVisitors(e.args)},onDisplayChatlog:function(t){t.preventDefault();e.place('<img alt="loading" src="'+getStaticAssetUrl("img/logo/waiting.gif")+'"/>',"tablechatlog");this.ajaxcall("/table/table/chatHistory.html",{type:"table",id:this.table,all:!0},this,function(e){$("tablechatlog").innerHTML="<br/><br/>";for(var t in e.history){var i=e.history[t],a=new Date(1e3*i.time),n=a.getFullYear(),o=a.getMonth()+1,s=a.getDate(),r=a.getHours(),l="0"+a.getMinutes(),d="0"+a.getSeconds(),c=n+"/"+o+"/"+s+" "+r+":"+l.substring(l.length-2)+":"+d.substring(d.length-2);$("tablechatlog").innerHTML+="<p>"+c+" <b>"+i.player_name+"</b>: "+i.text+"</p>"}},function(e){},"get")},onDisplayGamelog:function(t){t.preventDefault();e.place('<img alt="loading" src="'+getStaticAssetUrl("img/logo/waiting.gif")+'"/>',"tablegamelog");this.ajaxcall("/table/table/displayGameLog.html",{table:this.table},this,function(e){$("tablegamelog").innerHTML=e})},onAccessLevelSwitch:function(e){var t={table:this.table,level0:$("tableaccess_Beginners").checked,level1:$("tableaccess_Apprentices").checked,level2:$("tableaccess_Averageplayers").checked,level3:$("tableaccess_Goodplayers").checked,level4:$("tableaccess_Strongplayers").checked,level5:$("tableaccess_Experts").checked,level6:$("tableaccess_Masters").checked};this.ajaxcall("/table/table/changeTableAccessLevel.html",t,this,function(){this.accessLevelSwitchPreviousState={level0:$("tableaccess_Beginners").checked,level1:$("tableaccess_Apprentices").checked,level2:$("tableaccess_Averageplayers").checked,level3:$("tableaccess_Goodplayers").checked,level4:$("tableaccess_Strongplayers").checked,level5:$("tableaccess_Experts").checked,level6:$("tableaccess_Masters").checked}},function(e){if(e){$("tableaccess_Beginners").checked=this.accessLevelSwitchPreviousState.level0;$("tableaccess_Apprentices").checked=this.accessLevelSwitchPreviousState.level1;$("tableaccess_Averageplayers").checked=this.accessLevelSwitchPreviousState.level2;$("tableaccess_Goodplayers").checked=this.accessLevelSwitchPreviousState.level3;$("tableaccess_Strongplayers").checked=this.accessLevelSwitchPreviousState.level4;$("tableaccess_Experts").checked=this.accessLevelSwitchPreviousState.level5;$("tableaccess_Masters").checked=this.accessLevelSwitchPreviousState.level6}})},onAccessReputationSwitch:function(e){var t={table:this.table,karma:$("filter_karma").value};this.ajaxcall("/table/table/changeTableAccessReputation.html",t,this,function(){},function(t){t&&"filter_karma"==e.target.id&&($("filter_karma").value=0)})},onWantedMinMin:function(e){e.preventDefault();this.changeWantedPlayers(-1,0)},onWantedMinPlus:function(e){e.preventDefault();this.changeWantedPlayers(1,0)},onWantedMaxMin:function(e){e.preventDefault();this.changeWantedPlayers(0,-1)},onWantedMaxPlus:function(e){e.preventDefault();this.changeWantedPlayers(0,1)},changeWantedPlayers:function(e,t){var i=toint($("wanted_min").innerHTML),a=toint($("wanted_max").innerHTML);if(null===t){a=i;t=e}var n=this.tabledatas.game_min_players,o=this.tabledatas.game_max_players,s=i,r=a;i+=e;a+=t;i=this.adjustPlayerCountToValid(e,i,n,o);(a=this.adjustPlayerCountToValid(t,a,n,o))<i&&(-1==t?i=a:a=i);if(a<this.tabledatas.current_player_nbr)this.showMessage(_("Expel a player first"),"error");else if(i<n)this.showMessage(_("Can't start game with less players"),"error");else if(a>o)this.showMessage(_("Maximum number of players for this game"),"error");else{$("wanted_min").innerHTML=i;$("wanted_max").innerHTML=a;$("wanted").innerHTML=i;this.ajaxcall("/table/table/changeWantedPlayers.html",{table:this.table,maxp:a,minp:i},this,function(){},function(e){if(e){$("wanted_min").innerHTML=s;$("wanted_max").innerHTML=r;$("wanted").innerHTML=s}})}},adjustPlayerCountToValid:function(e,t,i,a){if(t>i&&t<a&&e)for(var n=e>0?1:-1;void 0===this.tabledatas.game_player_number[t];)t+=n;return t},onTableDateChange:function(){var e=dijit.byId("table_scheduled_date").value,t=new Date(toint(e)),i=dijit.byId("table_hour").value,a=dijit.byId("table_minute").value;t.setHours(i,a,0,0);e=Math.round(t.getTime()/1e3);this.ajaxcall("/table/table/changeTableDate.html",{table:this.table,timestamp:e},this,function(){})},tutorialThankYouDialog:function(t){e.require("dijit.Dialog");e.destroy("thankyouDialogContent");var i=new dijit.Dialog({title:_("Saying `thank you` for this first game")});i.tableModule=this;var a='<div id="thankyouDialogContent">';a+=_("You played your first game on BGA: congratulations!")+"<br/><br/>";a+=_("If you find one of your opponents helpful during this first game, please tell us so we can recommand him/her to other beginners:")+"<br/><br/>";a+="<ul>";for(id in t.result.player){var n=t.result.player[id];n.player_id!=current_player_id&&(a+="<li><a href='#' id='recommand_"+n.player_id+"' class='recommand' >"+e.string.substitute(_("Recommend ${player}"),{player:n.name})+"</a></li>")}a+="<li><a href='#' id='recommand_0' class='recommand' >"+_("I don't want to recommend anyone")+"</a></li>";a+="</ul></div><br/>";i.attr("content",a);i.show();e.query(".recommand").connect("onclick",e.hitch(i,function(t){t.preventDefault();var i=t.currentTarget.id.substr(10);this.tableModule.ajaxcall("/table/table/thankYouBeginner.html",{table:this.tableModule.table,player:i},this,function(e){});e.destroy("thankyouDialogContent");this.hide()}))},onOpenTableNow:function(t){e.stopEvent(t);"asyncopen"==this.tabledatas.status||"asyncinit"==this.tabledatas.status?this.getTurnBasedConfirmDlg(e.hitch(this,function(e){e.ajaxcall("/table/table/openTableNow.html",{table:e.table},this,function(e){})})):this.ajaxcall("/table/table/openTableNow.html",{table:this.table},this,function(e){})},onRealTimeAnyway:function(t){e.stopEvent(t);this.ajaxcall("/table/table/changeoption.html",{table:this.table,id:200,value:1},this,function(t){e.style("realtime_anyway_wrap","display","none")})},onTurnBasedAnyway:function(t){e.stopEvent(t);this.ajaxcall("/table/table/changeoption.html",{table:this.table,id:200,value:17},this,function(t){e.style("realtime_anyway_wrap","display","none")})},onStartChat:function(t){e.stopEvent(t);mainsite.createChatBarWindow({type:"table",id:this.table,label:$("table_name").innerHTML,game_name:this.tabledatas.game_name,url:"/table?table="+this.table,channel:"/table/t"+this.table,window_id:"table_"+this.table,subscribe:!1,start:"expanded"},!1);mainsite.expandChatWindow("table_"+this.table);mainsite.loadPreviousMessage("table",this.table)},onLimitTableAccess:function(t){e.stopEvent(t);this.restrictTableDialog=new ebg.popindialog;this.restrictTableDialog.create("restrictTableDialog");this.restrictTableDialog.setTitle(_("LB_LIMIT_THIS_TABLE_ACCESS"));if(void 0===this.restrict_form){this.restrict_form=e.clone($("limit_table_access_form"));e.destroy("limit_table_access_form")}var i='<div id="restrictTableDialog">';i+=this.restrict_form.innerHTML;i+="</div>";this.restrictTableDialog.setContent(i);this.restrictTableDialog.show();e.query(".tableaccess_level").connect("onclick",this,"onAccessLevelSwitch");e.query(".filter_reputation").connect("onchange",this,"onAccessReputationSwitch");e.connect($("restrictToGroup"),"onchange",this,function(){var e=$("restrictToGroup").value,t={table:this.table};0==toint(e)?t.none="1":t.group=e;this.ajaxcall("/table/table/restrictToGroup.html",t,this,function(e){})});e.connect($("restrictToLanguage"),"onchange",this,function(){var e=$("restrictToLanguage").value,t={table:this.table};0==toint(e)?t.none="1":t.lang=e;this.ajaxcall("/table/table/restrictToLanguage.html",t,this,function(e){})});e.connect($("limit_table_access_close"),"onclick",e.hitch(this,function(e){e.preventDefault();this.restrictTableDialog.destroy()}));var a=this.tabledatas;for(var n in a.level_filter.details){var o="tableaccess_"+n.replace(" ","");a.level_filter.details[n]?$(o).checked="checked":$(o).checked=""}this.accessLevelSwitchPreviousState={level0:$("tableaccess_Beginners").checked,level1:$("tableaccess_Apprentices").checked,level2:$("tableaccess_Averageplayers").checked,level3:$("tableaccess_Goodplayers").checked,level4:$("tableaccess_Strongplayers").checked,level5:$("tableaccess_Experts").checked,level6:$("tableaccess_Masters").checked};if($("filter_opinion")&&$("filter_leave")&&$("filter_clock")){$("filter_opinion").value=a.reputation_filter.details.opinion;$("filter_leave").value=a.reputation_filter.details.leave;$("filter_clock").value=a.reputation_filter.details.clock}$("filter_karma").value=a.reputation_filter.details.karma;null!==a.filter_group&&($("restrictToGroup").value=a.filter_group);null!==a.filter_lang&&($("restrictToLanguage").value=a.filter_lang)},showArenaFirstTimeTutorial:function(){this.arenaTutorial=new ebg.popindialog;this.arenaTutorial.create("arenaTutorial");this.arenaTutorial.setTitle('<div class="icon32 icon_arena arena_colored imgtext" style="top:7px"></div> '+_("Arena mode"));var t='<div id="arenaTutorialDialog" >';t+="<br/>";t+="<h3> "+_("Compete to become the world champion this season!")+"</h3>";t+="<br/>";t+="<p>"+e.string.substitute(_("You win ${point} each time you win a game."),{point:'<span class="icon20 icon_arena"></span>'})+"</p>";t+="<br/>";t+="<p>"+e.string.substitute(_("Get enough ${point} to be promoted to the upper leage!"),{point:'<span class="icon20 icon_arena"></span>'})+"</p>";t+="<br/>";t+="<p>"+_("Good luck.")+"</p>";t+="<br/>";t+="<br class='clear'/>";t+="</div>";this.arenaTutorial.setContent(t);this.arenaTutorial.show()},onInviteFriend:function(t){e.stopEvent(t);var i='<div id="invite_friends_popup" class="invite_friends_popup">';i+='<div style="text-align: center;margin-bottom:20px;margin-top: 5px;">';i+='<h1><i class="fa fa-group fa-lg"></i> '+__("lang_mainsite","Invite a friend")+"</h1>";i+="</div>";i+="<div id='invite_friends_content'></div>";i+="<div class='clear' />";i+="</div>";var a=!1;if(void 0===this.inviteFriendsPopup){a=!0;this.inviteFriendsPopup=new dijit.TooltipDialog({id:"invite_friends_popup",content:i,closable:!0});this.inviteFriends=new ebg.invitefriends;this.inviteFriends.create(this,"invite_friends_content");this.inviteFriends.bSeeMoreLink=!1;this.inviteFriends.bHotSeat=!0;this.inviteFriends.onSelectPlayer=e.hitch(this,"onInviteSomeFriend");this.inviteFriendsFirstRefresh=e.connect(this.inviteFriends,"onRefreshDone",e.hitch(this,function(){dijit.popup.close(this.inviteFriendsPopup);dijit.popup.open({popup:this.inviteFriendsPopup,around:$("invite_friend"),orient:["below","below-alt","above","above-alt"]});e.disconnect(this.inviteFriendsFirstRefresh)}));this.inviteFriends.refresh()}else this.inviteFriends.refresh();if(void 0!==this.inviteFriendsIsOpen&&this.inviteFriendsIsOpen){dijit.popup.close(this.inviteFriendsPopup);this.inviteFriendsIsOpen=!1}else{this.inviteFriendsIsOpen=!0;dijit.popup.open({popup:this.inviteFriendsPopup,around:$(t.currentTarget),orient:["below","below-alt","above","above-alt"]})}a&&(this.closingInviteFriend=e.connect(window,"onclick",this,function(){dijit.popup.close(this.inviteFriendsPopup);this.inviteFriendsIsOpen=!1}))},onInviteSomeFriend:function(e,t){var i={table:this.table,player:e};void 0!==t&&(i.hotseat=t);this.ajaxcall("/table/table/invitePlayer.html",i,this,function(e){})}})})},"ebg/selfedit":function(){define(["dojo","dojo/_base/declare","dojox/html/entities"],function(e,t){return t("ebg.selfedit",null,{constructor:function(){this.page=null;this.div_id=null;this.div=null;this.value=0;this.type="num";this.changeUrl=null;this.changeParams={};this.disabled=!1;this.possible_values={}},create:function(t,i,a,n,o,s,r,l){this.page=t;this.div_id=i;this.value=n;this.type=a;this.changeUrl=o;this.changeParams=s;this.div=$(i);void 0===l&&(l={});"num"!=this.type&&"text"!=this.type&&"textarea"!=this.type&&"time"!=this.type&&"enum"!=this.type&&console.error("Wrong selfedit type:"+this.type);if("enum"==this.type){void 0===r&&console.error("Selfedit: enum type without possible values !");this.possible_values=r}e.style(this.div,"display","inline");var d=this.value;"textarea"==this.type?d=this.page.nl2br(d,!1):"time"==this.type?""==this.value&&(d=_("as soon as possible")):"enum"==this.type&&(d=this.possible_values[this.value]);var c='<div id="'+this.div_id+'_value" class="selfedit_value"><span id="'+this.div_id+'_displayed_value">'+d+'</span> <a class="bga-link" id="'+this.div_id+'_edit_btn" href="#" >['+_("modify")+']</a></div><div id="'+this.div_id+'_valueedit"  class="selfedit_valueedit">';if("num"==this.type||"text"==this.type)c+='<input type="text" id="'+this.div_id+'_input" value="'+this.value+'"></input>';else if("textarea"==this.type)c+='<textarea id="'+this.div_id+'_input" style="width: 90%">'+this.value+"</textarea><br/>";else if("time"==this.type){c+='<select id="'+this.div_id+'_input"><option value=""></option>';var u;for(u=0;u<24;u++){var h=(20+u)%24;h<10&&(h="0"+h);c+='<option value="'+h+':00">'+h+":00</option>";c+='<option value="'+h+':15">'+h+":15</option>";c+='<option value="'+h+':30">'+h+":30</option>";c+='<option value="'+h+':45">'+h+":45</option>"}c+="</select>"}else if("enum"==this.type){c+='<select id="'+this.div_id+'_input">';var p;for(p in this.possible_values){var m="";l[p]&&(m='disabled="disabled"');var g="";p==this.value&&(g='selected="selected"');c+='<option value="'+p+'" '+g+" "+m+">"+this.possible_values[p]+"</option>"}c+="</select>"}c+=' <a class="bgabutton bgabutton_blue" href="#"  id="'+this.div_id+'_save_btn"><span>'+_("ok")+"</span></a>";c+="</div>";e.place(c,this.div_id);"time"==this.type&&""!=this.value&&($(this.div_id+"_input").value=this.value);e.connect($(this.div_id+"_edit_btn"),"onclick",this,"onEditValue");e.connect($(this.div_id+"_save_btn"),"onclick",this,"onSaveValue");if("enum"==this.type){e.style(this.div_id+"_save_btn","display","none");e.connect($(this.div_id+"_input"),"onchange",this,"onSaveValue")}},setValue:function(e){this.value=e;if("time"==this.type)$(this.div_id+"_input").value=this.value;else{$(this.div_id+"_input").value=dojox.html.entities.decode(String(this.value));var t=this.page.nl2br(this.value,!1);"enum"==this.type&&(t=this.page.nl2br(this.possible_values[this.value]));$(this.div_id+"_displayed_value").innerHTML=t}},onEditValue:function(e){e.preventDefault();!0!==this.disabled&&this.valueEditMode()},valueEditMode:function(){e.style(this.div_id+"_value","display","none");e.style(this.div_id+"_valueedit","display","inline");"time"!=this.type&&"enum"!=this.type&&$(this.div_id+"_input").focus()},onSaveValue:function(t){t.preventDefault();var i=this.value;this.changeParams.value=$(this.div_id+"_input").value;this.page.ajaxcall(this.changeUrl,this.changeParams,this,function(t){var i=this.page.nl2br(dojox.html.entities.encode(this.changeParams.value),!1);"enum"==this.type&&(i=this.page.nl2br(dojox.html.entities.encode(this.possible_values[this.changeParams.value]),!1));$(this.div_id+"_displayed_value").innerHTML=i;if("enum"!=this.type){e.style(this.div_id+"_value","display","inline");e.style(this.div_id+"_valueedit","display","none")}},function(e){e&&($(this.div_id+"_input").value=i)})},onCancelValue:function(t){t.preventDefault();e.style(this.div_id+"_value","display","inline");e.style(this.div_id+"_valueedit","display","none")},disable:function(){this.disabled=!0;null!=$(this.div_id+"_value")&&e.style(this.div_id+"_value","display","inline");null!=$(this.div_id+"_valueedit")&&e.style(this.div_id+"_valueedit","display","none");e.style(this.div_id+"_edit_btn","display","none")}})})},"ebg/tableresults":function(){define(["dojo","dojo/_base/declare","ebg/thumb","ebg/core/common"],function(e,t){return t("ebg.tableresults",null,{constructor:function(){this.page=null;this.div=null;this.jstpl_template='<div class="game_abandonned" id="game_abandonned" style="display:none">                                        <h4 class="game_result_status_important">${LB_GAME_ABANDONNED}</h4>                                        <span id="game_abandonned_explanation"></span>                                        <br/>                                        <br/>                                    </div>                                    <div class="game_cancelled" id="game_cancelled" style="display:none">                                        <h4 class="game_result_status_important">${LB_GAME_RESULT_CANCELLED} (${LB_SOMEONE_LEFT_THE_GAME_BEFORE_THE_END}) :</h4>                                        ${THE_PLAYER_WHO_LEFT}<br/>                                        ${THE_OTHERS_PLAYERS}                                        <br/>                                        <br/>                                    </div>                                    <div class="game_cancelled" id="game_unranked_cancelled" style="display:none">                                        <h4 class="game_result_status_important">${LB_SOMEONE_LEFT_THE_GAME_BEFORE_THE_END}</h4>                                        <br/>                                    </div>                                    <h4 class="game_conceded" id="game_conceded" style="display:none">${LB_GAME_CONCEDED}</h4>                                    <h4 class="game_unranked" id="game_unranked" style="display:none"><span id="game_unranked_label">${label_unranked} <i class="fa fa-question-circle"></i></span></h4>                                    <div class="game_result" id="game_result"></div>                                    <div id="tiebreaker_explanation"></div>                                    <div class="publishresult_container">                                        <span class="publishresult_button">                                            <span class="publishresult bgabutton bgabutton_gray" id="publishresult">                                                <i class="fa fa-share-alt"></i> ${share}                                            </span>                                            <div id="publishresult_content">                                                <div class="fb-share-button" data-href="https://${LANGUAGE_SHORT}.boardgamearena.com/table?table=${TABLE_ID}" data-layout="button" data-size="large"></div>                                            </div>                                        </span>                                    </div>';this.jstpl_score_entry='<div class="score-entry" id="score_entry_${player_id}"><div class="rank">${rankstr}</div><div class="emblemwrap ${emblem_class} emblemwrap_l"><img id="emblem_${player_id}" src="${emblem}" alt="${name}" class="emblem"/><div class="emblempremium"></div></div><div class="name"><a href="${url_base}/player?id=${player_id}" id="player_${player_id}_name" class="playername">${name}</a><span style="display:${is_bug_reporter_display}"> ('+__("lang_mainsite","Bug reporter")+')</span><span style="display:${is_creator_display}"> [creator]</span></div><div class="score">${score} <i class="fa fa-lg fa-star"></i><span class="score_aux score_aux_${score} tttiebraker" id="score_aux_${index}"> (${score_aux}<i class="fa fa-star tiebreaker"></i>)</span></div><div class="clear"></div><div class="adddetails adddetails_arena"><span class="rankdetails rankdetailsarena" style="display:${show_arena}"><div id="winpointsarena_${player_id}" class="winpoints"><span class="" id="winpointsarena_value_${player_id}">${arena_win_display}</span> &nbsp;&nbsp;<img alt="->" src="'+getStaticAssetUrl("img/common/arrow.png")+'" class="imgtext"/>&nbsp;&nbsp;</div><div id="newrankarena_${player_id}" class="newrank">${arena_after_display}</div></span></div><div id="adddetails_${player_id}" class="adddetails"><span class="rankdetails"><div id="winpoints_${player_id}" class="winpoints"><span id="leave_${player_id}" style="display:none;" class="leavepenalty">&nbsp;<span id="leavevalue_wrap_${player_id}"><div class="icon20 icon20_penaltyleave "></div> </span></span><span class="" id="winpoints_value_${player_id}">${point_win}</span> &nbsp;&nbsp;<img alt="->" src="'+getStaticAssetUrl("img/common/arrow.png")+'" class="imgtext"/>&nbsp;&nbsp;</div><div id="newrank_${player_id}" class="newrank">${rank_after_game}</div></span><div class="penalties"><span id="clock_${player_id}" style="display:none;" class="clockpenalty">&nbsp;<div class="icon20 icon20_penaltyclock"></div></span></div></div><br/><div class="reputation_wrap" style="display:${reputation_display}"><p id="reputation_block_${player_id}"><div class="reputation" id="reput_${player_id}"></div></p><br/><p id="stickynote_wrap_${player_id}" class="stickynote_wrap"><a class="bga-link" href="#" id="stickynote_edit_${player_id}"><i class="fa fa-lg fa-sticky-note-o"></i>&nbsp; <span id="stickynote_ctrl_${player_id}"></span></a></p></div><div class="clear"></div></div>';this.jstpl_trophy='<div class="trophy">                           <a id="award_${AWARD_ID}" href="${url_base}/award?game=${GAME_ID}&award=${AWARD_TYPE_ID}">                                <div class="trophyimg_wrap"><div class="trophyimg" id="awardimg_${AWARD_ID}" style="background-image:  url(\'${base_img}\')"></div></div>                                <div class="trophyname"><b>${TROPHY_NAME}</b><br/>${TROPHY_SPECIAL} <div class="xp_container">+${TROPHY_PRESTIGE} XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div></div><div class="clear"></div>                            </a>                        </div>';this.jstpl_statistics='<p>${intro}</p><div id="table_stats" class="smalltext">                </div>                <div id="player_stats">                    <table class="statstable" id="player_stats_table">                        <tr id="player_stats_header">                            <th></th>                        </tr>                    </table>                </div>';this.jstpl_table_stat='<div class="row-data">                            <div class="row-label" title="${statname}">${statname}</div>                            <div class="row-value">&nbsp;${value} ${unit}</div>                        </div>';this.jstpl_playerstatheader='<th id="playerstatheader_${ID}">${NAME}</th>';this.jstpl_playerstat="<tr>                                <th>${NAME}</th>                                ${PLAYER_STATS}                            </tr>";this.tableinfos=null;this.pma=!1},create:function(t,i,a,n,o){this.page=t;this.div=i;this.stats_div=a;this.tableinfos=n;this.pma=o;if($(this.div)){e.place(e.string.substitute(this.jstpl_template,{LANGUAGE_SHORT:e.config.locale.substr(0,2),TABLE_ID:n.id,LB_GAME_ABANDONNED:__("lang_mainsite","LB_GAME_ABANDONNED"),LB_GAME_CONCEDED:__("lang_mainsite","LB_GAME_CONCEDED"),label_unranked:__("lang_mainsite","Unranked game (Training mode)"),LB_SOMEONE_LEFT_THE_GAME_BEFORE_THE_END:__("lang_mainsite","LB_SOMEONE_LEFT_THE_GAME_BEFORE_THE_END"),LB_GAME_RESULT_CANCELLED:__("lang_mainsite","LB_GAME_RESULT_CANCELLED"),THE_PLAYER_WHO_LEFT:__("lang_mainsite","The player who left (or was skipped) lost the game and got a %s penalty.").replace("%s",""),THE_OTHERS_PLAYERS:__("lang_mainsite","The other players won this game and get %s of normal ELO points (because %s of this game has been played before the incident).").replace("%s",this.tableinfos.progression+"%").replace("%s",this.tableinfos.progression+"%"),share:__("lang_mainsite","Share")}),this.div,"replace");this.playeropinion={};e.connect($("publishresult"),"onclick",this,"onPublishResult");this.page.ajaxcall("/table/table/tableratingsupdate.html",{id:this.tableinfos.id},this,function(e){this.tableinfos.result.ratings_update=e;this.update()});this.updateStats()}},destroy:function(){},update:function(){var t=this.tableinfos;void 0!==t.thumbs&&(this.playeropinion=t.thumbs);if(void 0===i)var i=this.page.player_id;e.style("game_abandonned","display","block");e.style("publishresult","display","none");var a,n=!1;if("didntstart_cron_timeout"===t.result.endgame_reason)$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Table closed automatically because not enough players joined the table after a while.");else if("didntstart_cron_init_timeout"===t.result.endgame_reason)$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Table has been abandonned during initial configuration.");else if("didntstart_players_left"===t.result.endgame_reason)$("game_abandonned_explanation").innerHTML=__("lang_mainsite","All players left the game before it begins.");else if("didntplay_cron_timeout"===t.result.endgame_reason)$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Game has been closed automatically because no move had been done on it during a long period of time.");else if("normal_end"===t.result.endgame_reason||"normal_concede_end"===t.result.endgame_reason){e.style("game_abandonned","display","none");e.style("publishresult","display","none");n=!0;"normal_concede_end"===t.result.endgame_reason&&e.style("game_conceded","display","block")}else if("neutralized_after_skipturn"===t.result.endgame_reason||"neutralized_after_skipturn_error"===t.result.endgame_reason){e.style($("game_cancelled"),"display","block");e.style("game_abandonned","display","none");e.style("publishresult","display","none");n=!0}else"abandon_by_decision"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML=__("lang_mainsite","The game has been abandonned because all players (with a positive clock) decided it, or because all players left the game."):"abandon_by_tournamenttimeout"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Game has been abandonned automatically because players did not managed to finish it before the next round of the tournament. The player with the most remaining reflexion time wins the game."):"error_tournament_wrongnumber"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Some players of this tournament game did not show up, so we could not start the game (these players got a penalty on their profile)."):"synchro_error_corrupted"===t.result.endgame_reason||"synchro_error_finished_on_gs"===t.result.endgame_reason||"synchro_error_not_on_gs"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Game has been closed automatically due to a technical error")+" ("+t.result.endgame_reason+")":"express_stop"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML="A developer cancel this game using Express Stop.":$("game_abandonned_explanation").innerHTML="Unknow endgame reason: "+t.result.endgame_reason;if(1==toint(t.unranked)){if("neutralized_after_skipturn"===t.result.endgame_reason||"neutralized_after_skipturn_error"===t.result.endgame_reason){e.style($("game_cancelled"),"display","none");e.style($("game_unranked_cancelled"),"display","block")}e.style($("game_unranked"),"display","block");this.page.addTooltip("game_unranked_label",__("lang_mainsite","The Training mode has been enabled for this table (no ranking points gain/loss for this game)."),"")}var o=null,s=[],r=null,l={},d=!1;for(var c in t.result.player){r=(a=t.result.player[c]).player_id;a.is_creator_display="undefined"!=typeof globalUserInfos&&globalUserInfos.user_rights.includes("display_technical")&&t.table_creator===a.player_id?"":"none";l[r]={rank_after_game:a.rank_after_game,elo_win:a.point_win,rank_before_game:a.rank_after_game-a.point_win,gamerank:a.gamerank,name:a.name,opponents:{}};1!=a.gamerank&&(d=!0)}for(var r in l){var u=0;for(var h in l)if(h!=r){var p=l[r].rank_before_game-l[h].rank_before_game;if(toint(l[r].gamerank)<toint(l[h].gamerank))var _=1;else if(l[r].gamerank==l[h].gamerank)_=.5;else _=0;var m=1/(1+Math.pow(10,-p/400)),g=_-m;u+=g;l[r].opponents[h]={gameresult:_,expectedResult:m,elo_delta_no_k:g}}l[r].k_factor=0!=u?Math.floor(l[r].elo_win/u):60;if(1301==l[r].rank_after_game&&1300==l[r].rank_before_game){l[r].k_factor=60;l[r].particular_case=__("lang_mainsite","You always get at least 1 ELO point during your first game on BGA.")}else 1400==l[r].rank_after_game&&u<0?l[r].particular_case=__("lang_mainsite","Note: you can never go back under 100 ELO."):l[r].rank_after_game<1400&&u<0&&(l[r].particular_case=__("lang_mainsite","Note: you cannot lose ELO while your ELO has not reach 100."))}var f={};const b=new URLSearchParams(window.location.search).get("reporterId");if(b){const e=document.getElementById("reviewgame");e&&(e.href+="&reporterId="+b)}for(var c in t.result.player){r=(a=t.result.player[c]).player_id;a.index=c;a.rank_after_game,a.point_win;a.point_win_arena="";a.show_arena="none";a.arena_win_display="";a.arena_after_display="";if(a.score){t.result.losers_not_ranked&&!d?a.rankstr=__("lang_mainsite","Tie"):t.result.is_coop||t.result.is_solo?a.score>0?a.rankstr=__("lang_mainsite","Winner"):a.rankstr=__("lang_mainsite","Loser"):a.rankstr=this.page.getRankString(a.gamerank,t.result.losers_not_ranked);a.point_win=Math.floor(l[r].rank_after_game)-Math.floor(l[r].rank_before_game);a.point_win>=0&&(a.point_win="+"+a.point_win);a.rank_after_game=this.page.getEloLabel(a.rank_after_game);if(1==toint(t.unranked)){a.rank_after_game="";a.point_win=""}if(null!=a.arena_points_win){a.show_arena="block";var y=this.page.arenaPointsDetails(a.arena_after_game);if(5==y.league){var v=a.arena_points_win>=0?"+":"";a.arena_win_display=v+Math.round(a.arena_points_win%1*1e4);a.arena_after_display=Math.round(a.arena_after_game%1*1e4)+" "+__("lang_mainsite","pts")+" ";a.arena_after_display+='<div style="display:inline-block;position:relative;margin-top: -32px;margin-bottom: 26px;">';a.arena_after_display+='<div class="myarena_league league_'+y.league+'" style="position:relative;display:inline-block;top:21px;left:0px">';a.arena_after_display+='<div class="arena_label"></div>';a.arena_after_display+="</div>";a.arena_after_display+="</div>"}else{if(a.arena_points_win>100)a.arena_win_display="";else{v=a.arena_points_win>=0?"+":"";a.arena_win_display=v+Math.round(a.arena_points_win)%10+'<div class="icon20 icon_arena"></div>'}a.arena_after_display='<div style="display:inline-block;position:relative;margin-top: -29px;margin-bottom: 26px;">';a.arena_after_display+='<div class="myarena_league league_'+y.league+'" style="position:relative;display:inline-block;top:21px;">';a.arena_after_display+='<div class="arena_label">'+y.points+"</div>";a.arena_after_display+="</div>";a.arena_after_display+="</div>"}}}else{a.rank_mask="";a.point_win="";a.rank_after_game="";a.is_tie="";a.score="";a.score_aux="";a.rankstr=""}a.emblem=getPlayerAvatar(a.player_id,a.avatar,50);null===a.gender&&(a.gender="");a.flag=a.country.code;a.table_id=t.id;a.emblem_class="";1==a.is_premium&&(a.emblem_class="is_premium");null!==o&&o==a.score&&null!==a.score_aux&&s.push(a.score);f[c]={score:a.score,score_aux:a.score_aux};o=a.score;null===a.score_aux&&(a.score_aux="");a.signal_player_label=__("lang_mainsite","Signal this player");a.reputation_display="block";r==i&&(a.reputation_display="none");a.url_base="";void 0!==this.page.metasiteurl&&(a.url_base=this.page.metasiteurl);a.is_bug_reporter_display=b==r?"":"none";e.place(this.page.format_string(this.jstpl_score_entry,a),"game_result");this.page.addTooltip("flag_"+r,a.country.name,"");if(this.playeropinion[r]&&1==this.playeropinion[r].n){this.page.ajaxcall("/table/table/loadStickyNote.html",{player:r},this,function(e){$("stickynote_ctrl_"+e.player).innerHTML=e.note});this.page.addTooltip("stickynote_edit_"+r,e.string.substitute(__("lang_mainsite","A personal note on ${player}, for your eyes only"),{player:a.name}),__("lang_mainsite","Modify"))}else{$("stickynote_ctrl_"+r).innerHTML=e.string.substitute(__("lang_mainsite","Write a personal note about ${name}"),{name:$("player_"+r+"_name").innerHTML});this.page.addTooltip("stickynote_edit_"+r,"",e.string.substitute(__("lang_mainsite","Write a personal note about ${player}, for your eyes only"),{player:a.name}))}e.connect($("stickynote_edit_"+r),"onclick",this,"onEditSticky");if(toint(t.result.penalties[r].clock)>=0){e.style("clock_"+r,"display","inline");if(void 0!==t.result.penalties[r].clock_cancelled){e.place("<span> ("+__("lang_mainsite","Penalty cancelled")+") </span>","clock_"+r);e.addClass("clock_"+r,"clockpenalty_cancelled")}}if(toint(t.result.penalties[r].leave)>=0){if(void 0!==t.result.penalties[r].leave_cancelled){e.place("<span> ("+__("lang_mainsite","Penalty cancelled")+") </span>","leave_"+r);e.addClass("leave_"+r,"leavepenalty_cancelled")}else $("winpoints_value_"+r).innerHTML+=" - "+t.result.penalties[r].leave;e.style("leave_"+r,"display","inline");e.style("leavevalue_wrap_"+r,"display","inline")}Object.keys(this.tableinfos.result.ratings_update).length>0&&this.addPlayerEloTooltipNew(r);this.page.addTooltipToClass("adddetails_arena",__("lang_mainsite","Arena points won/loss during this game"),"");var w=0;this.playeropinion[r]?0==(w=toint(this.playeropinion[r].t))&&r!=i&&"none"!=e.style("reputation_block_"+r,"display")&&!0:r!=i&&"none"!=e.style("reputation_block_"+r,"display")&&!0;if(r==i)0;else{(new ebg.thumb).create(this.page,"reput_"+r,r,w)}}null!==r&&e.addClass("score_entry_"+r,"last-score-entry");var x=null;null!==$("gametiebreaker")?x=$("gametiebreaker").innerHTML:void 0!==this.page.tiebreaker&&(x=__("lang_"+this.tableinfos.game_name,this.page.tiebreaker));if(""!=x&&1!=toint(t.cancelled)){for(var c in s){var k=s[c];e.query(".score_aux_"+k).style("display","inline")}this.page.addTooltipToClass("tttiebraker",__("lang_mainsite","Tie breaker")+": "+x,"");if(s.length>0){$("tiebreaker_explanation").innerHTML="<div class='smalltext'>(<i class='fa fa-star tiebreaker'></i>: "+__("lang_mainsite","Tie breaker")+": "+x+")</div><br/>";var C=!1;$("gametiebreaker_split")&&""!=$("gametiebreaker_split").innerHTML?C=$("gametiebreaker_split").innerHTML.split(","):void 0!==this.page.tiebreaker_split&&this.page.tiebreaker_split&&(C=this.page.tiebreaker_split);if(C){var T={};for(var c in f){var j=f[c].score,S=f[c].score_aux,M=[];M.push(parseInt(j));for(var A in C){var E=Math.floor(S/C[A]);S-=E*C[A];M.push(E)}T[c]={html:"",tie_step:0,score:M}}for(var c in T)for(var N in T)if(N!=c)for(var A in T[c].score){if(T[c].score[A]!=T[N].score[A])break;T[c].tie_step++}for(var c in T){var L="";if(T[c].tie_step>0){L=" (";for(A=1;A<=T[c].tie_step;A++)void 0!==T[c].score[A]&&(L+=T[c].score[A]+'<i class="fa fa-star tiebreaker"></i> &nbsp;');L=L.slice(0,-7);L+=")";$("score_aux_"+c).innerHTML=L}}}}}if(!n){e.query(".rankdetails").style("display","none");e.query(".score").style("display","none")}(1==t.unranked||t.game_hide_ranking||t.result.is_solo)&&e.query(".rankdetails").style("display","none");this.page.addTooltipToClass("clockpenalty",__("lang_mainsite","This player ran out of time during this game."),"");this.page.addTooltipToClass("leavepenalty",__("lang_mainsite","This player left this game before the end."),"");this.page.addTooltipToClass("leavepenalty_cancelled",__("lang_mainsite","This penalty has been cancelled because we judged that it was not this player fault (ex: technical error)."),"");this.page.addTooltipToClass("clockpenalty_cancelled",__("lang_mainsite","This penalty has been cancelled because we judged that it was not this player fault (ex: technical error)."),"");"undefined"!=typeof mainsite?mainsite.updatePremiumEmblemLinks():null!=typeof gameui&&gameui.updatePremiumEmblemLinks()},onEditSticky:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(16);e.destroy("stickEditDialog");var a=new ebg.popindialog;a.create("stickEditDialog");a.setTitle(e.string.substitute(__("lang_mainsite","Write a personal note about ${name}"),{name:$("player_"+i+"_name").innerHTML}));a.setMaxWidth(400);a.tableModule=this.page;var n="";$("stickynote_ctrl_"+i).innerHTML!=e.string.substitute(__("lang_mainsite","Write a personal note about ${name}"),{name:$("player_"+i+"_name").innerHTML})&&(n=$("stickynote_ctrl_"+i).innerHTML);var o='<div id="stickEditDialog">';o+="<textarea id='sticky_text' style='width: 100%'>"+n+"</textarea>";o+="<p><a class='bgabutton bgabutton_gray' id='stickyedit_cancel' href='#'><span>"+__("lang_mainsite","Cancel")+"</span></a> <a class='bgabutton bgabutton_blue' id='stickyedit_save' href='#'><span>"+__("lang_mainsite","Save")+"</span></a></p>";o+="</div>";a.setContent(o);a.show();e.connect($("stickyedit_cancel"),"onclick",e.hitch(a,function(t){t.preventDefault();e.destroy("stickEditDialog");this.destroy()}));e.connect($("stickyedit_save"),"onclick",e.hitch(a,function(e){e.preventDefault();var t=$("sticky_text").value;this.destroy();this.tableModule.ajaxcall("/table/table/updateText.html",{type:"stickynote",id:i,text:t},this,function(e){});$("stickynote_ctrl_"+i).innerHTML=t}))},updateStats:function(){var t="";if(this.tableinfos.result.stats){this.pma||["private_alpha","alpha"].includes(this.tableinfos.game_status)||(t='<p style="text-align:center;"><a href="/premium?src=gamestats" class="bgabutton bgabutton_blue">'+__("lang_mainsite","Go Premium to see game statistics!")+"</a></p><br/><br/>");e.place(e.string.substitute(this.jstpl_statistics,{intro:t}),this.stats_div,"only");var i=1;if(this.pma||["private_alpha","alpha"].includes(this.tableinfos.game_status)){this.insertTableStat(__("lang_mainsite","Game duration"),Math.round(this.tableinfos.result.time_duration/60),__("lang_mainsite","mn"));i++;if(!this.tableinfos.game_hide_ranking&&!this.tableinfos.result.is_solo){this.insertTableStat(__("lang_mainsite","Players average level"),this.page.getEloLabel(this.tableinfos.result.table_level));i++}}else{this.insertTableStat(__("lang_mainsite","Game duration"),'<img class="statmasked" id="statmasked_'+i+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'" alt="masked" />');i++;if(!this.tableinfos.game_hide_ranking&&!this.tableinfos.result.is_solo){this.insertTableStat(__("lang_mainsite","Players average level"),'<img class="statmasked" id="statmasked_'+i+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'" alt="masked" />');i++}}for(var a in this.tableinfos.result.stats.table){i++;if(3==(c=this.tableinfos.result.stats.table[a]).id||1==c.id);else if(void 0!==c.value&&null!==c.value){if("*masked*"==c.value||!this.pma&&!["private_alpha","alpha"].includes(this.tableinfos.game_status))c.value='<img class="statmasked" id="statmasked_'+i+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'" alt="masked" />';else{"int"==c.type?c.value=Math.round(c.value):"bool"==c.type&&(c.value=0==c.value?__("lang_mainsite","no"):__("lang_mainsite","yes"));void 0!==c.valuelabel&&(c.value=__("lang_"+this.tableinfos.game_name,c.valuelabel))}this.insertTableStat(__("lang_"+this.tableinfos.game_name,c.name),c.value,c.unit)}}this.page.addTooltipToClass("statmasked",__("lang_mainsite","You must be a Premium member to see statistics"),"");var n={},o={};for(var a in this.tableinfos.result.player){var s=this.tableinfos.result.player[a];e.place(e.string.substitute(this.jstpl_playerstatheader,{ID:s.player_id,NAME:s.name}),"player_stats_header");n[s.player_id]=s.gamerank;o[s.player_id]=s.score}var r="";for(var a in this.tableinfos.result.player){var l=(s=this.tableinfos.result.player[a]).player_id;r+="<td>"+this.page.getRankString(n[l])+" ("+o[l]+'<i class="fa fa-lg fa-star"></i>)</td>'}e.place(e.string.substitute(this.jstpl_playerstat,{NAME:__("lang_mainsite","LB_GAME_RESULT"),PLAYER_STATS:r}),"player_stats_table");for(var d in this.tableinfos.result.stats.player)if("time_bonus_nbr"!=d&&"reflexion_time_sd"!=d||null!==$("go_to_table")){r="";var c,u=void 0===(c=this.tableinfos.result.stats.player[d]).unit?"":" "+c.unit,h=!1;for(var a in this.tableinfos.result.player){l=this.tableinfos.result.player[a].player_id;var p="-";void 0!==c.values[l]&&null!==c.values[l]&&(p=c.values[l]);i++;null!==p&&(h=!0);if("*masked*"==p||!this.pma&&!["private_alpha","alpha"].includes(this.tableinfos.game_status))p='<img class="statmasked" id="statmasked_'+i+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'" alt="masked" />';else if("-"!=p){"int"==c.type?p=Math.round(p):"bool"==c.type&&(p=0==p?__("lang_mainsite","no"):__("lang_mainsite","yes"));void 0!==c.valuelabels[l]&&(p=__("lang_"+this.tableinfos.game_name,c.valuelabels[l]));if("reflexion_time"==d){p=this.page.formatReflexionTime(p).string;u=""}}r+="<td>"+p+u+"</td>"}h&&e.place(e.string.substitute(this.jstpl_playerstat,{NAME:__("lang_"+this.tableinfos.game_name,c.name),PLAYER_STATS:r}),"player_stats_table")}else;r="";for(var a in this.tableinfos.result.player){r+='<td class="smalltext"><div class="icon20 icon20_stat"></div> <a class="bga-link" href="/playerstat?id='+(l=(s=this.tableinfos.result.player[a]).player_id)+"&game="+this.tableinfos.game_id+'">'+__("lang_mainsite","%s`s statistics at this game").replace("%s",s.name)+"</a></td>"}e.place(e.string.substitute(this.jstpl_playerstat,{NAME:'<div class="icon20 icon20_stat"></div> '+__("lang_mainsite","All stats"),PLAYER_STATS:r}),"player_stats_table")}},insertTableStat:function(t,i,a){void 0===a&&(a="");e.place(e.string.substitute(this.jstpl_table_stat,{statname:t,value:i,unit:a}),"table_stats")},onPublishResult:function(t){e.stopEvent(t);e.style("publishresult","display","none");e.style("publishresult_content","display","block");FB.XFBML.parse()},addPlayerEloTooltipNew:function(e){let t=this.tableinfos.result.ratings_update,i=t.players_current_ratings[e],a=t.players_elo_rating_update[e];const n=new Intl.NumberFormat("en-US",{signDisplay:"exceptZero"});let o="";if(this.tableinfos.game_hide_ranking||this.tableinfos.result.is_solo)o+=`\n                    <div class="elo-tooltip-coop-notice">\n                        ${_("Additional details on ELO calculation are unavailable for this game")}\n                    </div>\n                `;else{const e=Object.keys(a.duels).length;for(const i in a.duels){const s=a.duels[i];let r=t.players_current_ratings[i],l="";for(const e of s.duel_modifiers){let t=e.description,i=e.description_args;if(t){t=_(t);t=t.replace(new RegExp(Object.keys(i).join("|"),"g"),e=>{let t=i[e].text;i[e].properties&&i[e].properties.forEach(e=>{if("highlight"===e)t=`<span class='modifier-highlight'>${t}</span>`});return t});l+=`<div class="modifier-description modifier-${e.type}">\n                                    ${t}\n                                </div>`}}let d=parseInt(2*s.duel_result),c=[_("defeat").toUpperCase(),_("tie").toUpperCase(),_("win").toUpperCase()][d],u=["red","gray","green"][d],h=n.format(Number.parseFloat(s.elo_delta/e).toFixed(2)),p="gray";h>0&&(p="green");h<0&&(p="red");o+=`<div class="duel">\n                            <div class="duel-profile">\n                                <div class="duel-opponent">\n                                    <span class="opponent-elo">${this.page.getEloLabel(r.elo,!0)}</span>\n                                    <span>\n                                        <span class="opponent-name">${t.players_results[i].name}</span>\n                                        <span class="player-rank-pos">(${this.page.getRankString(t.players_results[i].rank)})</span>\n                                    </span>\n                                </div>\n                                <div class="duel-conditions">\n                                    <div class="duel-win-probability">\n                                        ${_("Win probability")}: ${Math.round(100*s.expected_result)}%\n                                    </div>\n                                    <div class="duel-modifiers">\n                                        ${l}\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="duel-outcome" style="color:${u}">\n                                ${c}\n                            </div>\n                            <div class="duel-reward" style="color:${p}">\n                                ${h}\n                            </div>\n                        </div>`}}let s='<div class="arrows-cont">';for(let u=0;u<15;u++)s+='<div class="arrows-square"></div>';s+="</div>";let r="gray";a.real_elo_delta>0&&(r="green");a.real_elo_delta<0&&(r="red");let l="";if(a.global_modifiers){for(const e in a.global_modifiers);l.length>0&&(l=`<div class="global-modifiers">\n                            ${l}\n                        </div>`)}let d="";a.elo_delta_adjust_desc&&(d=`<div class="adjustment-description">\n                    ${_(a.elo_delta_adjust_desc)}\n                </div>`);let c=`<div class="player-elo-tooltip">\n                    <div class="elo-tooltip-title">\n                        <span class="header">${_("Details of {ELO} calculation").replace("{ELO}","<b>ELO</b>")}</span>\n                        <span><span class="player-name">${t.players_results[e].name}</span><span class="player-rank-pos">(${this.page.getRankString(t.players_results[e].rank)})</span></span>\n                    </div>\n                    <div class="calculation-result">\n                        ${s}\n                        <div class="result-content">\n                            <div class="elo-before">\n                                <span>${this.page.getEloLabel(i.elo,!1,!1)}</span>\n                                <span>${_("Before this game")}</span>\n                            </div>\n                            <div class="elo-delta">\n                                <span style="color:${r}">${n.format(a.real_elo_delta)}</span>\n                                <span><b>${_("ELO variation")}</b></span>\n                            </div>\n                            <div class="elo-after">\n                                <span>${this.page.getEloLabel(a.new_elo_rating,!1,!1)}</span>\n                                <span>${_("After this game")}</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="calculation-description">\n                        ${l}\n                        ${d}\n                    </div>\n                    <div class="duels-list">\n                        ${o}\n                    </div>\n                </div>`;this.page.addTooltipHtml("adddetails_"+e,c)}})})},"ebg/site/tablemanager":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.tablemanager",ebg.core.mainsitemodule,{constructor:function(){this.tables=null;this.jstpl_table_wrap='<div id="gametable_${id}"></div>';this.jstpl_table='<div class="gametable gametable_status_${status}"><div class="gametable_upper_part"><div class="gameinfo"><img src="${game_icon_url}" class="game_icon" alt="${game_name}"/></div><div class="gametable_infos"><div class="gameinfoname"><span class="gamename">${game_name_displayed}</span></div><div class="table_no"><a href="table?table=${id}">n${id}</a></div></div><div class="table_top_status"><div class="progression_wrap"><div class="game_progression_bar" style="display:${progression_visibility}"><div id="game_progression_inner_${id}" class="game_progression_inner" style="width:${progression_width}px"></div></div></div><b>${status_detailled}</b> &bull; '+_("Created")+' ${created_from}<div class="table_top_status_detailed"><div>${filters}</div><div class="game_presentation">${presentation}</div></div></div></div><a class="mediumbutton jointable" href="table?table=${id}" style="display:${join_visibility}"><span>'+_("See table")+'</span></a><div class="clear gametable_separator"></div><div class="players" id="players_table_${id}"></div><div class="clear"/></div>';this.jstpl_player_table='<div class="tableplace ${tableplaceclass}"><a href="player?id=${player_id}" title="${player_name}"><img src="/data/arms/player_${player_id}.png?h=${player_avatar}" alt="${player_name}" class="emblem"/></a><a href="player?id=${player_id}" class="player_name">${player_name}</a><br/><span class="playersummary">${player_summary}</span></div>';this.jstpl_player_table_free='<div class="tableplace"><div class="emblem ${freeplacetype}"></div><span class="player_name">${text}</span><br/></div>';this.notifqueue=new ebg.gamenotif;this.table_to_status={}},onLoad:function(t){mainsite.setPageTitle(_("Joining a game table"));this.ajaxcall("/tablemanager/tablemanager/tableinfos.html?status=active_now",{},this,function(e){this.reloadGameTables(e.tables);this.reloadNewTables(e.gameplayerstats)});this.register_centrifuge_subs(mainsite.subscribeCentrifugeChannel("/tablemanager/global",this.notifqueue,"onNotification"));this.register_centrifuge_subs(mainsite.subscribeCentrifugeChannel("/tablemanager/detailled",this.notifqueue,"onNotification"));this.register_subs(e.subscribe("tablemanagerInfosChanged",this,"onTableInfosChanged"));this.register_subs(e.subscribe("updateGameProgression",this,"onUpdateGameProgression"));this.register_subs(e.subscribe("updateGamePlayerStats",this,"onUpdateGamePlayerStats"));e.query(".createtable").connect("onclick",this,"onCreateTable")},onOnUnload:function(){this.unsubscribe_all()},reloadGameTables:function(t){e.empty("gametables");e.empty("gametables_inprogress");this.table_to_status={};for(var i in t){var a=t[i];e.place(this.format_string(this.jstpl_table_wrap,{id:a.id}),this.getTableLocation(a),"first");this.display_table(a)}},reloadNewTables:function(t){e.style($("gametables_new"),"display","block");for(var i in t)if($("registered_nbr_"+i)){$("registered_nbr_"+i).innerHTML=t[i].registered;$("online_nbr_"+i).innerHTML=t[i].online;$("available_nbr_"+i).innerHTML=t[i].available;$("love_nbr_"+i).innerHTML=t[i].available_love;$("playing_nbr_"+i).innerHTML=t[i].playing}},display_table:function(t){t.id;e.empty("gametable_"+t.id);if(1!=t.destroyed&&mainsite.gamefilter[t.game_id]){t.join_visibility="block";t.created_from=time_ago_format(t.created_from);"open"==t.status?t.status_detailled=_("Open for joining"):"setup"==t.status?t.status_detailled=_("Game is about to start"):"play"==t.status?t.status_detailled=_("Game in progress"):"finished"==t.status&&(t.status_detailled=_("Game has ended"));t.presentation=this.nl2br(t.presentation,!1);t.progression_visibility="none";t.progression_width=0;if("play"==t.status){t.progression_visibility="block";t.progression_width=Math.max(0,3*toint(t.progression))}void 0!==t.reputation_filter.label&&(t.reputation_filter=t.reputation_filter.label);void 0!==t.level_filter.label&&(t.level_filter=t.level_filter.label);t.filters=this.format_string_recursive(t.level_filter.log,t.level_filter.args);if(""!=t.reputation_filter){""!=t.filters&&(t.filters+=", ");t.filters+=t.reputation_filter}t.game_name_displayed=__("lang_mainsite",t.game_name+"_displayed");t.game_icon_url=getMediaUrl(t.game_name,"icon");var i=this.format_string(this.jstpl_table,t);e.place(i,"gametable_"+t.id);var a=0;for(var n in t.player_display){var o=t.player_display[n],s=t.players[o],r="";0==s.ranksummary?r=_("First game"):1==s.ranksummary?r=_("Beginner"):1600==s.ranksummary?r=_("Good player"):1800==s.ranksummary?r=_("Expert"):2e3==s.ranksummary&&(r=_("Master"));var l="";"expected"==s.table_status&&(l="tableplace_expected");var d=this.format_string(this.jstpl_player_table,{player_id:s.id,player_name:s.fullname,player_avatar:null===s.avatar?"":s.avatar,player_summary:r,tableplaceclass:l});e.place(d,"players_table_"+t.id);a++}if("open"==t.status)for(;a<t.max_player;){a++;var c="freeplace",u="("+_("Free")+")";if(a>t.min_player){c="freeplaceopt";u="("+_("Free")+")"}e.place(this.format_string(this.jstpl_player_table_free,{freeplacetype:c,text:u}),"players_table_"+t.id)}var h=this.table_to_status[t.id];h&&("open"!=h&&"setup"!=h||"open"==t.status||"setup"==t.status||e.fx.wipeOut({node:"gametable_"+t.id,duration:500,onEnd:e.hitch(this,function(){var i=e.clone($("gametable_"+t.id));e.destroy("gametable_"+t.id);e.place(i,"gametables_inprogress","first");e.fx.wipeIn({node:"gametable_"+t.id,duration:500}).play()})}).play());this.table_to_status[t.id]=t.status}},onTableInfosChanged:function(t){var i=t.args;if($("gametable_"+i.id))this.display_table(i);else{e.place(this.format_string(this.jstpl_table_wrap,{id:i.id}),this.getTableLocation(i),"first");this.display_table(i);e.style("gametable_"+i.id,"display","none");e.fx.wipeIn({node:"gametable_"+i.id,duration:500}).play()}this.updateGameInProgressCount()},onUpdateGameProgression:function(t){var i=t.args.table,a=Math.max(0,3*toint(t.args.progress));$("game_progression_inner_"+i)&&e.style($("game_progression_inner_"+i),"width",a+"px")},getTableLocation:function(e){var t="gametables";"open"!=e.status&&"setup"!=e.status&&(t="gametables_inprogress");return t},updateGameInProgressCount:function(){this.table_to_status;var e=0;for(var t in this.table_to_status)"play"==this.table_to_status[t]&&e++;$("game_in_progress").innerHTML=e},onCreateTable:function(t){t.preventDefault();var i=t.currentTarget.id.substr(12);this.ajaxcall("/tablemanager/tablemanager/createnew.html",{game:i},this,function(t){if(t.table){t.table;var a=t.table;e.publish("gotourl",[{module:"table",args:{table:a,tb:t.forceTB,nr:!0}}])}else t.mmstarted&&gotourl("lobby?game="+i)})},onSeeGameInProgress:function(t){t.preventDefault();var i=e.position($("gametables_inprogress"));window.scroll(0,i.y)},onUpdateGamePlayerStats:function(e){this.reloadNewTables(e.args)}})})},"ebg/site/tournament":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","ebg/comboajax","ebg/board"],function(e,t,i){return t("ebg.site.tournament",ebg.core.mainsitemodule,{constructor:function(){this.tournament_id=null;this.avatar_src=null;this.lastresult=null;this.newsfeed=null;this.invitePlayer=null;this.eventHandlers=[];this.tournamentComponent=null},doesNeedServerSideLoad:function(){return!globalUserInfos.flags.tournament_rework},onLoad:function(t){if(globalUserInfos.flags.tournament_rework){document.documentElement.classList.add("bga-white-background");this.tournamentComponent=new i.ms.tournaments.view.BgaTournament({target:document.querySelector("#main-content"),props:{gameId:t.game,tournamentId:parseInt(t.id)}})}else{$("tournamentfullname")&&mainsite.setPageTitle($("tournamentfullname").innerHTML);var a=e.query(".trophyimg_wrap img");a.length>0&&(this.avatar_src=a[0].src);e.query(".localDate").forEach(function(e){e.innerHTML=date_format(e.innerHTML)});e.query(".time_to_format").forEach(e.hitch(this,function(e){e.innerHTML=this.formatReflexionTime(e.innerHTML).string}));e.connect($("launchtournament"),"onclick",this,"onLaunchTournament");e.connect($("canceltournament"),"onclick",this,"onCancelTournament");e.connect($("register_tournament"),"onclick",this,"onRegisterTournament");e.connect($("unregister_tournament"),"onclick",this,"onUnregisterTournament");e.connect($("withdraw_from_tournament"),"onclick",this,"onWithdrawTournament");e.connect($("add_to_calendar"),"onclick",this,"onAddToCalendar");e.connect($("add_to_calendar2"),"onclick",this,"onAddToCalendar");e.query(".go_to_stage").connect("onclick",this,"onGoToStage");e.query(".get_tournament_link").connect("onclick",this,"onGetTournamentLink");e.query(".zoomOnEncounterSerie").connect("onclick",this,"onZoomOnEncounterSerie");this.tournament_id=t.id;this.lastresult=new ebg.board;this.lastresult.board_uid="L";this.lastresult.per_page=5;this.lastresult.create(this,$("lastresult"),"tournament",this.tournament_id,!1);this.newsfeed=new ebg.board;this.newsfeed.board_uid="N";$("participant")&&$("tadmin")&&(this.newsfeed.bStatusUpdate="1"==$("participant").innerHTML||"1"==$("tadmin").innerHTML);$("tournamentGroup")&&(this.group_id=$("tournamentGroup").innerHTML);this.newsfeed.create(this,$("newsfeed"),"group",this.group_id,!1);1==toint($("canChat").innerHTML)?e.style("startchat","display","inline"):e.style("startchat","display","none");e.connect($("startchat"),"onclick",this,"onStartChat");e.connect($("changeTrophyImage"),"onclick",this,function(t){t.preventDefault();e.style("changeTrophyImage","display","none");e.style("changeTrophyImageForm","display","block")});e.connect($("change_emblem_submit"),"onclick",this,"onSubmitNewEmblem");e.connect($("change_emblem_cancel"),"onclick",this,function(t){t.preventDefault();e.style("changeTrophyImage","display","block");e.style("changeTrophyImageForm","display","none")});e.query(".date_to_format").forEach(e.hitch(this,function(t){t.innerHTML=date_format(toint(t.innerHTML),!1,!1);e.style(t,"display","inline")}));e.connect($("invite_to_groupe_toggle"),"onclick",this,function(t){e.stopEvent(t);e.style("invite_to_groupe_toggle_wrap","display","none");e.style("invite_to_group","display","block")});this.invitePlayer=new ebg.comboajax;this.invitePlayer.create("invitePlayer","/player/player/findplayer.html",__("lang_mainsite","Invite some player ..."));e.connect(this.invitePlayer,"onChange",this,function(e){""!=e&&this.ajaxcall("/tournament/tournament/invitePlayer.html",{id:this.tournament_id,player:e},this,function(){this.showMessage(_("This player has been invited to join this tournament"),"info")},function(e){})});if(void 0!==mainsite.bShowTournamentCalendarOnNextLoad&&mainsite.bShowTournamentCalendarOnNextLoad){delete mainsite.bShowTournamentCalendarOnNextLoad;this.showCalendarDialog()}$("gameoption_206")&&($("gameoption_206").innerHTML=mainsite.playingHoursToLocal($("gameoption_206").innerHTML));this.v2initialize();"#stage_display"===document.location.hash&&$("stage_display").scrollIntoView({behavior:"smooth",block:"start"})}},onOnUnload:function(){document.documentElement.classList.remove("bga-white-background");if(this.tournamentComponent)this.tournamentComponent.$destroy();else{dijit.byId("invitePlayer").destroy();this.eventHandlers.forEach(function(t){e.disconnect(t)})}},onLaunchTournament:function(t){t.preventDefault();this.confirmationDialog(_("Are you sure you want to open this tournament now ?"),e.hitch(this,function(){this.ajaxcall("/tournament/tournament/launchtournament.html",{id:this.tournament_id},this,function(e){mainsite.gotourl_forcereload("tournament?id="+this.tournament_id)},function(e){},"get")}))},onCancelTournament:function(t){t.preventDefault();this.confirmationDialog(_("Are you sure you want to CANCEL this tournament now ?"),e.hitch(this,function(){this.ajaxcall("/tournament/tournament/canceltournament.html",{id:this.tournament_id},this,function(e){mainsite.gotourl_forcereload("tournament?id="+this.tournament_id)},function(e){},"get")}))},onRegisterTournament:function(t){t.preventDefault();var i="";i+=$("tournament_agenda").innerHTML;i+="<br/>";i+=_("By registering to this tournament you undertake to play all matches planned, otherwise your reputation and/or ELO ranking will be affected. Do you confirm ?");let a=e.query(".tournament-terms-conditions")[0].getAttribute("data-url");a&&(i+='<div class="my-2"><a href="'+a+'" target="_blank">'+window._("You also confirm that you've read and that you accept the terms and conditions."));this.confirmationDialog(i,e.hitch(this,function(){this.ajaxcall("/tournament/tournament/register.html",{id:this.tournament_id},this,function(e){mainsite.bShowTournamentCalendarOnNextLoad=!0;mainsite.gotourl_forcereload("tournament?id="+this.tournament_id)},function(e){},"get")}))},onUnregisterTournament:function(e){e.preventDefault();this.ajaxcall("/tournament/tournament/unregister.html",{id:this.tournament_id},this,function(e){mainsite.gotourl_forcereload("tournament?id="+this.tournament_id)},function(e){},"get")},onWithdrawTournament:function(t){t.preventDefault();var i=new ebg.popindialog;i.create("withdrawTournamentDialog");i.setTitle(_("Withdraw from the tournament"));i.setMaxWidth(600);i.setContent('<img alt="loading" src="'+getStaticAssetUrl("img/logo/waiting.gif")+'"/>');i.show();this.ajaxcall("/tournament/tournament/withdrawInfo.html",{id:this.tournament_id},this,t=>{var a=[],n=t.tables.length,o="-4 ";a.push(_("If you withdraw from the tournament, you will be eliminated and will not be required to play any additional games."));if(n>0){a.push("<br/><br/>"+e.string.substitute(_("However, you will still need to finish the <b>${count} table(s)</b> you are currently in."),{count:n}));a.push("<br/><br/>"+e.string.substitute(_("There will be a small karma penalty for withdrawing now (${karmaLoss}), and stronger penalties will also apply if you abandon these tables."),{karmaLoss:o}))}else a.push("<br/><br/>"+e.string.substitute(_("There will be a small karma penalty for withdrawing (${karmaLoss})."),{karmaLoss:o}));a.push('<br/><br/><label><input id="withdrawTournamentDialog-confirmcb" type="checkbox"> '+_("I confirm I want to withdraw from this tournament immediately")+"</label>");n>0&&a.push('<br/><label class="text-red-600"><input id="withdrawTournamentDialog-confirm2cb" type="checkbox"> '+e.string.substitute(_("I understand that I have to finish the ${count} game(s) already in progress"),{count:n})+"</label>");a.push('<div class="flex items-center justify-around">');a.push('<div id="withdrawTournamentDialog-cancelbtn" class="bgabutton bgabutton_gray">'+__("lang_mainsite","Please, no")+"</div>");a.push('<div id="withdrawTournamentDialog-confirmbtn" class="bgabutton bgabutton_red">'+__("lang_mainsite","Withdraw")+"</div>");a.push("</div>");i.setContent(a.join(""));e.connect($("withdrawTournamentDialog-cancelbtn"),"onclick",e=>{e.preventDefault();i.destroy()});e.connect($("withdrawTournamentDialog-confirmbtn"),"onclick",e=>{e.preventDefault();var t=$("withdrawTournamentDialog-confirmcb"),a=$("withdrawTournamentDialog-confirm2cb");if(!t.checked||a&&!a.checked)this.showMessage("You need to confirm this action","error");else{this.ajaxcall("/tournament/tournament/withdraw.html",{id:this.tournament_id,abandon:!1},this,function(e){mainsite.gotourl_forcereload("tournament?id="+this.tournament_id)},function(e){},"post");i.destroy()}})},function(e){},"get")},onGoToStage:function(e){e.preventDefault();$("stage_display").scrollIntoView({behavior:"smooth",block:"start"})},onZoomOnEncounterSerie:function(e){e.preventDefault();e.currentTarget.id.substr(21);alert("No table has been setup for this encounter")},onSubmitNewEmblem:function(e){e.preventDefault();this.ajaxcall("/group/group/newEmblem.html",{form_id:"changeTrophyImageForm"},this,function(e){if(0===e.valid)this.showMessage(e.invalidity_reason,"error");else{this.showMessage(_("New emblem loaded !"),"info");mainsite.gotourl_forcereload("tournament?id="+this.tournament_id)}},function(){},"iframe")},onAddToCalendar:function(t){e.stopEvent(t);this.showCalendarDialog()},ISODateString:function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+""+t(e.getUTCMonth()+1)+t(e.getUTCDate())+"T"+t(e.getUTCHours())+t(e.getUTCMinutes())+t(e.getUTCSeconds())+"Z"},showCalendarDialog:function(){var t=new ebg.popindialog;t.create("calendarDlg");t.setTitle(_("Add to my calendar"));t.setMaxWidth(400);var i='<div id="calendarDlg" style="text-align:center;min-width: 300px;">',a=window.location.href,n=$("first_match_date").innerHTML,o=new Date(1e3*n),s=this.ISODateString(o),r=this.ISODateString(new Date(o.getTime()+36e5));i+="<p><a target='_blank' href='"+("https://www.google.com/calendar/render?action=TEMPLATE&text="+encodeURIComponent("Board Game Arena: "+$("tournamentfullname").innerHTML)+"&dates="+s+"/"+r+"&details="+encodeURIComponent(a)+"&location="+encodeURIComponent(a)+"&pli=1&sf=true&output=xml")+"' class='bgabutton bgabutton_blue bgabutton_big'>"+_("Add to my")+" Google Calendar</a></p>";i+="<p><a target='_blank' href='/tournament/tournament/tournamentCalendarIcs.html?id="+this.tournament_id+"' class='bgabutton bgabutton_blue bgabutton_big'>"+_("Add to my")+" Outlook Calendar</a></p>";i+="<p><a target='_blank' href='/tournament/tournament/tournamentCalendarIcs.html?id="+this.tournament_id+"' class='bgabutton bgabutton_blue bgabutton_big'>"+_("Add to my")+" iCal Calendar</a></p>";i+="<br/>";i+="<p><a href='#' class='bgabutton bgabutton_gray' id='cancel_button'>"+_("Cancel")+"</a></p>";i+="</div>";t.setContent(i);t.show();e.connect($("cancel_button"),"onclick",e.hitch(t,function(e){e.preventDefault();this.destroy()}));e.query("#calendarDlg .bgabutton_blue").connect("onclick",e.hitch(t,function(e){this.destroy()}))},onStartChat:function(e){e.preventDefault();mainsite.createChatBarWindow({type:"group",id:this.group_id,avatar_src:this.avatar_src,label:$("tournamentfullname").innerHTML,url:"/tournament?id="+this.tournament_id,channel:"/group/g"+this.group_id,window_id:"group_"+this.group_id,subscribe:!1,start:"expanded"},!1);mainsite.expandChatWindow("group_"+this.group_id);mainsite.loadPreviousMessage("group",this.group_id)},onGetTournamentLink:function(t){t.preventDefault();var i=t.target.getAttribute("data-url");if(i){var a=new ebg.popindialog;a.create("tournamentLinkDlg");a.setTitle(_("Private tournament link"));a.setMaxWidth(600);var n='<div id="tournamentLinkDlg" style="min-width: 560px;">';n+="<p>"+_("Only players using this link will be able to register to this private tournament.")+"</p>";n+='<p><input class="tournament-copy-link-input" id="copy_tournament_link_input" type="text" value="'+i+'"/></p>';n+='<div class="bgabutton bgabutton_blue bgabutton_big" id="copy_tournament_link">'+_("Copy Link")+"</div>";n+="<p><a href='#' class='bgabutton bgabutton_gray' id='close_button'>"+_("Close")+"</a></p>";n+="</div>";a.setContent(n);a.show();e.connect($("close_button"),"onclick",function(e){e.preventDefault();a.destroy()});e.connect($("copy_tournament_link"),"onclick",function(e){e.preventDefault();$("copy_tournament_link_input").select();document.execCommand("copy");$("copy_tournament_link").innerHTML=_("Link copied in your clipboard !")})}},v2initialize:function(){var t=document.querySelector(".v2tournament");if(t){this.eventHandlers.push(e.connect(t,"click",this,function(t){var i;if(t.target&&t.target.classList.contains("v2tournament__encounters-clear-button"))this.ssv2FilterPlayerId(null);else if(t.target&&t.target.closest&&(i=t.target.closest("[data-tournament-player-id]"))){e.stopEvent(t);var a=i.getAttribute("data-tournament-player-id");a&&this.ssv2FilterPlayerId(a)}else if(t.target&&t.target.closest&&(i=t.target.closest(".v2tournament__encounters-steps-arrow"))){e.stopEvent(t);i.classList.contains("v2tournament__encounters-steps-arrow--left")&&this.ssv2Scroll("left");i.classList.contains("v2tournament__encounters-steps-arrow--right")&&this.ssv2Scroll("right")}else;}));this.eventHandlers.push(e.connect(t,"mouseover",this,function(e){var t=e.target.closest("[data-tournament-player-id]");t&&this.ssv2HighlightPlayerId(t.getAttribute("data-tournament-player-id"))}));this.eventHandlers.push(e.connect(t,"mouseout",this,function(e){e.target.closest("[data-tournament-player-id]")&&this.ssv2HighlightPlayerId(!1)}));document.querySelector(".v2tournament__players-stats-table__extend")&&this.eventHandlers.push(e.connect(document.querySelector(".v2tournament__players-stats-table__extend"),"onclick",this,"ssv2ToggleExtendPlayersInfo"));this.ssv2InitializeDragScroll(".v2tournament")}},ssv2HighlightPlayerId:function(e){document.querySelectorAll("[data-tournament-player-id]").forEach(function(t){var i=t.getAttribute("data-tournament-player-id")==e?"add":"remove";t.classList[i]("highlighted")})},ssv2FilterPlayerId:function(t){e.query(".v2tournament__encounter [data-tournament-player-id].filtered").removeClass("filtered");if(null!==t){e.query(".v2tournament__encounters").addClass("v2tournament__encounters--filtered");e.query(".v2tournament__encounters-clear-filter").removeClass("hidden");var i=null;e.query(".v2tournament__encounter").forEach(function(a){var n=e.query('[data-tournament-player-id="'+t+'"]',a);if(n.length>0){i=n;a.classList.remove("hidden");n.addClass("filtered")}else a.classList.add("hidden")});e.query(".v2tournament__encounters-clear-player").innerHTML("").append(i.clone());var a=e.query(".v2tournament__encounters")[0];a&&a.scrollIntoView()}else{e.query(".v2tournament__encounter").removeClass("hidden");e.query(".v2tournament__encounters-clear-filter").addClass("hidden");e.query(".v2tournament__encounters").removeClass("v2tournament__encounters--filtered")}},ssv2ToggleExtendPlayersInfo:function(){document.querySelector(".v2tournament__players-stats-table").classList.toggle("v2tournament__players-stats-table--extended")},ssv2InitializeDragScroll:function(t){var i=function(e,t){return e&&e!==document.body?function(e,t){var i,a;if("x"===t){i=e.scrollWidth>e.clientWidth;a=window.getComputedStyle(e).overflowX}else{i=e.scrollHeight>e.clientHeight;a=window.getComputedStyle(e).overflowY}var n=a.match(/auto|scroll/);return i&&n}(e,t)?e:i(e.parentNode,t):document.body},a=document.querySelector(t);if(a){a.style.cursor="grab";var n=!1,o=null,s=null,r=0,l=0,d=0,c=0;this.eventHandlers.push(e.connect(a,"mousedown",function(e){o=i(e.target,"x");s=i(e.target,"y");n=!0;l=e.clientX;c=e.clientY;r=o===document.body?window.pageXOffset:o.scrollLeft;d=s===document.body?window.pageYOffset:s.scrollLeft;e.preventDefault()}));this.eventHandlers.push(e.connect(window,"mouseup",function(t){if(n){t.preventDefault();e.stopEvent(t);o.style.pointerEvents=null;o.parentNode.classList.remove("dragging");s.style.pointerEvents=null;s.parentNode.classList.remove("dragging");n=!1}}));this.eventHandlers.push(e.connect(window,"mousemove",this,function(e){if(n){e.preventDefault();o.parentNode.classList.add("dragging");s.parentNode.classList.add("dragging");o===document.body?window.scrollTo(r+l-e.clientX,window.scrollY):o.scrollLeft=r+l-e.clientX;s===document.body?window.scrollTo(window.scrollX,d+c-e.clientY):s.scrollTop=d+c-e.clientY;o.style.pointerEvents="none";s.style.pointerEvents="none";this.ssv2UpdateScrollArrows()}}));this.ssv2UpdateScrollArrows()}},ssv2ToggleScrollArrows:function(t,i){var a="v2tournament__encounters-steps-arrow",n=a+"--visible";e.query("."+a+"--left")[t?"addClass":"removeClass"](n);e.query("."+a+"--right")[i?"addClass":"removeClass"](n)},ssv2UpdateScrollArrows:function(){var e=document.querySelector(".v2tournament__encounters-steps-wrapper");if(e){var t=e.scrollWidth,i=e.offsetWidth,a=Math.ceil(e.scrollLeft);t<=i?this.ssv2ToggleScrollArrows(!1,!1):0!==a?a!==t-i?this.ssv2ToggleScrollArrows(!0,!0):this.ssv2ToggleScrollArrows(!0,!1):this.ssv2ToggleScrollArrows(!1,!0)}},ssv2Scroll:function(t){var i=document.querySelector(".v2tournament__encounters-steps-wrapper"),a=i.scrollWidth,n=i.offsetWidth,o=i.scrollLeft;if(!(a<n)){var s=o+("left"===t?-200:200);i.scrollLeft=s;setTimeout(e.hitch(this,this.ssv2UpdateScrollArrows),1500)}}})})},"ebg/site/tournamentlist":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule"],function(e,t,i){return t("ebg.site.tournamentlist",ebg.core.mainsitemodule,{constructor:function(){this.clockmode="realtime";this.page_displayed=0;this.is_full_tournament_checkbox_visible=!0;this.jstpl_tournament=['<a href="/tournament?id=${id}" class="tournaments-list-result tournaments-list-result--mode-${game_mode} tournaments-list-result--player-status-${player_status} no-underline">','  <div class="tournaments-list-result__indicator">',"  </div>",'  <div class="tournaments-list-result__title">','    <div class="tournaments-list-result__gamebox game_icon" style="background-image: url(${game_icon})"></div>',"    <div>",'      <div class="tournaments-list-result__gamename flex"><span class="${is_official_display}"><img class="w-5 h-5 mr-1" src="'+g_themeurl+'img/common/svg/tournaments/official.svg" alt="Official tournament" title="Official tournament"/></span>${game_name_displayed}</div>','      <div class="tournaments-list-result__subtitle">','        <div class="tournaments-list-result__avatar" style="background-image: url(${avatar_image})"></div>','        <div class="tournaments-list-result__name"><span class="tournaments-list-result__championship">${championship_name}</span><span> &bull; ${name}</span></div>',"      </div>","    </div>","  </div>",'  <div class="tournaments-list-result__players">','    <i class="fa fa-child"></i>',"    <span>",'      <span class="tournaments-list-result__players-reg">${registered}</span> / ','      <span class="tournaments-list-result__players-max">${max_players}</span>',"    </span>","  </div>",'  <div class="tournaments-list-result__infos">','    <div class="tournaments-list-result__date">${start_at} <span class="date_to_format">${start_date}</span></div>','    <div class="tournaments-list-result__type">${game_mode_displayed} - ${type_formatted}</div>','    <div class="tournaments-list-result__gameinfo">','      <span class="tournaments-list-result__timing"><i class="fa fa-clock-o"></i> ${game_timing}</span>','      <span class="tournaments-list-result__gameplayers"><i class="fa fa-child"></i> ${game_players}</span>',"    </div>","  </div>",'  <div class="tournaments-list-result__infos2">','    <div class="tournaments-list-result__status">${status_details}</div>','    <div class="tournaments-list-result__playerstatus">${playerstatus_detailled}</div>',"  </div>",'  <div class="tournaments-list-result__xp"><div class="xp_container">${prestige} XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div></div>',"</a>"].join("");this.page_loaded=!1},doesNeedServerSideLoad:function(){return!globalUserInfos.flags.tournament_rework},onLoad:function(t){e.parser.parse();mainsite.setPageTitle(_("Tournaments"));var a;if(globalUserInfos.flags.tournament_rework){document.documentElement.classList.add("bga-white-background");a=document.querySelector("#main-content");this.tournamentsList=new i.ms.tournaments.BgaTournamentsList({target:a,props:{initialQuery:t}});this.tournamentsList.$on("query-params-change",e=>{const t="/tournamentlist?d&"+new URLSearchParams(e.detail.params).toString();history.pushState(null,"",t)})}else{this.setupMenuBar();e.addClass("pageheader_tournament","pageheader_menuitemselected");(a=document.querySelector(".tournamentlist-module--old")).style.display="";this.initializeForm(t);this.connect($("see_more_tables"),"onclick","onSeeMoreTables");this.connect($("create_new_tournament"),"onclick",function(t){e.stopEvent(t);this.toggleCreateTournament()});this.updateGameMode(!0);this.page_loaded=!0;this.onFiltersChange(!0)}},onOnUnload:function(){this.gameSelector&&this.gameSelector.$destroy();this.gameSelectorQuickLaunch&&this.gameSelectorQuickLaunch.$destroy();this.tournamentlist&&this.tournamentsList.$destroy();globalUserInfos.flags.tournament_rework&&document.documentElement.classList.remove("bga-white-background")},onQuickLaunch:function(e){gotourl("newtournament?game="+e)},initializeForm:function(t){var a,n=!1;this.connectQuery('input[name="filterallstatus"]',"onchange",()=>this.onFiltersChange());void 0!==t.gamecateg&&($("gamesfiltertype").value=t.gamecateg);this.connect($("gamesfiltertype"),"onchange",()=>this.onFiltersChange());this.connect($("filter_text"),"onfocus",function(){e.style("filter_text_btn","display","inline")});this.connect($("filter_text_btn"),"onclick",()=>this.onFiltersChange());var o="all";"true"===t.realtime?o="realtime":"true"===t.turnbased&&(o="turnbased");e.query('[name="mode"').forEach(function(e){e.checked=o==e.value});this.connectQuery('input[name="mode"]',"onchange",()=>this.onFiltersChange());if($("filter_game_selector")){this.gameSelector=new i.ms.games.BgaGameSelector({target:$("filter_game_selector")});this.gameSelector.$on("game-selected",()=>this.onFiltersChange());t.game&&this.gameSelector&&(this.gameSelector.value=+t.game)}$("filtergame_wrap").style.display=3==t.gamecateg?"":"none";if(t.text){$("filter_text").value=t.text;e.style("filter_text_btn","display","inline")}$("tournament_full").checked="true"===t.full;this.connect($("tournament_full"),"onchange",()=>this.onFiltersChange());a=void 0!==t.created&&t.created;$("tournament_i_created").checked=a;a&&(n=!0);this.connect($("tournament_i_created"),"onchange",()=>this.onFiltersChange());a=t.tournament_i_registered||0;e.query('[name="i_registered"').forEach(function(e){e.checked=a==e.value});a>0&&(n=!0);this.connectQuery('input[name="i_registered"]',"onchange",()=>this.onFiltersChange());a=t.time||0;$("time_filter").value=a;a>0&&(n=!0);this.connect($("time_filter"),"onchange",()=>this.onFiltersChange());a=t.prestige||0;$("prestige_filter").value=a;a>0&&(n=!0);this.connect($("prestige_filter"),"onchange",()=>this.onFiltersChange());a=t.type||0;$("type_filter").value=a;a&&"0"!=a&&(n=!0);this.connect($("type_filter"),"onchange",()=>this.onFiltersChange());a=t.players_per_match_min||0;$("players_per_match_min_filter").value=a;a&&"0"!=a&&(n=!0);this.connect($("players_per_match_min_filter"),"onchange",()=>this.onFiltersChange());a=t.players_per_match_max||0;$("players_per_match_max_filter").value=a;a&&"0"!=a&&(n=!0);this.connect($("players_per_match_max_filter"),"onchange",()=>this.onFiltersChange());if($("filter_game_selector_quicklaunch")){this.gameSelectorQuickLaunch=new i.ms.games.BgaGameSelector({target:$("filter_game_selector_quicklaunch")});this.gameSelectorQuickLaunch.$on("game-selected",()=>{this.onQuickLaunch(this.gameSelectorQuickLaunch.value)})}this.toggleAdvanced(n);this.connectQuery(".tournaments-list-filters__show-advanced","onclick",function(e){this.toggleAdvanced(!0)})},toggleAdvanced:function(t){e.query(".tournaments-list-filters__side-advanced").style("display",t?"":"none");e.query(".tournaments-list-filters__show-advanced").style("display",t?"none":"hide")},toggleCreateTournament:function(t){var i=e.query(".tournaments-list-create__form")[0];void 0===t&&(t=!i.classList.contains("visible"));var a=t?"add":"remove";i.classList[a]("visible")},getFormContent:function(){var e,t={};t.time=$("time_filter").value;t.prestige=$("prestige_filter").value;t.type=$("type_filter").value;t.players_per_match_min=$("players_per_match_min_filter").value;t.players_per_match_max=$("players_per_match_max_filter").value;t.gamecateg=$("gamesfiltertype").value;e=document.querySelector('input[name="filterallstatus"]:checked');t.status=e?e.value:null;var i=this.gameSelector.value;t.game=toint(i);e=document.querySelector('input[name="i_registered"]:checked');t.tournament_i_registered=e?e.value:null;$("tournament_i_created").checked&&(t.created=!0);switch((e=document.querySelector('input[name="mode"]:checked'))?e.value:null){default:case"all":break;case"realtime":t.realtime=!0;break;case"turnbased":t.turnbased=!0}this.is_full_tournament_checkbox_visible?t.full=$("tournament_full").checked:t.full=!0;""!=$("filter_text").value&&(t.text=$("filter_text").value);return t},updateResults:function(t){if(t){e.empty("tournament_list");this.page_displayed=0}var i=this.getFormContent();i.page=this.page_displayed;if(null!==i){e.style("tablestats_loading","display","block");this.ajaxcall("/tournamentlist/tournamentlist/getTournaments.html",i,this,function(t){e.style("tablestats_loading","display","none");this.addGameResultRows(t.list);if(0===t.list.length){e.style("no_tournament_wrap","display","");e.style("see_more_tables","display","none")}else{e.style("no_tournament_wrap","display","none");e.style("see_more_tables","display","")}})}},addGameResultRows:function(t){for(var i in t){var a=t[i],n=Math.floor(Date.now()/1e3),o={};if(mainsite.gamefilter[a.game_id]){(o=a).game_icon=getMediaUrl(o.game_name,"icon");o.game_name_displayed=_(o.game_name+"_displayed");o.game_mode=21==o.time_profile?"turnbased":"realtime";o.game_mode_displayed=21==o.time_profile?_("Turn-based"):_("Realtime");o.game_timing="";var s=[];a.game_max_duration_formatted&&s.push(o.game_max_duration_formatted);if(0!=a.playing_hours&&null!==a.playing_hours){var r=toint(a.playing_hours)-1+":00",l=mainsite.playingHoursToLocal(r,!0);s.push(e.string.substitute(_("between ${start_hour} and ${end_hour}"),l))}s.length>0&&(o.game_timing+=s.join(", "));o.game_players="";var d=[];a.players_per_match_min&&a.players_per_match_min<a.players_per_match&&d.push(a.players_per_match_min+" - ");a.players_per_match&&d.push(a.players_per_match);d.length>0&&(o.game_players+=d.join(""));o.start_date=a.date;o.start_at=a.date<n?_("Started"):_("Starts");if(null==a.player_status){a.player_status="none";o.playerstatus_detailled=""}else"active"==a.player_status?o.playerstatus_detailled='<i class="fa fa-star"></i> '+_("You are participating in this tournament"):"eliminated"==a.player_status?o.playerstatus_detailled='<i class="fa fa-star"></i> '+_("You participated to this tournament"):"withdrawn"==a.player_status?o.playerstatus_detailled='<i class="fa fa-star"></i> '+_("You withdrew from this tournament"):o.playerstatus_detailled="";e.place(this.format_string(this.jstpl_tournament,o),"tournament_list")}}this.formatDates(".tournaments-list-results")},onSeeMoreTables:function(t){e.stopEvent(t);this.page_displayed++;this.updateResults()},onFiltersChange:function(t){if(0!=this.page_loaded){var i=this.getFormContent();$("filtergame_wrap").style.display=3==i.gamecateg?"":"none";1==i.created||1==i.tournament_i_registered||"future"!==i.status?this.toggleFullTournamentCheckbox(!1):this.toggleFullTournamentCheckbox(!0);var a="tournamentlist?d&"+e.objectToQuery(i);!0===t?history.replaceState(null,"",a):history.pushState(null,"",a);this.updateResults(!0)}},toggleFullTournamentCheckbox:function(e){this.is_full_tournament_checkbox_visible=e;$("tournament_full_wrapper").style.visibility=e?"visible":"hidden"},setupMenuBar:function(){this.rankingMode="tournament";$("mobile_switcher_firstline_gamemode").innerHTML=e.query("#pageheader_"+this.rankingMode+" .firstline")[0].innerHTML;$("mobile_switcher_secondline_gamemode").innerHTML=e.query("#pageheader_"+this.rankingMode+" .secondshortline")[0].innerHTML;e.place(e.query("#pageheader_"+this.rankingMode+" .pageheader_big_switch_icon")[0].innerHTML,"mobile_switcher_icon_gamemode","only");this.connect($("pageheader_mobile_switcher"),"onclick","onGameModeChangeMobileSwitcher");this.connect($("pageheader_mobile_switcher_gamemode"),"onclick","onGameModeChangeMobileSwitcherGamemode");this.connect($("pageheader_async"),"onclick","onGameModeChange");this.connect($("pageheader_realtime"),"onclick","onGameModeChange");this.connect($("pageheader_simple"),"onclick","onRankingModeChange");this.connect($("pageheader_arena"),"onclick","onRankingModeChange");this.connect($("pageheader_tournament"),"onclick","onRankingModeChange");var t=$("playing_mode").innerHTML;"s"==t[0]?this.rankingMode="simple":this.rankingMode="arena";"r"==t[1]?this.clockmode="realtime":this.clockmode="async";"m"==t[2]?this.opponentMode="manual":this.opponentMode="automatic"},onGameModeChangeMobileSwitcher:function(t){e.stopEvent(t);if(e.hasClass("pageheader_mobile_switcher_wrap","dropdown_expanded"))"none"!=e.style("pageheader_mobile_switcher","display")&&e.removeClass("pageheader_mobile_switcher_wrap","dropdown_expanded");else{e.query(".dropdown_expanded").removeClass("dropdown_expanded");e.addClass("pageheader_mobile_switcher_wrap","dropdown_expanded")}},onGameModeChangeMobileSwitcherGamemode:function(t){e.stopEvent(t);if(e.hasClass("pageheader_mobile_switcher_wrap_gamemode","dropdown_expanded"))"none"!=e.style("pageheader_mobile_switcher","display")&&e.removeClass("pageheader_mobile_switcher_wrap_gamemode","dropdown_expanded");else{e.query(".dropdown_expanded").removeClass("dropdown_expanded");e.addClass("pageheader_mobile_switcher_wrap_gamemode","dropdown_expanded")}},onRankingModeChange:function(e){var t=e.currentTarget.id.split("_")[1];"simple"==t?gotourl("lobby?simple"):"arena"==t&&gotourl("lobby?arena")},onGameModeChange:function(e){"pageheader_async"==e.currentTarget.id?this.clockmode="async":this.clockmode="realtime";this.updateGameMode()},updateRankingMode:function(){e.query("#pageheader_lobbymenunav_gamemode .pageheader_menuitem").removeClass("pageheader_menuitemselected");"simple"==this.rankingMode||this.rankingMode},updateGameMode:function(t){var i=this.clockmode;e.query("#pageheader_lobbymenunav .pageheader_menuitemselected").removeClass("pageheader_menuitemselected");if("realtime"==i){$("mobile_switcher_firstline").innerHTML=e.query("#pageheader_realtime .firstline")[0].innerHTML;$("mobile_switcher_secondline").innerHTML=e.query("#pageheader_realtime .secondshortline")[0].innerHTML;e.removeClass("mobile_switcher_icon","icon32_turnbased");e.addClass("mobile_switcher_icon","icon32_realtime");e.removeClass("pageheader_mobile_switcher","gametable_status_asyncopen")}else if("async"==i){$("mobile_switcher_firstline").innerHTML=e.query("#pageheader_async .firstline")[0].innerHTML;$("mobile_switcher_secondline").innerHTML=e.query("#pageheader_async .secondshortline")[0].innerHTML;e.removeClass("mobile_switcher_icon","icon32_realtime");e.addClass("mobile_switcher_icon","icon32_turnbased");e.addClass("pageheader_mobile_switcher","gametable_status_asyncopen")}if(void 0!==t&&t);else{this.saveLobbyMode();this.updateResults(!0)}},saveLobbyMode:function(){var e=this.clockmode;this.ajaxcall("/player/profile/setGameMode.html",{async:"async"==e?1:0,realtime:"realtime"==e?1:0,simple:"automatic"==this.opponentMode,arena:"simple"!=this.rankingMode},this,function(e){})},formatDates:function(t){t||(t="body");e.query(t).forEach(function(t){e.query(".date_to_format",t).forEach(function(t){e.removeClass(t,"date_to_format");var i=toint(t.innerHTML);t.innerHTML=date_format(i,!0,!1,!0);t.hasAttribute("title")||t.setAttribute("title",date_format_simple(i))})})}})})},"ebg/site/translation":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule","dojox/dtl/filter/strings","ebg/comboajax"],function(e,t){return t("ebg.site.translation",ebg.core.mainsitemodule,{constructor:function(){this.module_id=null;this.sourceLocale=null;this.destLocale=null;this.locale_src_current=null;this.locale_dst_current=null;this.bOfficialTranslator=!1;this.confirmedMainLanguageTranslation=!1;this.confirmedValidatedTranslation=!1;this.filteringSelect=null;this.popindialog=null;this.trh_id=null},onLoad:function(t){mainsite.setPageTitle(_("Translation"));t.module_id&&(this.module_id=t.module_id);this.sourceLocale=new dijit.form.Select({id:"sourceLocale",name:"sourceLocale"},"sourceLocale");if(t.source_locale){this.locale_src_current=t.source_locale;this.sourceLocale.attr("value",t.source_locale)}e.style($("sourceLocaleWrap"),"display","inline-block");e.query("#sourceLocale td").style("padding","4px");this.destLocale=new dijit.form.Select({id:"destLocale",name:"destLocale"},"destLocale");if(t.dest_locale){this.locale_dst_current=t.dest_locale;this.destLocale.attr("value",t.dest_locale)}e.style($("destLocaleWrap"),"display","inline-block");e.query("#destLocale td").style("padding","4px");e.query(".active_textarea").connect("onkeyup",this,"onChangeTranslation");e.query(".active_textarea").connect("onblur",this,"onBlurTranslation");e.query(".translation_history_link").connect("onclick",this,"onClickHistoryLink");e.query(".newcomment_textarea").connect("onblur",this,"onBlurComment");e.query(".confirm_translation_button").connect("onclick",this,"onConfirmTranslation");e.query(".modify_translation_button").connect("onclick",this,"onModifyTranslation");e.query(".request_change_button").connect("onclick",this,"onRequestChange");e.connect(this.sourceLocale,"onChange",this,"onChangeSourceLocale");e.connect(this.destLocale,"onChange",this,"onChangeDestLocale");e.connect($("findstring_button"),"onclick",this,"onFindStringButton");this.connectClass("validated_change_conditions","onfocus","displayValidatedChangeConditions");e.connect($("findreset_form"),"onsubmit",e.hitch(this,function(t){e.stopEvent(t);gotourl($("findreset_form").getAttribute("bgaaction"))}));1==toint($("officialtranslator").innerHTML)&&(this.bOfficialTranslator=!0);this.filteringSelect=new ebg.comboajax;this.filteringSelect.create("findplayer","/player/player/findplayer.html",__("lang_mainsite","Type a player name..."));null!==$("findplayer")&&e.style("findplayer","padding","4px");e.connect(this.filteringSelect,"onChange",this,function(e){if(0!=toint(e)){this.filteringSelect;$("findtype_player").checked=!0;$("findtype_player").focus();$("findtype_player").blur()}t.translator_id!=e&&this.updatePageWithFilter()});""!=$("translator_player_name").value&&this.filteringSelect.setSelection($("translator_player_name").value);e.connect($("findtype_all"),"onclick",this,function(e){this.onFindStringButton(e)});e.connect($("findtype_untranslated"),"onclick",this,function(e){this.onFindStringButton(e)});e.connect($("findtype_machine"),"onclick",this,function(e){this.onFindStringButton(e)});e.connect($("findtype_recent"),"onclick",this,function(e){this.onFindStringButton(e)});e.connect($("findtype_validated"),"onclick",this,function(e){this.onFindStringButton(e)});e.connect($("findstring_value"),"onkeypress",this,function(e){13==e.keyCode&&this.onFindStringButton(e)});e.connect($("findcontext_value"),"onkeypress",this,function(e){13==e.keyCode&&this.onFindStringButton(e)})},onClickHistoryLink:function(t){t.preventDefault();t.stopPropagation();var i=t.currentTarget.id.split("_")[1];this.ajaxcall("/translation/translation/getTranslationHistory.html",{trk_id:i,locale:this.destLocale.getValue(),lock:!0},this,function(t){var a="<table class=\"statstable\"><tbody><tr><th style='width:50%'>"+_("Translation")+"</th><th>"+_("Comment")+"</th><th>"+_("Date")+"</th><th>"+_("Translator")+"</th></tr>";for(var n in t){var o=(r=t[n]).player_fullname;null==r.player_fullname&&(o="BGA");null==r.player_fullname&&"microsoft"==r.machine_translation&&(o="Microsoft Translator");null==r.player_fullname&&"google"==r.machine_translation&&(o="Google Translate");var s="";null!=r.str_translation_date&&(s=r.str_translation_date);null!=r.str_confirmation_date&&(s=r.str_confirmation_date);a+="<tr style='"+(1==r.is_current?"background-color: #cceecc;":"")+"'><td><textarea class='readonly_textarea' readonly='readonly'>"+(null!=r.str_translated?r.str_translated:"")+"</textarea></td><td><span>"+(null!=r.str_translation_comment?r.str_translation_comment:"")+(current_player_id==r.player_id?" (<a href='#' id='edit_comment_"+r.trh_id+"_"+r.trk_id+"' class='edit_comment bga-link'>"+_("Edit")+"</a>)":"")+"</span></td><td>"+s+"</td><td>"+o+"</td></tr>"}a+="</tbody></table>";$("history_"+i).innerHTML=a;for(var n in t){var r=t[n];current_player_id==r.player_id&&e.connect($("edit_comment_"+n+"_"+r.trk_id),"onclick",this,"onClickEditComment")}"none"==e.style($("history_"+i),"display")?e.style($("history_"+i),"display","block"):e.style($("history_"+i),"display","none")})},onClickEditComment:function(t){t.preventDefault();t.stopPropagation();var i=t.currentTarget.id,a=i.split("_")[2];this.trh_id=a;var n=i.split("_")[3];e.query(".instant_comment").style("display","none");$("newcomment_"+n).value="";e.style($("instantcomment_"+n),"display","block");e.style($("recorded_comment_"+n),"display","none");$("newcomment_"+n).focus()},onBlurTranslation:function(t){t.preventDefault();t.stopPropagation();var i=t.currentTarget,a=t.currentTarget.id.split("_")[1],n=$("translation_current_"+a).innerHTML;if(!i.readOnly)if("en_US"!=this.destLocale.getValue()||"en_US"==this.sourceLocale.getValue()){if(i.value!=$("current_"+a).value){var o=i.value.trim().slice(-1),s=$("toTranslate_"+a).value.trim().slice(-1);if(""==i.value||o==s||!("."==s&&""!=o||"!"==s&&""!=o||"?"==s&&""!=o||"."!=s&&(""==o||"."==o)||"!"!=s&&(""==o||"!"==o)||"?"!=s&&(""==o||"?"==o)||":"==s&&""!=o||":"==o)||confirm(_("You have changed the ending punctuation from the original English text. As a general rule, you shouldn't do that (it can change the meaning or the interface aesthetics intended by the developer). Are you REALLY REALLY sure?"))){if(!this.confirmedMainLanguageTranslation&&"en_US"==this.destLocale.getValue()){if(!confirm("You are changing the reference English text. You should be really careful when doing this as it will impact translations in other languages (this is for fixing syntax or typos, not for changing the meaning or overall structure of the text). Are you sure that's what you want to do?"))return;this.confirmedMainLanguageTranslation=!0}if(!this.confirmedValidatedTranslation&&e.hasClass(i,"textarea_status_validated")){if(!confirm(_("You are changing a validated translation. This doesn't award any gift points and should be done only to fix clear and obvious mistakes. Please do not make changes you are not sure of, and always stay as close as possible to the original English text in meaning and style. Do you want to proceed?")))return;this.confirmedValidatedTranslation=!0}("m / d / Y"!=$("toTranslate_"+a).value&&"m/d/Y"!=$("toTranslate_"+a).value||confirm(_("This string defines the date formatting for your language. It should contain the letters 'm', 'd' and 'Y' in the proper order. It's important to get this right! Are you sure?")))&&("m/d/Y H:i"!=$("toTranslate_"+a).value&&"m/d/Y - H:i"!=$("toTranslate_"+a).value||confirm(_("This string defines the date formatting for your language. It should contain the letters 'm', 'd', 'Y', 'H' and 'i' in the proper order. It's important to get this right! Are you sure?")))&&("H:i"!=$("toTranslate_"+a).value||confirm(_("This string defines the time formatting for your language. It should contain the letters 'H' and 'i' in the proper order. It's important to get this right! Are you sure?")))&&(-1!=$("toTranslate_"+a).value.indexOf("%y-%m-%d")&&-1==i.value.indexOf("%y-%m-%d")||-1!=$("toTranslate_"+a).value.indexOf("${Y}-${M}-${D}")&&-1==i.value.indexOf("${Y}-${M}-${D}")?alert(_("This string defines the ISO 8601 date formatting for your language. You cannot change the date part of this string, only what follows.")):(i.value!=$("toTranslate_"+a).value||confirm(_("Your translation is identical to the text to translate. Are you sure this is correct?")))&&(i.value.replace(/[\s\u202F]/g,"")!=$("current_"+a).value.replace(/[\s\u202F]/g,"")||confirm(_("Your translation is identical to the previous translation, except for spaces. Are you sure this is correct?")+"\n\n"+_("NB: if you confirm, the translation will be updated but will stay assigned to its current translator.")))&&this.ajaxcall("/translation/translation/recordTranslation.html",{trk_id:a,current_trh_id:n,locale:this.destLocale.getValue(),str_translated:i.value,lock:!0},this,function(t){"none"!=e.style($("history_"+a),"display")&&e.style($("history_"+a),"display","none");t.restore&&($("translated_"+t.trk_id).value=t.restore);t.message&&("error"==t.status?this.showMessage(t.message,"error"):this.showMessage(t.message,"info"));e.removeClass($("status_"+t.trk_id),"status_empty");e.removeClass($("status_"+t.trk_id),"status_error");e.removeClass($("status_"+t.trk_id),"status_machine");e.removeClass($("status_"+t.trk_id),"status_recorded");e.removeClass($("status_"+t.trk_id),"status_writing");e.removeClass($("status_"+t.trk_id),"status_validated");e.addClass($("status_"+t.trk_id),"status_"+t.status);e.removeClass($("translated_"+t.trk_id),"textarea_status_empty");e.removeClass($("translated_"+t.trk_id),"textarea_status_machine");e.removeClass($("translated_"+t.trk_id),"textarea_status_recorded");e.removeClass($("translated_"+t.trk_id),"textarea_status_validated");e.addClass($("translated_"+t.trk_id),"textarea_status_"+t.status);if(t.just_translated){$("translation_footer_"+t.trk_id).innerHTML=_("Just translated by you");e.style($("in_progress_"+t.trk_id),"display","none");e.style($("translator_"+t.trk_id),"display","block")}else{e.style($("in_progress_"+t.trk_id),"display","none");if(""!=$("translated_"+t.trk_id).value){!0===t.reverted&&($("translation_footer_"+t.trk_id).innerHTML=_("Reverted to a previous translation"));e.style($("translator_"+t.trk_id),"display","block")}else e.style($("not_translated_"+t.trk_id),"display","block")}if(t.reverted||t.just_translated||t.same_translator){e.style($("instantcomment_"+a),"display","block");e.style($("recorded_comment_"+a),"display","none");var i=document.activeElement;!i.id.split("_")[0]||"translated"!=i.id.split("_")[0]&&"newcomment"!=i.id.split("_")[0]?$("newcomment_"+a).focus():i.focus();if(t.reverted){this.trh_id=t.trh_id;$("translation_current_"+t.trk_id).innerHTML=t.revert_to_trh_id}t.just_translated&&($("translation_current_"+t.trk_id).innerHTML=t.trh_id)}else{e.style($("instantcomment_"+a),"display","none");""!=$("translation_comment_"+a).innerHTML&&e.style($("recorded_comment_"+a),"display","block")}if("recorded"==t.status){e.style($("confirm_translation_"+a),"display","none");e.style($("modify_translation_"+a),"display","none")}"error"!==t.status&&($("current_"+a).value=$("translated_"+t.trk_id).value)},function(e){},"post"))}}}else this.showMessage(_("You cannot translate from another language into English since English is the reference language"),"error")},onChangeTranslation:function(t){var i=t.currentTarget,a=t.currentTarget.id.split("_")[1];if(!i.readOnly){e.removeClass($("status_"+a),"status_empty");e.removeClass($("status_"+a),"status_error");e.removeClass($("status_"+a),"status_machine");e.removeClass($("status_"+a),"status_recorded");e.addClass($("status_"+a),"status_writing");if(9!=t.keyCode){e.style($("not_translated_"+a),"display","none");e.style($("in_progress_"+a),"display","block");e.style($("translator_"+a),"display","none");if(""!=$("translated_"+a).value){$("newcomment_"+a).value="";$("translation_comment_"+a).innerHTML="";e.style($("instantcomment_"+a),"display","block");e.style($("recorded_comment_"+a),"display","none")}}}},onChangeSourceLocale:function(e){e!=this.locale_src_current&&this.updatePageWithFilter()},onChangeDestLocale:function(e){e!=this.locale_dst_current&&this.updatePageWithFilter()},updatePageWithFilter:function(){var t={module_id:this.module_id,source_locale:this.sourceLocale.getValue(),dest_locale:this.destLocale.getValue()},i=document.querySelector('input[name="findtype"]:checked');i&&(t.findtype=i.value);""!=$("findstring_value").value&&(t.find=$("findstring_value").value);""!=$("findcontext_value").value&&(t.findctx=$("findcontext_value").value);var a=this.filteringSelect.getSelection();null!==a&&"player"==t.findtype&&(t.translator_id=a);e.publish("gotourl",[{module:"translation",args:t}])},onBlurComment:function(t){var i=t.currentTarget.id.substr(11),a=$("newcomment_"+i),n=this.trh_id;this.trh_id=null;this.ajaxcall("/translation/translation/recordComment.html",{trk_id:i,trh_id:n,locale:this.destLocale.getValue(),comment:a.value,lock:!0},this,function(t){if(""!=a.value){this.showMessage(_("Your comment has been recorded"),"info");$("translation_comment_"+i).innerHTML=t}""!=$("translation_comment_"+i).innerHTML&&e.style($("recorded_comment_"+i),"display","block");e.style($("instantcomment_"+i),"display","none");"none"!=e.style($("history_"+i),"display")&&e.style($("history_"+i),"display","none")})},onModifyTranslation:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(19);$("translated_"+i).focus();$("translated_"+i).select()},onConfirmTranslation:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(20),a=$("translation_current_"+i).innerHTML;this.ajaxcall("/translation/translation/confirmTranslation.html",{trk_id:i,trh_id:a,locale:this.destLocale.getValue(),lock:!0},this,function(t){this.showMessage(_("Your confirmation has been registered"),"info");e.style($("confirm_translation_"+i),"display","none");e.style($("modify_translation_"+i),"display","none");e.removeClass($("translated_"+i),"textarea_status_machine");e.removeClass($("status_"+i),"status_machine");e.addClass($("translated_"+i),"textarea_status_recorded");e.addClass($("status_"+i),"status_recorded");"none"!=e.style($("history_"+i),"display")&&e.style($("history_"+i),"display","none")})},onRequestChange:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(15),a=$("translation_current_"+i).innerHTML;this.popindialog=new ebg.popindialog;this.popindialog.create("request_change","main-content");this.popindialog.setMaxWidth(600);var n=$("translated_"+i).dir,o=$("translated_"+i).value,s=null!==$("isTranslationAdmin")&&1==$("isTranslationAdmin").innerHTML,r=null!==$("isModuleDeveloper")&&1==$("isModuleDeveloper").innerHTML,l='<br>                    <div class="translation_block" style="display:block; margin:auto;">                        <p>The current English text:</p>                        <textarea  dir="'+n+'" id="current_'+i+'" class="readonly_textarea" readonly="false">'+o+'</textarea>                        <br /><br >                        <p>Your proposal for a change to the current English text:</p>                        <textarea  dir="'+n+'" id="proposed_'+i+'" class="active_textarea">'+o+'</textarea>                        <br /><br >                        <p>Your comment in English explaining this change request:</p>                        <textarea id="proposedcomment_'+i+'" class="active_textarea"></textarea>                        <br /><br >                        <p align="left"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> Changing the original English text impacts translations in other languages. It is meant to be used to fix grammar, syntax or typographical errors. It should NOT be used to change the meaning or overall structure of the text (if that is needed, it should be asked of the developer through a <a class="bga-link" href="bugs" target="_blank">bug/suggestion report</a>).<br /><br /></p>                        <p align="left" style="color: red; display: '+(s||r?"":"none")+';"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> '+(s?"As an admin, your change request will be automatically validated.":"As a developer for this game, your change request will be automatically validated.")+'<br /></p>                        <p align="left" style="color: red; display: '+(s||r?"":"none")+';"><input id="forceretranslation_'+i+'" type="checkbox" style="vertical-align: text-bottom;"/><label style="padding: 0.6em;">Force retranslation in all languages?</label></p><br />                        <div class="clear" style="text-align:center">                            <a href="#" id="request_change_cancel" class="bgabutton bgabutton_gray">'+_("Cancel")+'</a>                            <a href="#" id="request_change_submit" class="bgabutton bgabutton_blue">'+_("Submit request")+"</a>                        </div>                    </div>";this.popindialog.setContent(l);this.popindialog.show();e.connect($("request_change_cancel"),"onclick",this,function(t){e.stopEvent(t);this.popindialog.destroy()});e.connect($("request_change_submit"),"onclick",this,function(t){e.stopEvent(t);this.ajaxcall("/translation/translation/recordTranslation.html",{trk_id:i,current_trh_id:a,locale:this.destLocale.getValue(),str_translated:$("proposed_"+i).value,comment:$("proposedcomment_"+i).value,proposed:!0,force_retranslation:$("forceretranslation_"+i).checked,lock:!0},this,function(t){"recorded"==t.status?this.showMessage(_("Your change request has been automatically validated"),"info"):this.showMessage(_("Your change request has been submitted"),"info");e.style($("request_change_"+i),"display","none");"none"!=e.style($("history_"+i),"display")&&e.style($("history_"+i),"display","none");this.popindialog.destroy()},function(e){},"post")})},onFindStringButton:function(t){e.stopEvent(t);this.updatePageWithFilter()},displayValidatedChangeConditions:function(t){e.stopEvent(t);this.popindialog=new ebg.popindialog;this.popindialog.create("request_change","main-content");this.popindialog.setMaxWidth(600);var i="<br>                    <div>                        <p>"+_("This translation is validated. You can change it only if you meet the following conditions:")+'</p>                        <br />                        <ul>                        <li style="list-style: disc outside; margin-left: 30px;">'+_("You speak English and have indicated it in your language preferences")+'</li>                        <li style="list-style: disc outside; margin-left: 30px;">'+_("You have reached a reputation of at least %s").replace("%s","90")+'</li>                        <li style="list-style: disc outside; margin-left: 30px;">'+_("You have a seniority of at least 3 months on Board Game Arena")+'</li>                        <li style="list-style: disc outside; margin-left: 30px;">'+_("If this translation concerns a game, you have played this game at least 10 times")+'</li>                        <li style="list-style: disc outside; margin-left: 30px;">'+_("If this translation concerns the mainsite, you have played at least 100 games.")+'</li>                        <ul>                        <br />                        <p><i class="fa fa-exclamation-circle" aria-hidden="true"></i> '+_("Please be aware that fixing validated translations doesn't award any gift points: it should be used only to fix clear and obvious mistakes.")+'</p>                        <br />                        <div class="clear" style="text-align:center">                            <a href="#" id="request_change_cancel" class="bgabutton bgabutton_blue">'+_("Close")+"</a>                        </div>                    </div>";this.popindialog.setContent(i);this.popindialog.show();e.connect($("request_change_cancel"),"onclick",this,function(t){e.stopEvent(t);this.popindialog.destroy()})},onOnUnload:function(){this.sourceLocale.destroy();this.destLocale.destroy();$("findplayer")&&dijit.byId("findplayer").destroy()}})})},"ebg/site/translationhq":function(){define(["dojo","dojo/_base/declare","ebg/core/mainsitemodule"],function(e,t){return t("ebg.site.translationhq",ebg.core.mainsitemodule,{constructor:function(){this.languageCombo=null;this.language=null},onLoad:function(t){mainsite.setPageTitle(_("Translation headquarter"));e.connect($("filter_name"),"onkeyup",this,"onUpdateFilters");this.languageCombo=new dijit.form.Select({id:"language",name:"language"},"language");this.languageCombo.attr("value",$("currentlang").innerHTML);e.style($("languagewrap"),"display","inline-block");e.query("#language td").style("padding","4px");this.language=$("currentlang").innerHTML;e.connect(this.languageCombo,"onChange",this,"onChangeLanguage")},onUpdateFilters:function(){var t=$("filter_name").value;if(""!=(t=removeAccents(t.toLowerCase()))){e.query(".module_entry").style("display","none");e.query(".search_highlight").forEach(function(e){e.parentNode.innerHTML=e.parentNode.innerHTML.replace(e.outerHTML,e.innerHTML)});e.query(".module_name").forEach(e.hitch(this,function(i){var a=i.innerHTML;a=removeAccents(a.toLowerCase());if(-1!=this.strip_tags(a).indexOf(t)){var n=a.indexOf(t);-1!=n&&(i.innerHTML.substring(n+t.length).indexOf("<")<0||i.innerHTML.substring(n+t.length).indexOf(">")>i.innerHTML.substring(n+t.length).indexOf("<"))&&(i.innerHTML=i.innerHTML.substring(0,n)+"<span class='search_highlight'>"+i.innerHTML.substring(n,n+t.length)+"</span>"+i.innerHTML.substring(n+t.length));e.style(i.parentNode,"display","")}}))}else{e.query(".search_highlight").forEach(function(e){e.parentNode.innerHTML=e.parentNode.innerHTML.replace(e.outerHTML,e.innerHTML)});e.query(".module_entry").style("display","")}},onChangeLanguage:function(t){t!=this.language&&e.publish("gotourl",[{module:"translationhq",args:{language:this.languageCombo.getValue()}}])},onOnUnload:function(){this.languageCombo.destroy()}})})},"ebg/site/tutorialfaq":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule"],function(e,t,i){return t("ebg.site.tutorialfaq",ebg.core.mainsitemodule,{constructor:function(){},doesNeedServerSideLoad:function(){return!0},onLoad:function(){mainsite.setPageTitle(_("How to build a tutorial?"));const e=document.querySelector("#tutorialfaq-viewer");if(!e)return;const t=e.dataset.pdfUrl||"";this.tutorialFaqComponent=new i.ms.ui.special.BgaSlideViewer({target:e,props:{src:t}})},onOnUnload:function(){if(this.tutorialFaqComponent){this.tutorialFaqComponent.$destroy();this.tutorialFaqComponent=null}}})})},"ebg/site/tutoriallist":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule","ebg/pageheader"],function(e,t,i){return t("ebg.site.tutoriallist",ebg.core.mainsitemodule,{constructor:function(){this.pageheader=null;this.jstpl_tutorial_game='<div id="tutorials_game_${game_id}" class="pagesection tutorial_game" style="color:black;font-weight:normal;">                            <h3 class="pagesection__title">                                <img width="280" height="280" src="${game_box_url}" loading="lazy" class="game_box"/>                                ${game_name_displayed}                            </h3>                            <div class="pagesection__content">                                <div id="tutorial_list_${game_id}" class="tutorial_list">                                </div>                                <div id="seemore_${game_id}" style="text-align:center;display:none;">                                    <a href="#" id="display_more_tutorials_${game_id}" class="bgabutton bgabutton_gray see_more_tutorial">'+_("Display more")+'</a>                                </div>                                <div class="clear"></div>                            </div>                        </div>';this.jstpl_tutorial='<div id="tutorial_stat_${tutorial_id}" class="tutorial_stat arenasuggestion ${current_public_tutorial}">                <div class="arenasuggestion__player">                    <div class="tutorial_date">${date}</div>                    <div class="tournaments-results-players__avatar emblemwrap">                        <img class="player_avatar emblem" src="${player_avatar_url}"/>                    </div>                    <a class="tournaments-results-players__name playername" href="/player?id={player_id}">${player_fullname}</a>                </div>                <div class="arenasuggestion__content">                    <div class="arenasuggestion__text">${duration} ${duration_label} &bull; ${steps_nbr} '+_("steps")+'</div>                    <div class="arenasuggestion__text"><span class="tutoplayed">${did_not_play_before}</span> '+_("views by beginners")+'</div>                    <div class="arenasuggestion__text"><span class="tutoplayed">${view_until_end}%</span> '+_("views until the end")+'</div>                    <div class="arenasuggestion__text"><span class="tutoplayed">${played_after}%</span> '+_("played the game after the tutorial")+'</div>                    <div class="arenasuggestion__text"><span class="tutorating">${rating}</span> '+_("tutorial average rating")+" (${nb_rating} "+_("ratings")+')</div>                </div>                <span class="${emblemclass} emblemstatus"></span>                ${buttons}                <a href="/tutorial?game=${game_name}&tutorial=${tutorial_id}" class="tutolink" target="_blank">                </a>        </div>'},onLoad:function(t){mainsite.setPageTitle("Tutorials");var i=[{btn:"pageheader_best",section:[]},{btn:"pageheader_known",section:[]},{btn:"pageheader_author",section:[]},{btn:"pageheader_dev",section:[]},{btn:"pageheader_notutorial",section:[]},{btn:"pageheader_allgames",section:[]},{btn:"pageheader_game",section:[]}],a="best";void 0!==t.section&&(a=t.section);for(var n in i)i[n].btn=="pageheader_"+a&&(i[n].defaults=!0);t.game&&(this.specific_game_id=t.game);this.pageheader=new ebg.pageheader;this.pageheader.create(this,"pageheader",i,!1);e.connect(this.pageheader,"onSectionChanged",this,"onSectionChanged");this.onSectionChanged()},onOnUnload:function(){},onSectionChanged:function(){var t=this.pageheader.getSelected();if(null!==t){t=t.split("_")[1];e.empty("tutorial_list_wrapper");e.place('<div class="centered"><br/><br/><br/><span class="loading_icon"></span></div>',"tutorial_list_wrapper");var i={category:t};"game"==t&&(i.game=this.specific_game_id);this.ajaxcall("/tutoriallist/tutoriallist/getTutorialList.html",i,this,function(t){e.empty("tutorial_list_wrapper");t.is_admin&&(this.is_admin=!0);for(var i in t.games)this.insert_game(t.games[i]);for(var i in t.tutorials)this.insert_tutorial(t.tutorials[i],!1);this.tutorials=t.tutorials;e.query(".see_more_tutorial").connect("onclick",this,"onSeeMore");this.configureTutorialElements()})}},configureTutorialElements:function(){this.addTooltipToClass("ttalphatuto",_("This tutorial has been proposed for review: you can play and rate it!"),"");this.addTooltipToClass("ttbetatuto",_("This tutorial is currently tested on random BGA players, and only available in English."),"");this.addTooltipToClass("ttrejectedtuto",_("Unfortunately, despite of its quality, another tutorial has been chosen to be the official tutorial for this game :("),"");this.addTooltipToClass("ttpublictuto",_("This tutorial is the official tutorial for this game, available for translation in all languages :)"),"")},insert_game:function(t){t.game_box_url=i.stores.games.getBoxImage(t.game_name).w280;e.place(this.format_string(this.jstpl_tutorial_game,t),$("tutorial_list_wrapper"))},insert_tutorial:function(t,i){if(null==t.player_avatar){var a="<span>"+_("No tutorial available yet for this game")+'<br/><a class="bgabutton bgabutton_gray" href="/tutorialfaq"><i class="fa fa-info-circle"></i> How to build a tutorial?</a></span>';e.place(a,"seemore_"+t.game_id,"only");e.style("seemore_"+t.game_id,"display","block")}else{if(0==i){if(e.query("#tutorial_list_"+t.game_id+" .tutorial_stat").length>=2){e.style("seemore_"+t.game_id,"display","block");return}if("rejected"==t.tutorial_status){e.style("seemore_"+t.game_id,"display","block");return}}if($("tutorial_stat_"+t.tutorial_id))return;var n=0;null==t.did_not_play_before&&(t.did_not_play_before=0);if(t.did_not_play_before>0){n=t.played_after/t.did_not_play_before;t.played_after=Math.round(1e3*n)/10}else t.played_after="-";t.view_until_end="-";if(t.finished>0){t.view_until_end=t.finished/t.started;t.view_until_end=Math.round(1e3*t.view_until_end)/10}t.duration=Math.round(t.duration/60);t.duration_label=_("mn");if(null===t.duration){t.duration=_("Unknow duration");t.duration_label=""}t.tutoplayed=_("on {NBR} sessions").replace("{NBR}",t.did_not_play_before);t.nb_rating>0?t.rating=Math.round(10*t.rating)/10:t.rating="-";t.player_avatar_url=getPlayerAvatar(t.player_id,t.player_avatar,32);t.current_public_tutorial="";if("beta"==t.tutorial_status)t.emblemclass="emblemtutobeta ttbetatuto";else if("alpha"==t.tutorial_status)t.emblemclass="emblemtutoalpha ttalphatuto";else if("rejected"==t.tutorial_status)t.emblemclass="emblemtutorejected ttrejectedtuto";else if("public"==t.tutorial_status){t.emblemclass="emblemtutopublic ttpublictuto";t.current_public_tutorial="current_public_tutorial"}t.buttons="";const a=["developer","maintainer"].includes(t.role)||this.is_admin;if(a){t.buttons+='<div><button type="button" id="tuto_override_js_version_'+t.tutorial_id+'" class="bgabutton bgabutton_blue" style="position: relative; z-index: 1;">'+_("Override JS version")+"</button></div>";if("beta"==t.tutorial_status){t.buttons+='<div><a id="tuto_set_public_'+t.tutorial_id+'" href="#" class="bgabutton bgabutton_blue tuto_set">'+_("Make it official!")+"</a></div>";t.buttons+='<div><a id="tuto_set_rejected_'+t.tutorial_id+'" href="#" class="bgabutton bgabutton_gray tuto_set">'+_("Reject")+"</a></div>"}else if("alpha"==t.tutorial_status){t.buttons+='<div><a id="tuto_set_beta_'+t.tutorial_id+'" href="#" class="bgabutton bgabutton_blue tuto_set">'+_("Set to BETA")+"</a></div>";t.buttons+='<div><a id="tuto_set_rejected_'+t.tutorial_id+'" href="#" class="bgabutton bgabutton_gray tuto_set">'+_("Reject")+"</a></div>"}else"rejected"==t.tutorial_status?t.buttons+='<div><a id="tuto_set_alpha_'+t.tutorial_id+'" href="#" class="bgabutton bgabutton_blue tuto_set">'+_("Set to ALPHA")+"</a></div>":"public"==t.tutorial_status&&(t.buttons+='<div><a id="tuto_set_rejected_'+t.tutorial_id+'" href="#" class="bgabutton bgabutton_gray tuto_set">'+_("Remove")+"</a></div>")}null===t.tutorial_steps_&&(t.steps_nbr="?");t.date=t.publish_date;null===t.date&&(t.date="-");$("tuto_stat_place_"+t.tutorial_id)?e.place(this.format_string(this.jstpl_tutorial,t),$("tuto_stat_place_"+t.tutorial_id),"after"):e.place(this.format_string(this.jstpl_tutorial,t),$("tutorial_list_"+t.game_id));e.query("#tutorial_stat_"+t.tutorial_id+" .tuto_set").connect("onclick",this,"onSetTuto");a&&document.getElementById(`tuto_override_js_version_${t.tutorial_id}`).addEventListener("click",e=>this.onTutoOverrideClick(e,t))}},onSetTuto:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[3],a=t.currentTarget.id.split("_")[2],n="";"rejected"==a?n=_("This tutorial will be archived and won't be proposed anymore to players or reviewers. Are you sure?"):"beta"==a?n=_("This tutorial will be proposed to random players to check if it is good enough. Are you sure?"):"public"==a?n=_("Warning: this tutorial will be the official tutorial for this game, and all existing tutorial will be archived (with their translations lost). Are you sure?"):"alpha"==a&&(n=_("This tutorial will be proposed (again) to reviewers for evalation. Are you sure?"));this.confirmationDialog(n,e.hitch(this,function(){this.ajaxcall("/tutoriallist/tutoriallist/setTutoAs.html",{id:i,status:a},this,function(t){e.place('<div id="tuto_stat_place_'+i+'"></div>',"tutorial_stat_"+i,"after");e.destroy("tutorial_stat_"+i);for(var a in t.tutorials)this.insert_tutorial(t.tutorials[a],!0)})}))},onTutoOverrideClick:function(t,i){t.stopPropagation();this.askForValueDialog(_("Override tutorial gameversion"),t=>{const a=i.tutorial_id;this.ajaxcall("/tutoriallist/tutoriallist/overrideGameversion.html",{id:a,version:t},this,t=>{this.showMessage(_("Updated! Please make sure the tutorial is still working as expected."),"info");e.place(`<div id="tuto_stat_place_${a}"></div>`,`tutorial_stat_${a}`,"after");e.destroy("tutorial_stat_"+a);for(var i in t.tutorials)this.insert_tutorial(t.tutorials[i],!0)})},`${_("Current game version override:")} <strong>${i.gameversion_override||_("None")}</strong>. ${_("Leave it empty to remove game version override.")}`)},onSeeMore:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[3];for(var a in this.tutorials)this.tutorials[a].game_id==i&&this.insert_tutorial(this.tutorials[a],!0);e.destroy(t.currentTarget);this.configureTutorialElements()}})})},"ebg/site/welcome":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/mainsitemodule"],function(e,t,i){return t("ebg.site.welcome",ebg.core.mainsitemodule,{constructor:function(){},doesNeedServerSideLoad:function(){return!1},onLoad:function(e){document.documentElement.classList.add("bga-white-background");mainsite.setPageTitle(_("Play board games online !"),_("Home"));this.homePageComponent=new i.ms.homepage.BgaHomepage({target:document.querySelector("#main-content")})},onOnUnload:function(){document.documentElement.classList.remove("bga-white-background");this.homePageComponent&&this.homePageComponent.$destroy()}})})},"dojo/selector/acme":function(){define(["../dom","../sniff","../_base/array","../_base/lang","../_base/window"],function(e,t,i,a,n){var o=a.trim,s=i.forEach,r=function(){return n.doc},l="BackCompat"==r().compatMode,d=">~+",c=!1,u=function(){return!0},h=function(e){d.indexOf(e.slice(-1))>=0?e+=" * ":e+=" ";for(var t,i,a=function(t,i){return o(e.slice(t,i))},n=[],s=-1,r=-1,l=-1,u=-1,h=-1,p=-1,_=-1,m="",g="",f=0,b=e.length,y=null,v=null,w=function(){!function(){if(p>=0){y.id=a(p,f).replace(/\\/g,"");p=-1}}();!function(){if(_>=0){var e=_==f?null:a(_,f);y[d.indexOf(e)<0?"tag":"oper"]=e;_=-1}}();!function(){if(h>=0){y.classes.push(a(h+1,f).replace(/\\/g,""));h=-1}}()},x=function(){w();u>=0&&y.pseudos.push({name:a(u+1,f)});y.loops=y.pseudos.length||y.attrs.length||y.classes.length;y.oquery=y.query=a(i,f);y.otag=y.tag=y.oper?null:y.tag||"*";y.tag&&(y.tag=y.tag.toUpperCase());if(n.length&&n[n.length-1].oper){y.infixOper=n.pop();y.query=y.infixOper.query+" "+y.query}n.push(y);y=null};m=g,g=e.charAt(f),f<b;f++)if("\\"!=m){if(!y){i=f;y={query:null,pseudos:[],attrs:[],classes:[],tag:null,oper:null,id:null,getTag:function(){return c?this.otag:this.tag}};_=f}if(t)g==t&&(t=null);else if("'"!=g&&'"'!=g)if(s>=0){if("]"==g){v.attr?v.matchFor=a(l||s+1,f):v.attr=a(s+1,f);var k=v.matchFor;k&&('"'!=k.charAt(0)&&"'"!=k.charAt(0)||(v.matchFor=k.slice(1,-1)));v.matchFor&&(v.matchFor=v.matchFor.replace(/\\/g,""));y.attrs.push(v);v=null;s=l=-1}else if("="==g){var C="|~^$*".indexOf(m)>=0?m:"";v.type=C+g;v.attr=a(s+1,f-C.length);l=f+1}}else if(r>=0){if(")"==g){u>=0&&(v.value=a(r+1,f));u=r=-1}}else if("#"==g){w();p=f+1}else if("."==g){w();h=f}else if(":"==g){w();u=f}else if("["==g){w();s=f;v={}}else if("("==g){if(u>=0){v={name:a(u+1,f),value:null};y.pseudos.push(v)}r=f}else" "==g&&m!=g&&x();else t=g}return n},p=function(e,t){return e?t?function(){return e.apply(window,arguments)&&t.apply(window,arguments)}:e:t},_=function(e,t){var i=t||[];e&&i.push(e);return i},m=function(e){return 1==e.nodeType},g=function(e,t){return e?"class"==t?e.className||"":"for"==t?e.htmlFor||"":"style"==t?e.style.cssText||"":(c?e.getAttribute(t):e.getAttribute(t,2))||"":""},f={"*=":function(e,t){return function(i){return g(i,e).indexOf(t)>=0}},"^=":function(e,t){return function(i){return 0==g(i,e).indexOf(t)}},"$=":function(e,t){return function(i){var a=" "+g(i,e),n=a.lastIndexOf(t);return n>-1&&n==a.length-t.length}},"~=":function(e,t){var i=" "+t+" ";return function(t){return(" "+g(t,e)+" ").indexOf(i)>=0}},"|=":function(e,t){var i=t+"-";return function(a){var n=g(a,e);return n==t||0==n.indexOf(i)}},"=":function(e,t){return function(i){return g(i,e)==t}}},b=r().documentElement,y=!(b.nextElementSibling||"nextElementSibling"in b),v=y?"nextSibling":"nextElementSibling",w=y?"previousSibling":"previousElementSibling",x=y?m:u,k=function(e){for(;e=e[w];)if(x(e))return!1;return!0},C=function(e){for(;e=e[v];)if(x(e))return!1;return!0},T=function(e){var i=e.parentNode,a=0,n=(i=7!=i.nodeType?i:i.nextSibling).children||i.childNodes,o=e._i||e.getAttribute("_i")||-1,s=i._l||(void 0!==i.getAttribute?i.getAttribute("_l"):-1);if(!n)return-1;var r=n.length;if(s==r&&o>=0&&s>=0)return o;t("ie")&&void 0!==i.setAttribute?i.setAttribute("_l",r):i._l=r;o=-1;for(var l=i.firstElementChild||i.firstChild;l;l=l[v])if(x(l)){t("ie")?l.setAttribute("_i",++a):l._i=++a;e===l&&(o=a)}return o},j=function(e){return!(T(e)%2)},S=function(e){return T(e)%2},$={checked:function(e,t){return function(e){return!!("checked"in e?e.checked:e.selected)}},disabled:function(e,t){return function(e){return e.disabled}},enabled:function(e,t){return function(e){return!e.disabled}},"first-child":function(){return k},"last-child":function(){return C},"only-child":function(e,t){return function(e){return k(e)&&C(e)}},empty:function(e,t){return function(e){for(var t=e.childNodes,i=e.childNodes.length-1;i>=0;i--){var a=t[i].nodeType;if(1===a||3==a)return!1}return!0}},contains:function(e,t){var i=t.charAt(0);'"'!=i&&"'"!=i||(t=t.slice(1,-1));return function(e){return e.innerHTML.indexOf(t)>=0}},not:function(e,t){var i=h(t)[0],a={el:1};"*"!=i.tag&&(a.tag=1);i.classes.length||(a.classes=1);var n=A(i,a);return function(e){return!n(e)}},"nth-child":function(e,t){var i=parseInt;if("odd"==t)return S;if("even"==t)return j;if(-1!=t.indexOf("n")){var a=t.split("n",2),n=a[0]?"-"==a[0]?-1:i(a[0]):1,o=a[1]?i(a[1]):0,s=0,r=-1;if(n>0){if(o<0)o=o%n&&n+o%n;else if(o>0){o>=n&&(s=o-o%n);o%=n}}else if(n<0){n*=-1;if(o>0){r=o;o%=n}}if(n>0)return function(e){var t=T(e);return t>=s&&(r<0||t<=r)&&t%n==o};t=o}var l=i(t);return function(e){return T(e)==l}}},M=t("ie")<9||9==t("ie")&&t("quirks")?function(e){var t=e.toLowerCase();"class"==t&&(e="className");return function(i){return c?i.getAttribute(e):i[e]||i[t]}}:function(e){return function(t){return t&&t.getAttribute&&t.hasAttribute(e)}},A=function(e,t){if(!e)return u;var i=null;"el"in(t=t||{})||(i=p(i,m));"tag"in t||"*"!=e.tag&&(i=p(i,function(t){return t&&(c?t.tagName:t.tagName.toUpperCase())==e.getTag()}));"classes"in t||s(e.classes,function(e,t,a){var n=new RegExp("(?:^|\\s)"+e+"(?:\\s|$)");(i=p(i,function(e){return n.test(e.className)})).count=t});"pseudos"in t||s(e.pseudos,function(e){var t=e.name;$[t]&&(i=p(i,$[t](t,e.value)))});"attrs"in t||s(e.attrs,function(e){var t,a=e.attr;e.type&&f[e.type]?t=f[e.type](a,e.matchFor):a.length&&(t=M(a));t&&(i=p(i,t))});"id"in t||e.id&&(i=p(i,function(t){return!!t&&t.id==e.id}));i||"default"in t||(i=u);return i},E=function(e,t){var a=function(e){var t=[];try{t=Array.prototype.slice.call(e)}catch(n){for(var i=0,a=e.length;i<a;i++)t.push(e[i])}return t};e=e||u;return function(n,o,s){var r,l=0,d=[];d=a(n.children||n.childNodes);t&&i.forEach(d,function(e){1===e.nodeType&&(d=d.concat(a(e.getElementsByTagName("*"))))});for(;r=d[l++];)x(r)&&(!s||Y(r,s))&&e(r,l)&&o.push(r);return o}},N=function(e,t){for(var i=e.parentNode;i&&i!=t;)i=i.parentNode;return!!i},L={},D=function(t){var a=L[t.query];if(a)return a;var n=t.infixOper,o=n?n.oper:"",s=A(t,{el:1}),d="*"==t.tag,c=r().getElementsByClassName;if(o){var h={el:1};d&&(h.tag=1);s=A(t,h);"+"==o?a=function(e){return function(t,i,a){for(;t=t[v];)if(!y||m(t)){a&&!Y(t,a)||!e(t)||i.push(t);break}return i}}(s):"~"==o?a=function(e){return function(t,i,a){for(var n=t[v];n;){if(x(n)){if(a&&!Y(n,a))break;e(n)&&i.push(n)}n=n[v]}return i}}(s):">"==o&&(a=E(s))}else if(t.id){s=!t.loops&&d?u:A(t,{el:1,id:1});a=function(a,n){var o=e.byId(t.id,a.ownerDocument||a);if(a.ownerDocument&&!N(a,a.ownerDocument)){var r=11===a.nodeType?a.childNodes:[a];i.some(r,function(e){var i=E(function(e){return e.id===t.id},!0)(e,[]);if(i.length){o=i[0];return!1}})}if(o&&s(o))return 9==a.nodeType||N(o,a)?_(o,n):void 0}}else if(c&&/\{\s*\[native code\]\s*\}/.test(String(c))&&t.classes.length&&!l){s=A(t,{el:1,classes:1,id:1});var p=t.classes.join(" ");a=function(e,t,i){for(var a,n=_(0,t),o=0,r=e.getElementsByClassName(p);a=r[o++];)s(a,e)&&Y(a,i)&&n.push(a);return n}}else if(d||t.loops){s=A(t,{el:1,tag:1,id:1});a=function(e,i,a){for(var n,o=_(0,i),r=0,l=t.getTag(),d=l?e.getElementsByTagName(l):[];n=d[r++];)s(n,e)&&Y(n,a)&&o.push(n);return o}}else a=function(e,i,a){for(var n,o=_(0,i),s=0,r=t.getTag(),l=r?e.getElementsByTagName(r):[];n=l[s++];)Y(n,a)&&o.push(n);return o};return L[t.query]=a},P={},I={},R=function(e){var t=h(o(e));if(1==t.length){var i=D(t[0]);return function(e){var t=i(e,[]);t&&(t.nozip=!0);return t}}return function(e){return function(e,t){for(var i,a,n,o,s=_(e),r=t.length,l=0;l<r;l++){o=[];i=t[l];if(s.length-1>0){n={};o.nozip=!0}for(var d=D(i),c=0;a=s[c];c++)d(a,o,n);if(!o.length)break;s=o}return o}(e,t)}},F=t("ie")?"commentStrip":"nozip",O="querySelectorAll",B=!!r()[O],H=/\\[>~+]|n\+\d|([^ \\])?([>~+])([^ =])?/g,z=function(e,t,i,a){return i?(t?t+" ":"")+i+(a?" "+a:""):e},q=/([^[]*)([^\]]*])?/g,G=function(e,t,i){return t.replace(H,z)+(i||"")},W=function(e,i){e=e.replace(q,G);if(B){var a=I[e];if(a&&!i)return a}var n=P[e];if(n)return n;var o=e.charAt(0),s=-1==e.indexOf(" ");e.indexOf("#")>=0&&s&&(i=!0);if(B&&!i&&-1==d.indexOf(o)&&(!t("ie")||-1==e.indexOf(":"))&&!(l&&e.indexOf(".")>=0)&&-1==e.indexOf(":contains")&&-1==e.indexOf(":checked")&&-1==e.indexOf("|=")){var r=d.indexOf(e.charAt(e.length-1))>=0?e+" *":e;return I[e]=function(t){if(9==t.nodeType||s)try{var i=t[O](r);i[F]=!0;return i}catch(a){}return W(e,!0)(t)}}var c=e.match(/([^\s,](?:"(?:\\.|[^"])+"|'(?:\\.|[^'])+'|[^,])*)/g);return P[e]=c.length<2?R(e):function(e){for(var t,i=0,a=[];t=c[i++];)a=a.concat(R(t)(e));return a}},U=0,V=t("ie")?function(e){return c?e.getAttribute("_uid")||e.setAttribute("_uid",++U)||U:e.uniqueID}:function(e){return e._uid||(e._uid=++U)},Y=function(e,t){if(!t)return 1;var i=V(e);return t[i]?0:t[i]=1},X="_zipIdx",K=function(e,i){var a=(i=i||r()).ownerDocument||i;c="div"===a.createElement("div").tagName;var n=W(e)(i);return n&&n.nozip?n:function(e){if(e&&e.nozip)return e;if(!e||!e.length)return[];if(e.length<2)return[e[0]];var i,a,n=[];U++;if(t("ie")&&c){var o=U+"";for(i=0;i<e.length;i++)if((a=e[i])&&a.getAttribute(X)!=o){n.push(a);a.setAttribute(X,o)}}else if(t("ie")&&e.commentStrip)try{for(i=0;i<e.length;i++)(a=e[i])&&m(a)&&n.push(a)}catch(s){}else for(i=0;i<e.length;i++)if((a=e[i])&&a[X]!=U){n.push(a);a[X]=U}return n}(n)};K.filter=function(t,a,n){for(var o,s=[],r=h(a),l=1!=r.length||/[^\w#\.]/.test(a)?function(t){return-1!=i.indexOf(K(a,e.byId(n)),t)}:A(r[0]),d=0;o=t[d];d++)l(o)&&s.push(o);return s};return K})},"url:dijit/templates/Dialog.html":'<div class="dijitDialog" role="dialog" aria-labelledby="${id}_title">\n\t<div data-dojo-attach-point="titleBar" class="dijitDialogTitleBar">\n\t\t<span data-dojo-attach-point="titleNode" class="dijitDialogTitle" id="${id}_title"\n\t\t\t\trole="heading" level="1"></span>\n\t\t<span data-dojo-attach-point="closeButtonNode" class="dijitDialogCloseIcon" data-dojo-attach-event="ondijitclick: onCancel" title="${buttonCancel}" role="button" tabindex="-1">\n\t\t\t<span data-dojo-attach-point="closeText" class="closeText" title="${buttonCancel}">x</span>\n\t\t</span>\n\t</div>\n\t<div data-dojo-attach-point="containerNode" class="dijitDialogPaneContent"></div>\n\t${!actionBarTemplate}\n</div>\n\n',"url:dijit/templates/Tooltip.html":'<div class="dijitTooltip dijitTooltipLeft" id="dojoTooltip" data-dojo-attach-event="mouseenter:onMouseEnter,mouseleave:onMouseLeave"\n\t><div class="dijitTooltipConnector" data-dojo-attach-point="connectorNode"></div\n\t><div class="dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point="containerNode" role=\'alert\'></div\n></div>\n',"url:dijit/form/templates/TextBox.html":'<div class="dijit dijitReset dijitInline dijitLeft" id="widget_${id}" role="presentation"\n\t><div class="dijitReset dijitInputField dijitInputContainer"\n\t\t><input class="dijitReset dijitInputInner" data-dojo-attach-point=\'textbox,focusNode\' autocomplete="off"\n\t\t\t${!nameAttrSetting} type=\'${type}\'\n\t/></div\n></div>\n',"url:dijit/form/templates/ValidationTextBox.html":'<div class="dijit dijitReset dijitInline dijitLeft"\n\tid="widget_${id}" role="presentation"\n\t><div class=\'dijitReset dijitValidationContainer\'\n\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t/></div\n\t><div class="dijitReset dijitInputField dijitInputContainer"\n\t\t><input class="dijitReset dijitInputInner" data-dojo-attach-point=\'textbox,focusNode\' autocomplete="off"\n\t\t\t${!nameAttrSetting} type=\'${type}\'\n\t/></div\n></div>\n',"url:dijit/form/templates/DropDownBox.html":'<div class="dijit dijitReset dijitInline dijitLeft"\n\tid="widget_${id}"\n\trole="combobox"\n\taria-haspopup="true"\n\tdata-dojo-attach-point="_popupStateNode"\n\t><div class=\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\n\t\tdata-dojo-attach-point="_buttonNode" role="presentation"\n\t\t><input class="dijitReset dijitInputField dijitArrowButtonInner" value="&#9660; " type="text" tabIndex="-1" readonly="readonly" role="button presentation" aria-hidden="true"\n\t\t\t${_buttonInputDisabled}\n\t/></div\n\t><div class=\'dijitReset dijitValidationContainer\'\n\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t/></div\n\t><div class="dijitReset dijitInputField dijitInputContainer"\n\t\t><input class=\'dijitReset dijitInputInner\' ${!nameAttrSetting} type="${type}" autocomplete="off"\n\t\t\tdata-dojo-attach-point="textbox,focusNode" role="textbox"\n\t/></div\n></div>\n',"url:dijit/form/templates/Button.html":'<span class="dijit dijitReset dijitInline" role="presentation"\n\t><span class="dijitReset dijitInline dijitButtonNode"\n\t\tdata-dojo-attach-event="ondijitclick:__onClick" role="presentation"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdata-dojo-attach-point="titleNode,focusNode"\n\t\t\trole="button" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon" data-dojo-attach-point="iconNode"></span\n\t\t\t><span class="dijitReset dijitToggleButtonIconChar">&#x25CF;</span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tid="${id}_label"\n\t\t\t\tdata-dojo-attach-point="containerNode"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\n\t\tdata-dojo-attach-event="onclick:_onClick"\n\t\ttabIndex="-1" aria-hidden="true" data-dojo-attach-point="valueNode"\n/></span>\n',"url:dijit/form/templates/DropDownButton.html":'<span class="dijit dijitReset dijitInline"\n\t><span class=\'dijitReset dijitInline dijitButtonNode\'\n\t\tdata-dojo-attach-event="ondijitclick:__onClick" data-dojo-attach-point="_buttonNode"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdata-dojo-attach-point="focusNode,titleNode,_arrowWrapperNode,_popupStateNode"\n\t\t\trole="button" aria-haspopup="true" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon"\n\t\t\t\tdata-dojo-attach-point="iconNode"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tdata-dojo-attach-point="containerNode"\n\t\t\t\tid="${id}_label"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonInner"></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonChar">&#9660;</span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen" tabIndex="-1"\n\t\tdata-dojo-attach-event="onclick:_onClick" data-dojo-attach-point="valueNode" aria-hidden="true"\n/></span>\n',"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n',"url:dijit/templates/MenuItem.html":'<tr class="dijitReset" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<span role="presentation" class="dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"></span>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"\n\t\trole="presentation"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<span data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<span class="dijitInline dijitIcon dijitMenuExpand"></span>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</span>\n\t</td>\n</tr>\n',"url:dijit/templates/MenuSeparator.html":'<tr class="dijitMenuSeparator" role="separator">\n\t<td class="dijitMenuSeparatorIconCell">\n\t\t<div class="dijitMenuSeparatorTop"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n\t<td colspan="3" class="dijitMenuSeparatorLabelCell">\n\t\t<div class="dijitMenuSeparatorTop dijitMenuSeparatorLabel"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n</tr>\n',"url:dijit/form/templates/Select.html":'<table class="dijit dijitReset dijitInline dijitLeft"\n\tdata-dojo-attach-point="_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing=\'0\' cellpadding=\'0\'\n\trole="listbox" aria-haspopup="true"\n\t><tbody role="presentation"><tr role="presentation"\n\t\t><td class="dijitReset dijitStretch dijitButtonContents" role="presentation"\n\t\t\t><div class="dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point="containerNode,textDirNode" role="presentation"></div\n\t\t\t><div class="dijitReset dijitValidationContainer"\n\t\t\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t\t\t/></div\n\t\t\t><input type="hidden" ${!nameAttrSetting} data-dojo-attach-point="valueNode" value="${value}" aria-hidden="true"\n\t\t/></td\n\t\t><td class="dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\n\t\t\tdata-dojo-attach-point="titleNode" role="presentation"\n\t\t\t><input class="dijitReset dijitInputField dijitArrowButtonInner" value="&#9660; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n',"url:dijit/templates/TooltipDialog.html":'<div role="alertdialog" tabIndex="-1">\n\t<div class="dijitTooltipContainer" role="presentation">\n\t\t<div data-dojo-attach-point="contentsNode" class="dijitTooltipContents dijitTooltipFocusNode">\n\t\t\t<div data-dojo-attach-point="containerNode"></div>\n\t\t\t${!actionBarTemplate}\n\t\t</div>\n\t</div>\n\t<div class="dijitTooltipConnector" role="presentation" data-dojo-attach-point="connectorNode"></div>\n</div>\n',"url:dijit/templates/Calendar.html":'<div class="dijitCalendarContainer dijitInline" role="presentation" aria-labelledby="${id}_mddb ${id}_year">\n\t<div class="dijitReset dijitCalendarMonthContainer" role="presentation">\n\t\t<div class=\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point="decrementMonth">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitCalendarIncrementControl dijitCalendarDecrease" role="presentation"/>\n\t\t\t<span data-dojo-attach-point="decreaseArrowNode" class="dijitA11ySideArrow">-</span>\n\t\t</div>\n\t\t<div class=\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point="incrementMonth">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitCalendarIncrementControl dijitCalendarIncrease" role="presentation"/>\n\t\t\t<span data-dojo-attach-point="increaseArrowNode" class="dijitA11ySideArrow">+</span>\n\t\t</div>\n\t\t<div data-dojo-attach-point="monthNode" class="dijitInline"></div>\n\t</div>\n\t<table cellspacing="0" cellpadding="0" role="grid" data-dojo-attach-point="gridNode">\n\t\t<thead>\n\t\t\t<tr role="row">\n\t\t\t\t${!dayCellsHtml}\n\t\t\t</tr>\n\t\t</thead>\n\t\t<tbody data-dojo-attach-point="dateRowsNode" data-dojo-attach-event="ondijitclick: _onDayClick" class="dijitReset dijitCalendarBodyContainer">\n\t\t\t\t${!dateRowsHtml}\n\t\t</tbody>\n\t</table>\n\t<div class="dijitReset dijitCalendarYearContainer" role="presentation">\n\t\t<div class="dijitCalendarYearLabel">\n\t\t\t<span data-dojo-attach-point="previousYearLabelNode" class="dijitInline dijitCalendarPreviousYear" role="button"></span>\n\t\t\t<span data-dojo-attach-point="currentYearLabelNode" class="dijitInline dijitCalendarSelectedYear" role="button" id="${id}_year"></span>\n\t\t\t<span data-dojo-attach-point="nextYearLabelNode" class="dijitInline dijitCalendarNextYear" role="button"></span>\n\t\t</div>\n\t</div>\n</div>\n',"*now":function(e){e(['dojo/i18n!*preload*ebg/layer/nls/ly_metasite*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])}}});define("ebg/layer/ly_metasite",["dojo/_base/fx","dijit/Dialog","dojox/html/entities","dojo/string","dojo/fx","dojo/fx/easing","dojo/parser","dojo/io/iframe","dijit/Tooltip","dojox/uuid/generateRandomUuid","dojo/back","dojo/hash","dojox/dtl/filter/strings","dojox/dtl/filter/htmlstrings","dojo/i18n","dijit/form/FilteringSelect","dijit/Editor","dijit/_editor/plugins/FontChoice","dijit/_editor/plugins/TextColor","dijit/_editor/plugins/LinkDialog","dijit/_editor/plugins/ViewSource","dojox/gfx/path","dojox/gfx/svg","ebg/core/core","ebg/core/i18n","ebg/gamenotif","ebg/core/mainsite","ebg/core/soundManager","ebg/lazyload","ebg/site/account","ebg/site/arenasuggestions","ebg/site/award","ebg/site/bugs","ebg/site/community","ebg/site/controlpanel","ebg/site/doc","ebg/site/gamegurus","ebg/site/gameinprogress","ebg/site/gamelist","ebg/site/gamepanel","ebg/site/gamereview","ebg/site/group","ebg/site/headlines","ebg/site/lobby","ebg/site/moderation","ebg/site/newgroup","ebg/site/news","ebg/site/newtournament","ebg/site/page","ebg/site/player","ebg/site/playernotif","ebg/site/playerstat","ebg/site/preferences","ebg/site/premium","ebg/site/prestige","ebg/site/report","ebg/site/shopsupport","ebg/site/table","ebg/site/tablemanager","ebg/site/tournament","ebg/site/tournamentlist","ebg/site/translation","ebg/site/translationhq","ebg/site/tutorialfaq","ebg/site/tutoriallist","ebg/site/welcome"],function(e,t){return t("ebg.layer.ly_metasite",null,{})});